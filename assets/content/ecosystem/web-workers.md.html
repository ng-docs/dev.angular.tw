<header class="docs-header">
      <docs-breadcrumb></docs-breadcrumb>

      
  <!-- Page title -->
  <div class="docs-page-title">
    <h1 tabindex="-1" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="40bfhnilf20f4cpt7dpp912ls">用 Web Worker 处理后台进程</h1>
    <a class="docs-github-links" target="_blank" href="https://github.com/angular/angular/edit/main/adev/src/content/ecosystem/web-workers.md" title="Edit this page" aria-label="Edit this page">
      <!-- Pencil -->
      <docs-icon role="presentation">edit</docs-icon>
    </a>
  </div>
    </header>
    <p data-ng_translator_product="100" data-ng_translator_ref_id="97yr34lnk5ollxwvec5osonjv"><a href="https://developer.mozilla.org/docs/Web/API/Web_Workers_API" target="_blank">Web Worker</a>可让你在后台线程中运行占用CPU的计算，从而释放主线程以更新用户界面。 执行大量计算的应用程序，如生成计算机辅助设计（CAD）图纸或进行繁重的几何计算，可以使用 Web Worker来提高性能。</p>

    <div class="docs-alert docs-alert-helpful">
    <p data-ng_translator_product="100" data-ng_translator_ref_id="1rwu6nfsctgqzl9de80sr55vj"><strong>提示：</strong>Angular CLI 不支持在 Web Worker中运行自身。</p>

    </div>
    
  <h2 id="adding-a-web-worker">
    <a href="#adding-a-web-worker" class="docs-anchor" tabindex="-1" aria-label="Link to Adding a web worker" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="9tj6jrqzrx8m80p552amj53cg">添加 Web Worker</a>
  </h2>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="4k8z0r36tkhw8t52hb858wh6l">要把 Web Worker 添加到现有项目中，请使用 Angular CLI <code>ng generate</code> 命令。</p>
<div class="docs-code shell">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line">ng generate web-worker &lt;location&gt;</div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="dr3zh8ehdhbl3qqvhdz4uwr1t">你可以在应用的任何位置添加 Web Worker。比如，要把一个 Web Worker 添加到根组件 <code>src/app/app.component.ts</code>，请运行如下命令。</p>
<div class="docs-code shell">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line">ng generate web-worker app</div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="53hzaguzi3nse5kjl9mtvc9xz">该命令会执行以下操作。</p>

    <ol class="docs-ordered-list">
      <li><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="9j1u8p9lfllnuvhm15hc0f8ab">把你的项目配置为使用 Web Worker，如果还没有的话。</p>
</li>
<li><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="amgtcsx4e7x3dxopxge06djeq">把如下脚手架代码添加到 <code>src/app/app.worker.ts</code> 以接收消息。</p>
<div class="docs-code" header="src/app/app.worker.ts">
    <div class="docs-code-header"><h3>src/app/app.worker.ts</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'message'</span>, <span class="hljs-function">(<span class="hljs-params">{ data }</span>) =&gt;</span> {</div><div class="hljs-ln-line">   <span class="hljs-keyword">const</span> response = <span class="hljs-string">`worker response to <span class="hljs-subst">${data}</span>`</span>;</div><div class="hljs-ln-line">   <span class="hljs-title function_">postMessage</span>(response);</div><div class="hljs-ln-line"> });</div></code>
    </pre>
  </div></li>
<li><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="c7nj905eekbzsqjh9dknzueg6">把如下脚手架代码添加到 <code>src/app/app.component.ts</code> 以使用这个 Worker。</p>
<div class="docs-code" header="src/app/app.component.ts">
    <div class="docs-code-header"><h3>src/app/app.component.ts</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Worker</span> !== <span class="hljs-string">'undefined'</span>) {</div><div class="hljs-ln-line">   <span class="hljs-comment">// Create a new</span></div><div class="hljs-ln-line">   <span class="hljs-keyword">const</span> worker = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Worker</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">'./app.worker'</span>, <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>));</div><div class="hljs-ln-line">   worker.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">{ data }</span>) =&gt;</span> {</div><div class="hljs-ln-line">     <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`page got message: <span class="hljs-subst">${data}</span>`</span>);</div><div class="hljs-ln-line">   };</div><div class="hljs-ln-line">   worker.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">'hello'</span>);</div><div class="hljs-ln-line"> } <span class="hljs-keyword">else</span> {</div><div class="hljs-ln-line">   <span class="hljs-comment">// Web workers are not supported in this environment.</span></div><div class="hljs-ln-line">   <span class="hljs-comment">// You should add a fallback so that your program still executes correctly.</span></div><div class="hljs-ln-line"> }</div></code>
    </pre>
  </div></li>

    </ol>
    <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="e8wugpimyqurpqg0cvz2bv036">生成这个初始脚手架之后，你必须把代码重构成向这个 Worker 发送消息和从 Worker 接收消息，以便使用 Web Worker。</p>

    <div class="docs-alert docs-alert-important">
    <p data-ng_translator_product="100" data-ng_translator_ref_id="4c4jxyzhb3hv9i892bpptdrlp"><strong>重要：</strong> 某些环境或平台（如 
<code>@angular/platform-server</code> 用于
<a href="guide/ssr">服务端渲染</a>）不支持 web workers。</p>

    </div>
    <p data-ng_translator_product="100" data-ng_translator_ref_id="e6d51gkat1m2iqbgne4q8sr06">为了确保你的应用在这些环境中能够正常工作，你必须提供一个备用机制来执行工作线程本应执行的计算。</p>
