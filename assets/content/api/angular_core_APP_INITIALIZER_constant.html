<div class="api"><header class="docs-reference-header"><span class="docs-reference-category">@angular/core</span><div class="docs-reference-title"><div><h1>APP_INITIALIZER</h1><div class="docs-api-item-label" data-mode="full" data-type="constant">constant</div></div><a class="docs-github-links" target="_blank" href="https://github.com/angular/angular/blob/main/packages/core/src/application/application_init.ts#L134-L136" title="View source" aria-label="View source"><i role="presentation" aria-hidden="true" class="material-symbols-outlined">code</i></a></div><p class="docs-reference-description"></p><p data-ng_translator_product="100" data-ng_translator_ref_id="ar384unt6wned5ho82vykpg9q">一个 DI 令牌，你可以用来提供一个或多个初始化函数。</p><p></p><nav class="docs-pill-row"><a class="docs-pill" href="api/core/ApplicationInitStatus">ApplicationInitStatus</a></nav></header><div data-tab="API" data-tab-url="api"><div class="docs-reference-api-tab"><div class="docs-code"><pre class="docs-mini-scroll-track"><code><div class="hljs-ln-line "><span class="hljs-keyword">const</span> <span class="hljs-attr">APP_INITIALIZER</span>: <span class="hljs-title class_">InjectionToken</span>&lt;<span class="hljs-keyword">readonly</span> (<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span> | <span class="hljs-title class_">Observable</span>&lt;<span class="hljs-built_in">unknown</span>&gt; | <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">unknown</span>&gt;)[]&gt;;</div></code></pre></div></div></div><div data-tab="说明" data-tab-url="description"><div><p data-ng_translator_product="100" data-ng_translator_ref_id="ar384unt6wned5ho82vykpg9q">一个 DI 令牌，你可以用来提供一个或多个初始化函数。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="b3s6porn0om7o47a3aericzbn">所提供的函数是在应用程序启动时注入的，并在应用程序初始化期间执行。如果这些函数中的任何一个返回
Promise，则直到 Promise 被解析之前，初始化都不会完成。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="cmlnay4duyb9sq4jb60o9t94w">例如，你可以创建一个加载语言数据或外部配置的工厂函数，并将该函数提供给 
<code>APP_INITIALIZER</code> 令牌。该函数在应用引导过程中执行，并且所需数据在启动时可用。</p></div></div><div data-tab="用法说明" data-tab-url="usage-notes"><div><p data-ng_translator_product="100" data-ng_translator_ref_id="6g3z7lu5zvb87pyoslnt1ae04">以下示例阐明了如何使用 
<code>APP_INITIALIZER</code> 令牌和返回 Promise 的函数来配置多提供者。</p>
<h3 data-ng_translator_product="100" data-ng_translator_ref_id="1epxhf1mnk7uq67kc1d0xbnqd">带有 NgModule 的应用示例</h3>

      <div class="docs-code" role="group">
        <pre class="docs-mini-scroll-track">
          <code>
            <span class="hljs-ln-line"> function initializeApp(): <span class="hljs-built_in">Promise</span>&lt;any&gt; {</span><span class="hljs-ln-line">   <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-params">(resolve, reject)</span> =&gt;</span> {</span><span class="hljs-ln-line">     <span class="hljs-regexp">//</span> Do some asynchronous stuff</span><span class="hljs-ln-line">     resolve();</span><span class="hljs-ln-line">   });</span><span class="hljs-ln-line"> }</span><span class="hljs-ln-line"></span><span class="hljs-ln-line"> @NgModule({</span><span class="hljs-ln-line">  imports: [BrowserModule],</span><span class="hljs-ln-line">  declarations: [AppComponent],</span><span class="hljs-ln-line">  bootstrap: [AppComponent],</span><span class="hljs-ln-line">  providers: [{</span><span class="hljs-ln-line">    provide: APP_INITIALIZER,</span><span class="hljs-ln-line">    useFactory: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> initializeApp,</span><span class="hljs-ln-line">    multi: <span class="hljs-literal">true</span></span><span class="hljs-ln-line">   }]</span><span class="hljs-ln-line">  })</span><span class="hljs-ln-line"> <span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppModule</span> {}</span>
          </code>
        </pre>
      </div>
    <h3 data-ng_translator_product="100" data-ng_translator_ref_id="f46pgzn3c79ctur8hbfsj5huf">独立应用示例</h3>

      <div class="docs-code" role="group">
        <pre class="docs-mini-scroll-track">
          <code>
            <span class="hljs-ln-line">export function initializeApp(http: HttpClient) {</span><span class="hljs-ln-line">  return (): Promise&lt;any&gt; =&gt;</span><span class="hljs-ln-line">    <span class="hljs-built_in">firstValueFrom</span>(</span><span class="hljs-ln-line">      http</span><span class="hljs-ln-line">        .<span class="hljs-built_in">get</span>(<span class="hljs-string">"https://someUrl.com/api/user"</span>)</span><span class="hljs-ln-line">        .<span class="hljs-built_in">pipe</span>(<span class="hljs-built_in">tap</span>(user =&gt; { ... }))</span><span class="hljs-ln-line">    );</span><span class="hljs-ln-line">}</span><span class="hljs-ln-line"></span><span class="hljs-ln-line">bootstrapApplication(App, {</span><span class="hljs-ln-line">  providers: [</span><span class="hljs-ln-line">    <span class="hljs-built_in">provideHttpClient</span>(),</span><span class="hljs-ln-line">    {</span><span class="hljs-ln-line">      provide: APP_INITIALIZER,</span><span class="hljs-ln-line">      useFactory: initializeApp,</span><span class="hljs-ln-line">      multi: true,</span><span class="hljs-ln-line">      deps: [HttpClient],</span><span class="hljs-ln-line">    },</span><span class="hljs-ln-line">  ],</span><span class="hljs-ln-line">});</span><span class="hljs-ln-line"></span>
          </code>
        </pre>
      </div>
    <p data-ng_translator_product="100" data-ng_translator_ref_id="972y2gj7uj1g6fwrk48ktpyzp">还可以使用 
<code>APP_INITIALIZER</code> 令牌和返回可观察者的函数来配置多提供者，参见下例。注意：此示例中的 
<code>HttpClient</code> 用于演示目的，以阐明工厂函数如何与通过 DI 可用的其他提供者一起工作。</p>
<h3 data-ng_translator_product="100" data-ng_translator_ref_id="1epxhf1mnk7uq67kc1d0xbnqd">带有 NgModule 的应用示例</h3>

      <div class="docs-code" role="group">
        <pre class="docs-mini-scroll-track">
          <code>
            <span class="hljs-ln-line"> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initializeAppFactory</span>(<span class="hljs-params">httpClient: HttpClient</span>): (<span class="hljs-params"></span>) =&gt;</span> Observable&lt;any&gt; {</span><span class="hljs-ln-line">  <span class="hljs-keyword">return</span> () =&gt; httpClient.<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">"https://someUrl.com/api/user"</span>)</span><span class="hljs-ln-line">    .<span class="hljs-title function_ invoke__">pipe</span>(</span><span class="hljs-ln-line">       <span class="hljs-title function_ invoke__">tap</span>(user =&gt; { ... })</span><span class="hljs-ln-line">    );</span><span class="hljs-ln-line"> }</span><span class="hljs-ln-line"></span><span class="hljs-ln-line"> @<span class="hljs-title function_ invoke__">NgModule</span>({</span><span class="hljs-ln-line">   <span class="hljs-attr">imports</span>: [BrowserModule, HttpClientModule],</span><span class="hljs-ln-line">   <span class="hljs-attr">declarations</span>: [AppComponent],</span><span class="hljs-ln-line">   <span class="hljs-attr">bootstrap</span>: [AppComponent],</span><span class="hljs-ln-line">   <span class="hljs-attr">providers</span>: [{</span><span class="hljs-ln-line">     <span class="hljs-attr">provide</span>: APP_INITIALIZER,</span><span class="hljs-ln-line">     <span class="hljs-attr">useFactory</span>: initializeAppFactory,</span><span class="hljs-ln-line">     <span class="hljs-attr">deps</span>: [HttpClient],</span><span class="hljs-ln-line">     <span class="hljs-attr">multi</span>: <span class="hljs-literal">true</span></span><span class="hljs-ln-line">   }]</span><span class="hljs-ln-line"> })</span><span class="hljs-ln-line"> export <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppModule</span> </span>{}</span>
          </code>
        </pre>
      </div>
    <h3 data-ng_translator_product="100" data-ng_translator_ref_id="f46pgzn3c79ctur8hbfsj5huf">独立应用示例</h3>

      <div class="docs-code" role="group">
        <pre class="docs-mini-scroll-track">
          <code>
            <span class="hljs-ln-line"> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initializeAppFactory</span>(<span class="hljs-params">httpClient: HttpClient</span>): (<span class="hljs-params"></span>) =&gt;</span> Observable&lt;any&gt; {</span><span class="hljs-ln-line">  <span class="hljs-keyword">return</span> () =&gt; httpClient.<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">"https://someUrl.com/api/user"</span>)</span><span class="hljs-ln-line">    .<span class="hljs-title function_ invoke__">pipe</span>(</span><span class="hljs-ln-line">       <span class="hljs-title function_ invoke__">tap</span>(user =&gt; { ... })</span><span class="hljs-ln-line">    );</span><span class="hljs-ln-line"> }</span><span class="hljs-ln-line"></span><span class="hljs-ln-line"><span class="hljs-title function_ invoke__">bootstrapApplication</span>(App, {</span><span class="hljs-ln-line">  <span class="hljs-attr">providers</span>: [</span><span class="hljs-ln-line">    <span class="hljs-title function_ invoke__">provideHttpClient</span>(),</span><span class="hljs-ln-line">    {</span><span class="hljs-ln-line">      <span class="hljs-attr">provide</span>: APP_INITIALIZER,</span><span class="hljs-ln-line">      <span class="hljs-attr">useFactory</span>: initializeAppFactory,</span><span class="hljs-ln-line">      <span class="hljs-attr">multi</span>: <span class="hljs-literal">true</span>,</span><span class="hljs-ln-line">      <span class="hljs-attr">deps</span>: [HttpClient],</span><span class="hljs-ln-line">    },</span><span class="hljs-ln-line">  ],</span><span class="hljs-ln-line">});</span>
          </code>
        </pre>
      </div>
    </div></div></div>