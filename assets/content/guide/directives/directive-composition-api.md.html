<header class="docs-header">
      <docs-breadcrumb></docs-breadcrumb>

      
  <!-- Page title -->
  <div class="docs-page-title">
    <h1 tabindex="-1" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="8a1v1libqy1ysmkczr9wna5t8">指令组合 API</h1>
    <a class="docs-github-links" target="_blank" href="https://github.com/angular/angular/edit/main/adev/src/content/guide/directives/directive-composition-api.md" title="Edit this page" aria-label="Edit this page">
      <!-- Pencil -->
      <docs-icon role="presentation">edit</docs-icon>
    </a>
  </div>
    </header>
    <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="6d097y7skqha9j20sfq2xq4cc">Angular 指令提供了一种封装可复用行为的好方法 —— 指令可以将属性、CSS 类和事件侦听器应用于元素。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="5ws6ob45twscc2spkxm67g5da"><em>指令组合 API</em> 允许你从组件的 TypeScript 类<em>内部</em>将指令应用于组件的宿主元素。</p>

  <h2 id="adding-directives-to-a-component">
    <a href="#adding-directives-to-a-component" class="docs-anchor" tabindex="-1" aria-label="Link to Adding directives to a component" data-ng_translator_product="100" data-ng_translator_ref_id="bfznth9bruqo3y02n45jciu14">向组件添加指令</a>
  </h2>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="35z02jxvt7a2ebduo48nz2gda">你可以通过将 <code>hostDirectives</code> 属性添加到组件的装饰器来将指令应用于组件。我们称这样的指令为<em>宿主指令</em>。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="7vsgsro5a7qeoru36zp6ps9o3">在此示例中，我们将指令 <code>MenuBehavior</code> 应用于 <code>AdminMenu</code> 的宿主元素。这类似于将 <code>MenuBehavior</code> 应用于模板中的 <code>&lt;admin-menu&gt;</code> 元素。</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-meta">@Component</span>({</div><div class="hljs-ln-line">  <span class="hljs-attr">standalone</span>: <span class="hljs-literal">true</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">selector</span>: <span class="hljs-string">'admin-menu'</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">template</span>: <span class="hljs-string">'admin-menu.html'</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">hostDirectives</span>: [<span class="hljs-title class_">MenuBehavior</span>],</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AdminMenu</span> { }</div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_ref_id="4f9ukyoo4cu8hn4xfxzv1wttj">当框架渲染组件时，Angular 还会创建每个宿主指令的实例。这些指令的宿主绑定应用于组件的宿主元素。默认情况下，宿主指令的输入和输出不会作为组件公共 API 的一部分公开。有关更多信息，请参见下文的 
<a href="#including-inputs-and-outputs">包括输入和输出</a>。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="7h9j7dah45e32dz1vn7kydiuw"><strong>Angular 会在编译时静态应用宿主指令</strong>。你不能在运行时动态添加指令。</p>
<p><strong data-ng_translator_product="100" data-ng_translator_ref_id="8eekstmo1fmiko3k0d2xxavrs">在 
<code>hostDirectives</code> 中使用的指令必须是 
<code>standalone: true</code>。</strong></p>
<p><strong data-ng_translator_product="100" data-ng_translator_ref_id="2vj93cjpu91iuozde11493q1v">Angular 会忽略应用在 
<code>hostDirectives</code> 属性中的指令的 
<code>selector</code>。</strong></p>

  <h2 id="including-inputs-and-outputs">
    <a href="#including-inputs-and-outputs" class="docs-anchor" tabindex="-1" aria-label="Link to Including inputs and outputs" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="buwbz4db0oufcnpjc6hf6azr6">包含输入属性和输出属性</a>
  </h2>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="dbk6kqocg818k13k81mt6yyr3">默认情况下，当你将 <code>hostDirectives</code> 应用于组件时，宿主指令的输入属性和输出属性不会包含在组件的 API 中。你可以通过扩展 <code>hostDirectives</code> 中的条目来在组件的 API 中显式包含输入和输出：</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-meta">@Component</span>({</div><div class="hljs-ln-line">  <span class="hljs-attr">standalone</span>: <span class="hljs-literal">true</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">selector</span>: <span class="hljs-string">'admin-menu'</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">template</span>: <span class="hljs-string">'admin-menu.html'</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">hostDirectives</span>: [{</div><div class="hljs-ln-line">    <span class="hljs-attr">directive</span>: <span class="hljs-title class_">MenuBehavior</span>,</div><div class="hljs-ln-line">    <span class="hljs-attr">inputs</span>: [<span class="hljs-string">'menuId'</span>],</div><div class="hljs-ln-line">    <span class="hljs-attr">outputs</span>: [<span class="hljs-string">'menuClosed'</span>],</div><div class="hljs-ln-line">  }],</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AdminMenu</span> { }</div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="2a3kwvu0e0pfmbjpllepgsv7i">通过显式指定输入和输出，使用 <code>hostDirective</code> 的组件的使用者可以将它们绑定在模板中：</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-tag">&lt;<span class="hljs-name">admin-menu</span> <span class="hljs-attr">menuId</span>=<span class="hljs-string">"top-menu"</span> (<span class="hljs-attr">menuClosed</span>)=<span class="hljs-string">"logMenuClosed()"</span>&gt;</span></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="76n85hjd6yz6qh60isti0zr88">此外，你可以为 <code>hostDirective</code> 的输入和输出起别名来自定义组件的 API：</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-meta">@Component</span>({</div><div class="hljs-ln-line">  <span class="hljs-attr">standalone</span>: <span class="hljs-literal">true</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">selector</span>: <span class="hljs-string">'admin-menu'</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">template</span>: <span class="hljs-string">'admin-menu.html'</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">hostDirectives</span>: [{</div><div class="hljs-ln-line">    <span class="hljs-attr">directive</span>: <span class="hljs-title class_">MenuBehavior</span>,</div><div class="hljs-ln-line">    <span class="hljs-attr">inputs</span>: [<span class="hljs-string">'menuId: id'</span>],</div><div class="hljs-ln-line">    <span class="hljs-attr">outputs</span>: [<span class="hljs-string">'menuClosed: closed'</span>],</div><div class="hljs-ln-line">  }],</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AdminMenu</span> { }</div></code>
    </pre>
  </div><div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-tag">&lt;<span class="hljs-name">admin-menu</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"top-menu"</span> (<span class="hljs-attr">closed</span>)=<span class="hljs-string">"logMenuClosed()"</span>&gt;</span></div></code>
    </pre>
  </div>
  <h2 id="adding-directives-to-another-directive">
    <a href="#adding-directives-to-another-directive" class="docs-anchor" tabindex="-1" aria-label="Link to Adding directives to another directive" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="ekgryson3ukx8dynkbxh78gty">将指令添加到另一个指令中</a>
  </h2>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="3841u34bqq02ly39zpb3ih9x9">除了组件之外，你还可以将 <code>hostDirectives</code> 添加到其他指令。这启用了多个行为的可传递聚合能力。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="4djqwfu6szsadf0ht15g1pawy">在以下示例中，我们定义了两个指令，<code>Menu</code> 和 <code>Tooltip</code>。然后，我们会在 <code>MenuWithTooltip</code> 中组合这两个指令的行为。最后，我们将 <code>MenuWithTooltip</code> 应用到 <code>SpecializedMenuWithTooltip</code> 上。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="3xttbk8auccnhk2vw86h5mv4x">在模板中使用 <code>SpecializedMenuWithTooltip</code> 时，它会创建 <code>Menu</code>、<code>Tooltip</code> 和 <code>MenuWithTooltip</code> 的所有实例。这些指令的宿主绑定中的每一个都会应用于 <code>SpecializedMenuWithTooltip</code> 的宿主元素。</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-meta">@Directive</span>({...})</div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Menu</span> { }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Directive</span>({...})</div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Tooltip</span> { }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-comment">// MenuWithTooltip can compose behaviors from multiple other directives</span></div><div class="hljs-ln-line"><span class="hljs-meta">@Directive</span>({</div><div class="hljs-ln-line">  <span class="hljs-attr">standalone</span>: <span class="hljs-literal">true</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">hostDirectives</span>: [<span class="hljs-title class_">Tooltip</span>, <span class="hljs-title class_">Menu</span>],</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MenuWithTooltip</span> { }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-comment">// CustomWidget can apply the already-composed behaviors from MenuWithTooltip</span></div><div class="hljs-ln-line"><span class="hljs-meta">@Directive</span>({</div><div class="hljs-ln-line">  <span class="hljs-attr">standalone</span>: <span class="hljs-literal">true</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">hostDirectives</span>: [<span class="hljs-title class_">MenuWithTooltip</span>],</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpecializedMenuWithTooltip</span> { }</div></code>
    </pre>
  </div>
  <h2 id="host-directive-semantics">
    <a href="#host-directive-semantics" class="docs-anchor" tabindex="-1" aria-label="Link to Host directive semantics" data-ng_translator_product="100" data-ng_translator_ref_id="23msxy7v94bus6ywl0qxavacw">宿主指令语义</a>
  </h2>
  
  <h3 id="directive-execution-order">
    <a href="#directive-execution-order" class="docs-anchor" tabindex="-1" aria-label="Link to Directive execution order" data-ng_translator_product="100" data-ng_translator_ref_id="13x6o5s56edpkaqkyobjz9oh1">指令的执行顺序</a>
  </h3>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="cuikgzlmee9hp708dictk9nk7">宿主指令经历与在模板中直接使用的组件和指令相同的生命周期。然而，宿主指令总是<em>先于</em>它们所应用的组件或指令执行其构造函数、生命周期钩子和绑定。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="aytf36j1wcvhopntf3v2htwd">以下示例显示了宿主指令的最小化使用：</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-meta">@Component</span>({</div><div class="hljs-ln-line">  <span class="hljs-attr">standalone</span>: <span class="hljs-literal">true</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">selector</span>: <span class="hljs-string">'admin-menu'</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">template</span>: <span class="hljs-string">'admin-menu.html'</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">hostDirectives</span>: [<span class="hljs-title class_">MenuBehavior</span>],</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AdminMenu</span> { }</div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="3lvx2has93wkhvsd7lpoxcu7p">这里的执行顺序是：</p>

    <ol class="docs-ordered-list">
      <li data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="4u6sd4pqngp9zfpj1xelnv9sa"><code>MenuBehavior</code> 实例化</li>
<li data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="4n5cq9dnev1lwqhbi9qbvwrzg"><code>AdminMenu</code> 实例化</li>
<li data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="9quff6k5xi1fy8rxoxloqg0kw"><code>MenuBehavior</code> 接收输入（ <code>ngOnInit</code> ）</li>
<li data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="44apjcz2oj66djenrxdiwjyks"><code>AdminMenu</code> 接收输入（<code>ngOnInit</code>）</li>
<li data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="881trtoldxhtf2upj60g5v7rt"><code>MenuBehavior</code> 应用宿主绑定</li>
<li data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="22j5dc683xt5zl04ok0il14bf"><code>AdminMenu</code> 应用宿主绑定</li>

    </ol>
    <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="a02c9odxjrgn7lqmkjdcjvlcf">这种操作顺序意味着带有 <code>hostDirectives</code> 的组件可以重写（override）宿主指令指定的任何宿主绑定。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="525haxl4283e1e2vv0hbiimwl">展开宿主指令的嵌套链的操作顺序，如下例所示。</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-meta">@Directive</span>({...})</div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Tooltip</span> { }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Directive</span>({</div><div class="hljs-ln-line">  <span class="hljs-attr">standalone</span>: <span class="hljs-literal">true</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">hostDirectives</span>: [<span class="hljs-title class_">Tooltip</span>],</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomTooltip</span> { }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Directive</span>({</div><div class="hljs-ln-line">  <span class="hljs-attr">standalone</span>: <span class="hljs-literal">true</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">hostDirectives</span>: [<span class="hljs-title class_">CustomTooltip</span>],</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EvenMoreCustomTooltip</span> { }</div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="9xsdsy62sz91ii5rk01isruez">在上面的示例中，执行顺序是：</p>

    <ol class="docs-ordered-list">
      <li data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="2yioat4wd1bf4jzqcs9dmtrdh"><code>Tooltip</code> 实例化</li>
<li data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="6sz9w2687vzpkxghaoxq2ymxk"><code>CustomTooltip</code> 实例化</li>
<li data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="a3mpc1umjzhx31b5j2z4y63pp"><code>EvenMoreCustomTooltip</code> 实例化</li>
<li data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="1wpw7bh0bleqb1fxn7z1dgwm6"><code>Tooltip</code> 接收输入（<code>ngOnInit</code>）</li>
<li data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="cu7hhy4qavyl7ciojwlotz46q"><code>CustomTooltip</code> 接收输入（<code>ngOnInit</code>）</li>
<li data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="dfg1cm3c2f6ld1q5736if4pfv"><code>EvenMoreCustomTooltip</code> 接收输入（<code>ngOnInit</code>）</li>
<li data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="3v939gumd2siow60l6uysl5ax"><code>Tooltip</code> 应用宿主绑定</li>
<li data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="46m0mrul2vzlwkv1kn5647wu8"><code>CustomTooltip</code> 应用宿主绑定</li>
<li data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="chekmqubml9zqwwo34pc129lh"><code>EvenMoreCustomTooltip</code> 应用宿主绑定</li>

    </ol>
    
  <h3 id="dependency-injection">
    <a href="#dependency-injection" class="docs-anchor" tabindex="-1" aria-label="Link to Dependency injection" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="ev35fdpq1f46jvj853hmazgoj">依赖注入</a>
  </h3>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="brmjdpq54dqhlzq4f4nxcugo3">指定了 <code>hostDirectives</code> 的组件或指令可以注入这些宿主指令的实例，反之亦然。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="2rfnva1z92ijdxg6ggmc87u0s">当把宿主指令应用于组件时，组件和宿主指令都可以定义提供者。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="ds3avc82pdau0leelb4heixm3">如果带有 <code>hostDirectives</code> 的组件或指令以及这些宿主指令都提供相同的注入令牌，则带有 <code>hostDirectives</code> 的类定义的提供者会优先于宿主指令定义的提供者。</p>
