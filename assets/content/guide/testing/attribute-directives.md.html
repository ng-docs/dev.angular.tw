<header class="docs-header">
      <docs-breadcrumb></docs-breadcrumb>

      
  <!-- Page title -->
  <div class="docs-page-title">
    <h1 tabindex="-1" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="c7as3gaxqukb7eyo00s24tsv3">测试属性型指令</h1>
    <a class="docs-github-links" target="_blank" href="https://github.com/angular/angular/edit/main/adev/src/content/guide/testing/attribute-directives.md" title="Edit this page" aria-label="Edit this page">
      <!-- Pencil -->
      <docs-icon role="presentation">edit</docs-icon>
    </a>
  </div>
    </header>
    <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="52mr6q5j59157crygtiw1pr2f"><em>属性型指令</em>会修改元素、组件或其他指令的行为。它的名字反映了该指令的应用方式：作为宿主元素的一个属性。</p>

  <h2 id="testing-the-highlightdirective">
    <a href="#testing-the-highlightdirective" class="docs-anchor" tabindex="-1" aria-label="Link to Testing the <code>HighlightDirective</code>" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="488f50l8p5k1ue1hrv4ghlxq7">测试 <code>HighlightDirective</code></a>
  </h2>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="7l99bum16232tuyln885gc73e">本范例应用的 <code>HighlightDirective</code> 会根据数据绑定中的颜色或默认颜色（浅灰）来设置元素的背景色。它还会把该元素的自定义属性（<code>customProperty</code>）设置为 <code>true</code>，当然这除了示范本技术之外别无它用。</p>
<div class="docs-code" path="adev/src/content/examples/testing/src/app/shared/highlight.directive.ts" header="app/shared/highlight.directive.ts">
    <div class="docs-code-header"><h3>app/shared/highlight.directive.ts</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">Directive</span>, <span class="hljs-title class_">ElementRef</span>, <span class="hljs-title class_">Input</span>, <span class="hljs-title class_">OnChanges</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Directive</span>({<span class="hljs-attr">standalone</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">selector</span>: <span class="hljs-string">'[highlight]'</span>})</div><div class="hljs-ln-line"><span class="hljs-comment">/**</span></div><div class="hljs-ln-line"> * Set backgroundColor for the attached element to highlight color</div><div class="hljs-ln-line"> * and set the element's customProperty to true</div><div class="hljs-ln-line"> */</div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HighlightDirective</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">OnChanges</span> {</div><div class="hljs-ln-line">  defaultColor = <span class="hljs-string">'rgb(211, 211, 211)'</span>; <span class="hljs-comment">// lightgray</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-meta">@Input</span>(<span class="hljs-string">'highlight'</span>) bgColor = <span class="hljs-string">''</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> el: ElementRef</span>) {</div><div class="hljs-ln-line">    el.<span class="hljs-property">nativeElement</span>.<span class="hljs-property">style</span>.<span class="hljs-property">customProperty</span> = <span class="hljs-literal">true</span>;</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">ngOnChanges</span>(<span class="hljs-params"></span>) {</div><div class="hljs-ln-line">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">el</span>.<span class="hljs-property">nativeElement</span>.<span class="hljs-property">style</span>.<span class="hljs-property">backgroundColor</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">bgColor</span> || <span class="hljs-variable language_">this</span>.<span class="hljs-property">defaultColor</span>;</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="948ia9e8d857ilqnagccd2x8c">它在整个应用中都用到过，也许最简单的是在 <code>AboutComponent</code> 中：</p>
<div class="docs-code" path="adev/src/content/examples/testing/src/app/about/about.component.ts" header="app/about/about.component.ts">
    <div class="docs-code-header"><h3>app/about/about.component.ts</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {Component} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {HighlightDirective} <span class="hljs-keyword">from</span> <span class="hljs-string">'../shared/highlight.directive'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {TwainComponent} <span class="hljs-keyword">from</span> <span class="hljs-string">'../twain/twain.component'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">@Component({</div><div class="hljs-ln-line">  standalone: <span class="hljs-literal">true</span>,</div><div class="hljs-ln-line">  template: `<span class="language-javascript"></span></div><div class="hljs-ln-line">    &lt;h2 highlight=<span class="hljs-string">"skyblue"</span>&gt;<span class="hljs-title class_">About</span>&lt;/h2&gt;</div><div class="hljs-ln-line">    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>Quote of the day:<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span></div><div class="hljs-ln-line">    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">twain-quote</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">twain-quote</span>&gt;</span></span></div><div class="hljs-ln-line">  `,</div><div class="hljs-ln-line">  imports: [TwainComponent, HighlightDirective],</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AboutComponent</span> {}</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_ref_id="852ftqqnd66bmjyb1fsmioz4i">测试在 
<code>AboutComponent</code> 中具体使用 
<code>HighlightDirective</code> 只需要使用<a href="guide/testing/components-scenarios">组件测试场景</a>的<a href="guide/testing/components-scenarios#nested-component-tests">「嵌套组件测试」</a> 部分探索过的技术。</p>
<div class="docs-code" path="adev/src/content/examples/testing/src/app/about/about.component.spec.ts" visiblelines="12,13,14,15,16,17,18,19,20,21,22,23,24,25" header="app/about/about.component.spec.ts">
    <div class="docs-code-header"><h3>app/about/about.component.spec.ts</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {provideHttpClient} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/common/http'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {CUSTOM_ELEMENTS_SCHEMA} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {ComponentFixture, TestBed} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core/testing'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {UserService} <span class="hljs-keyword">from</span> <span class="hljs-string">'../model'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {TwainService} <span class="hljs-keyword">from</span> <span class="hljs-string">'../twain/twain.service'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {AboutComponent} <span class="hljs-keyword">from</span> <span class="hljs-string">'./about.component'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">let fixture: ComponentFixture&lt;AboutComponent&gt;;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">describe(<span class="hljs-string">'AboutComponent (highlightDirective)'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">  beforeEach(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">    fixture = TestBed.configureTestingModule({</div><div class="hljs-ln-line">      imports: [AboutComponent],</div><div class="hljs-ln-line">      providers: [provideHttpClient(), TwainService, UserService],</div><div class="hljs-ln-line">      schemas: [CUSTOM_ELEMENTS_SCHEMA],</div><div class="hljs-ln-line">    }).createComponent(AboutComponent);</div><div class="hljs-ln-line">    fixture.detectChanges(); <span class="hljs-regexp">//</span> initial binding</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  it(<span class="hljs-string">'should have skyblue &lt;h2&gt;'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">    const h2: HTMLElement = fixture.nativeElement.querySelector(<span class="hljs-string">'h2'</span>);</div><div class="hljs-ln-line">    const bgColor = h2.style.backgroundColor;</div><div class="hljs-ln-line">    expect(bgColor).toBe(<span class="hljs-string">'skyblue'</span>);</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line">});</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="82o235c0nc4zcys2mhs8okywn">但是，测试单个用例不太可能涉及指令的全部能力。要找到并测试那些使用了该指令的所有组件会很乏味、很脆弱，而且几乎不可能做到完全覆盖。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="7qfhxuagi401np7wr78s841k8"><em>纯类测试</em>可能会有一点帮助，但像这种属性型指令往往会操纵 DOM。孤立的单元测试不会触及 DOM，因此也无法给人带来对指令功效的信心。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="tqaqmzthn3yjge9is6nb69j">更好的解决方案是创建一个人工测试组件来演示应用该指令的所有方法。</p>
<div class="docs-code" path="adev/src/content/examples/testing/src/app/shared/highlight.directive.spec.ts" visiblelines="6,7,8,9,10,11,12,13,14" header="app/shared/highlight.directive.spec.ts (TestComponent)">
    <div class="docs-code-header"><h3 data-ng_translator_product="100" data-ng_translator_ref_id="edfmwd5bodc36ji1city9tzhk">app/shared/highlight.directive.spec.ts（TestComponent）</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {Component, DebugElement} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {ComponentFixture, TestBed} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core/testing'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {By} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/platform-browser'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {HighlightDirective} <span class="hljs-keyword">from</span> <span class="hljs-string">'./highlight.directive'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">@Component({</div><div class="hljs-ln-line">  standalone: <span class="hljs-literal">true</span>,</div><div class="hljs-ln-line">  template: `<span class="language-javascript"> &lt;h2 highlight=<span class="hljs-string">"yellow"</span>&gt;<span class="hljs-title class_">Something</span> <span class="hljs-title class_">Yellow</span>&lt;/h2&gt;</span></div><div class="hljs-ln-line">    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">highlight</span>&gt;</span>The Default (Gray)<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span></div><div class="hljs-ln-line">    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>No Highlight<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span></div><div class="hljs-ln-line">    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> #<span class="hljs-attr">box</span> [<span class="hljs-attr">highlight</span>]=<span class="hljs-string">"box.value"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"cyan"</span> /&gt;</span></span>`,</div><div class="hljs-ln-line">  imports: [HighlightDirective],</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TestComponent</span> {}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">describe(<span class="hljs-string">'HighlightDirective'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">  let fixture: ComponentFixture&lt;TestComponent&gt;;</div><div class="hljs-ln-line">  let des: DebugElement[]; <span class="hljs-regexp">//</span> the three elements w/ the directive</div><div class="hljs-ln-line">  let bareH2: DebugElement; <span class="hljs-regexp">//</span> the &lt;h2&gt; w/o the directive</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  beforeEach(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">    fixture = TestBed.configureTestingModule({</div><div class="hljs-ln-line">      imports: [HighlightDirective, TestComponent],</div><div class="hljs-ln-line">    }).createComponent(TestComponent);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    fixture.detectChanges(); <span class="hljs-regexp">//</span> initial binding</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-regexp">//</span> all elements <span class="hljs-keyword">with</span> an attached HighlightDirective</div><div class="hljs-ln-line">    des = fixture.debugElement.queryAll(By.directive(HighlightDirective));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-regexp">//</span> the h2 without the HighlightDirective</div><div class="hljs-ln-line">    bareH2 = fixture.debugElement.query(By.css(<span class="hljs-string">'h2:not([highlight])'</span>));</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-regexp">//</span> color tests</div><div class="hljs-ln-line">  it(<span class="hljs-string">'should have three highlighted elements'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">    expect(des.length).toBe(<span class="hljs-number">3</span>);</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  it(<span class="hljs-string">'should color 1st &lt;h2&gt; background "yellow"'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">    const bgColor = des[<span class="hljs-number">0</span>].nativeElement.style.backgroundColor;</div><div class="hljs-ln-line">    expect(bgColor).toBe(<span class="hljs-string">'yellow'</span>);</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  it(<span class="hljs-string">'should color 2nd &lt;h2&gt; background w/ default color'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">    const dir = des[<span class="hljs-number">1</span>].injector.get(HighlightDirective) <span class="hljs-keyword">as</span> HighlightDirective;</div><div class="hljs-ln-line">    const bgColor = des[<span class="hljs-number">1</span>].nativeElement.style.backgroundColor;</div><div class="hljs-ln-line">    expect(bgColor).toBe(dir.defaultColor);</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  it(<span class="hljs-string">'should bind &lt;input&gt; background to value color'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-regexp">//</span> easier to work <span class="hljs-keyword">with</span> nativeElement</div><div class="hljs-ln-line">    const input = des[<span class="hljs-number">2</span>].nativeElement <span class="hljs-keyword">as</span> HTMLInputElement;</div><div class="hljs-ln-line">    expect(input.style.backgroundColor).withContext(<span class="hljs-string">'initial backgroundColor'</span>).toBe(<span class="hljs-string">'cyan'</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    input.value = <span class="hljs-string">'green'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-regexp">//</span> Dispatch a DOM event so that Angular responds to the input value change.</div><div class="hljs-ln-line">    input.dispatchEvent(<span class="hljs-keyword">new</span> Event(<span class="hljs-string">'input'</span>));</div><div class="hljs-ln-line">    fixture.detectChanges();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    expect(input.style.backgroundColor).withContext(<span class="hljs-string">'changed backgroundColor'</span>).toBe(<span class="hljs-string">'green'</span>);</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  it(<span class="hljs-string">'bare &lt;h2&gt; should not have a customProperty'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">    expect(bareH2.properties[<span class="hljs-string">'customProperty'</span>]).toBeUndefined();</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-regexp">//</span> Removed <span class="hljs-literal">on</span> <span class="hljs-number">12</span>/<span class="hljs-number">02</span>/<span class="hljs-number">2016</span> <span class="hljs-keyword">when</span> ceased public discussion <span class="hljs-keyword">of</span> the `<span class="language-javascript"><span class="hljs-title class_">Renderer</span></span>`. Revive <span class="hljs-keyword">in</span> future?</div><div class="hljs-ln-line">  <span class="hljs-regexp">//</span> <span class="hljs-regexp">//</span> customProperty tests</div><div class="hljs-ln-line">  <span class="hljs-regexp">//</span> it(<span class="hljs-string">'all highlighted elements should have a true customProperty'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">  <span class="hljs-regexp">//</span>   const allTrue = des.map(de =&gt; !!de.properties[<span class="hljs-string">'customProperty'</span>]).every(v =&gt; v === <span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">  <span class="hljs-regexp">//</span>   expect(allTrue).toBe(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">  <span class="hljs-regexp">//</span> });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-regexp">//</span> injected directive</div><div class="hljs-ln-line">  <span class="hljs-regexp">//</span> attached HighlightDirective can be injected</div><div class="hljs-ln-line">  it(<span class="hljs-string">'can inject `HighlightDirective` in 1st &lt;h2&gt;'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">    const dir = des[<span class="hljs-number">0</span>].injector.get(HighlightDirective);</div><div class="hljs-ln-line">    expect(dir).toBeTruthy();</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  it(<span class="hljs-string">'cannot inject `HighlightDirective` in 3rd &lt;h2&gt;'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">    const dir = bareH2.injector.get(HighlightDirective, <span class="hljs-literal">null</span>);</div><div class="hljs-ln-line">    expect(dir).toBe(<span class="hljs-literal">null</span>);</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-regexp">//</span> DebugElement.providerTokens</div><div class="hljs-ln-line">  <span class="hljs-regexp">//</span> attached HighlightDirective should be listed <span class="hljs-keyword">in</span> the providerTokens</div><div class="hljs-ln-line">  it(<span class="hljs-string">'should have `HighlightDirective` in 1st &lt;h2&gt; providerTokens'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">    expect(des[<span class="hljs-number">0</span>].providerTokens).toContain(HighlightDirective);</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  it(<span class="hljs-string">'should not have `HighlightDirective` in 3rd &lt;h2&gt; providerTokens'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">    expect(bareH2.providerTokens).<span class="hljs-keyword">not</span>.toContain(HighlightDirective);</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line">});</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div><img alt="HighlightDirective spec in action" src="assets/images/guide/testing/highlight-directive-spec.png">


    <div class="docs-alert docs-alert-helpful">
    <p data-ng_translator_product="100" data-ng_translator_ref_id="exxbo5p8wabvs7a5afhgd4j1j"><strong>提示：</strong> 
<code>&lt;input&gt;</code> 情况将 
<code>HighlightDirective</code> 绑定到输入框中的颜色名称值。 初始值是单词 "cyan"，它应该是输入框的背景色。</p>

    </div>
    <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="6ou7jukpgi0ent9sl340xznfk">下面是对该组件的一些测试：</p>
<div class="docs-code" path="adev/src/content/examples/testing/src/app/shared/highlight.directive.spec.ts" visiblelines="21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67" header="app/shared/highlight.directive.spec.ts (selected tests)">
    <div class="docs-code-header"><h3 data-ng_translator_product="100" data-ng_translator_ref_id="wryo9gt6pxn30h671mize5sh">app/shared/highlight.directive.spec.ts（选定测试）</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {Component, DebugElement} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {ComponentFixture, TestBed} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core/testing'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {By} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/platform-browser'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {HighlightDirective} <span class="hljs-keyword">from</span> <span class="hljs-string">'./highlight.directive'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">@Component({</div><div class="hljs-ln-line">  standalone: <span class="hljs-literal">true</span>,</div><div class="hljs-ln-line">  template: `<span class="language-javascript"> &lt;h2 highlight=<span class="hljs-string">"yellow"</span>&gt;<span class="hljs-title class_">Something</span> <span class="hljs-title class_">Yellow</span>&lt;/h2&gt;</span></div><div class="hljs-ln-line">    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">highlight</span>&gt;</span>The Default (Gray)<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span></div><div class="hljs-ln-line">    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>No Highlight<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span></div><div class="hljs-ln-line">    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> #<span class="hljs-attr">box</span> [<span class="hljs-attr">highlight</span>]=<span class="hljs-string">"box.value"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"cyan"</span> /&gt;</span></span>`,</div><div class="hljs-ln-line">  imports: [HighlightDirective],</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TestComponent</span> {}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">describe(<span class="hljs-string">'HighlightDirective'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">  let fixture: ComponentFixture&lt;TestComponent&gt;;</div><div class="hljs-ln-line">  let des: DebugElement[]; <span class="hljs-regexp">//</span> the three elements w/ the directive</div><div class="hljs-ln-line">  let bareH2: DebugElement; <span class="hljs-regexp">//</span> the &lt;h2&gt; w/o the directive</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  beforeEach(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">    fixture = TestBed.configureTestingModule({</div><div class="hljs-ln-line">      imports: [HighlightDirective, TestComponent],</div><div class="hljs-ln-line">    }).createComponent(TestComponent);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    fixture.detectChanges(); <span class="hljs-regexp">//</span> initial binding</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-regexp">//</span> all elements <span class="hljs-keyword">with</span> an attached HighlightDirective</div><div class="hljs-ln-line">    des = fixture.debugElement.queryAll(By.directive(HighlightDirective));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-regexp">//</span> the h2 without the HighlightDirective</div><div class="hljs-ln-line">    bareH2 = fixture.debugElement.query(By.css(<span class="hljs-string">'h2:not([highlight])'</span>));</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-regexp">//</span> color tests</div><div class="hljs-ln-line">  it(<span class="hljs-string">'should have three highlighted elements'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">    expect(des.length).toBe(<span class="hljs-number">3</span>);</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  it(<span class="hljs-string">'should color 1st &lt;h2&gt; background "yellow"'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">    const bgColor = des[<span class="hljs-number">0</span>].nativeElement.style.backgroundColor;</div><div class="hljs-ln-line">    expect(bgColor).toBe(<span class="hljs-string">'yellow'</span>);</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  it(<span class="hljs-string">'should color 2nd &lt;h2&gt; background w/ default color'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">    const dir = des[<span class="hljs-number">1</span>].injector.get(HighlightDirective) <span class="hljs-keyword">as</span> HighlightDirective;</div><div class="hljs-ln-line">    const bgColor = des[<span class="hljs-number">1</span>].nativeElement.style.backgroundColor;</div><div class="hljs-ln-line">    expect(bgColor).toBe(dir.defaultColor);</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  it(<span class="hljs-string">'should bind &lt;input&gt; background to value color'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-regexp">//</span> easier to work <span class="hljs-keyword">with</span> nativeElement</div><div class="hljs-ln-line">    const input = des[<span class="hljs-number">2</span>].nativeElement <span class="hljs-keyword">as</span> HTMLInputElement;</div><div class="hljs-ln-line">    expect(input.style.backgroundColor).withContext(<span class="hljs-string">'initial backgroundColor'</span>).toBe(<span class="hljs-string">'cyan'</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    input.value = <span class="hljs-string">'green'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-regexp">//</span> Dispatch a DOM event so that Angular responds to the input value change.</div><div class="hljs-ln-line">    input.dispatchEvent(<span class="hljs-keyword">new</span> Event(<span class="hljs-string">'input'</span>));</div><div class="hljs-ln-line">    fixture.detectChanges();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    expect(input.style.backgroundColor).withContext(<span class="hljs-string">'changed backgroundColor'</span>).toBe(<span class="hljs-string">'green'</span>);</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  it(<span class="hljs-string">'bare &lt;h2&gt; should not have a customProperty'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">    expect(bareH2.properties[<span class="hljs-string">'customProperty'</span>]).toBeUndefined();</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-regexp">//</span> Removed <span class="hljs-literal">on</span> <span class="hljs-number">12</span>/<span class="hljs-number">02</span>/<span class="hljs-number">2016</span> <span class="hljs-keyword">when</span> ceased public discussion <span class="hljs-keyword">of</span> the `<span class="language-javascript"><span class="hljs-title class_">Renderer</span></span>`. Revive <span class="hljs-keyword">in</span> future?</div><div class="hljs-ln-line">  <span class="hljs-regexp">//</span> <span class="hljs-regexp">//</span> customProperty tests</div><div class="hljs-ln-line">  <span class="hljs-regexp">//</span> it(<span class="hljs-string">'all highlighted elements should have a true customProperty'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">  <span class="hljs-regexp">//</span>   const allTrue = des.map(de =&gt; !!de.properties[<span class="hljs-string">'customProperty'</span>]).every(v =&gt; v === <span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">  <span class="hljs-regexp">//</span>   expect(allTrue).toBe(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">  <span class="hljs-regexp">//</span> });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-regexp">//</span> injected directive</div><div class="hljs-ln-line">  <span class="hljs-regexp">//</span> attached HighlightDirective can be injected</div><div class="hljs-ln-line">  it(<span class="hljs-string">'can inject `HighlightDirective` in 1st &lt;h2&gt;'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">    const dir = des[<span class="hljs-number">0</span>].injector.get(HighlightDirective);</div><div class="hljs-ln-line">    expect(dir).toBeTruthy();</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  it(<span class="hljs-string">'cannot inject `HighlightDirective` in 3rd &lt;h2&gt;'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">    const dir = bareH2.injector.get(HighlightDirective, <span class="hljs-literal">null</span>);</div><div class="hljs-ln-line">    expect(dir).toBe(<span class="hljs-literal">null</span>);</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-regexp">//</span> DebugElement.providerTokens</div><div class="hljs-ln-line">  <span class="hljs-regexp">//</span> attached HighlightDirective should be listed <span class="hljs-keyword">in</span> the providerTokens</div><div class="hljs-ln-line">  it(<span class="hljs-string">'should have `HighlightDirective` in 1st &lt;h2&gt; providerTokens'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">    expect(des[<span class="hljs-number">0</span>].providerTokens).toContain(HighlightDirective);</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  it(<span class="hljs-string">'should not have `HighlightDirective` in 3rd &lt;h2&gt; providerTokens'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">    expect(bareH2.providerTokens).<span class="hljs-keyword">not</span>.toContain(HighlightDirective);</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line">});</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="3y2lc5hlzxsz1e3wn30k2l0na">一些技巧值得注意：</p>

  <ul class="docs-list">
    <li><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="5f8hiwv6q6n8ia5l7g4ciz39k"><code>By.directive</code> 谓词是一种获取那些<em>不知道类型</em>但都附有本指令的元素的好办法。</p>
</li>
<li><p data-ng_translator_product="100" data-ng_translator_ref_id="dyfmglmkorp5j4zj0hd4wuf1c">在 
<code>By.css('h2:not([highlight])')</code> 中的 
<a href="https://developer.mozilla.org/docs/Web/CSS/:not" target="_blank"><code>:not</code> 伪类</a> 有助于找到
<em>没有</em>指令的 
<code>&lt;h2&gt;</code> 元素。 
<code>By.css('*:not([highlight])')</code> 可找到
<em>任何</em>没有指令的元素。</p>
</li>
<li><p data-ng_translator_product="100" data-ng_translator_ref_id="62jhjeoo5samx3usffspniamf"><code>DebugElement.styles</code> 即使在没有真实浏览器的情况下，也能访问元素样式，这要归功于 
<code>DebugElement</code> 抽象。 但当抽象比起使用 
<code>nativeElement</code> 变得更复杂或不清晰时，请安心使用 nativeElement。</p>
</li>
<li><p data-ng_translator_product="100" data-ng_translator_ref_id="anfk4xvdtmxpkp654firbvrjb">Angular 将指令添加到应用指令的元素的注入器中。 默认颜色的测试使用第二个 
<code>&lt;h2&gt;</code> 的注入器来获取其 
<code>HighlightDirective</code> 实例及其 
<code>defaultColor</code>。</p>
</li>
<li><p data-ng_translator_product="100" data-ng_translator_ref_id="elf8tzmtdzst7usqd6pbk7zx"><code>DebugElement.properties</code> 允许访问由指令设置的人工自定义属性。</p>
</li>

  </ul>
  