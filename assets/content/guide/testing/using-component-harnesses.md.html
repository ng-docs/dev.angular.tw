<header class="docs-header">
      <docs-breadcrumb></docs-breadcrumb>

      
  <!-- Page title -->
  <div class="docs-page-title">
    <h1 tabindex="-1">在測試中使用元件測試工具</h1>
    <a class="docs-github-links" target="_blank" href="https://github.com/angular/angular/edit/main/adev/src/content/guide/testing/using-component-harnesses.md" title="Edit this page" aria-label="Edit this page">
      <!-- Pencil -->
      <docs-icon role="presentation">edit</docs-icon>
    </a>
  </div>
    </header>
    
  <h2 id="before-you-start">
    <a href="#before-you-start" class="docs-anchor" tabindex="-1" aria-label="Link to Before you start">開始之前</a>
  </h2>
  
    <div class="docs-alert docs-alert-tip">
    <p><strong>提示：</strong> 本指南假定你已閱讀過<a href="guide/testing/component-harnesses-overview">元件測試工具概覽指南</a>。如果你是首次使用元件測試工具，請先閱讀該指南。</p>

    </div>
    
  <h3 id="cdk-installation">
    <a href="#cdk-installation" class="docs-anchor" tabindex="-1" aria-label="Link to CDK Installation">CDK 安裝</a>
  </h3>
  <p><a href="https://material.angular.io/cdk/categories" target="_blank">元件開發工具包 (CDK)</a> 是一組用於建立元件的行為基元。要使用元件測試工具，請先從 npm 安裝 <code>@angular/cdk</code>。你可以使用 Angular CLI 從終端執行此操作：</p>
<div class="docs-code shell">
    
    <pre class="docs-mini-scroll-track">      <pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">ng</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> @angular/cdk</span></span></code></pre>
    </pre>
  </div>
  <h2 id="test-harness-environments-and-loaders">
    <a href="#test-harness-environments-and-loaders" class="docs-anchor" tabindex="-1" aria-label="Link to Test harness environments and loaders">測試工具環境和載入器</a>
  </h2>
  <p>你可以在不同的測試環境中使用元件測試工具。Angular CDK 支援兩種內建環境：</p>

  <ul class="docs-list">
    <li>使用 Angular 的 <code>TestBed</code> 進行單元測試</li>
<li>使用 <a href="https://developer.mozilla.org/en-US/docs/Web/WebDriver" target="_blank">WebDriver</a> 的端到端測試</li>

  </ul>
  <p>每個環境都提供一個 <strong>測試工具載入器</strong>。載入器會建立你在整個測試中使用的測試工具實例。有關受支援的測試環境的更具體指導，請參見下文。</p>
<p>其他測試環境需要自定義繫結。有關更多訊息，請參閱<a href="guide/testing/component-harnesses-testing-environments">為其他測試環境新增測試工具支援指南</a>。</p>

  <h3 id="using-the-loader-from-testbedharnessenvironment-for-unit-tests">
    <a href="#using-the-loader-from-testbedharnessenvironment-for-unit-tests" class="docs-anchor" tabindex="-1" aria-label="Link to Using the loader from <code>TestbedHarnessEnvironment</code> for unit tests">在單元測試中使用來自 <code>TestbedHarnessEnvironment</code> 的載入器</a>
  </h3>
  <p>對於單元測試，你可以從 <a href="https://material.angular.io/cdk/testing/api#TestbedHarnessEnvironment" target="_blank">TestbedHarnessEnvironment</a> 建立一個測試工具載入器。此環境使用 Angular 的 <code>TestBed</code> 建立的 <a href="api/core/testing/ComponentFixture">元件 fixture</a>。</p>
<p>要建立以 fixture 的根元素為根的測試工具載入器，請使用 <code>loader()</code> 方法：</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> fixture</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> TestBed.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">createComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(MyComponent);</span></span><span class="line"></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">// Create a harness loader from the fixture</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> loader</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> TestbedHarnessEnvironment.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">loader</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(fixture);</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">...</span></span><span class="line"></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">// Use the loader to get harness instances</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> myComponentHarness</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> loader.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">getHarness</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(MyComponent);</span></span></code></pre>
    </pre>
  </div><p>要為 fixture 之外的元素建立測試工具載入器，請使用 <code>documentRootLoader()</code> 方法。例如，顯示浮動元素或彈出視窗的程式碼通常會將 DOM 元素直接附著到文件主體，例如 Angular CDK 中的 <code>Overlay</code> 服務。</p>
<p>你還可以直接使用 <code>harnessForFixture()</code> 為 fixture 根元素處的測試工具直接建立一個測試工具載入器。</p>

  <h3 id="using-the-loader-from-seleniumwebdriverharnessenvironment-for-end-to-end-tests">
    <a href="#using-the-loader-from-seleniumwebdriverharnessenvironment-for-end-to-end-tests" class="docs-anchor" tabindex="-1" aria-label="Link to Using the loader from <code>SeleniumWebDriverHarnessEnvironment</code> for end-to-end tests">在端到端測試中使用來自 <code>SeleniumWebDriverHarnessEnvironment</code> 的載入器</a>
  </h3>
  <p>對於基於 WebDriver 的端到端測試，你可以使用 <code>SeleniumWebDriverHarnessEnvironment</code> 建立一個測試工具載入器。</p>
<p>使用 <code>loader()</code> 方法獲取當前 HTML 文件的測試工具載入器實例，該實例以文件的根元素為根。此環境使用 WebDriver 用戶端。</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> wd</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> webdriver</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">WebDriver</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> getMyWebDriverClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">();</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> loader</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> SeleniumWebDriverHarnessEnvironment.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">loader</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(wd);</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">...</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> myComponentHarness</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> loader.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">getHarness</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(MyComponent);</span></span></code></pre>
    </pre>
  </div>
  <h2 id="using-a-harness-loader">
    <a href="#using-a-harness-loader" class="docs-anchor" tabindex="-1" aria-label="Link to Using a harness loader">使用測試工具載入器</a>
  </h2>
  <p>測試工具載入器實例對應於特定的 DOM 元素，並用於為該特定元素下的元素建立元件測試工具實例。</p>
<p>要獲取元素的第一個實例的 <code>ComponentHarness</code>，請使用 <code>getHarness()</code> 方法。要獲取所有 <code>ComponentHarness</code> 實例，請使用 <code>getAllHarnesses()</code> 方法。</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">// Get harness for first instance of the element</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> myComponentHarness</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> loader.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">getHarness</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(MyComponent);</span></span><span class="line"></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">// Get harnesses for all instances of the element</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> myComponentHarnesses</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> loader.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">getHarnesses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(MyComponent);</span></span></code></pre>
    </pre>
  </div><p>例如，考慮一個可複用的對話框按鈕元件，該組件在單擊時開啟一個對話框。它包含以下元件，每個元件都有一個對應的測試工具：</p>

  <ul class="docs-list">
    <li><code>MyDialogButton</code>（組合了 <code>MyButton</code> 和 <code>MyDialog</code>，並提供便捷的 API）</li>
<li><code>MyButton</code>（一個標準的按鈕元件）</li>
<li><code>MyDialog</code>（一個透過 <code>MyDialogButton</code> 在點選時附著到 <code>document.body</code> 的對話框）</li>

  </ul>
  <p>以下測試為每個元件載入測試工具：</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> fixture</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> ComponentFixture</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">MyDialogButton</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;;</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> loader</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> HarnessLoader</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> rootLoader</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> HarnessLoader</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span><span class="line"></span><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">beforeEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  fixture </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> TestBed.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">createComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(MyDialogButton);</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  loader </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> TestbedHarnessEnvironment.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">loader</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(fixture);</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  rootLoader </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> TestbedHarnessEnvironment.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">documentRootLoader</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(fixture);</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">});</span></span><span class="line"></span><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">it</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">'loads harnesses'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {</span></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">  // Load a harness for the bootstrapped component with `harnessForFixture`</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  dialogButtonHarness </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">      await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> TestbedHarnessEnvironment.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">harnessForFixture</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(fixture, MyDialogButtonHarness);</span></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">  // The button element is inside the fixture's root element, so we use `loader`.</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> buttonHarness</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> loader.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">getHarness</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(MyButtonHarness);</span></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">  // Click the button to open the dialog</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">  await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> buttonHarness.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">click</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">();</span></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">  // The dialog is appended to `document.body`, outside of the fixture's root element,</span></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">  // so we use `rootLoader` in this case.</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> dialogHarness</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> rootLoader.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">getHarness</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(MyDialogHarness);</span></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">  // ... make some assertions</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">});</span></span></code></pre>
    </pre>
  </div>
  <h3 id="harness-behavior-in-different-environments">
    <a href="#harness-behavior-in-different-environments" class="docs-anchor" tabindex="-1" aria-label="Link to Harness behavior in different environments">不同環境中的測試工具行為</a>
  </h3>
  <p>測試工具在所有環境中的行為可能不完全相同。在真實使用者互動與單元測試中生成的模擬事件之間，一些差異是不可避免的。Angular CDK 盡最大努力在可能的範圍內規範化行為。</p>

  <h3 id="interacting-with-child-elements">
    <a href="#interacting-with-child-elements" class="docs-anchor" tabindex="-1" aria-label="Link to Interacting with child elements">與子元素互動</a>
  </h3>
  <p>要與此測試工具載入器的根元素下方的元素進行互動，請使用子元素的 <code>HarnessLoader</code> 實例。對於子元素的第一個實例，請使用 <code>getChildLoader()</code> 方法。對於子元素的所有實例，請使用 <code>getAllChildLoaders()</code> 方法。</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> myComponentHarness</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> loader.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">getHarness</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(MyComponent);</span></span><span class="line"></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">// Get loader for first instance of child element with '.child' selector</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> childLoader</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> myComponentHarness.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">getLoader</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">'.child'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span><span class="line"></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">// Get loaders for all instances of child elements with '.child' selector</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> allChildLoaders</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> myComponentHarness.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">getAllChildLoaders</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">'.child'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span></code></pre>
    </pre>
  </div>
  <h3 id="filtering-harnesses">
    <a href="#filtering-harnesses" class="docs-anchor" tabindex="-1" aria-label="Link to Filtering harnesses">過濾測試工具</a>
  </h3>
  <p>當頁面包含特定元件的多個實例時，你可能希望根據元件的某些屬性進行過濾，以獲取特定的元件實例。你可以使用<strong>測試工具謂詞</strong>（一個用於將 <code>ComponentHarness</code> 類別與謂詞函式關聯的類別，謂詞函式可用於過濾元件實例）來做到這一點。</p>
<p>當你向 <code>HarnessLoader</code> 請求測試工具時，實際上是在提供 HarnessQuery。查詢可以是以下兩種情況之一：</p>

  <ul class="docs-list">
    <li>測試工具建構式函式。這隻會獲取該測試工具</li>
<li>一個 <code>HarnessPredicate</code>，它獲取根據一個或多個條件過濾的測試工具</li>

  </ul>
  <p><code>HarnessPredicate</code> 確實支援一些基礎過濾器（selector、ancestor），這些過濾器適用於任何擴充套件了 <code>ComponentHarness</code> 的東西。</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">// Example of loading a MyButtonComponentHarness with a harness predicate</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> disabledButtonPredicate</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> HarnessPredicate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(MyButtonComponentHarness, {selector: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">'[disabled]'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">});</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> disabledButton</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> loader.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">getHarness</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(disabledButtonPredicate);</span></span></code></pre>
    </pre>
  </div><p>但是，通常測試工具會實現一個靜態 <code>with()</code> 方法，該方法接受特定於元件的過濾選項並回傳 <code>HarnessPredicate</code>。</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">// Example of loading a MyButtonComponentHarness with a specific selector</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> button</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> loader.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">getHarness</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(MyButtonComponentHarness.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">({selector: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">'btn'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}))</span></span></code></pre>
    </pre>
  </div><p>有關更多詳細訊息，請參閱特定的測試工具文件，因為其他過濾選項特定於每個測試工具的實現。</p>

  <h2 id="using-test-harness-apis">
    <a href="#using-test-harness-apis" class="docs-anchor" tabindex="-1" aria-label="Link to Using test harness APIs">使用測試工具 API</a>
  </h2>
  <p>雖然每個測試工具都為其對應的元件定義了特定的 API，但它們都共享一個公共基底類別 <a href="https://material.angular.io/cdk/testing/api#ComponentHarness" target="_blank">ComponentHarness</a>。這個基底類別定義了一個靜態屬性 <code>hostSelector</code>，它將測試工具類別與 DOM 中元件的實例對應。</p>
<p>除此之外，任何給定測試工具的 API 都特定於其對應的元件；請參閱元件的文件以瞭解如何使用特定的測試工具。</p>
<p>例如，以下是使用 <a href="https://material.angular.io/components/slider/api#MatSliderHarness" target="_blank">Angular Material 滑區塊元件測試工具</a> 的元件的測試：</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">it</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">'should get value of slider thumb'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> slider</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> loader.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">getHarness</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(MatSliderHarness);</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> thumb</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> slider.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">getEndThumb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">();</span></span><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">    expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> thumb.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">getValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">()).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">toBe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">});</span></span></code></pre>
    </pre>
  </div>
  <h2 id="interop-with-angular-change-detection">
    <a href="#interop-with-angular-change-detection" class="docs-anchor" tabindex="-1" aria-label="Link to Interop with Angular change detection">與 Angular 變更檢測互操作</a>
  </h2>
  <p>預設情況下，測試工具在讀取 DOM 元素的狀態之前以及與 DOM 元素互動之後執行 Angular 的 <a href="https://angular.dev/best-practices/runtime-performance" target="_blank">變更檢測</a>。</p>
<p>有時你可能需要在測試中對變更檢測進行更精細的控制。例如，在非同步操作掛起時檢查元件的狀態。在這些情況下，請使用 <code>manualChangeDetection</code> 函式為程式碼區塊停用變更檢測的自動處理。</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">it</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">'checks state while async action is in progress'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> buttonHarness</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> loader.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">getHarness</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(MyButtonHarness);</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">  await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> manualChangeDetection</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> buttonHarness.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">click</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">();</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    fixture.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">detectChanges</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">();</span></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    // Check expectations while async click operation is in progress.</span></span><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">    expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">isProgressSpinnerVisible</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">()).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">toBe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> fixture.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">whenStable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">();</span></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    // Check expectations after async click operation complete.</span></span><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">    expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">isProgressSpinnerVisible</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">()).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">toBe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  });</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">});</span></span></code></pre>
    </pre>
  </div><p>幾乎所有的測試工具方法都是非同步的，並回傳一個 <code>Promise</code> 以支援以下各項：</p>

  <ul class="docs-list">
    <li>支援單元測試</li>
<li>支援端到端測試</li>
<li>使測試免受非同步行為更改的影響</li>

  </ul>
  <p>Angular 團隊建議使用 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function" target="_blank">await</a> 以提升測試的可讀性。呼叫 <code>await</code> 會阻塞你的測試的執行，直到相關的 <code>Promise</code> 求解。</p>
<p>有時，你可能想要同時執行多個操作，並等待它們全部完成，而不是按順序執行每個操作。例如，讀取單個元件的多個屬性（Property）。在這些情況下，請使用 <code>parallel</code> 函式來並行化這些操作。<code>parallel</code> 函式的工作方式類似於 <code>Promise.all</code>，同時還最佳化變更檢測檢查。</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">it</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">'reads properties in parallel'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> checkboxHarness</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> loader.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">getHarness</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(MyCheckboxHarness);</span></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">  // Read the checked and intermediate properties simultaneously.</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">checked</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">indeterminate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> parallel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> [</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    checkboxHarness.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">isChecked</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(),</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    checkboxHarness.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">isIndeterminate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">()</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  ]);</span></span><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">  expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(checked).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">toBe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">  expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(indeterminate).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">toBe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">});</span></span></code></pre>
    </pre>
  </div>