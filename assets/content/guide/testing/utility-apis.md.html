<header class="docs-header">
      <docs-breadcrumb></docs-breadcrumb>

      
  <!-- Page title -->
  <div class="docs-page-title">
    <h1 tabindex="-1" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="ebvbxxp2lwm71m7q7b2xvbvg4">测试实用工具 API</h1>
    <a class="docs-github-links" target="_blank" href="https://github.com/angular/angular/edit/main/adev/src/content/guide/testing/utility-apis.md" title="Edit this page" aria-label="Edit this page">
      <!-- Pencil -->
      <docs-icon role="presentation">edit</docs-icon>
    </a>
  </div>
    </header>
    <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="8trgspubuw3qk2vb89e3u31p5">本页面描述了一些最有用的 Angular 测试特性。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="cmjnovr9fisqgadb1m6qhhpcw">Angular 测试工具包括 
<code>TestBed</code>、
<code>ComponentFixture</code> 和一些控制测试环境的函数。
<a href="#testbed-api-summary"><code>TestBed</code></a> 和 
<a href="#component-fixture-api-summary"><code>ComponentFixture</code></a> 类将分别介绍。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="9xfmr3bkgdsj428agchzu9574">下面是一些独立函数的摘要，以使用频率排序：</p>

  <div class="docs-table docs-scroll-track-transparent">
    <table>
      <thead>
        <tr>
<th align="left" data-ng_translator_product="100" data-ng_translator_ref_id="7y4o0j30ltpz4br769esy6uld">函数</th>
<th align="left" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="3prlgfrx5eo2xqncnnob4crxu">详情</th>
</tr>

      </thead>
      <tbody>
        <tr>
<td align="left"><code>waitForAsync</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="9by72g18p0zfz1v2smbhvf3x2">在特殊的
<em>异步测试 Zone</em>中运行测试 (
<code>it</code>) 或设置 (
<code>beforeEach</code>) 函数的主体。参见 
<a href="guide/testing/components-scenarios#waitForAsync">waitForAsync</a>。</td>
</tr>
<tr>
<td align="left"><code>fakeAsync</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="5auuvf6w504j8p8coducwuqpn">在特殊的
<em>fakeAsync 测试 Zone</em>中运行测试 (
<code>it</code>) 的主体，启用线性控制流编码风格。参见 
<a href="guide/testing/components-scenarios#fake-async">fakeAsync</a>。</td>
</tr>
<tr>
<td align="left"><code>tick</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="ec1bfgtcmip2z7qliss8m8mwy">通过刷新
<em>定时器</em>和
<em>微任务</em>队列，模拟时间的流逝和待处理的异步活动的完成，均在
<em>fakeAsync 测试 Zone</em>内。好奇且专注的读者可能会喜欢这篇长博客文章，
<a href="https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules" target="_blank">"<em>任务、微任务、队列和调度</em>"</a>。接受一个可选参数，将虚拟时钟向前推进指定的毫秒数，清除该时间范围内调度的异步活动。参见 
<a href="guide/testing/components-scenarios#tick">tick</a>。</td>
</tr>
<tr>
<td align="left"><code>inject</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="c89pw6ob77qyqw0z6ka4dyof5">将当前 
<code>TestBed</code> 注入器中的一个或多个服务注入到测试函数中。不能注入由组件自身提供的服务。参见关于 
<a href="guide/testing/components-scenarios#get-injected-services">debugElement.injector</a> 的讨论。</td>
</tr>
<tr>
<td align="left"><code>discardPeriodicTasks</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="66s9z75lxbzpnbtyslsdpkym4">当 
<code>fakeAsync()</code> 测试以待处理的定时器事件
<em>任务</em>（排队的 
<code>setTimeOut</code> 和 
<code>setInterval</code> 回调）结束时，测试会失败并显示清晰的错误信息。
<br> 一般来说，测试应该在没有排队任务的情况下结束。预计有待处理的定时任务时，请调用 
<code>discardPeriodicTasks</code> 以刷新
<em>任务</em>队列并避免错误。</td>
</tr>
<tr>
<td align="left"><code>flushMicrotasks</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="eujee0plyn8g93m3f9vosl9dk">当一个 
<code>fakeAsync()</code> 测试以未解决的 
<em>微任务</em>（如未求解的 Promise）结束时，该测试会以明确的错误信息失败。
<br>通常，测试应等待微任务完成。当预期有未完成的微任务时，调用 
<code>flushMicrotasks</code> 以清空 
<em>微任务</em> 队列并避免错误。</td>
</tr>
<tr>
<td align="left"><code>ComponentFixtureAutoDetect</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="1za3dgcafmjnxgdrpjq83roj3">一个用于开启
<a href="guide/testing/components-scenarios#automatic-change-detection">自动变更检测</a>的服务提供者令牌。</td>
</tr>
<tr>
<td align="left"><code>getTestBed</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="a3hm8abvdz8hdqu0dztk0utdr">获取当前的 
<code>TestBed</code> 实例。通常没有必要，因为 
<code>TestBed</code> 类的静态方法通常就足够了。
<code>TestBed</code> 实例暴露了一些静态方法中没有的、不常用的成员。</td>
</tr>

      </tbody>
    </table>
  </div>
  
  <h2 id="testbed-class-summary">
    <a href="#testbed-class-summary" class="docs-anchor" tabindex="-1" aria-label="Link to <code>TestBed</code> class summary" data-ng_translator_product="100" data-ng_translator_ref_id="ctg4j5ry5dape8jal8sj82f92"><code>TestBed</code> 类概述</a>
  </h2>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="82698yuo3ths1ij5d76is0za4"><code>TestBed</code> 类是 Angular 主要的测试工具之一。其 API 相当庞大，直到你逐步探索它之前，可能会感到不知所措。首先阅读本指南的前半部分以掌握基础知识，然后再尝试吸收完整的 API。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="4pb4jguy8a4xowo9zmblkvhoh">传递给 
<code>configureTestingModule</code> 的模块定义是 
<code>@NgModule</code> 元数据属性的一个子集。</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line">type <span class="hljs-title class_">TestModuleMetadata</span> = {</div><div class="hljs-ln-line">  providers?: any[];</div><div class="hljs-ln-line">  declarations?: any[];</div><div class="hljs-ln-line">  imports?: any[];</div><div class="hljs-ln-line">  schemas?: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">SchemaMetadata</span> | any[]&gt;;</div><div class="hljs-ln-line">};</div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_ref_id="a38jt59viwen7x52t8s99rdxd">每个覆盖方法都接受一个 
<code>MetadataOverride&lt;T&gt;</code>，其中 
<code>T</code> 是适合该方法的元数据类型，即 
<code>@NgModule</code>、
<code>@Component</code>、
<code>@Directive</code> 或 
<code>@Pipe</code> 的参数。</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line">type <span class="hljs-title class_">MetadataOverride</span>&lt;T&gt; = {</div><div class="hljs-ln-line">  add?: <span class="hljs-title class_">Partial</span>&lt;T&gt;;</div><div class="hljs-ln-line">  remove?: <span class="hljs-title class_">Partial</span>&lt;T&gt;;</div><div class="hljs-ln-line">  set?: <span class="hljs-title class_">Partial</span>&lt;T&gt;;</div><div class="hljs-ln-line">};</div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_ref_id="ckqcesd1skuzokjoq4yw8jc1o"><code>TestBed</code> API 由静态类方法组成，这些方法要么更新要么引用 
<em>全局</em>的 
<code>TestBed</code> 实例。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="1s803mo2saz6mbwiwsxtsh1za">在内部，所有静态方法都覆盖当前运行时 
<code>TestBed</code> 实例的方法，该实例也由 
<code>getTestBed()</code> 函数返回。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="belrarb7o9idmuun0m99zrgmj">在 
<code>beforeEach()</code> <em>中</em>调用 
<code>TestBed</code> 方法，以确保在每个单独测试之前进行全新开始。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="bo5rtabfl0612hhvd3ph25se5">这里列出了最重要的静态方法，以使用频率排序。</p>

  <div class="docs-table docs-scroll-track-transparent">
    <table>
      <thead>
        <tr>
<th align="left" data-ng_translator_product="100" data-ng_translator_ref_id="1xubgaqmffibk0p3s7z4lwoiw">方法</th>
<th align="left" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="3prlgfrx5eo2xqncnnob4crxu">详情</th>
</tr>

      </thead>
      <tbody>
        <tr>
<td align="left"><code>configureTestingModule</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="48vsx9690lmm4831n286wnvh9">测试垫片（
<code>karma-test-shim</code>，
<code>browser-test-shim</code>）建立
<a href="guide/testing">初始测试环境</a>和一个默认的测试模块。默认测试模块配置了基本声明和一些每个测试人员都需要的 Angular 服务替代品。
<br>调用 
<code>configureTestingModule</code> 通过添加和移除导入、声明（组件、指令和管道）和提供者来优化特定测试集的测试模块配置。</td>
</tr>
<tr>
<td align="left"><code>compileComponents</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="1bvy5uk7sls2c76savgwc0znk">在配置完测试模块后异步编译它。如果测试模块组件中 
<em>任何</em> 组件有 
<code>templateUrl</code> 或 
<code>styleUrls</code>，你
<strong>必须</strong>调用此方法，因为获取组件模板和样式文件必然是异步的。参见 
<a href="guide/testing/components-scenarios#calling-compilecomponents">compileComponents</a>。
<br>调用 
<code>compileComponents</code> 之后，
<code>TestBed</code> 配置在当前规范的持续时间内被冻结。</td>
</tr>
<tr>
<td align="left"><code>createComponent&lt;T&gt;</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="99xe2r5gwlnvzw34u6jtfzqgf">根据当前 
<code>TestBed</code> 配置创建类型为 
<code>T</code> 的组件实例。调用 
<code>createComponent</code> 后，
<code>TestBed</code> 配置在当前规范的持续时间内被冻结。</td>
</tr>
<tr>
<td align="left"><code>overrideModule</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="51y39nw82tk6u9dhexdorqsmr">替换给定 
<code>NgModule</code> 的元数据。记住，模块可以导入其他模块。
<code>overrideModule</code> 方法可以深入当前测试模块以修改这些内部模块之一。</td>
</tr>
<tr>
<td align="left"><code>overrideComponent</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="65x37t4w0t08uav41bu94zk81">替换给定组件类的元数据，该类可能深嵌在某个内部模块中。</td>
</tr>
<tr>
<td align="left"><code>overrideDirective</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="1qxbkcwad4phpironiv1fp0v">替换给定指令类的元数据，该类可能深嵌在某个内部模块中。</td>
</tr>
<tr>
<td align="left"><code>overridePipe</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="cwdrpvzeeqzmtqiukud4kk794">替换给定管道类的元数据，该类可能深嵌在某个内部模块中。</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><code>inject</code></td>
<td align="left">Retrieve a service from the current <code>TestBed</code> injector. The <code>inject</code> function is often adequate for this purpose. But <code>inject</code> throws an error if it can't provide the service. <br> What if the service is optional? <br> The <code>TestBed.inject()</code> method takes an optional second parameter, the object to return if Angular can't find the provider (<code>null</code> in this example): <docs-code header="app/demo/demo.testbed.spec.ts" path="adev/src/content/examples/testing/src/app/demo/demo.testbed.spec.ts" visibleRegion="testbed-get-w-null" /> After calling <code>TestBed.inject</code>, the <code>TestBed</code> configuration is frozen for the duration of the current spec.</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><code>initTestEnvironment</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="59elz7v4wmh6fsxvlxcfszk13">为整个测试运行初始化测试环境。
<br>测试垫片（
<code>karma-test-shim</code>，
<code>browser-test-shim</code>）为你调用它，因此很少有理由自己调用它。
<br>此方法
<em>只能调用一次</em>。要在测试运行过程中更改此默认值，首先调用 
<code>resetTestEnvironment</code>。
<br>指定 Angular 编译器工厂、
<code>PlatformRef</code> 和默认 Angular 测试模块。非浏览器平台的替代方案以一般形式 
<code>@angular/platform-&lt;platform_name&gt;/testing/&lt;platform_name&gt;</code> 提供。</td>
</tr>
<tr>
<td align="left"><code>resetTestEnvironment</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="dekbd3fdqjb947bvwfef4rzmv">重置初始测试环境，包括默认测试模块。</td>
</tr>

      </tbody>
    </table>
  </div>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="7oqw24pxeqmq6beqo9zrbuwm0">某些 
<code>TestBed</code> 实例方法不包含在静态 
<code>TestBed</code> 
<em>类</em>方法中。这些方法很少需要使用。</p>

  <h2 id="the-componentfixture">
    <a href="#the-componentfixture" class="docs-anchor" tabindex="-1" aria-label="Link to The <code>ComponentFixture</code>" data-ng_translator_product="100" data-ng_translator_ref_id="13uvhuwk7clfd489weqlj8mld">此 
<code>ComponentFixture</code></a>
  </h2>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="4d33umb2ua83eztnqffkolk7e">此 
<code>TestBed.createComponent&lt;T&gt;</code> 创建组件 
<code>T</code> 的实例，并返回该组件的强类型 
<code>ComponentFixture</code>。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="35alo5ahz7rbjg882l9xuvumi"><code>ComponentFixture</code> 的属性和方法提供对组件、其 DOM 表现以及其 Angular 环境各方面的访问。</p>

  <h3 id="componentfixture-properties">
    <a href="#componentfixture-properties" class="docs-anchor" tabindex="-1" aria-label="Link to <code>ComponentFixture</code> properties" data-ng_translator_product="100" data-ng_translator_ref_id="dcglo21326rhl5f70qgr20qz"><code>ComponentFixture</code> 属性</a>
  </h3>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="5erhswfokpke60pfl8ftj2ovp">下面是对测试最重要的属性，以使用频率排序。</p>

  <div class="docs-table docs-scroll-track-transparent">
    <table>
      <thead>
        <tr>
<th align="left" data-ng_translator_product="100" data-ng_translator_ref_id="9ghvm54f9feewnb0zbrlubp2h">属性</th>
<th align="left" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="3prlgfrx5eo2xqncnnob4crxu">详情</th>
</tr>

      </thead>
      <tbody>
        <tr>
<td align="left"><code>componentInstance</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="y5xihbd28dnmdyzaudgthxaw">由 
<code>TestBed.createComponent</code> 创建的组件类实例。</td>
</tr>
<tr>
<td align="left"><code>debugElement</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="1g8c8j2qau12zta2rjbhrkt3b">与组件根元素关联的 
<code>DebugElement</code>。
<br> 
<code>debugElement</code> 在测试和调试期间提供了对组件及其 DOM 元素的洞察。对于测试人员来说，这是一个关键属性。最有趣的成员在
<a href="#debug-element-details">下方</a>介绍。</td>
</tr>
<tr>
<td align="left"><code>nativeElement</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="4bx76gykh2bj263ordzmaxwnh">组件根部的原生 DOM 元素。</td>
</tr>
<tr>
<td align="left"><code>changeDetectorRef</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="dvpuprfmkbuds7m1wmm7odhms">此组件的 
<code>ChangeDetectorRef</code>。
<br> 
<code>ChangeDetectorRef</code> 对于测试具有 
<code>ChangeDetectionStrategy.OnPush</code> 方法或其变更检测在程序控制下的组件最为有用。</td>
</tr>

      </tbody>
    </table>
  </div>
  
  <h3 id="componentfixture-methods">
    <a href="#componentfixture-methods" class="docs-anchor" tabindex="-1" aria-label="Link to <code>ComponentFixture</code> methods" data-ng_translator_product="100" data-ng_translator_ref_id="8v1zejol87y20osn5reylruf7"><code>ComponentFixture</code> 方法</a>
  </h3>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="8isoy0gf8gtnjq5ob28umaeit"><em>夹具</em>方法导致 Angular 在组件树上执行某些任务。调用这些方法以触发 Angular 行为以响应模拟的用户操作。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="9rge64b4zkeic42ufdz0ewwez">下面是对测试最有用的方法。</p>

  <div class="docs-table docs-scroll-track-transparent">
    <table>
      <thead>
        <tr>
<th align="left" data-ng_translator_product="100" data-ng_translator_ref_id="1xubgaqmffibk0p3s7z4lwoiw">方法</th>
<th align="left" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="3prlgfrx5eo2xqncnnob4crxu">详情</th>
</tr>

      </thead>
      <tbody>
        <tr>
<td align="left"><code>detectChanges</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="3gab8gkd90nxkfiqzsx6i1ajc">触发组件的变更检测周期。
<br> 调用它以初始化组件（它会调用 
<code>ngOnInit</code>），并在你的测试代码更改组件的数据绑定属性值后调用。Angular 不能看到你已经更改了 
<code>personComponent.name</code>，不会更新 
<code>name</code> 绑定，直到你调用 
<code>detectChanges</code>。
<br> 之后运行 
<code>checkNoChanges</code>，以确认没有循环更新，除非调用为 
<code>detectChanges(false)</code>。</td>
</tr>
<tr>
<td align="left"><code>autoDetectChanges</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="740s4usk78jokyzwxsbicek">当你希望 fixture 自动检测变更时，将此设置为 
<code>true</code>。
<br> 当自动检测为 
<code>true</code> 时，测试 fixture 在创建组件后立即调用 
<code>detectChanges</code>。然后监听相关的 Zone 事件并相应地调用 
<code>detectChanges</code>。当你的测试代码直接修改组件属性值时，可能仍需要调用 
<code>fixture.detectChanges</code> 以触发数据绑定更新。
<br> 默认值为 
<code>false</code>。喜欢对测试行为进行精细控制的测试人员倾向于将其保持为 
<code>false</code>。</td>
</tr>
<tr>
<td align="left"><code>checkNoChanges</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="e89qpncijtzcmhplhx3pmc5ge">进行一次变更检测运行，以确保没有未完成的变更。如果有未完成的变更，将抛出异常。</td>
</tr>
<tr>
<td align="left"><code>isStable</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="cr3adby9pzk4ksw5v8pcnra7k">如果 fixture 当前是
<em>稳定的</em>，返回 
<code>true</code>。如果有未完成的异步任务，返回 
<code>false</code>。</td>
</tr>
<tr>
<td align="left"><code>whenStable</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="b8xgrf64rgsxbwnlxspm1v885">返回一个 promise，当 fixture 稳定时求解。
<br> 在异步活动或异步变更检测完成后恢复测试时，挂钩该 promise。参见 
<a href="guide/testing/components-scenarios#when-stable">whenStable</a>。</td>
</tr>
<tr>
<td align="left"><code>destroy</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="4qt5og7tutemtxiw5qbiw1u8">触发组件的销毁。</td>
</tr>

      </tbody>
    </table>
  </div>
  
  <h4 id="debugelement">
    <a href="#debugelement" class="docs-anchor" tabindex="-1" aria-label="Link to <code>DebugElement</code>"><code>DebugElement</code></a>
  </h4>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="42sl3b2ny0z5zrc561dgrur31"><code>DebugElement</code> 提供了对组件 DOM 表现的关键洞察。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="b92geul0hp6ehxuoz624lpp4x">从测试根组件的 
<code>DebugElement</code> （由 
<code>fixture.debugElement</code> 返回），你可以遍历（和查询）fixture 的整个元素和组件子树。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="aodxz6aw22ckjyszd38ojzlk3">以下是按大致实用顺序排列的最有用的 
<code>DebugElement</code> 成员：</p>

  <div class="docs-table docs-scroll-track-transparent">
    <table>
      <thead>
        <tr>
<th align="left" data-ng_translator_product="100" data-ng_translator_ref_id="e62kgm2ztk7rgk6auybfiv91o">成员</th>
<th align="left" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="3prlgfrx5eo2xqncnnob4crxu">详情</th>
</tr>

      </thead>
      <tbody>
        <tr>
<td align="left"><code>nativeElement</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="dkb0s45orw521d0pkobqk7vsh">在浏览器中对应的 DOM 元素</td>
</tr>
<tr>
<td align="left"><code>query</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="6sj4dti8uvz5mak6fkkmdhmsp">调用 
<code>query(predicate: Predicate&lt;DebugElement&gt;)</code> 会返回第一个在子树中任意深度匹配 
<a href="#query-predicate">谓词</a> 的 
<code>DebugElement</code>。</td>
</tr>
<tr>
<td align="left"><code>queryAll</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="a98mu0a9585o7zh9ablh6qp3x">调用 
<code>queryAll(predicate: Predicate&lt;DebugElement&gt;)</code> 会返回所有在子树中任意深度匹配 
<a href="#query-predicate">谓词</a> 的 
<code>DebugElements</code>。</td>
</tr>
<tr>
<td align="left"><code>injector</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="1yyfov98r97huxz9pmipkq99f">宿主依赖注入器。例如，根元素的组件实例注入器。</td>
</tr>
<tr>
<td align="left"><code>componentInstance</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="bx8lkfdxy9d5a7lqvgrjv63cq">元素自己的组件实例（如果有）。</td>
</tr>
<tr>
<td align="left"><code>context</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="8innf9xp7h5f7m43xx2dshe1h">为此元素提供父上下文的对象。通常是管理此元素的某个祖先组件实例。
<br> 当某个元素在 
<code>*ngFor</code> 中重复时，上下文是一个 
<code>NgForOf</code>，其 
<code>$implicit</code> 属性是行实例值的值。例如，
<code>*ngFor="let hero of heroes"</code> 中的 
<code>hero</code>。</td>
</tr>
<tr>
<td align="left"><code>children</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="86ewymbe9l72jbpkthh26mnni">直接的 
<code>DebugElement</code> 子元素。通过遍历 
<code>children</code> 来走树。
<code>DebugElement</code> 还有 
<code>childNodes</code>，一个 
<code>DebugNode</code> 对象列表。
<code>DebugElement</code> 派生自 
<code>DebugNode</code> 对象，节点通常比元素多。测试人员通常可以忽略普通节点。</td>
</tr>
<tr>
<td align="left"><code>parent</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="18plrloo4j447ennq2es5dsp2">此 
<code>DebugElement</code> 的父元素。如果这是根元素，则为 Null。</td>
</tr>
<tr>
<td align="left"><code>name</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="cbepw70acdtphjqvvurasmrph">元素令牌名称（如果是元素）。</td>
</tr>
<tr>
<td align="left"><code>triggerEventHandler</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="byoa85y0mu3e9o9qku9hf54ht">如果元素的 
<code>listeners</code> 集合中有相应的监听器，则按名称触发事件。第二个参数是处理程序所期望的
<em>事件对象</em>。参见
<a href="guide/testing/components-scenarios#trigger-event-handler">triggerEventHandler</a>。
<br> 如果事件缺少监听器或有其他问题，请考虑调用 
<code>nativeElement.dispatchEvent(eventObject)</code>。</td>
</tr>
<tr>
<td align="left"><code>listeners</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="d2o8ijedavrcs22angr1ks3i5">附着到组件的 
<code>@Output</code> 属性和/或元素的事件属性上的回调。</td>
</tr>
<tr>
<td align="left"><code>providerTokens</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="29hd6bn1yhrbf64nsrs1y7a8e">此组件的注入器查找令牌。包括组件本身以及组件在其 
<code>providers</code> 元数据中列出的令牌。</td>
</tr>
<tr>
<td align="left"><code>source</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="c5w6zws5rt4fuwyfua0ff831o">在源组件模板中找到此元素的位置。</td>
</tr>
<tr>
<td align="left"><code>references</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="4zdpmsmry1zmzstlbnyvkkary">与模板局部变量（例如 
<code>#foo</code>）关联的对象的字典，以局部变量名作为键。</td>
</tr>

      </tbody>
    </table>
  </div>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="4xgr1wxpmp8iil1nv7or5zkhj"><code>DebugElement.query(predicate)</code> 和 
<code>DebugElement.queryAll(predicate)</code> 方法接受一个谓词，该谓词用于过滤源元素的子树以匹配 
<code>DebugElement</code>。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="els8qv56zcdt8kmqtaoznjudd">谓词是任何接受 
<code>DebugElement</code> 并返回
<em>真值</em>的方法。以下示例查找所有引用名为 "content" 的模板局部变量的 
<code>DebugElements</code>：</p>
<div class="docs-code" path="adev/src/content/examples/testing/src/app/demo/demo.testbed.spec.ts" visiblelines="521,522" header="app/demo/demo.testbed.spec.ts">
    <div class="docs-code-header"><h3>app/demo/demo.testbed.spec.ts</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">Component</span>, <span class="hljs-title class_">DebugElement</span>, <span class="hljs-title class_">Injectable</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {</div><div class="hljs-ln-line">  <span class="hljs-title class_">ComponentFixture</span>,</div><div class="hljs-ln-line">  fakeAsync,</div><div class="hljs-ln-line">  inject,</div><div class="hljs-ln-line">  <span class="hljs-title class_">TestBed</span>,</div><div class="hljs-ln-line">  tick,</div><div class="hljs-ln-line">  waitForAsync,</div><div class="hljs-ln-line">} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core/testing'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">FormsModule</span>, <span class="hljs-title class_">NgControl</span>, <span class="hljs-title class_">NgModel</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/forms'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">By</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/platform-browser'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {addMatchers, click} <span class="hljs-keyword">from</span> <span class="hljs-string">'../../testing'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {</div><div class="hljs-ln-line">  <span class="hljs-title class_">BankAccountComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">BankAccountParentComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">Child1Component</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">Child2Component</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">Child3Component</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">ExternalTemplateComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">InputComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">IoComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">IoParentComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">LightswitchComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">MasterService</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">MyIfChildComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">MyIfComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">MyIfParentComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">NeedsContentComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">ParentComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">ReversePipeComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">ShellComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">TestProvidersComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">TestViewProvidersComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">ValueService</span>,</div><div class="hljs-ln-line">} <span class="hljs-keyword">from</span> <span class="hljs-string">'./demo'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NotProvided</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">ValueService</span> {</div><div class="hljs-ln-line">  <span class="hljs-comment">/* example below */</span></div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"><span class="hljs-title function_">beforeEach</span>(addMatchers);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-title function_">describe</span>(<span class="hljs-string">'demo (with TestBed):'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">  <span class="hljs-comment">////////  Service Tests  /////////////</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'ValueService'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">service</span>: <span class="hljs-title class_">ValueService</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({<span class="hljs-attr">providers</span>: [<span class="hljs-title class_">ValueService</span>]});</div><div class="hljs-ln-line">      service = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">inject</span>(<span class="hljs-title class_">ValueService</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should use ValueService'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      service = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">inject</span>(<span class="hljs-title class_">ValueService</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(service.<span class="hljs-title function_">getValue</span>()).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'real value'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'can inject a default value when service is not provided'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(<span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">inject</span>(<span class="hljs-title class_">NotProvided</span>, <span class="hljs-literal">null</span>)).<span class="hljs-title function_">toBeNull</span>();</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'test should wait for ValueService.getPromiseValue'</span>, <span class="hljs-title function_">waitForAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      service.<span class="hljs-title function_">getPromiseValue</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> <span class="hljs-title function_">expect</span>(value).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'promise value'</span>));</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'test should wait for ValueService.getObservableValue'</span>, <span class="hljs-title function_">waitForAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      service.<span class="hljs-title function_">getObservableValue</span>().<span class="hljs-title function_">subscribe</span>(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> <span class="hljs-title function_">expect</span>(value).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'observable value'</span>));</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">// Must use done. See https://github.com/angular/angular/issues/10127</span></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'test should wait for ValueService.getObservableDelayValue'</span>, <span class="hljs-function">(<span class="hljs-params">done: DoneFn</span>) =&gt;</span> {</div><div class="hljs-ln-line">      service.<span class="hljs-title function_">getObservableDelayValue</span>().<span class="hljs-title function_">subscribe</span>(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> {</div><div class="hljs-ln-line">        <span class="hljs-title function_">expect</span>(value).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'observable delay value'</span>);</div><div class="hljs-ln-line">        <span class="hljs-title function_">done</span>();</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should allow the use of fakeAsync'</span>, <span class="hljs-title function_">fakeAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">let</span> <span class="hljs-attr">value</span>: <span class="hljs-built_in">any</span>;</div><div class="hljs-ln-line">      service.<span class="hljs-title function_">getPromiseValue</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">val: <span class="hljs-built_in">any</span></span>) =&gt;</span> (value = val));</div><div class="hljs-ln-line">      <span class="hljs-title function_">tick</span>(); <span class="hljs-comment">// Trigger JS engine cycle until all promises resolve.</span></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(value).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'promise value'</span>);</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'MasterService'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">masterService</span>: <span class="hljs-title class_">MasterService</span>;</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">valueServiceSpy</span>: jasmine.<span class="hljs-property">SpyObj</span>&lt;<span class="hljs-title class_">ValueService</span>&gt;;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> spy = jasmine.<span class="hljs-title function_">createSpyObj</span>(<span class="hljs-string">'ValueService'</span>, [<span class="hljs-string">'getValue'</span>]);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-comment">// Provide both the service-to-test and its (spy) dependency</span></div><div class="hljs-ln-line">        <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">MasterService</span>, {<span class="hljs-attr">provide</span>: <span class="hljs-title class_">ValueService</span>, <span class="hljs-attr">useValue</span>: spy}],</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">      <span class="hljs-comment">// Inject both the service-to-test and its (spy) dependency</span></div><div class="hljs-ln-line">      masterService = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">inject</span>(<span class="hljs-title class_">MasterService</span>);</div><div class="hljs-ln-line">      valueServiceSpy = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">inject</span>(<span class="hljs-title class_">ValueService</span>) <span class="hljs-keyword">as</span> jasmine.<span class="hljs-property">SpyObj</span>&lt;<span class="hljs-title class_">ValueService</span>&gt;;</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'#getValue should return stubbed value from a spy'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> stubValue = <span class="hljs-string">'stub value'</span>;</div><div class="hljs-ln-line">      valueServiceSpy.<span class="hljs-property">getValue</span>.<span class="hljs-property">and</span>.<span class="hljs-title function_">returnValue</span>(stubValue);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(masterService.<span class="hljs-title function_">getValue</span>()).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'service returned stub value'</span>).<span class="hljs-title function_">toBe</span>(stubValue);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(valueServiceSpy.<span class="hljs-property">getValue</span>.<span class="hljs-property">calls</span>.<span class="hljs-title function_">count</span>())</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'spy method was called once'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(<span class="hljs-number">1</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(valueServiceSpy.<span class="hljs-property">getValue</span>.<span class="hljs-property">calls</span>.<span class="hljs-title function_">mostRecent</span>().<span class="hljs-property">returnValue</span>).<span class="hljs-title function_">toBe</span>(stubValue);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'use inject within `it`'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({<span class="hljs-attr">providers</span>: [<span class="hljs-title class_">ValueService</span>]});</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should use modified providers'</span>, <span class="hljs-title function_">inject</span>([<span class="hljs-title class_">ValueService</span>], <span class="hljs-function">(<span class="hljs-params">service: ValueService</span>) =&gt;</span> {</div><div class="hljs-ln-line">      service.<span class="hljs-title function_">setValue</span>(<span class="hljs-string">'value modified in beforeEach'</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(service.<span class="hljs-title function_">getValue</span>()).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'value modified in beforeEach'</span>);</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'using waitForAsync(inject) within beforeEach'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">serviceValue</span>: <span class="hljs-built_in">string</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({<span class="hljs-attr">providers</span>: [<span class="hljs-title class_">ValueService</span>]});</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-title function_">waitForAsync</span>(</div><div class="hljs-ln-line">      <span class="hljs-title function_">inject</span>([<span class="hljs-title class_">ValueService</span>], <span class="hljs-function">(<span class="hljs-params">service: ValueService</span>) =&gt;</span> {</div><div class="hljs-ln-line">        service.<span class="hljs-title function_">getPromiseValue</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> (serviceValue = value));</div><div class="hljs-ln-line">      }),</div><div class="hljs-ln-line">    ));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should use asynchronously modified value ... in synchronous test'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(serviceValue).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'promise value'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-comment">/////////// Component Tests //////////////////</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'TestBed component tests'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-comment">// beforeEach(waitForAsync(() =&gt; {</span></div><div class="hljs-ln-line">    <span class="hljs-comment">//   TestBed.configureTestingModule()</span></div><div class="hljs-ln-line">    <span class="hljs-comment">//     // Compile everything in DemoModule</span></div><div class="hljs-ln-line">    <span class="hljs-comment">//     .compileComponents();</span></div><div class="hljs-ln-line">    <span class="hljs-comment">// }));</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should create a component with inline template'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">Child1Component</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'Child'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should create a component with external template'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">ExternalTemplateComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'from external template'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should allow changing members of the component'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">MyIfComponent</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'MyIf()'</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-property">componentInstance</span>.<span class="hljs-property">showMore</span> = <span class="hljs-literal">true</span>;</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'MyIf(More)'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should create a nested component bound to inputs/outputs'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">IoParentComponent</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> heroes = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">queryAll</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'.hero'</span>));</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(heroes.<span class="hljs-property">length</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'has heroes'</span>).<span class="hljs-title function_">toBeGreaterThan</span>(<span class="hljs-number">0</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> hero = comp.<span class="hljs-property">heroes</span>[<span class="hljs-number">0</span>];</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">click</span>(heroes[<span class="hljs-number">0</span>]);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> selected = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'p'</span>));</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(selected).<span class="hljs-title function_">toHaveText</span>(hero.<span class="hljs-property">name</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'can access the instance variable of an `*ngFor` row component'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">IoParentComponent</span>);</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> heroName = comp.<span class="hljs-property">heroes</span>[<span class="hljs-number">0</span>].<span class="hljs-property">name</span>; <span class="hljs-comment">// first hero's name</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> ngForRow = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">directive</span>(<span class="hljs-title class_">IoComponent</span>)); <span class="hljs-comment">// first hero ngForRow</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> hero = ngForRow.<span class="hljs-property">context</span>.<span class="hljs-property">hero</span>; <span class="hljs-comment">// the hero object passed into the row</span></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(hero.<span class="hljs-property">name</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'ngRow.context.hero'</span>).<span class="hljs-title function_">toBe</span>(heroName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> rowComp = ngForRow.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      <span class="hljs-comment">// jasmine.any is an "instance-of-type" test.</span></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(rowComp).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'component is IoComp'</span>).<span class="hljs-title function_">toEqual</span>(jasmine.<span class="hljs-title function_">any</span>(<span class="hljs-title class_">IoComponent</span>));</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(rowComp.<span class="hljs-property">hero</span>.<span class="hljs-property">name</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'component.hero'</span>).<span class="hljs-title function_">toBe</span>(heroName);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should support clicking a button'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">LightswitchComponent</span>);</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> btn = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'button'</span>));</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> span = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'span'</span>)).<span class="hljs-property">nativeElement</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(span.<span class="hljs-property">textContent</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'before click'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toMatch</span>(<span class="hljs-regexp">/is off/i</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">click</span>(btn);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(span.<span class="hljs-property">textContent</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'after click'</span>).<span class="hljs-title function_">toMatch</span>(<span class="hljs-regexp">/is on/i</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">// ngModel is async so we must wait for it with promise-based `whenStable`</span></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should support entering text in input box (ngModel)'</span>, <span class="hljs-title function_">waitForAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> expectedOrigName = <span class="hljs-string">'John'</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> expectedNewName = <span class="hljs-string">'Sally'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">InputComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> input = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'input'</span>)).<span class="hljs-property">nativeElement</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLInputElement</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">name</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">`At start name should be <span class="hljs-subst">${expectedOrigName}</span> `</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(expectedOrigName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// wait until ngModel binds comp.name to input box</span></div><div class="hljs-ln-line">      fixture</div><div class="hljs-ln-line">        .<span class="hljs-title function_">whenStable</span>()</div><div class="hljs-ln-line">        .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">          <span class="hljs-title function_">expect</span>(input.<span class="hljs-property">value</span>)</div><div class="hljs-ln-line">            .<span class="hljs-title function_">withContext</span>(</div><div class="hljs-ln-line">              <span class="hljs-string">`After ngModel updates input box, input.value should be <span class="hljs-subst">${expectedOrigName}</span> `</span>,</div><div class="hljs-ln-line">            )</div><div class="hljs-ln-line">            .<span class="hljs-title function_">toBe</span>(expectedOrigName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-comment">// simulate user entering new name in input</span></div><div class="hljs-ln-line">          input.<span class="hljs-property">value</span> = expectedNewName;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-comment">// that change doesn't flow to the component immediately</span></div><div class="hljs-ln-line">          <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">name</span>)</div><div class="hljs-ln-line">            .<span class="hljs-title function_">withContext</span>(</div><div class="hljs-ln-line">              <span class="hljs-string">`comp.name should still be <span class="hljs-subst">${expectedOrigName}</span> after value change, before binding happens`</span>,</div><div class="hljs-ln-line">            )</div><div class="hljs-ln-line">            .<span class="hljs-title function_">toBe</span>(expectedOrigName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-comment">// Dispatch a DOM event so that Angular learns of input value change.</span></div><div class="hljs-ln-line">          <span class="hljs-comment">// then wait while ngModel pushes input.box value to comp.name</span></div><div class="hljs-ln-line">          input.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">'input'</span>));</div><div class="hljs-ln-line">          <span class="hljs-keyword">return</span> fixture.<span class="hljs-title function_">whenStable</span>();</div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">          <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">name</span>)</div><div class="hljs-ln-line">            .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">`After ngModel updates the model, comp.name should be <span class="hljs-subst">${expectedNewName}</span> `</span>)</div><div class="hljs-ln-line">            .<span class="hljs-title function_">toBe</span>(expectedNewName);</div><div class="hljs-ln-line">        });</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">// fakeAsync version of ngModel input test enables sync test style</span></div><div class="hljs-ln-line">    <span class="hljs-comment">// synchronous `tick` replaces asynchronous promise-base `whenStable`</span></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should support entering text in input box (ngModel) - fakeAsync'</span>, <span class="hljs-title function_">fakeAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> expectedOrigName = <span class="hljs-string">'John'</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> expectedNewName = <span class="hljs-string">'Sally'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">InputComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> input = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'input'</span>)).<span class="hljs-property">nativeElement</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLInputElement</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">name</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">`At start name should be <span class="hljs-subst">${expectedOrigName}</span> `</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(expectedOrigName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// wait until ngModel binds comp.name to input box</span></div><div class="hljs-ln-line">      <span class="hljs-title function_">tick</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(input.<span class="hljs-property">value</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">`After ngModel updates input box, input.value should be <span class="hljs-subst">${expectedOrigName}</span> `</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(expectedOrigName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// simulate user entering new name in input</span></div><div class="hljs-ln-line">      input.<span class="hljs-property">value</span> = expectedNewName;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// that change doesn't flow to the component immediately</span></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">name</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(</div><div class="hljs-ln-line">          <span class="hljs-string">`comp.name should still be <span class="hljs-subst">${expectedOrigName}</span> after value change, before binding happens`</span>,</div><div class="hljs-ln-line">        )</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(expectedOrigName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// Dispatch a DOM event so that Angular learns of input value change.</span></div><div class="hljs-ln-line">      <span class="hljs-comment">// then wait a tick while ngModel pushes input.box value to comp.name</span></div><div class="hljs-ln-line">      input.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">'input'</span>));</div><div class="hljs-ln-line">      <span class="hljs-title function_">tick</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">name</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">`After ngModel updates the model, comp.name should be <span class="hljs-subst">${expectedNewName}</span> `</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(expectedNewName);</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'ReversePipeComp should reverse the input text'</span>, <span class="hljs-title function_">fakeAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> inputText = <span class="hljs-string">'the quick brown fox.'</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> expectedText = <span class="hljs-string">'.xof nworb kciuq eht'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">ReversePipeComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> input = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'input'</span>)).<span class="hljs-property">nativeElement</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLInputElement</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> span = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'span'</span>)).<span class="hljs-property">nativeElement</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLElement</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// simulate user entering new name in input</span></div><div class="hljs-ln-line">      input.<span class="hljs-property">value</span> = inputText;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// Dispatch a DOM event so that Angular learns of input value change.</span></div><div class="hljs-ln-line">      <span class="hljs-comment">// then wait a tick while ngModel pushes input.box value to comp.text</span></div><div class="hljs-ln-line">      <span class="hljs-comment">// and Angular updates the output span</span></div><div class="hljs-ln-line">      input.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">'input'</span>));</div><div class="hljs-ln-line">      <span class="hljs-title function_">tick</span>();</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(span.<span class="hljs-property">textContent</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'output span'</span>).<span class="hljs-title function_">toBe</span>(expectedText);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">text</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'component.text'</span>).<span class="hljs-title function_">toBe</span>(inputText);</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">// Use this technique to find attached directives of any kind</span></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'can examine attached directives and listeners'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">InputComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> inputEl = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'input'</span>));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(inputEl.<span class="hljs-property">providerTokens</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'NgModel directive'</span>).<span class="hljs-title function_">toContain</span>(<span class="hljs-title class_">NgModel</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> ngControl = inputEl.<span class="hljs-property">injector</span>.<span class="hljs-title function_">get</span>(<span class="hljs-title class_">NgControl</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(ngControl).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'NgControl directive'</span>).<span class="hljs-title function_">toEqual</span>(jasmine.<span class="hljs-title function_">any</span>(<span class="hljs-title class_">NgControl</span>));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(inputEl.<span class="hljs-property">listeners</span>.<span class="hljs-property">length</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'several listeners attached'</span>).<span class="hljs-title function_">toBeGreaterThan</span>(<span class="hljs-number">2</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'BankAccountComponent should set attributes, styles, classes, and properties'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">BankAccountParentComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// the only child is debugElement of the BankAccount component</span></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> el = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-property">children</span>[<span class="hljs-number">0</span>];</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> childComp = el.<span class="hljs-property">componentInstance</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">BankAccountComponent</span>;</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(childComp).<span class="hljs-title function_">toEqual</span>(jasmine.<span class="hljs-title function_">any</span>(<span class="hljs-title class_">BankAccountComponent</span>));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">context</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'context is the child component'</span>).<span class="hljs-title function_">toBe</span>(childComp);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">attributes</span>[<span class="hljs-string">'account'</span>]).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'account attribute'</span>).<span class="hljs-title function_">toBe</span>(childComp.<span class="hljs-property">id</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">attributes</span>[<span class="hljs-string">'bank'</span>]).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'bank attribute'</span>).<span class="hljs-title function_">toBe</span>(childComp.<span class="hljs-property">bank</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">classes</span>[<span class="hljs-string">'closed'</span>]).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'closed class'</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">classes</span>[<span class="hljs-string">'open'</span>]).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'open class'</span>).<span class="hljs-title function_">toBeFalsy</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">styles</span>[<span class="hljs-string">'color'</span>]).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'color style'</span>).<span class="hljs-title function_">toBe</span>(comp.<span class="hljs-property">color</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">styles</span>[<span class="hljs-string">'width'</span>])</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'width style'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(comp.<span class="hljs-property">width</span> + <span class="hljs-string">'px'</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// Removed on 12/02/2016 when ceased public discussion of the `Renderer`. Revive in future?</span></div><div class="hljs-ln-line">      <span class="hljs-comment">// expect(el.properties['customProperty']).toBe(true, 'customProperty');</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'TestBed component overrides:'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">"should override ChildComp's template"</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">Child1Component</span>],</div><div class="hljs-ln-line">      })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">Child1Component</span>, {</div><div class="hljs-ln-line">          <span class="hljs-attr">set</span>: {<span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;span&gt;Fake&lt;/span&gt;'</span>},</div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">Child1Component</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'Fake'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">"should override TestProvidersComp's ValueService provider"</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">TestProvidersComponent</span>],</div><div class="hljs-ln-line">      })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">TestProvidersComponent</span>, {</div><div class="hljs-ln-line">          <span class="hljs-attr">remove</span>: {<span class="hljs-attr">providers</span>: [<span class="hljs-title class_">ValueService</span>]},</div><div class="hljs-ln-line">          <span class="hljs-attr">add</span>: {<span class="hljs-attr">providers</span>: [{<span class="hljs-attr">provide</span>: <span class="hljs-title class_">ValueService</span>, <span class="hljs-attr">useClass</span>: <span class="hljs-title class_">FakeValueService</span>}]},</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-comment">// Or replace them all (this component has only one provider)</span></div><div class="hljs-ln-line">          <span class="hljs-comment">// set:    { providers: [{ provide: ValueService, useClass: FakeValueService }] },</span></div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">TestProvidersComponent</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'injected value: faked value'</span>, <span class="hljs-string">'text'</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// Explore the providerTokens</span></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> tokens = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-property">providerTokens</span>;</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(tokens).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'component ctor'</span>).<span class="hljs-title function_">toContain</span>(fixture.<span class="hljs-property">componentInstance</span>.<span class="hljs-property">constructor</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(tokens).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'TestProvidersComp'</span>).<span class="hljs-title function_">toContain</span>(<span class="hljs-title class_">TestProvidersComponent</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(tokens).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'ValueService'</span>).<span class="hljs-title function_">toContain</span>(<span class="hljs-title class_">ValueService</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">"should override TestViewProvidersComp's ValueService viewProvider"</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">TestViewProvidersComponent</span>],</div><div class="hljs-ln-line">      })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">TestViewProvidersComponent</span>, {</div><div class="hljs-ln-line">          <span class="hljs-comment">// remove: { viewProviders: [ValueService]},</span></div><div class="hljs-ln-line">          <span class="hljs-comment">// add:    { viewProviders: [{ provide: ValueService, useClass: FakeValueService }]</span></div><div class="hljs-ln-line">          <span class="hljs-comment">// },</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-comment">// Or replace them all (this component has only one viewProvider)</span></div><div class="hljs-ln-line">          <span class="hljs-attr">set</span>: {<span class="hljs-attr">viewProviders</span>: [{<span class="hljs-attr">provide</span>: <span class="hljs-title class_">ValueService</span>, <span class="hljs-attr">useClass</span>: <span class="hljs-title class_">FakeValueService</span>}]},</div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">TestViewProvidersComponent</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'injected value: faked value'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">"injected provider should not be same as component's provider"</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-comment">// TestComponent is parent of TestProvidersComponent</span></div><div class="hljs-ln-line">      <span class="hljs-meta">@Component</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">standalone</span>: <span class="hljs-literal">true</span>,</div><div class="hljs-ln-line">        <span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;my-service-comp&gt;&lt;/my-service-comp&gt;'</span>,</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">TestProvidersComponent</span>],</div><div class="hljs-ln-line">      })</div><div class="hljs-ln-line">      <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestComponent</span> {}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// 3 levels of ValueService provider: module, TestComponent, TestProvidersComponent</span></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">TestComponent</span>, <span class="hljs-title class_">TestProvidersComponent</span>],</div><div class="hljs-ln-line">        <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">ValueService</span>],</div><div class="hljs-ln-line">      })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">TestComponent</span>, {</div><div class="hljs-ln-line">          <span class="hljs-attr">set</span>: {<span class="hljs-attr">providers</span>: [{<span class="hljs-attr">provide</span>: <span class="hljs-title class_">ValueService</span>, <span class="hljs-attr">useValue</span>: {}}]},</div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">TestProvidersComponent</span>, {</div><div class="hljs-ln-line">          <span class="hljs-attr">set</span>: {<span class="hljs-attr">providers</span>: [{<span class="hljs-attr">provide</span>: <span class="hljs-title class_">ValueService</span>, <span class="hljs-attr">useClass</span>: <span class="hljs-title class_">FakeValueService</span>}]},</div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">TestComponent</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">let</span> testBedProvider!: <span class="hljs-title class_">ValueService</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// `inject` uses TestBed's injector</span></div><div class="hljs-ln-line">      <span class="hljs-title function_">inject</span>([<span class="hljs-title class_">ValueService</span>], <span class="hljs-function">(<span class="hljs-params">s: ValueService</span>) =&gt;</span> (testBedProvider = s))();</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> tcProvider = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-property">injector</span>.<span class="hljs-title function_">get</span>(<span class="hljs-title class_">ValueService</span>) <span class="hljs-keyword">as</span> <span class="hljs-title class_">ValueService</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> tpcProvider = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-property">children</span>[<span class="hljs-number">0</span>].<span class="hljs-property">injector</span>.<span class="hljs-title function_">get</span>(</div><div class="hljs-ln-line">        <span class="hljs-title class_">ValueService</span>,</div><div class="hljs-ln-line">      ) <span class="hljs-keyword">as</span> <span class="hljs-title class_">FakeValueService</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(testBedProvider).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'testBed/tc not same providers'</span>).<span class="hljs-property">not</span>.<span class="hljs-title function_">toBe</span>(tcProvider);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(testBedProvider).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'testBed/tpc not same providers'</span>).<span class="hljs-property">not</span>.<span class="hljs-title function_">toBe</span>(tpcProvider);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(testBedProvider <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">ValueService</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'testBedProvider is ValueService'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(tcProvider)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'tcProvider is {}'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toEqual</span>({} <span class="hljs-keyword">as</span> <span class="hljs-title class_">ValueService</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(tpcProvider <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">FakeValueService</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'tpcProvider is FakeValueService'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'can access template local variables as references'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [</div><div class="hljs-ln-line">          <span class="hljs-title class_">ShellComponent</span>,</div><div class="hljs-ln-line">          <span class="hljs-title class_">NeedsContentComponent</span>,</div><div class="hljs-ln-line">          <span class="hljs-title class_">Child1Component</span>,</div><div class="hljs-ln-line">          <span class="hljs-title class_">Child2Component</span>,</div><div class="hljs-ln-line">          <span class="hljs-title class_">Child3Component</span>,</div><div class="hljs-ln-line">        ],</div><div class="hljs-ln-line">      })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">ShellComponent</span>, {</div><div class="hljs-ln-line">          <span class="hljs-attr">set</span>: {</div><div class="hljs-ln-line">            <span class="hljs-attr">selector</span>: <span class="hljs-string">'test-shell'</span>,</div><div class="hljs-ln-line">            <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">NeedsContentComponent</span>, <span class="hljs-title class_">Child1Component</span>, <span class="hljs-title class_">Child2Component</span>, <span class="hljs-title class_">Child3Component</span>],</div><div class="hljs-ln-line">            <span class="hljs-attr">template</span>: <span class="hljs-string">`</span></div><div class="hljs-ln-line">          &lt;needs-content #nc&gt;</div><div class="hljs-ln-line">            &lt;child-1 #content text="My"&gt;&lt;/child-1&gt;</div><div class="hljs-ln-line">            &lt;child-2 #content text="dog"&gt;&lt;/child-2&gt;</div><div class="hljs-ln-line">            &lt;child-2 text="has"&gt;&lt;/child-2&gt;</div><div class="hljs-ln-line">            &lt;child-3 #content text="fleas"&gt;&lt;/child-3&gt;</div><div class="hljs-ln-line">            &lt;div #content&gt;!&lt;/div&gt;</div><div class="hljs-ln-line">          &lt;/needs-content&gt;</div><div class="hljs-ln-line">          `,</div><div class="hljs-ln-line">          },</div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">ShellComponent</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// NeedsContentComp is the child of ShellComp</span></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> el = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-property">children</span>[<span class="hljs-number">0</span>];</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = el.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">children</span>.<span class="hljs-title function_">toArray</span>().<span class="hljs-property">length</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'three different child components and an ElementRef with #content'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(<span class="hljs-number">4</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">references</span>[<span class="hljs-string">'nc'</span>]).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'#nc reference to component'</span>).<span class="hljs-title function_">toBe</span>(comp);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// Filter for DebugElements with a #content reference</span></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> contentRefs = el.<span class="hljs-title function_">queryAll</span>(<span class="hljs-function">(<span class="hljs-params">de</span>) =&gt;</span> de.<span class="hljs-property">references</span>[<span class="hljs-string">'content'</span>]);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(contentRefs.<span class="hljs-property">length</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'elements w/ a #content reference'</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-number">4</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'nested (one-deep) component override'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">ParentComponent</span>, <span class="hljs-title class_">FakeChildComponent</span>],</div><div class="hljs-ln-line">      }).<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">ParentComponent</span>, {</div><div class="hljs-ln-line">        <span class="hljs-attr">set</span>: {<span class="hljs-attr">imports</span>: [<span class="hljs-title class_">FakeChildComponent</span>]},</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'ParentComp should use Fake Child component'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">ParentComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'Parent(Fake Child)'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'nested (two-deep) component override'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">ParentComponent</span>, <span class="hljs-title class_">FakeChildWithGrandchildComponent</span>, <span class="hljs-title class_">FakeGrandchildComponent</span>],</div><div class="hljs-ln-line">      }).<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">ParentComponent</span>, {</div><div class="hljs-ln-line">        <span class="hljs-attr">set</span>: {<span class="hljs-attr">imports</span>: [<span class="hljs-title class_">FakeChildWithGrandchildComponent</span>, <span class="hljs-title class_">FakeGrandchildComponent</span>]},</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should use Fake Grandchild component'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">ParentComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'Parent(Fake Child(Fake Grandchild))'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'lifecycle hooks w/ MyIfParentComp'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">fixture</span>: <span class="hljs-title class_">ComponentFixture</span>&lt;<span class="hljs-title class_">MyIfParentComponent</span>&gt;;</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">parent</span>: <span class="hljs-title class_">MyIfParentComponent</span>;</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">child</span>: <span class="hljs-title class_">MyIfChildComponent</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">FormsModule</span>, <span class="hljs-title class_">MyIfChildComponent</span>, <span class="hljs-title class_">MyIfParentComponent</span>],</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">MyIfParentComponent</span>);</div><div class="hljs-ln-line">      parent = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should instantiate parent component'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(parent).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'parent component should exist'</span>).<span class="hljs-property">not</span>.<span class="hljs-title function_">toBeNull</span>();</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'parent component OnInit should NOT be called before first detectChanges()'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(parent.<span class="hljs-property">ngOnInitCalled</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">false</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'parent component OnInit should be called after first detectChanges()'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(parent.<span class="hljs-property">ngOnInitCalled</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'child component should exist after OnInit'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">getChild</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(child <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">MyIfChildComponent</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'should create child'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">"should have called child component's OnInit "</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">getChild</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(child.<span class="hljs-property">ngOnInitCalled</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'child component called OnChanges once'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">getChild</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(child.<span class="hljs-property">ngOnChangesCounter</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-number">1</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'changed parent value flows to child'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">getChild</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      parent.<span class="hljs-property">parentValue</span> = <span class="hljs-string">'foo'</span>;</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(child.<span class="hljs-property">ngOnChangesCounter</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'expected 2 changes: initial value and changed value'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(<span class="hljs-number">2</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(child.<span class="hljs-property">childValue</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'childValue should eq changed parent value'</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'foo'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">// must be async test to see child flow to parent</span></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'changed child value flows to parent'</span>, <span class="hljs-title function_">waitForAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">getChild</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      child.<span class="hljs-property">childValue</span> = <span class="hljs-string">'bar'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {</div><div class="hljs-ln-line">        <span class="hljs-comment">// Wait one JS engine turn!</span></div><div class="hljs-ln-line">        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(), <span class="hljs-number">0</span>);</div><div class="hljs-ln-line">      }).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">        fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">        <span class="hljs-title function_">expect</span>(child.<span class="hljs-property">ngOnChangesCounter</span>)</div><div class="hljs-ln-line">          .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'expected 2 changes: initial value and changed value'</span>)</div><div class="hljs-ln-line">          .<span class="hljs-title function_">toBe</span>(<span class="hljs-number">2</span>);</div><div class="hljs-ln-line">        <span class="hljs-title function_">expect</span>(parent.<span class="hljs-property">parentValue</span>)</div><div class="hljs-ln-line">          .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'parentValue should eq changed parent value'</span>)</div><div class="hljs-ln-line">          .<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'bar'</span>);</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'clicking "Close Child" triggers child OnDestroy'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">getChild</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> btn = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'button'</span>));</div><div class="hljs-ln-line">      <span class="hljs-title function_">click</span>(btn);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(child.<span class="hljs-property">ngOnDestroyCalled</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">////// helpers ///</span></div><div class="hljs-ln-line">    <span class="hljs-comment">/**</span></div><div class="hljs-ln-line">     * Get the MyIfChildComp from parent; fail w/ good message if cannot.</div><div class="hljs-ln-line">     */</div><div class="hljs-ln-line">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">getChild</span>(<span class="hljs-params"></span>) {</div><div class="hljs-ln-line">      <span class="hljs-keyword">let</span> <span class="hljs-attr">childDe</span>: <span class="hljs-title class_">DebugElement</span>; <span class="hljs-comment">// DebugElement that should hold the MyIfChildComp</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// The Hard Way: requires detailed knowledge of the parent template</span></div><div class="hljs-ln-line">      <span class="hljs-keyword">try</span> {</div><div class="hljs-ln-line">        childDe = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-property">children</span>[<span class="hljs-number">4</span>].<span class="hljs-property">children</span>[<span class="hljs-number">0</span>];</div><div class="hljs-ln-line">      } <span class="hljs-keyword">catch</span> (err) {</div><div class="hljs-ln-line">        <span class="hljs-comment">/* we'll report the error */</span></div><div class="hljs-ln-line">      }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// DebugElement.queryAll: if we wanted all of many instances:</span></div><div class="hljs-ln-line">      childDe = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">queryAll</span>(</div><div class="hljs-ln-line">        <span class="hljs-function">(<span class="hljs-params">de</span>) =&gt;</span> de.<span class="hljs-property">componentInstance</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">MyIfChildComponent</span>,</div><div class="hljs-ln-line">      )[<span class="hljs-number">0</span>];</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// WE'LL USE THIS APPROACH !</span></div><div class="hljs-ln-line">      <span class="hljs-comment">// DebugElement.query: find first instance (if any)</span></div><div class="hljs-ln-line">      childDe = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(</div><div class="hljs-ln-line">        <span class="hljs-function">(<span class="hljs-params">de</span>) =&gt;</span> de.<span class="hljs-property">componentInstance</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">MyIfChildComponent</span>,</div><div class="hljs-ln-line">      );</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">if</span> (childDe &amp;&amp; childDe.<span class="hljs-property">componentInstance</span>) {</div><div class="hljs-ln-line">        child = childDe.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      } <span class="hljs-keyword">else</span> {</div><div class="hljs-ln-line">        <span class="hljs-title function_">fail</span>(<span class="hljs-string">'Unable to find MyIfChildComp within MyIfParentComp'</span>);</div><div class="hljs-ln-line">      }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> child;</div><div class="hljs-ln-line">    }</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line">});</div><div class="hljs-ln-line"><span class="hljs-comment">////////// Fakes ///////////</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component</span>({</div><div class="hljs-ln-line">  <span class="hljs-attr">standalone</span>: <span class="hljs-literal">true</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">selector</span>: <span class="hljs-string">'child-1'</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">template</span>: <span class="hljs-string">'Fake Child'</span>,</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FakeChildComponent</span> {}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component</span>({</div><div class="hljs-ln-line">  <span class="hljs-attr">standalone</span>: <span class="hljs-literal">true</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">selector</span>: <span class="hljs-string">'grandchild-1'</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">template</span>: <span class="hljs-string">'Fake Grandchild'</span>,</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FakeGrandchildComponent</span> {}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component</span>({</div><div class="hljs-ln-line">  <span class="hljs-attr">standalone</span>: <span class="hljs-literal">true</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">selector</span>: <span class="hljs-string">'child-1'</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">FakeGrandchildComponent</span>],</div><div class="hljs-ln-line">  <span class="hljs-attr">template</span>: <span class="hljs-string">'Fake Child(&lt;grandchild-1&gt;&lt;/grandchild-1&gt;)'</span>,</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FakeChildWithGrandchildComponent</span> {}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Injectable</span>()</div><div class="hljs-ln-line"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FakeValueService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">ValueService</span> {</div><div class="hljs-ln-line">  <span class="hljs-keyword">override</span> value = <span class="hljs-string">'faked value'</span>;</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_ref_id="3xna38penwf72zyyfxoas2qgj">Angular 的 
<code>By</code> 类有三个用于常见谓词的静态方法：</p>

  <div class="docs-table docs-scroll-track-transparent">
    <table>
      <thead>
        <tr>
<th align="left" data-ng_translator_product="100" data-ng_translator_ref_id="9zoyyca4y8znurrr61rj7hxy5">静态方法</th>
<th align="left" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="3prlgfrx5eo2xqncnnob4crxu">详情</th>
</tr>

      </thead>
      <tbody>
        <tr>
<td align="left"><code>By.all</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="87rly5szcna46j3sqogoax2b3">返回所有元素</td>
</tr>
<tr>
<td align="left"><code>By.css(selector)</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="efnrayosjm3j82avjr8fcs2r1">返回匹配 CSS 选择器的元素</td>
</tr>
<tr>
<td align="left"><code>By.directive(directive)</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="ax2pgez6g5hflk977bjzqt2ry">返回 Angular 匹配到指令类实例的元素</td>
</tr>

      </tbody>
    </table>
  </div>
  <div class="docs-code" path="adev/src/content/examples/testing/src/app/hero/hero-list.component.spec.ts" visiblelines="80,81,82" header="app/hero/hero-list.component.spec.ts">
    <div class="docs-code-header"><h3>app/hero/hero-list.component.spec.ts</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">ComponentFixture</span>, fakeAsync, <span class="hljs-title class_">TestBed</span>, tick, waitForAsync} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core/testing'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">By</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/platform-browser'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">DebugElement</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">Router</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/router'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {addMatchers} <span class="hljs-keyword">from</span> <span class="hljs-string">'../../testing'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">HeroService</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'../model/hero.service'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {getTestHeroes, <span class="hljs-title class_">TestHeroService</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'../model/testing/test-hero.service'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">HeroListComponent</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'./hero-list.component'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">HighlightDirective</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'../shared/highlight.directive'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {appConfig} <span class="hljs-keyword">from</span> <span class="hljs-string">'../app.config'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">HEROES</span> = <span class="hljs-title function_">getTestHeroes</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">let</span> <span class="hljs-attr">comp</span>: <span class="hljs-title class_">HeroListComponent</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">let</span> <span class="hljs-attr">fixture</span>: <span class="hljs-title class_">ComponentFixture</span>&lt;<span class="hljs-title class_">HeroListComponent</span>&gt;;</div><div class="hljs-ln-line"><span class="hljs-keyword">let</span> <span class="hljs-attr">page</span>: <span class="hljs-title class_">Page</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-comment">/////// Tests //////</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-title function_">describe</span>(<span class="hljs-string">'HeroListComponent'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">  <span class="hljs-title function_">beforeEach</span>(<span class="hljs-title function_">waitForAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-title function_">addMatchers</span>();</div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> routerSpy = jasmine.<span class="hljs-title function_">createSpyObj</span>(<span class="hljs-string">'Router'</span>, [<span class="hljs-string">'navigate'</span>]);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>(</div><div class="hljs-ln-line">      <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>({}, appConfig, {</div><div class="hljs-ln-line">        <span class="hljs-attr">providers</span>: [</div><div class="hljs-ln-line">          {<span class="hljs-attr">provide</span>: <span class="hljs-title class_">HeroService</span>, <span class="hljs-attr">useClass</span>: <span class="hljs-title class_">TestHeroService</span>},</div><div class="hljs-ln-line">          {<span class="hljs-attr">provide</span>: <span class="hljs-title class_">Router</span>, <span class="hljs-attr">useValue</span>: routerSpy},</div><div class="hljs-ln-line">        ],</div><div class="hljs-ln-line">      }),</div><div class="hljs-ln-line">    )</div><div class="hljs-ln-line">      .<span class="hljs-title function_">compileComponents</span>()</div><div class="hljs-ln-line">      .<span class="hljs-title function_">then</span>(createComponent);</div><div class="hljs-ln-line">  }));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">it</span>(<span class="hljs-string">'should display heroes'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-title function_">expect</span>(page.<span class="hljs-property">heroRows</span>.<span class="hljs-property">length</span>).<span class="hljs-title function_">toBeGreaterThan</span>(<span class="hljs-number">0</span>);</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">it</span>(<span class="hljs-string">'1st hero should match 1st test hero'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> expectedHero = <span class="hljs-variable constant_">HEROES</span>[<span class="hljs-number">0</span>];</div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> actualHero = page.<span class="hljs-property">heroRows</span>[<span class="hljs-number">0</span>].<span class="hljs-property">textContent</span>;</div><div class="hljs-ln-line">    <span class="hljs-title function_">expect</span>(actualHero).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'hero.id'</span>).<span class="hljs-title function_">toContain</span>(expectedHero.<span class="hljs-property">id</span>.<span class="hljs-title function_">toString</span>());</div><div class="hljs-ln-line">    <span class="hljs-title function_">expect</span>(actualHero).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'hero.name'</span>).<span class="hljs-title function_">toContain</span>(expectedHero.<span class="hljs-property">name</span>);</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">it</span>(<span class="hljs-string">'should select hero on click'</span>, <span class="hljs-title function_">fakeAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> expectedHero = <span class="hljs-variable constant_">HEROES</span>[<span class="hljs-number">1</span>];</div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> btn = page.<span class="hljs-property">heroRows</span>[<span class="hljs-number">1</span>].<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'button'</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    btn!.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">'click'</span>));</div><div class="hljs-ln-line">    <span class="hljs-title function_">tick</span>();</div><div class="hljs-ln-line">    <span class="hljs-comment">// `.toEqual` because selectedHero is clone of expectedHero; see FakeHeroService</span></div><div class="hljs-ln-line">    <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">selectedHero</span>).<span class="hljs-title function_">toEqual</span>(expectedHero);</div><div class="hljs-ln-line">  }));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">it</span>(<span class="hljs-string">'should navigate to selected hero detail on click'</span>, <span class="hljs-title function_">fakeAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> expectedHero = <span class="hljs-variable constant_">HEROES</span>[<span class="hljs-number">1</span>];</div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> btn = page.<span class="hljs-property">heroRows</span>[<span class="hljs-number">1</span>].<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'button'</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    btn!.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">'click'</span>));</div><div class="hljs-ln-line">    <span class="hljs-title function_">tick</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">// should have navigated</span></div><div class="hljs-ln-line">    <span class="hljs-title function_">expect</span>(page.<span class="hljs-property">navSpy</span>.<span class="hljs-property">calls</span>.<span class="hljs-title function_">any</span>()).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'navigate called'</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">// composed hero detail will be URL like 'heroes/42'</span></div><div class="hljs-ln-line">    <span class="hljs-comment">// expect link array with the route path and hero id</span></div><div class="hljs-ln-line">    <span class="hljs-comment">// first argument to router.navigate is link array</span></div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> navArgs = page.<span class="hljs-property">navSpy</span>.<span class="hljs-property">calls</span>.<span class="hljs-title function_">first</span>().<span class="hljs-property">args</span>[<span class="hljs-number">0</span>];</div><div class="hljs-ln-line">    <span class="hljs-title function_">expect</span>(navArgs[<span class="hljs-number">0</span>]).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'nav to heroes detail URL'</span>).<span class="hljs-title function_">toContain</span>(<span class="hljs-string">'heroes'</span>);</div><div class="hljs-ln-line">    <span class="hljs-title function_">expect</span>(navArgs[<span class="hljs-number">1</span>]).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'expected hero.id'</span>).<span class="hljs-title function_">toBe</span>(expectedHero.<span class="hljs-property">id</span>);</div><div class="hljs-ln-line">  }));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">it</span>(<span class="hljs-string">'should find `HighlightDirective` with `By.directive'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-comment">// Can find DebugElement either by css selector or by directive</span></div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> h2 = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'h2'</span>));</div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> directive = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">directive</span>(<span class="hljs-title class_">HighlightDirective</span>));</div><div class="hljs-ln-line">    <span class="hljs-title function_">expect</span>(h2).<span class="hljs-title function_">toBe</span>(directive);</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">it</span>(<span class="hljs-string">'should color header with `HighlightDirective`'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> h2 = page.<span class="hljs-property">highlightDe</span>.<span class="hljs-property">nativeElement</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLElement</span>;</div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> bgColor = h2.<span class="hljs-property">style</span>.<span class="hljs-property">backgroundColor</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">// different browsers report color values differently</span></div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> isExpectedColor = bgColor === <span class="hljs-string">'gold'</span> || bgColor === <span class="hljs-string">'rgb(255, 215, 0)'</span>;</div><div class="hljs-ln-line">    <span class="hljs-title function_">expect</span>(isExpectedColor).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'backgroundColor'</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">it</span>(<span class="hljs-string">"the `HighlightDirective` is among the element's providers"</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-title function_">expect</span>(page.<span class="hljs-property">highlightDe</span>.<span class="hljs-property">providerTokens</span>)</div><div class="hljs-ln-line">      .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'HighlightDirective'</span>)</div><div class="hljs-ln-line">      .<span class="hljs-title function_">toContain</span>(<span class="hljs-title class_">HighlightDirective</span>);</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line">});</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-comment">/////////// Helpers /////</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-comment">/** Create the component and set the `page` test variables */</span></div><div class="hljs-ln-line"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createComponent</span>(<span class="hljs-params"></span>) {</div><div class="hljs-ln-line">  fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">HeroListComponent</span>);</div><div class="hljs-ln-line">  comp = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-comment">// change detection triggers ngOnInit which gets a hero</span></div><div class="hljs-ln-line">  fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-keyword">return</span> fixture.<span class="hljs-title function_">whenStable</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-comment">// got the heroes and updated component</span></div><div class="hljs-ln-line">    <span class="hljs-comment">// change detection updates the view</span></div><div class="hljs-ln-line">    fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">    page = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>();</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Page</span> {</div><div class="hljs-ln-line">  <span class="hljs-comment">/** Hero line elements */</span></div><div class="hljs-ln-line">  <span class="hljs-attr">heroRows</span>: <span class="hljs-title class_">HTMLLIElement</span>[];</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-comment">/** Highlighted DebugElement */</span></div><div class="hljs-ln-line">  <span class="hljs-attr">highlightDe</span>: <span class="hljs-title class_">DebugElement</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-comment">/** Spy on router navigate method */</span></div><div class="hljs-ln-line">  <span class="hljs-attr">navSpy</span>: jasmine.<span class="hljs-property">Spy</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {</div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> heroRowNodes = fixture.<span class="hljs-property">nativeElement</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'li'</span>);</div><div class="hljs-ln-line">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">heroRows</span> = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(heroRowNodes);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">// Find the first element with an attached HighlightDirective</span></div><div class="hljs-ln-line">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">highlightDe</span> = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">directive</span>(<span class="hljs-title class_">HighlightDirective</span>));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">// Get the component's injected router navigation spy</span></div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> routerSpy = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-property">injector</span>.<span class="hljs-title function_">get</span>(<span class="hljs-title class_">Router</span>);</div><div class="hljs-ln-line">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">navSpy</span> = routerSpy.<span class="hljs-property">navigate</span> <span class="hljs-keyword">as</span> jasmine.<span class="hljs-property">Spy</span>;</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div>