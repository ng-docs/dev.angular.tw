<header class="docs-header">
      <docs-breadcrumb></docs-breadcrumb>

      
  <!-- Page title -->
  <div class="docs-page-title">
    <h1 tabindex="-1" data-ng_translator_product="100" data-ng_translator_ref_id="chimgir564h319oeuoiq25652">测试服务</h1>
    <a class="docs-github-links" target="_blank" href="https://github.com/angular/angular/edit/main/adev/src/content/guide/testing/services.md" title="Edit this page" aria-label="Edit this page">
      <!-- Pencil -->
      <docs-icon role="presentation">edit</docs-icon>
    </a>
  </div>
    </header>
    <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="a84796annz6q64lxtl1l3s702">为了检查你的服务是否正常工作，你可以专门为它们编写测试。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="53qikwqhd0f92oa21yajynco4">服务往往是最容易进行单元测试的文件。下面是一些针对 <code>ValueService</code> 的同步和异步单元测试，甚至不需要 Angular 测试工具的帮助。</p>
<div class="docs-code" path="adev/src/content/examples/testing/src/app/demo/demo.spec.ts" visiblelines="8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32" header="app/demo/demo.spec.ts">
    <div class="docs-code-header"><h3>app/demo/demo.spec.ts</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {LightswitchComponent, MasterService, ValueService, ReversePipe} <span class="hljs-keyword">from</span> <span class="hljs-string">'./demo'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">///////// Fakes /////////</div><div class="hljs-ln-line">export <span class="hljs-keyword">class</span> FakeValueService extends ValueService {</div><div class="hljs-ln-line">  override <span class="hljs-keyword">value</span> = <span class="hljs-string">'faked service value'</span>;</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line">////////////////////////</div><div class="hljs-ln-line">describe(<span class="hljs-string">'demo (no TestBed):'</span>, () =&gt; {</div><div class="hljs-ln-line">  // Straight Jasmine testing <span class="hljs-keyword">without</span> Angular<span class="hljs-string">'s testing support</span></div><div class="hljs-ln-line">  describe('ValueServic<span class="hljs-string">e', () =&gt; {</span></div><div class="hljs-ln-line">    let service: ValueService;</div><div class="hljs-ln-line">    beforeEach(() =&gt; {</div><div class="hljs-ln-line">      service = new ValueService();</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('#getValue should <span class="hljs-keyword">return</span> <span class="hljs-type">real</span> valu<span class="hljs-string">e', () =&gt; {</span></div><div class="hljs-ln-line">      expect(service.getValue()).toBe('<span class="hljs-type">real</span> valu<span class="hljs-string">e');</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('#getObservableValue should <span class="hljs-keyword">return</span> <span class="hljs-keyword">value</span> <span class="hljs-keyword">from</span> observabl<span class="hljs-string">e', (done: DoneFn) =&gt; {</span></div><div class="hljs-ln-line">      service.getObservableValue().subscribe((value) =&gt; {</div><div class="hljs-ln-line">        expect(value).toBe('observable valu<span class="hljs-string">e');</span></div><div class="hljs-ln-line">        done();</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('#getPromiseValue should <span class="hljs-keyword">return</span> <span class="hljs-keyword">value</span> <span class="hljs-keyword">from</span> a promis<span class="hljs-string">e', (done: DoneFn) =&gt; {</span></div><div class="hljs-ln-line">      service.getPromiseValue().then((value) =&gt; {</div><div class="hljs-ln-line">        expect(value).toBe('promise valu<span class="hljs-string">e');</span></div><div class="hljs-ln-line">        done();</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  // MasterService requires injection of a ValueService</div><div class="hljs-ln-line">  describe('MasterService <span class="hljs-keyword">without</span> Angular testing support<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">    let masterService: MasterService;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('#getValue should <span class="hljs-keyword">return</span> <span class="hljs-type">real</span> <span class="hljs-keyword">value</span> <span class="hljs-keyword">from</span> the <span class="hljs-type">real</span> servic<span class="hljs-string">e', () =&gt; {</span></div><div class="hljs-ln-line">      masterService = new MasterService(new ValueService());</div><div class="hljs-ln-line">      expect(masterService.getValue()).toBe('<span class="hljs-type">real</span> valu<span class="hljs-string">e');</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('#getValue should <span class="hljs-keyword">return</span> faked <span class="hljs-keyword">value</span> <span class="hljs-keyword">from</span> a fakeServic<span class="hljs-string">e', () =&gt; {</span></div><div class="hljs-ln-line">      masterService = new MasterService(new FakeValueService());</div><div class="hljs-ln-line">      expect(masterService.getValue()).toBe('faked service valu<span class="hljs-string">e');</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('#getValue should <span class="hljs-keyword">return</span> faked <span class="hljs-keyword">value</span> <span class="hljs-keyword">from</span> a fake <span class="hljs-keyword">object</span><span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">      const fake = {getValue: () =&gt; 'fake valu<span class="hljs-string">e'};</span></div><div class="hljs-ln-line">      masterService = new MasterService(fake as ValueService);</div><div class="hljs-ln-line">      expect(masterService.getValue()).toBe('fake valu<span class="hljs-string">e');</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('#getValue should <span class="hljs-keyword">return</span> stubbed <span class="hljs-keyword">value</span> <span class="hljs-keyword">from</span> a spy<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">      // create `getValue` spy on an object representing the ValueService</div><div class="hljs-ln-line">      const valueServiceSpy = jasmine.createSpyObj('ValueServic<span class="hljs-string">e', ['</span>getValu<span class="hljs-string">e']);</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      // set the value to return when the `getValue` spy is called.</div><div class="hljs-ln-line">      const stubValue = 'stub valu<span class="hljs-string">e';</span></div><div class="hljs-ln-line">      valueServiceSpy.getValue.and.returnValue(stubValue);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      masterService = new MasterService(valueServiceSpy);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      expect(masterService.getValue()).withContext('service returned stub valu<span class="hljs-string">e').toBe(stubValue);</span></div><div class="hljs-ln-line">      expect(valueServiceSpy.getValue.calls.count())</div><div class="hljs-ln-line">        .withContext('spy <span class="hljs-keyword">method</span> was <span class="hljs-keyword">called</span> onc<span class="hljs-string">e')</span></div><div class="hljs-ln-line">        .toBe(1);</div><div class="hljs-ln-line">      expect(valueServiceSpy.getValue.calls.mostRecent().returnValue).toBe(stubValue);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  describe('MasterService (<span class="hljs-keyword">no</span> beforeEach)<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">    it('#getValue should <span class="hljs-keyword">return</span> stubbed <span class="hljs-keyword">value</span> <span class="hljs-keyword">from</span> a spy<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">      const {masterService, stubValue, valueServiceSpy} = setup();</div><div class="hljs-ln-line">      expect(masterService.getValue()).withContext('service returned stub valu<span class="hljs-string">e').toBe(stubValue);</span></div><div class="hljs-ln-line">      expect(valueServiceSpy.getValue.calls.count())</div><div class="hljs-ln-line">        .withContext('spy <span class="hljs-keyword">method</span> was <span class="hljs-keyword">called</span> onc<span class="hljs-string">e')</span></div><div class="hljs-ln-line">        .toBe(1);</div><div class="hljs-ln-line">      expect(valueServiceSpy.getValue.calls.mostRecent().returnValue).toBe(stubValue);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    function setup() {</div><div class="hljs-ln-line">      const valueServiceSpy = jasmine.createSpyObj('ValueServic<span class="hljs-string">e', ['</span>getValu<span class="hljs-string">e']);</span></div><div class="hljs-ln-line">      const stubValue = 'stub valu<span class="hljs-string">e';</span></div><div class="hljs-ln-line">      const masterService = new MasterService(valueServiceSpy);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      valueServiceSpy.getValue.and.returnValue(stubValue);</div><div class="hljs-ln-line">      return {masterService, stubValue, valueServiceSpy};</div><div class="hljs-ln-line">    }</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  describe('ReversePip<span class="hljs-string">e', () =&gt; {</span></div><div class="hljs-ln-line">    let pipe: ReversePipe;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    beforeEach(() =&gt; {</div><div class="hljs-ln-line">      pipe = new ReversePipe();</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('transforms "abc" <span class="hljs-keyword">to</span> "cba"<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">      expect(pipe.transform('abc<span class="hljs-string">')).toBe('</span>cba<span class="hljs-string">');</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('<span class="hljs-keyword">no</span> change <span class="hljs-keyword">to</span> palindrome: "able was I ere I saw elba"<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">      const palindrome = 'able was I ere I saw elba<span class="hljs-string">';</span></div><div class="hljs-ln-line">      expect(pipe.transform(palindrome)).toBe(palindrome);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  describe('LightswitchComp<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">    it('#clicked() should toggle #isOn<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">      const comp = new LightswitchComponent();</div><div class="hljs-ln-line">      expect(comp.isOn).withContext('<span class="hljs-keyword">off</span> at first<span class="hljs-string">').toBe(false);</span></div><div class="hljs-ln-line">      comp.clicked();</div><div class="hljs-ln-line">      expect(comp.isOn).withContext('<span class="hljs-keyword">on</span> <span class="hljs-keyword">after</span> click<span class="hljs-string">').toBe(true);</span></div><div class="hljs-ln-line">      comp.clicked();</div><div class="hljs-ln-line">      expect(comp.isOn).withContext('<span class="hljs-keyword">off</span> <span class="hljs-keyword">after</span> second click<span class="hljs-string">').toBe(false);</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('#clicked() should <span class="hljs-keyword">set</span> #message <span class="hljs-keyword">to</span> "is on"<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">      const comp = new LightswitchComponent();</div><div class="hljs-ln-line">      expect(comp.message)</div><div class="hljs-ln-line">        .withContext('<span class="hljs-keyword">off</span> at first<span class="hljs-string">')</span></div><div class="hljs-ln-line">        .toMatch(/is off/i);</div><div class="hljs-ln-line">      comp.clicked();</div><div class="hljs-ln-line">      expect(comp.message).withContext('<span class="hljs-keyword">on</span> <span class="hljs-keyword">after</span> clicked<span class="hljs-string">').toMatch(/is on/i);</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line">});</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div>
  <h2 id="services-with-dependencies">
    <a href="#services-with-dependencies" class="docs-anchor" tabindex="-1" aria-label="Link to Services with dependencies" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="822bp8h8cqw5y49v2v7at3y3t">有依赖的服务</a>
  </h2>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="co7oivmx6lao9k8kbqbzgk3rv">服务通常依赖于 Angular 在构造函数中注入的其它服务。在很多情况下，调用服务的构造函数时，很容易手动创建和<em>注入</em>这些依赖。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="5e61ib8ge8d0nv26t9l7snckp"><code>MasterService</code> 就是一个简单的例子：</p>
<div class="docs-code" path="adev/src/content/examples/testing/src/app/demo/demo.ts" visiblelines="55,56,57,58,59,60,61" header="app/demo/demo.ts">
    <div class="docs-code-header"><h3>app/demo/demo.ts</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {</div><div class="hljs-ln-line">  Component,</div><div class="hljs-ln-line">  ContentChildren,</div><div class="hljs-ln-line">  Directive,</div><div class="hljs-ln-line">  EventEmitter,</div><div class="hljs-ln-line">  HostBinding,</div><div class="hljs-ln-line">  HostListener,</div><div class="hljs-ln-line">  Injectable,</div><div class="hljs-ln-line">  Input,</div><div class="hljs-ln-line">  OnChanges,</div><div class="hljs-ln-line">  OnDestroy,</div><div class="hljs-ln-line">  OnInit,</div><div class="hljs-ln-line">  Optional,</div><div class="hljs-ln-line">  Output,</div><div class="hljs-ln-line">  Pipe,</div><div class="hljs-ln-line">  PipeTransform,</div><div class="hljs-ln-line">  SimpleChanges,</div><div class="hljs-ln-line">} from <span class="hljs-string">'@angular/core'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {FormsModule} from <span class="hljs-string">'@angular/forms'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {of} from <span class="hljs-string">'rxjs'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {delay} from <span class="hljs-string">'rxjs/operators'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {sharedImports} from <span class="hljs-string">'../shared/shared'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-comment">////////// The App: Services and Components for the tests. //////////////</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">export <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Hero</span> {</div><div class="hljs-ln-line">  name: string;</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-comment">////////// Services ///////////////</span></div><div class="hljs-ln-line"><span class="hljs-meta">@Injectable()</span></div><div class="hljs-ln-line">export <span class="hljs-keyword">class</span> <span class="hljs-title class_">ValueService</span> {</div><div class="hljs-ln-line">  value = <span class="hljs-string">'real value'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  getValue() {</div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.value;</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line">  setValue(value: string) {</div><div class="hljs-ln-line">    <span class="hljs-keyword">this</span>.value = value;</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  getObservableValue() {</div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> of(<span class="hljs-string">'observable value'</span>);</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  getPromiseValue() {</div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> Promise.resolve(<span class="hljs-string">'promise value'</span>);</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  getObservableDelayValue() {</div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> of(<span class="hljs-string">'observable delay value'</span>).pipe(delay(<span class="hljs-number">10</span>));</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Injectable()</span></div><div class="hljs-ln-line">export <span class="hljs-keyword">class</span> <span class="hljs-title class_">MasterService</span> {</div><div class="hljs-ln-line">  <span class="hljs-keyword">constructor</span>(<span class="hljs-keyword">private</span> valueService: ValueService) {}</div><div class="hljs-ln-line">  getValue() {</div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.valueService.getValue();</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-comment">/////////// Pipe ////////////////</span></div><div class="hljs-ln-line"><span class="hljs-comment">/*</span></div><div class="hljs-ln-line"> * Reverse the input string.</div><div class="hljs-ln-line"> */</div><div class="hljs-ln-line"><span class="hljs-meta">@Pipe({name: <span class="hljs-string">'reverse'</span>, standalone: true})</span></div><div class="hljs-ln-line">export <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReversePipe</span> <span class="hljs-title">implements</span> <span class="hljs-title">PipeTransform</span> {</div><div class="hljs-ln-line">  transform(s: string) {</div><div class="hljs-ln-line">    let r = <span class="hljs-string">''</span>;</div><div class="hljs-ln-line">    <span class="hljs-keyword">for</span> (let i = s.length; i; ) {</div><div class="hljs-ln-line">      r += s[--i];</div><div class="hljs-ln-line">    }</div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> r;</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-comment">//////////// Components /////////////</span></div><div class="hljs-ln-line"><span class="hljs-meta">@Component({</span></div><div class="hljs-ln-line">  standalone: true,</div><div class="hljs-ln-line">  selector: <span class="hljs-string">'bank-account'</span>,</div><div class="hljs-ln-line">  template: ` Bank Name: {{ bank }} Account Id: {{ id }} `,</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line">export <span class="hljs-keyword">class</span> <span class="hljs-title class_">BankAccountComponent</span> {</div><div class="hljs-ln-line">  <span class="hljs-meta">@Input()</span> bank = <span class="hljs-string">''</span>;</div><div class="hljs-ln-line">  <span class="hljs-meta">@Input(<span class="hljs-string">'account'</span>)</span> id = <span class="hljs-string">''</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-comment">// Removed on 12/02/2016 when ceased public discussion of the `Renderer`. Revive in future?</span></div><div class="hljs-ln-line">  <span class="hljs-comment">// constructor(private renderer: Renderer, private el: ElementRef ) {</span></div><div class="hljs-ln-line">  <span class="hljs-comment">//   renderer.setElementProperty(el.nativeElement, 'customProperty', true);</span></div><div class="hljs-ln-line">  <span class="hljs-comment">// }</span></div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-comment">/** A component with attributes, styles, classes, and property setting */</span></div><div class="hljs-ln-line"><span class="hljs-meta">@Component({</span></div><div class="hljs-ln-line">  standalone: true,</div><div class="hljs-ln-line">  selector: <span class="hljs-string">'bank-account-parent'</span>,</div><div class="hljs-ln-line">  template: `</div><div class="hljs-ln-line">    &lt;bank-account</div><div class="hljs-ln-line">      bank=<span class="hljs-string">"RBC"</span></div><div class="hljs-ln-line">      account=<span class="hljs-string">"4747"</span></div><div class="hljs-ln-line">      [style.width.px]=<span class="hljs-string">"width"</span></div><div class="hljs-ln-line">      [style.color]=<span class="hljs-string">"color"</span></div><div class="hljs-ln-line">      [class.closed]=<span class="hljs-string">"isClosed"</span></div><div class="hljs-ln-line">      [class.open]=<span class="hljs-string">"!isClosed"</span></div><div class="hljs-ln-line">    &gt;</div><div class="hljs-ln-line">    &lt;/bank-account&gt;</div><div class="hljs-ln-line">  `,</div><div class="hljs-ln-line">  imports: [BankAccountComponent],</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line">export <span class="hljs-keyword">class</span> <span class="hljs-title class_">BankAccountParentComponent</span> {</div><div class="hljs-ln-line">  width = <span class="hljs-number">200</span>;</div><div class="hljs-ln-line">  color = <span class="hljs-string">'red'</span>;</div><div class="hljs-ln-line">  isClosed = <span class="hljs-literal">true</span>;</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component({</span></div><div class="hljs-ln-line">  standalone: true,</div><div class="hljs-ln-line">  selector: <span class="hljs-string">'lightswitch-comp'</span>,</div><div class="hljs-ln-line">  template: ` &lt;button type=<span class="hljs-string">"button"</span> (click)=<span class="hljs-string">"clicked()"</span>&gt;Click me!&lt;/button&gt;</div><div class="hljs-ln-line">    &lt;span&gt;{{ message }}&lt;/span&gt;`,</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line">export <span class="hljs-keyword">class</span> <span class="hljs-title class_">LightswitchComponent</span> {</div><div class="hljs-ln-line">  isOn = <span class="hljs-literal">false</span>;</div><div class="hljs-ln-line">  clicked() {</div><div class="hljs-ln-line">    <span class="hljs-keyword">this</span>.isOn = !<span class="hljs-keyword">this</span>.isOn;</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line">  <span class="hljs-keyword">get</span> message() {</div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> `The light <span class="hljs-keyword">is</span> ${<span class="hljs-keyword">this</span>.isOn ? <span class="hljs-string">'On'</span> : <span class="hljs-string">'Off'</span>}`;</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component({</span></div><div class="hljs-ln-line">  standalone: true,</div><div class="hljs-ln-line">  selector: <span class="hljs-string">'child-1'</span>,</div><div class="hljs-ln-line">  template: <span class="hljs-string">'&lt;span&gt;Child-1({{text}})&lt;/span&gt;'</span>,</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line">export <span class="hljs-keyword">class</span> <span class="hljs-title class_">Child1Component</span> {</div><div class="hljs-ln-line">  <span class="hljs-meta">@Input()</span> text = <span class="hljs-string">'Original'</span>;</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component({</span></div><div class="hljs-ln-line">  standalone: true,</div><div class="hljs-ln-line">  selector: <span class="hljs-string">'child-2'</span>,</div><div class="hljs-ln-line">  template: <span class="hljs-string">'&lt;div&gt;Child-2({{text}})&lt;/div&gt;'</span>,</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line">export <span class="hljs-keyword">class</span> <span class="hljs-title class_">Child2Component</span> {</div><div class="hljs-ln-line">  <span class="hljs-meta">@Input()</span> text = <span class="hljs-string">''</span>;</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component({</span></div><div class="hljs-ln-line">  standalone: true,</div><div class="hljs-ln-line">  selector: <span class="hljs-string">'child-3'</span>,</div><div class="hljs-ln-line">  template: <span class="hljs-string">'&lt;div&gt;Child-3({{text}})&lt;/div&gt;'</span>,</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line">export <span class="hljs-keyword">class</span> <span class="hljs-title class_">Child3Component</span> {</div><div class="hljs-ln-line">  <span class="hljs-meta">@Input()</span> text = <span class="hljs-string">''</span>;</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component({</span></div><div class="hljs-ln-line">  standalone: true,</div><div class="hljs-ln-line">  selector: <span class="hljs-string">'input-comp'</span>,</div><div class="hljs-ln-line">  template: <span class="hljs-string">'&lt;input [(ngModel)]="name"&gt;'</span>,</div><div class="hljs-ln-line">  imports: [FormsModule],</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line">export <span class="hljs-keyword">class</span> <span class="hljs-title class_">InputComponent</span> {</div><div class="hljs-ln-line">  name = <span class="hljs-string">'John'</span>;</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-comment">/* Prefer this metadata syntax */</span></div><div class="hljs-ln-line"><span class="hljs-comment">// @Directive({</span></div><div class="hljs-ln-line"><span class="hljs-comment">//   selector: 'input[value]',</span></div><div class="hljs-ln-line"><span class="hljs-comment">//   host: {</span></div><div class="hljs-ln-line"><span class="hljs-comment">//     '[value]': 'value',</span></div><div class="hljs-ln-line"><span class="hljs-comment">//     '(input)': 'valueChange.emit($event.target.value)'</span></div><div class="hljs-ln-line"><span class="hljs-comment">//   },</span></div><div class="hljs-ln-line"><span class="hljs-comment">//   inputs:  ['value'],</span></div><div class="hljs-ln-line"><span class="hljs-comment">//   outputs: ['valueChange']</span></div><div class="hljs-ln-line"><span class="hljs-comment">// })</span></div><div class="hljs-ln-line"><span class="hljs-comment">// export class InputValueBinderDirective {</span></div><div class="hljs-ln-line"><span class="hljs-comment">//   value: any;</span></div><div class="hljs-ln-line"><span class="hljs-comment">//   valueChange: EventEmitter&lt;any&gt; = new EventEmitter();</span></div><div class="hljs-ln-line"><span class="hljs-comment">// }</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-comment">// As the styleguide recommends</span></div><div class="hljs-ln-line"><span class="hljs-meta">@Directive({standalone: true, selector: <span class="hljs-string">'input[value]'</span>})</span></div><div class="hljs-ln-line">export <span class="hljs-keyword">class</span> <span class="hljs-title class_">InputValueBinderDirective</span> {</div><div class="hljs-ln-line">  <span class="hljs-meta">@HostBinding()</span> <span class="hljs-meta">@Input()</span> value: any;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-meta">@Output()</span> valueChange: EventEmitter&lt;any&gt; = new EventEmitter();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-meta">@HostListener(<span class="hljs-string">'input'</span>, [<span class="hljs-string">'$event.target.value'</span>])</span></div><div class="hljs-ln-line">  onInput(value: any) {</div><div class="hljs-ln-line">    <span class="hljs-keyword">this</span>.valueChange.emit(value);</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component({</span></div><div class="hljs-ln-line">  standalone: true,</div><div class="hljs-ln-line">  selector: <span class="hljs-string">'input-value-comp'</span>,</div><div class="hljs-ln-line">  template: ` Name: &lt;input [value]=<span class="hljs-string">"name"</span> /&gt; {{ name }} `,</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line">export <span class="hljs-keyword">class</span> <span class="hljs-title class_">InputValueBinderComponent</span> {</div><div class="hljs-ln-line">  name = <span class="hljs-string">'Sally'</span>; <span class="hljs-comment">// initial value</span></div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component({</span></div><div class="hljs-ln-line">  standalone: true,</div><div class="hljs-ln-line">  selector: <span class="hljs-string">'parent-comp'</span>,</div><div class="hljs-ln-line">  imports: [Child1Component],</div><div class="hljs-ln-line">  template: <span class="hljs-string">'Parent(&lt;child-1&gt;&lt;/child-1&gt;)'</span>,</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line">export <span class="hljs-keyword">class</span> <span class="hljs-title class_">ParentComponent</span> {}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component({</span></div><div class="hljs-ln-line">  standalone: true,</div><div class="hljs-ln-line">  selector: <span class="hljs-string">'io-comp'</span>,</div><div class="hljs-ln-line">  template: <span class="hljs-string">'&lt;button type="button" class="hero" (click)="click()"&gt;Original {{hero.name}}&lt;/button&gt;'</span>,</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line">export <span class="hljs-keyword">class</span> <span class="hljs-title class_">IoComponent</span> {</div><div class="hljs-ln-line">  <span class="hljs-meta">@Input()</span> hero!: Hero;</div><div class="hljs-ln-line">  <span class="hljs-meta">@Output()</span> selected = new EventEmitter&lt;Hero&gt;();</div><div class="hljs-ln-line">  click() {</div><div class="hljs-ln-line">    <span class="hljs-keyword">this</span>.selected.emit(<span class="hljs-keyword">this</span>.hero);</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component({</span></div><div class="hljs-ln-line">  standalone: true,</div><div class="hljs-ln-line">  selector: <span class="hljs-string">'io-parent-comp'</span>,</div><div class="hljs-ln-line">  template: `</div><div class="hljs-ln-line">    @if (!selectedHero) {</div><div class="hljs-ln-line">      &lt;p&gt;&lt;i&gt;Click to select a hero&lt;/i&gt;&lt;/p&gt;</div><div class="hljs-ln-line">    }</div><div class="hljs-ln-line">    @if (selectedHero) {</div><div class="hljs-ln-line">      &lt;p&gt;The selected hero is {{ selectedHero.name }}&lt;/p&gt;</div><div class="hljs-ln-line">    }</div><div class="hljs-ln-line">    @for (hero of heroes; track hero) {</div><div class="hljs-ln-line">      &lt;io-comp [hero]=<span class="hljs-string">"hero"</span> (selected)=<span class="hljs-string">"onSelect(<span class="hljs-variable">$event</span>)"</span>&gt; &lt;/io-comp&gt;</div><div class="hljs-ln-line">    }</div><div class="hljs-ln-line">  `,</div><div class="hljs-ln-line">  imports: [IoComponent, sharedImports],</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line">export <span class="hljs-keyword">class</span> <span class="hljs-title class_">IoParentComponent</span> {</div><div class="hljs-ln-line">  heroes: Hero[] = [{name: <span class="hljs-string">'Bob'</span>}, {name: <span class="hljs-string">'Carol'</span>}, {name: <span class="hljs-string">'Ted'</span>}, {name: <span class="hljs-string">'Alice'</span>}];</div><div class="hljs-ln-line">  selectedHero!: Hero;</div><div class="hljs-ln-line">  onSelect(hero: Hero) {</div><div class="hljs-ln-line">    <span class="hljs-keyword">this</span>.selectedHero = hero;</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component({</span></div><div class="hljs-ln-line">  standalone: true,</div><div class="hljs-ln-line">  selector: <span class="hljs-string">'my-if-comp'</span>,</div><div class="hljs-ln-line">  template: <span class="hljs-string">'MyIf(@if (showMore) {&lt;span&gt;More&lt;/span&gt;})'</span>,</div><div class="hljs-ln-line">  imports: [sharedImports],</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line">export <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyIfComponent</span> {</div><div class="hljs-ln-line">  showMore = <span class="hljs-literal">false</span>;</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component({</span></div><div class="hljs-ln-line">  standalone: true,</div><div class="hljs-ln-line">  selector: <span class="hljs-string">'my-service-comp'</span>,</div><div class="hljs-ln-line">  template: <span class="hljs-string">'injected value: {{valueService.value}}'</span>,</div><div class="hljs-ln-line">  providers: [ValueService],</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line">export <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestProvidersComponent</span> {</div><div class="hljs-ln-line">  <span class="hljs-keyword">constructor</span>(<span class="hljs-keyword">public</span> valueService: ValueService) {}</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component({</span></div><div class="hljs-ln-line">  standalone: true,</div><div class="hljs-ln-line">  selector: <span class="hljs-string">'my-service-comp'</span>,</div><div class="hljs-ln-line">  template: <span class="hljs-string">'injected value: {{valueService.value}}'</span>,</div><div class="hljs-ln-line">  viewProviders: [ValueService],</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line">export <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestViewProvidersComponent</span> {</div><div class="hljs-ln-line">  <span class="hljs-keyword">constructor</span>(<span class="hljs-keyword">public</span> valueService: ValueService) {}</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component({</span></div><div class="hljs-ln-line">  standalone: true,</div><div class="hljs-ln-line">  selector: <span class="hljs-string">'external-template-comp'</span>,</div><div class="hljs-ln-line">  templateUrl: <span class="hljs-string">'./demo-external-template.html'</span>,</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line">export <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExternalTemplateComponent</span> <span class="hljs-title">implements</span> <span class="hljs-title">OnInit</span> {</div><div class="hljs-ln-line">  serviceValue = <span class="hljs-string">''</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-keyword">constructor</span>(<span class="hljs-meta">@Optional()</span> <span class="hljs-keyword">private</span> service?: ValueService) {}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  ngOnInit() {</div><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.service) {</div><div class="hljs-ln-line">      <span class="hljs-keyword">this</span>.serviceValue = <span class="hljs-keyword">this</span>.service.getValue();</div><div class="hljs-ln-line">    }</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component({</span></div><div class="hljs-ln-line">  standalone: true,</div><div class="hljs-ln-line">  selector: <span class="hljs-string">'comp-w-ext-comp'</span>,</div><div class="hljs-ln-line">  imports: [ExternalTemplateComponent],</div><div class="hljs-ln-line">  template: `</div><div class="hljs-ln-line">    &lt;h3&gt;comp-w-ext-comp&lt;/h3&gt;</div><div class="hljs-ln-line">    &lt;external-template-comp&gt;&lt;/external-template-comp&gt;</div><div class="hljs-ln-line">  `,</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line">export <span class="hljs-keyword">class</span> <span class="hljs-title class_">InnerCompWithExternalTemplateComponent</span> {}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component({standalone: true, selector: <span class="hljs-string">'needs-content'</span>, template: <span class="hljs-string">'&lt;ng-content&gt;&lt;/ng-content&gt;'</span>})</span></div><div class="hljs-ln-line">export <span class="hljs-keyword">class</span> <span class="hljs-title class_">NeedsContentComponent</span> {</div><div class="hljs-ln-line">  <span class="hljs-comment">// children with #content local variable</span></div><div class="hljs-ln-line">  <span class="hljs-meta">@ContentChildren(<span class="hljs-string">'content'</span>)</span> children: any;</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-comment">///////// MyIfChildComp ////////</span></div><div class="hljs-ln-line"><span class="hljs-meta">@Component({</span></div><div class="hljs-ln-line">  standalone: true,</div><div class="hljs-ln-line">  selector: <span class="hljs-string">'my-if-child-1'</span>,</div><div class="hljs-ln-line">  template: ` &lt;h4&gt;MyIfChildComp&lt;/h4&gt;</div><div class="hljs-ln-line">    &lt;div&gt;</div><div class="hljs-ln-line">      &lt;label for=<span class="hljs-string">"child-value"</span></div><div class="hljs-ln-line">        &gt;Child value: &lt;input id=<span class="hljs-string">"child-value"</span> [(ngModel)]=<span class="hljs-string">"childValue"</span> /&gt;</div><div class="hljs-ln-line">      &lt;/label&gt;</div><div class="hljs-ln-line">    &lt;/div&gt;</div><div class="hljs-ln-line">    &lt;p&gt;&lt;i&gt;Change log:&lt;/i&gt;&lt;/p&gt;</div><div class="hljs-ln-line">    @for (log of changeLog; track log; let i = $index) {</div><div class="hljs-ln-line">      &lt;div&gt;{{ i + 1 }} - {{ log }}&lt;/div&gt;</div><div class="hljs-ln-line">    }`,</div><div class="hljs-ln-line">  imports: [FormsModule, sharedImports],</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line">export <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyIfChildComponent</span> <span class="hljs-title">implements</span> <span class="hljs-title">OnInit</span>, <span class="hljs-type">OnChanges</span>, <span class="hljs-type">OnDestroy</span> {</div><div class="hljs-ln-line">  <span class="hljs-meta">@Input()</span> value = <span class="hljs-string">''</span>;</div><div class="hljs-ln-line">  <span class="hljs-meta">@Output()</span> valueChange = new EventEmitter&lt;string&gt;();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-keyword">get</span> childValue() {</div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.value;</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line">  <span class="hljs-keyword">set</span> childValue(v: string) {</div><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.value === v) {</div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span>;</div><div class="hljs-ln-line">    }</div><div class="hljs-ln-line">    <span class="hljs-keyword">this</span>.value = v;</div><div class="hljs-ln-line">    <span class="hljs-keyword">this</span>.valueChange.emit(v);</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  changeLog: string[] = [];</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  ngOnInitCalled = <span class="hljs-literal">false</span>;</div><div class="hljs-ln-line">  ngOnChangesCounter = <span class="hljs-number">0</span>;</div><div class="hljs-ln-line">  ngOnDestroyCalled = <span class="hljs-literal">false</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  ngOnInit() {</div><div class="hljs-ln-line">    <span class="hljs-keyword">this</span>.ngOnInitCalled = <span class="hljs-literal">true</span>;</div><div class="hljs-ln-line">    <span class="hljs-keyword">this</span>.changeLog.push(<span class="hljs-string">'ngOnInit called'</span>);</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  ngOnDestroy() {</div><div class="hljs-ln-line">    <span class="hljs-keyword">this</span>.ngOnDestroyCalled = <span class="hljs-literal">true</span>;</div><div class="hljs-ln-line">    <span class="hljs-keyword">this</span>.changeLog.push(<span class="hljs-string">'ngOnDestroy called'</span>);</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  ngOnChanges(changes: SimpleChanges) {</div><div class="hljs-ln-line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> propName <span class="hljs-keyword">in</span> changes) {</div><div class="hljs-ln-line">      <span class="hljs-keyword">this</span>.ngOnChangesCounter += <span class="hljs-number">1</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> prop = changes[propName];</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> cur = JSON.stringify(prop.currentValue);</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> prev = JSON.stringify(prop.previousValue);</div><div class="hljs-ln-line">      <span class="hljs-keyword">this</span>.changeLog.push(`${propName}: currentValue = ${cur}, previousValue = ${prev}`);</div><div class="hljs-ln-line">    }</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-comment">///////// MyIfParentComp ////////</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component({</span></div><div class="hljs-ln-line">  standalone: true,</div><div class="hljs-ln-line">  selector: <span class="hljs-string">'my-if-parent-comp'</span>,</div><div class="hljs-ln-line">  template: `</div><div class="hljs-ln-line">    &lt;h3&gt;MyIfParentComp&lt;/h3&gt;</div><div class="hljs-ln-line">    &lt;label for=<span class="hljs-string">"parent"</span></div><div class="hljs-ln-line">      &gt;Parent value:</div><div class="hljs-ln-line">      &lt;input id=<span class="hljs-string">"parent"</span> [(ngModel)]=<span class="hljs-string">"parentValue"</span> /&gt;</div><div class="hljs-ln-line">    &lt;/label&gt;</div><div class="hljs-ln-line">    &lt;button type=<span class="hljs-string">"button"</span> (click)=<span class="hljs-string">"clicked()"</span>&gt;{{ toggleLabel }} Child&lt;/button&gt;&lt;br /&gt;</div><div class="hljs-ln-line">    @if (showChild) {</div><div class="hljs-ln-line">      &lt;div style=<span class="hljs-string">"margin: 4px; padding: 4px; background-color: aliceblue;"</span>&gt;</div><div class="hljs-ln-line">        &lt;my-if-child-1 [(value)]=<span class="hljs-string">"parentValue"</span>&gt;&lt;/my-if-child-1&gt;</div><div class="hljs-ln-line">      &lt;/div&gt;</div><div class="hljs-ln-line">    }</div><div class="hljs-ln-line">  `,</div><div class="hljs-ln-line">  imports: [FormsModule, MyIfChildComponent, sharedImports],</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line">export <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyIfParentComponent</span> <span class="hljs-title">implements</span> <span class="hljs-title">OnInit</span> {</div><div class="hljs-ln-line">  ngOnInitCalled = <span class="hljs-literal">false</span>;</div><div class="hljs-ln-line">  parentValue = <span class="hljs-string">'Hello, World'</span>;</div><div class="hljs-ln-line">  showChild = <span class="hljs-literal">false</span>;</div><div class="hljs-ln-line">  toggleLabel = <span class="hljs-string">'Unknown'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  ngOnInit() {</div><div class="hljs-ln-line">    <span class="hljs-keyword">this</span>.ngOnInitCalled = <span class="hljs-literal">true</span>;</div><div class="hljs-ln-line">    <span class="hljs-keyword">this</span>.clicked();</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  clicked() {</div><div class="hljs-ln-line">    <span class="hljs-keyword">this</span>.showChild = !<span class="hljs-keyword">this</span>.showChild;</div><div class="hljs-ln-line">    <span class="hljs-keyword">this</span>.toggleLabel = <span class="hljs-keyword">this</span>.showChild ? <span class="hljs-string">'Close'</span> : <span class="hljs-string">'Show'</span>;</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component({</span></div><div class="hljs-ln-line">  standalone: true,</div><div class="hljs-ln-line">  selector: <span class="hljs-string">'reverse-pipe-comp'</span>,</div><div class="hljs-ln-line">  template: `</div><div class="hljs-ln-line">    &lt;input [(ngModel)]=<span class="hljs-string">"text"</span> /&gt;</div><div class="hljs-ln-line">    &lt;span&gt;{{ text | reverse }}&lt;/span&gt;</div><div class="hljs-ln-line">  `,</div><div class="hljs-ln-line">  imports: [ReversePipe, FormsModule],</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line">export <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReversePipeComponent</span> {</div><div class="hljs-ln-line">  text = <span class="hljs-string">'my dog has fleas.'</span>;</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component({</span></div><div class="hljs-ln-line">  standalone: true,</div><div class="hljs-ln-line">  imports: [NeedsContentComponent],</div><div class="hljs-ln-line">  template: <span class="hljs-string">'&lt;div&gt;Replace Me&lt;/div&gt;'</span>,</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line">export <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShellComponent</span> {}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component({</span></div><div class="hljs-ln-line">  standalone: true,</div><div class="hljs-ln-line">  selector: <span class="hljs-string">'demo-comp'</span>,</div><div class="hljs-ln-line">  template: `</div><div class="hljs-ln-line">    &lt;h1&gt;Specs Demo&lt;/h1&gt;</div><div class="hljs-ln-line">    &lt;my-if-parent-comp&gt;&lt;/my-if-parent-comp&gt;</div><div class="hljs-ln-line">    &lt;hr /&gt;</div><div class="hljs-ln-line">    &lt;h3&gt;Input/Output Component&lt;/h3&gt;</div><div class="hljs-ln-line">    &lt;io-parent-comp&gt;&lt;/io-parent-comp&gt;</div><div class="hljs-ln-line">    &lt;hr /&gt;</div><div class="hljs-ln-line">    &lt;h3&gt;External Template Component&lt;/h3&gt;</div><div class="hljs-ln-line">    &lt;external-template-comp&gt;&lt;/external-template-comp&gt;</div><div class="hljs-ln-line">    &lt;hr /&gt;</div><div class="hljs-ln-line">    &lt;h3&gt;Component With External Template Component&lt;/h3&gt;</div><div class="hljs-ln-line">    &lt;comp-w-ext-comp&gt;&lt;/comp-w-ext-comp&gt;</div><div class="hljs-ln-line">    &lt;hr /&gt;</div><div class="hljs-ln-line">    &lt;h3&gt;Reverse Pipe&lt;/h3&gt;</div><div class="hljs-ln-line">    &lt;reverse-pipe-comp&gt;&lt;/reverse-pipe-comp&gt;</div><div class="hljs-ln-line">    &lt;hr /&gt;</div><div class="hljs-ln-line">    &lt;h3&gt;InputValueBinder Directive&lt;/h3&gt;</div><div class="hljs-ln-line">    &lt;input-value-comp&gt;&lt;/input-value-comp&gt;</div><div class="hljs-ln-line">    &lt;hr /&gt;</div><div class="hljs-ln-line">    &lt;h3&gt;Button Component&lt;/h3&gt;</div><div class="hljs-ln-line">    &lt;lightswitch-comp&gt;&lt;/lightswitch-comp&gt;</div><div class="hljs-ln-line">    &lt;hr /&gt;</div><div class="hljs-ln-line">    &lt;h3&gt;Needs Content&lt;/h3&gt;</div><div class="hljs-ln-line">    &lt;needs-content #nc&gt;</div><div class="hljs-ln-line">      &lt;child-1 #content text=<span class="hljs-string">"My"</span>&gt;&lt;/child-1&gt;</div><div class="hljs-ln-line">      &lt;child-2 #content text=<span class="hljs-string">"dog"</span>&gt;&lt;/child-2&gt;</div><div class="hljs-ln-line">      &lt;child-2 text=<span class="hljs-string">"has"</span>&gt;&lt;/child-2&gt;</div><div class="hljs-ln-line">      &lt;child-3 #content text=<span class="hljs-string">"fleas"</span>&gt;&lt;/child-3&gt;</div><div class="hljs-ln-line">      &lt;div #content&gt;!&lt;/div&gt;</div><div class="hljs-ln-line">    &lt;/needs-content&gt;</div><div class="hljs-ln-line">  `,</div><div class="hljs-ln-line">  imports: [</div><div class="hljs-ln-line">    Child1Component,</div><div class="hljs-ln-line">    Child2Component,</div><div class="hljs-ln-line">    Child3Component,</div><div class="hljs-ln-line">    ExternalTemplateComponent,</div><div class="hljs-ln-line">    InnerCompWithExternalTemplateComponent,</div><div class="hljs-ln-line">    InputValueBinderComponent,</div><div class="hljs-ln-line">    IoParentComponent,</div><div class="hljs-ln-line">    LightswitchComponent,</div><div class="hljs-ln-line">    NeedsContentComponent,</div><div class="hljs-ln-line">    ReversePipeComponent,</div><div class="hljs-ln-line">    MyIfParentComponent,</div><div class="hljs-ln-line">  ],</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line">export <span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoComponent</span> {}</div><div class="hljs-ln-line"><span class="hljs-comment">//////// Aggregations ////////////</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">export <span class="hljs-keyword">const</span> demoProviders = [MasterService, ValueService];</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="e732jzduwt4khk20izg6rrvn4"><code>MasterService</code> 只把它唯一的方法 <code>getValue</code> 委托给了所注入的 <code>ValueService</code>。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="7ggnkn8lmdqms3j9gc1yxlife">这里有几种测试方法。</p>
<div class="docs-code" path="adev/src/content/examples/testing/src/app/demo/demo.spec.ts" visiblelines="35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70" header="app/demo/demo.spec.ts">
    <div class="docs-code-header"><h3>app/demo/demo.spec.ts</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {LightswitchComponent, MasterService, ValueService, ReversePipe} <span class="hljs-keyword">from</span> <span class="hljs-string">'./demo'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">///////// Fakes /////////</div><div class="hljs-ln-line">export <span class="hljs-keyword">class</span> FakeValueService extends ValueService {</div><div class="hljs-ln-line">  override <span class="hljs-keyword">value</span> = <span class="hljs-string">'faked service value'</span>;</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line">////////////////////////</div><div class="hljs-ln-line">describe(<span class="hljs-string">'demo (no TestBed):'</span>, () =&gt; {</div><div class="hljs-ln-line">  // Straight Jasmine testing <span class="hljs-keyword">without</span> Angular<span class="hljs-string">'s testing support</span></div><div class="hljs-ln-line">  describe('ValueServic<span class="hljs-string">e', () =&gt; {</span></div><div class="hljs-ln-line">    let service: ValueService;</div><div class="hljs-ln-line">    beforeEach(() =&gt; {</div><div class="hljs-ln-line">      service = new ValueService();</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('#getValue should <span class="hljs-keyword">return</span> <span class="hljs-type">real</span> valu<span class="hljs-string">e', () =&gt; {</span></div><div class="hljs-ln-line">      expect(service.getValue()).toBe('<span class="hljs-type">real</span> valu<span class="hljs-string">e');</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('#getObservableValue should <span class="hljs-keyword">return</span> <span class="hljs-keyword">value</span> <span class="hljs-keyword">from</span> observabl<span class="hljs-string">e', (done: DoneFn) =&gt; {</span></div><div class="hljs-ln-line">      service.getObservableValue().subscribe((value) =&gt; {</div><div class="hljs-ln-line">        expect(value).toBe('observable valu<span class="hljs-string">e');</span></div><div class="hljs-ln-line">        done();</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('#getPromiseValue should <span class="hljs-keyword">return</span> <span class="hljs-keyword">value</span> <span class="hljs-keyword">from</span> a promis<span class="hljs-string">e', (done: DoneFn) =&gt; {</span></div><div class="hljs-ln-line">      service.getPromiseValue().then((value) =&gt; {</div><div class="hljs-ln-line">        expect(value).toBe('promise valu<span class="hljs-string">e');</span></div><div class="hljs-ln-line">        done();</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  // MasterService requires injection of a ValueService</div><div class="hljs-ln-line">  describe('MasterService <span class="hljs-keyword">without</span> Angular testing support<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">    let masterService: MasterService;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('#getValue should <span class="hljs-keyword">return</span> <span class="hljs-type">real</span> <span class="hljs-keyword">value</span> <span class="hljs-keyword">from</span> the <span class="hljs-type">real</span> servic<span class="hljs-string">e', () =&gt; {</span></div><div class="hljs-ln-line">      masterService = new MasterService(new ValueService());</div><div class="hljs-ln-line">      expect(masterService.getValue()).toBe('<span class="hljs-type">real</span> valu<span class="hljs-string">e');</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('#getValue should <span class="hljs-keyword">return</span> faked <span class="hljs-keyword">value</span> <span class="hljs-keyword">from</span> a fakeServic<span class="hljs-string">e', () =&gt; {</span></div><div class="hljs-ln-line">      masterService = new MasterService(new FakeValueService());</div><div class="hljs-ln-line">      expect(masterService.getValue()).toBe('faked service valu<span class="hljs-string">e');</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('#getValue should <span class="hljs-keyword">return</span> faked <span class="hljs-keyword">value</span> <span class="hljs-keyword">from</span> a fake <span class="hljs-keyword">object</span><span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">      const fake = {getValue: () =&gt; 'fake valu<span class="hljs-string">e'};</span></div><div class="hljs-ln-line">      masterService = new MasterService(fake as ValueService);</div><div class="hljs-ln-line">      expect(masterService.getValue()).toBe('fake valu<span class="hljs-string">e');</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('#getValue should <span class="hljs-keyword">return</span> stubbed <span class="hljs-keyword">value</span> <span class="hljs-keyword">from</span> a spy<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">      // create `getValue` spy on an object representing the ValueService</div><div class="hljs-ln-line">      const valueServiceSpy = jasmine.createSpyObj('ValueServic<span class="hljs-string">e', ['</span>getValu<span class="hljs-string">e']);</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      // set the value to return when the `getValue` spy is called.</div><div class="hljs-ln-line">      const stubValue = 'stub valu<span class="hljs-string">e';</span></div><div class="hljs-ln-line">      valueServiceSpy.getValue.and.returnValue(stubValue);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      masterService = new MasterService(valueServiceSpy);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      expect(masterService.getValue()).withContext('service returned stub valu<span class="hljs-string">e').toBe(stubValue);</span></div><div class="hljs-ln-line">      expect(valueServiceSpy.getValue.calls.count())</div><div class="hljs-ln-line">        .withContext('spy <span class="hljs-keyword">method</span> was <span class="hljs-keyword">called</span> onc<span class="hljs-string">e')</span></div><div class="hljs-ln-line">        .toBe(1);</div><div class="hljs-ln-line">      expect(valueServiceSpy.getValue.calls.mostRecent().returnValue).toBe(stubValue);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  describe('MasterService (<span class="hljs-keyword">no</span> beforeEach)<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">    it('#getValue should <span class="hljs-keyword">return</span> stubbed <span class="hljs-keyword">value</span> <span class="hljs-keyword">from</span> a spy<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">      const {masterService, stubValue, valueServiceSpy} = setup();</div><div class="hljs-ln-line">      expect(masterService.getValue()).withContext('service returned stub valu<span class="hljs-string">e').toBe(stubValue);</span></div><div class="hljs-ln-line">      expect(valueServiceSpy.getValue.calls.count())</div><div class="hljs-ln-line">        .withContext('spy <span class="hljs-keyword">method</span> was <span class="hljs-keyword">called</span> onc<span class="hljs-string">e')</span></div><div class="hljs-ln-line">        .toBe(1);</div><div class="hljs-ln-line">      expect(valueServiceSpy.getValue.calls.mostRecent().returnValue).toBe(stubValue);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    function setup() {</div><div class="hljs-ln-line">      const valueServiceSpy = jasmine.createSpyObj('ValueServic<span class="hljs-string">e', ['</span>getValu<span class="hljs-string">e']);</span></div><div class="hljs-ln-line">      const stubValue = 'stub valu<span class="hljs-string">e';</span></div><div class="hljs-ln-line">      const masterService = new MasterService(valueServiceSpy);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      valueServiceSpy.getValue.and.returnValue(stubValue);</div><div class="hljs-ln-line">      return {masterService, stubValue, valueServiceSpy};</div><div class="hljs-ln-line">    }</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  describe('ReversePip<span class="hljs-string">e', () =&gt; {</span></div><div class="hljs-ln-line">    let pipe: ReversePipe;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    beforeEach(() =&gt; {</div><div class="hljs-ln-line">      pipe = new ReversePipe();</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('transforms "abc" <span class="hljs-keyword">to</span> "cba"<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">      expect(pipe.transform('abc<span class="hljs-string">')).toBe('</span>cba<span class="hljs-string">');</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('<span class="hljs-keyword">no</span> change <span class="hljs-keyword">to</span> palindrome: "able was I ere I saw elba"<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">      const palindrome = 'able was I ere I saw elba<span class="hljs-string">';</span></div><div class="hljs-ln-line">      expect(pipe.transform(palindrome)).toBe(palindrome);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  describe('LightswitchComp<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">    it('#clicked() should toggle #isOn<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">      const comp = new LightswitchComponent();</div><div class="hljs-ln-line">      expect(comp.isOn).withContext('<span class="hljs-keyword">off</span> at first<span class="hljs-string">').toBe(false);</span></div><div class="hljs-ln-line">      comp.clicked();</div><div class="hljs-ln-line">      expect(comp.isOn).withContext('<span class="hljs-keyword">on</span> <span class="hljs-keyword">after</span> click<span class="hljs-string">').toBe(true);</span></div><div class="hljs-ln-line">      comp.clicked();</div><div class="hljs-ln-line">      expect(comp.isOn).withContext('<span class="hljs-keyword">off</span> <span class="hljs-keyword">after</span> second click<span class="hljs-string">').toBe(false);</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('#clicked() should <span class="hljs-keyword">set</span> #message <span class="hljs-keyword">to</span> "is on"<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">      const comp = new LightswitchComponent();</div><div class="hljs-ln-line">      expect(comp.message)</div><div class="hljs-ln-line">        .withContext('<span class="hljs-keyword">off</span> at first<span class="hljs-string">')</span></div><div class="hljs-ln-line">        .toMatch(/is off/i);</div><div class="hljs-ln-line">      comp.clicked();</div><div class="hljs-ln-line">      expect(comp.message).withContext('<span class="hljs-keyword">on</span> <span class="hljs-keyword">after</span> clicked<span class="hljs-string">').toMatch(/is on/i);</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line">});</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="8mo0rk841y29ljycwdz3c7he0">第一个测试使用 <code>new</code> 创建了一个 <code>ValueService</code>，并把它传给了 <code>MasterService</code> 的构造函数。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="dh00wa5j9i8tj1tsdmcd2ut5c">然而，注入真实服务很难工作良好，因为大多数被依赖的服务都很难创建和控制。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="bpfetmpsc57xw55guliwvz4o">相反，模拟依赖项，使用一个虚拟值，或者在相关的服务方法上创建一个 
<a href="https://jasmine.github.io/tutorials/your_first_suite#section-Spies" target="_blank">测试间谍</a>。</p>

    <div class="docs-alert docs-alert-helpful">
    <p data-ng_translator_product="100" data-ng_translator_ref_id="7fkels4mxk8uqq6w5m3su0dt4"><strong>有用提示：</strong> 优先使用测试间谍，因为它们通常是模拟服务的最佳方式。</p>

    </div>
    <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="89in4zne91ap3w70mxfxq63jo">这些标准的测试技巧非常适合对服务进行单独测试。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="en2hegrncb618p9tk31py5gwh">但是，你几乎总是使用 Angular 依赖注入机制来将服务注入到应用类中，你应该有一些测试来体现这种使用模式。Angular 测试实用工具可以让你轻松调查这些注入服务的行为。</p>

  <h2 id="testing-services-with-the-testbed">
    <a href="#testing-services-with-the-testbed" class="docs-anchor" tabindex="-1" aria-label="Link to Testing services with the <code>TestBed</code>" data-ng_translator_product="100" data-ng_translator_ref_id="64eq8lj9enkd0h2q84cga0njv">使用 
<code>TestBed</code> 测试服务</a>
  </h2>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="egxwwxsa8vu2639683kxx0vh4">你的应用依赖 Angular 的 
<a href="guide/di">依赖注入（DI）</a>来创建服务。 当一个服务有一个依赖服务时，DI 会找到或创建该依赖服务。 而且如果该依赖服务自身也有依赖项，DI 也会找到或创建它们。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="apk0atyccs1fzjmkrhkx5uvle">作为一个服务的 
<em>消费者</em>，你不需要担心这些。 你不需要担心构造函数参数的顺序或它们是如何创建的。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="8azgovspiyjq5vkxnrxis80j">作为服务
<em>测试者</em>，你必须至少考虑服务依赖的第一级，但当你使用 
<code>TestBed</code> 测试工具提供和创建服务时，<em>可以</em>让 Angular DI 进行服务创建并处理构造函数参数顺序。</p>

  <h2 id="angular-testbed">
    <a href="#angular-testbed" class="docs-anchor" tabindex="-1" aria-label="Link to Angular <code>TestBed</code>">Angular <code>TestBed</code></a>
  </h2>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="20b2wp4c7d27owaz2c03n2sw3"><code>TestBed</code> 是最重要的 Angular 测试工具。 
<code>TestBed</code> 创建一个动态构建的 Angular 
<em>测试</em>模块，模拟一个 Angular 
<a href="guide/ngmodules">@NgModule</a>。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="4nkuoistl2ermwag4nu3ahqyx"><code>TestBed.configureTestingModule()</code> 方法接收一个元数据对象，该对象可以具有大多数 
<a href="guide/ngmodules">@NgModule</a> 的属性。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="cqytnw6gw33y9xdu7dpre6o99">要测试某个服务，你可以在元数据属性 <code>providers</code> 中设置一个要测试或模拟的服务数组。</p>
<div class="docs-code" path="adev/src/content/examples/testing/src/app/demo/demo.testbed.spec.ts" visiblelines="47,48,49,50,52" header="app/demo/demo.testbed.spec.ts (provide ValueService in beforeEach)">
    <div class="docs-code-header"><h3 data-ng_translator_product="100" data-ng_translator_ref_id="5rnu7irnpnbjpgz0kstzfhjqo">app/demo/demo.testbed.spec.ts（在 beforeEach 中提供 ValueService）</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">Component</span>, <span class="hljs-title class_">DebugElement</span>, <span class="hljs-title class_">Injectable</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {</div><div class="hljs-ln-line">  <span class="hljs-title class_">ComponentFixture</span>,</div><div class="hljs-ln-line">  fakeAsync,</div><div class="hljs-ln-line">  inject,</div><div class="hljs-ln-line">  <span class="hljs-title class_">TestBed</span>,</div><div class="hljs-ln-line">  tick,</div><div class="hljs-ln-line">  waitForAsync,</div><div class="hljs-ln-line">} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core/testing'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">FormsModule</span>, <span class="hljs-title class_">NgControl</span>, <span class="hljs-title class_">NgModel</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/forms'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">By</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/platform-browser'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {addMatchers, click} <span class="hljs-keyword">from</span> <span class="hljs-string">'../../testing'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {</div><div class="hljs-ln-line">  <span class="hljs-title class_">BankAccountComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">BankAccountParentComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">Child1Component</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">Child2Component</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">Child3Component</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">ExternalTemplateComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">InputComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">IoComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">IoParentComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">LightswitchComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">MasterService</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">MyIfChildComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">MyIfComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">MyIfParentComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">NeedsContentComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">ParentComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">ReversePipeComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">ShellComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">TestProvidersComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">TestViewProvidersComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">ValueService</span>,</div><div class="hljs-ln-line">} <span class="hljs-keyword">from</span> <span class="hljs-string">'./demo'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NotProvided</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">ValueService</span> {</div><div class="hljs-ln-line">  <span class="hljs-comment">/* example below */</span></div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"><span class="hljs-title function_">beforeEach</span>(addMatchers);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-title function_">describe</span>(<span class="hljs-string">'demo (with TestBed):'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">  <span class="hljs-comment">////////  Service Tests  /////////////</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'ValueService'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">service</span>: <span class="hljs-title class_">ValueService</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({<span class="hljs-attr">providers</span>: [<span class="hljs-title class_">ValueService</span>]});</div><div class="hljs-ln-line">      service = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">inject</span>(<span class="hljs-title class_">ValueService</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should use ValueService'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      service = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">inject</span>(<span class="hljs-title class_">ValueService</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(service.<span class="hljs-title function_">getValue</span>()).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'real value'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'can inject a default value when service is not provided'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(<span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">inject</span>(<span class="hljs-title class_">NotProvided</span>, <span class="hljs-literal">null</span>)).<span class="hljs-title function_">toBeNull</span>();</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'test should wait for ValueService.getPromiseValue'</span>, <span class="hljs-title function_">waitForAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      service.<span class="hljs-title function_">getPromiseValue</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> <span class="hljs-title function_">expect</span>(value).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'promise value'</span>));</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'test should wait for ValueService.getObservableValue'</span>, <span class="hljs-title function_">waitForAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      service.<span class="hljs-title function_">getObservableValue</span>().<span class="hljs-title function_">subscribe</span>(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> <span class="hljs-title function_">expect</span>(value).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'observable value'</span>));</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">// Must use done. See https://github.com/angular/angular/issues/10127</span></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'test should wait for ValueService.getObservableDelayValue'</span>, <span class="hljs-function">(<span class="hljs-params">done: DoneFn</span>) =&gt;</span> {</div><div class="hljs-ln-line">      service.<span class="hljs-title function_">getObservableDelayValue</span>().<span class="hljs-title function_">subscribe</span>(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> {</div><div class="hljs-ln-line">        <span class="hljs-title function_">expect</span>(value).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'observable delay value'</span>);</div><div class="hljs-ln-line">        <span class="hljs-title function_">done</span>();</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should allow the use of fakeAsync'</span>, <span class="hljs-title function_">fakeAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">let</span> <span class="hljs-attr">value</span>: <span class="hljs-built_in">any</span>;</div><div class="hljs-ln-line">      service.<span class="hljs-title function_">getPromiseValue</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">val: <span class="hljs-built_in">any</span></span>) =&gt;</span> (value = val));</div><div class="hljs-ln-line">      <span class="hljs-title function_">tick</span>(); <span class="hljs-comment">// Trigger JS engine cycle until all promises resolve.</span></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(value).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'promise value'</span>);</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'MasterService'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">masterService</span>: <span class="hljs-title class_">MasterService</span>;</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">valueServiceSpy</span>: jasmine.<span class="hljs-property">SpyObj</span>&lt;<span class="hljs-title class_">ValueService</span>&gt;;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> spy = jasmine.<span class="hljs-title function_">createSpyObj</span>(<span class="hljs-string">'ValueService'</span>, [<span class="hljs-string">'getValue'</span>]);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-comment">// Provide both the service-to-test and its (spy) dependency</span></div><div class="hljs-ln-line">        <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">MasterService</span>, {<span class="hljs-attr">provide</span>: <span class="hljs-title class_">ValueService</span>, <span class="hljs-attr">useValue</span>: spy}],</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">      <span class="hljs-comment">// Inject both the service-to-test and its (spy) dependency</span></div><div class="hljs-ln-line">      masterService = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">inject</span>(<span class="hljs-title class_">MasterService</span>);</div><div class="hljs-ln-line">      valueServiceSpy = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">inject</span>(<span class="hljs-title class_">ValueService</span>) <span class="hljs-keyword">as</span> jasmine.<span class="hljs-property">SpyObj</span>&lt;<span class="hljs-title class_">ValueService</span>&gt;;</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'#getValue should return stubbed value from a spy'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> stubValue = <span class="hljs-string">'stub value'</span>;</div><div class="hljs-ln-line">      valueServiceSpy.<span class="hljs-property">getValue</span>.<span class="hljs-property">and</span>.<span class="hljs-title function_">returnValue</span>(stubValue);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(masterService.<span class="hljs-title function_">getValue</span>()).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'service returned stub value'</span>).<span class="hljs-title function_">toBe</span>(stubValue);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(valueServiceSpy.<span class="hljs-property">getValue</span>.<span class="hljs-property">calls</span>.<span class="hljs-title function_">count</span>())</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'spy method was called once'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(<span class="hljs-number">1</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(valueServiceSpy.<span class="hljs-property">getValue</span>.<span class="hljs-property">calls</span>.<span class="hljs-title function_">mostRecent</span>().<span class="hljs-property">returnValue</span>).<span class="hljs-title function_">toBe</span>(stubValue);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'use inject within `it`'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({<span class="hljs-attr">providers</span>: [<span class="hljs-title class_">ValueService</span>]});</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should use modified providers'</span>, <span class="hljs-title function_">inject</span>([<span class="hljs-title class_">ValueService</span>], <span class="hljs-function">(<span class="hljs-params">service: ValueService</span>) =&gt;</span> {</div><div class="hljs-ln-line">      service.<span class="hljs-title function_">setValue</span>(<span class="hljs-string">'value modified in beforeEach'</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(service.<span class="hljs-title function_">getValue</span>()).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'value modified in beforeEach'</span>);</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'using waitForAsync(inject) within beforeEach'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">serviceValue</span>: <span class="hljs-built_in">string</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({<span class="hljs-attr">providers</span>: [<span class="hljs-title class_">ValueService</span>]});</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-title function_">waitForAsync</span>(</div><div class="hljs-ln-line">      <span class="hljs-title function_">inject</span>([<span class="hljs-title class_">ValueService</span>], <span class="hljs-function">(<span class="hljs-params">service: ValueService</span>) =&gt;</span> {</div><div class="hljs-ln-line">        service.<span class="hljs-title function_">getPromiseValue</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> (serviceValue = value));</div><div class="hljs-ln-line">      }),</div><div class="hljs-ln-line">    ));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should use asynchronously modified value ... in synchronous test'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(serviceValue).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'promise value'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-comment">/////////// Component Tests //////////////////</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'TestBed component tests'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-comment">// beforeEach(waitForAsync(() =&gt; {</span></div><div class="hljs-ln-line">    <span class="hljs-comment">//   TestBed.configureTestingModule()</span></div><div class="hljs-ln-line">    <span class="hljs-comment">//     // Compile everything in DemoModule</span></div><div class="hljs-ln-line">    <span class="hljs-comment">//     .compileComponents();</span></div><div class="hljs-ln-line">    <span class="hljs-comment">// }));</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should create a component with inline template'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">Child1Component</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'Child'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should create a component with external template'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">ExternalTemplateComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'from external template'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should allow changing members of the component'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">MyIfComponent</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'MyIf()'</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-property">componentInstance</span>.<span class="hljs-property">showMore</span> = <span class="hljs-literal">true</span>;</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'MyIf(More)'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should create a nested component bound to inputs/outputs'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">IoParentComponent</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> heroes = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">queryAll</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'.hero'</span>));</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(heroes.<span class="hljs-property">length</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'has heroes'</span>).<span class="hljs-title function_">toBeGreaterThan</span>(<span class="hljs-number">0</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> hero = comp.<span class="hljs-property">heroes</span>[<span class="hljs-number">0</span>];</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">click</span>(heroes[<span class="hljs-number">0</span>]);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> selected = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'p'</span>));</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(selected).<span class="hljs-title function_">toHaveText</span>(hero.<span class="hljs-property">name</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'can access the instance variable of an `*ngFor` row component'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">IoParentComponent</span>);</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> heroName = comp.<span class="hljs-property">heroes</span>[<span class="hljs-number">0</span>].<span class="hljs-property">name</span>; <span class="hljs-comment">// first hero's name</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> ngForRow = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">directive</span>(<span class="hljs-title class_">IoComponent</span>)); <span class="hljs-comment">// first hero ngForRow</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> hero = ngForRow.<span class="hljs-property">context</span>.<span class="hljs-property">hero</span>; <span class="hljs-comment">// the hero object passed into the row</span></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(hero.<span class="hljs-property">name</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'ngRow.context.hero'</span>).<span class="hljs-title function_">toBe</span>(heroName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> rowComp = ngForRow.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      <span class="hljs-comment">// jasmine.any is an "instance-of-type" test.</span></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(rowComp).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'component is IoComp'</span>).<span class="hljs-title function_">toEqual</span>(jasmine.<span class="hljs-title function_">any</span>(<span class="hljs-title class_">IoComponent</span>));</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(rowComp.<span class="hljs-property">hero</span>.<span class="hljs-property">name</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'component.hero'</span>).<span class="hljs-title function_">toBe</span>(heroName);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should support clicking a button'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">LightswitchComponent</span>);</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> btn = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'button'</span>));</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> span = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'span'</span>)).<span class="hljs-property">nativeElement</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(span.<span class="hljs-property">textContent</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'before click'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toMatch</span>(<span class="hljs-regexp">/is off/i</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">click</span>(btn);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(span.<span class="hljs-property">textContent</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'after click'</span>).<span class="hljs-title function_">toMatch</span>(<span class="hljs-regexp">/is on/i</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">// ngModel is async so we must wait for it with promise-based `whenStable`</span></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should support entering text in input box (ngModel)'</span>, <span class="hljs-title function_">waitForAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> expectedOrigName = <span class="hljs-string">'John'</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> expectedNewName = <span class="hljs-string">'Sally'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">InputComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> input = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'input'</span>)).<span class="hljs-property">nativeElement</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLInputElement</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">name</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">`At start name should be <span class="hljs-subst">${expectedOrigName}</span> `</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(expectedOrigName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// wait until ngModel binds comp.name to input box</span></div><div class="hljs-ln-line">      fixture</div><div class="hljs-ln-line">        .<span class="hljs-title function_">whenStable</span>()</div><div class="hljs-ln-line">        .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">          <span class="hljs-title function_">expect</span>(input.<span class="hljs-property">value</span>)</div><div class="hljs-ln-line">            .<span class="hljs-title function_">withContext</span>(</div><div class="hljs-ln-line">              <span class="hljs-string">`After ngModel updates input box, input.value should be <span class="hljs-subst">${expectedOrigName}</span> `</span>,</div><div class="hljs-ln-line">            )</div><div class="hljs-ln-line">            .<span class="hljs-title function_">toBe</span>(expectedOrigName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-comment">// simulate user entering new name in input</span></div><div class="hljs-ln-line">          input.<span class="hljs-property">value</span> = expectedNewName;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-comment">// that change doesn't flow to the component immediately</span></div><div class="hljs-ln-line">          <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">name</span>)</div><div class="hljs-ln-line">            .<span class="hljs-title function_">withContext</span>(</div><div class="hljs-ln-line">              <span class="hljs-string">`comp.name should still be <span class="hljs-subst">${expectedOrigName}</span> after value change, before binding happens`</span>,</div><div class="hljs-ln-line">            )</div><div class="hljs-ln-line">            .<span class="hljs-title function_">toBe</span>(expectedOrigName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-comment">// Dispatch a DOM event so that Angular learns of input value change.</span></div><div class="hljs-ln-line">          <span class="hljs-comment">// then wait while ngModel pushes input.box value to comp.name</span></div><div class="hljs-ln-line">          input.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">'input'</span>));</div><div class="hljs-ln-line">          <span class="hljs-keyword">return</span> fixture.<span class="hljs-title function_">whenStable</span>();</div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">          <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">name</span>)</div><div class="hljs-ln-line">            .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">`After ngModel updates the model, comp.name should be <span class="hljs-subst">${expectedNewName}</span> `</span>)</div><div class="hljs-ln-line">            .<span class="hljs-title function_">toBe</span>(expectedNewName);</div><div class="hljs-ln-line">        });</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">// fakeAsync version of ngModel input test enables sync test style</span></div><div class="hljs-ln-line">    <span class="hljs-comment">// synchronous `tick` replaces asynchronous promise-base `whenStable`</span></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should support entering text in input box (ngModel) - fakeAsync'</span>, <span class="hljs-title function_">fakeAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> expectedOrigName = <span class="hljs-string">'John'</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> expectedNewName = <span class="hljs-string">'Sally'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">InputComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> input = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'input'</span>)).<span class="hljs-property">nativeElement</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLInputElement</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">name</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">`At start name should be <span class="hljs-subst">${expectedOrigName}</span> `</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(expectedOrigName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// wait until ngModel binds comp.name to input box</span></div><div class="hljs-ln-line">      <span class="hljs-title function_">tick</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(input.<span class="hljs-property">value</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">`After ngModel updates input box, input.value should be <span class="hljs-subst">${expectedOrigName}</span> `</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(expectedOrigName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// simulate user entering new name in input</span></div><div class="hljs-ln-line">      input.<span class="hljs-property">value</span> = expectedNewName;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// that change doesn't flow to the component immediately</span></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">name</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(</div><div class="hljs-ln-line">          <span class="hljs-string">`comp.name should still be <span class="hljs-subst">${expectedOrigName}</span> after value change, before binding happens`</span>,</div><div class="hljs-ln-line">        )</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(expectedOrigName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// Dispatch a DOM event so that Angular learns of input value change.</span></div><div class="hljs-ln-line">      <span class="hljs-comment">// then wait a tick while ngModel pushes input.box value to comp.name</span></div><div class="hljs-ln-line">      input.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">'input'</span>));</div><div class="hljs-ln-line">      <span class="hljs-title function_">tick</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">name</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">`After ngModel updates the model, comp.name should be <span class="hljs-subst">${expectedNewName}</span> `</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(expectedNewName);</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'ReversePipeComp should reverse the input text'</span>, <span class="hljs-title function_">fakeAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> inputText = <span class="hljs-string">'the quick brown fox.'</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> expectedText = <span class="hljs-string">'.xof nworb kciuq eht'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">ReversePipeComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> input = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'input'</span>)).<span class="hljs-property">nativeElement</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLInputElement</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> span = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'span'</span>)).<span class="hljs-property">nativeElement</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLElement</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// simulate user entering new name in input</span></div><div class="hljs-ln-line">      input.<span class="hljs-property">value</span> = inputText;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// Dispatch a DOM event so that Angular learns of input value change.</span></div><div class="hljs-ln-line">      <span class="hljs-comment">// then wait a tick while ngModel pushes input.box value to comp.text</span></div><div class="hljs-ln-line">      <span class="hljs-comment">// and Angular updates the output span</span></div><div class="hljs-ln-line">      input.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">'input'</span>));</div><div class="hljs-ln-line">      <span class="hljs-title function_">tick</span>();</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(span.<span class="hljs-property">textContent</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'output span'</span>).<span class="hljs-title function_">toBe</span>(expectedText);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">text</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'component.text'</span>).<span class="hljs-title function_">toBe</span>(inputText);</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">// Use this technique to find attached directives of any kind</span></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'can examine attached directives and listeners'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">InputComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> inputEl = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'input'</span>));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(inputEl.<span class="hljs-property">providerTokens</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'NgModel directive'</span>).<span class="hljs-title function_">toContain</span>(<span class="hljs-title class_">NgModel</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> ngControl = inputEl.<span class="hljs-property">injector</span>.<span class="hljs-title function_">get</span>(<span class="hljs-title class_">NgControl</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(ngControl).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'NgControl directive'</span>).<span class="hljs-title function_">toEqual</span>(jasmine.<span class="hljs-title function_">any</span>(<span class="hljs-title class_">NgControl</span>));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(inputEl.<span class="hljs-property">listeners</span>.<span class="hljs-property">length</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'several listeners attached'</span>).<span class="hljs-title function_">toBeGreaterThan</span>(<span class="hljs-number">2</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'BankAccountComponent should set attributes, styles, classes, and properties'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">BankAccountParentComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// the only child is debugElement of the BankAccount component</span></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> el = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-property">children</span>[<span class="hljs-number">0</span>];</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> childComp = el.<span class="hljs-property">componentInstance</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">BankAccountComponent</span>;</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(childComp).<span class="hljs-title function_">toEqual</span>(jasmine.<span class="hljs-title function_">any</span>(<span class="hljs-title class_">BankAccountComponent</span>));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">context</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'context is the child component'</span>).<span class="hljs-title function_">toBe</span>(childComp);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">attributes</span>[<span class="hljs-string">'account'</span>]).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'account attribute'</span>).<span class="hljs-title function_">toBe</span>(childComp.<span class="hljs-property">id</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">attributes</span>[<span class="hljs-string">'bank'</span>]).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'bank attribute'</span>).<span class="hljs-title function_">toBe</span>(childComp.<span class="hljs-property">bank</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">classes</span>[<span class="hljs-string">'closed'</span>]).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'closed class'</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">classes</span>[<span class="hljs-string">'open'</span>]).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'open class'</span>).<span class="hljs-title function_">toBeFalsy</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">styles</span>[<span class="hljs-string">'color'</span>]).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'color style'</span>).<span class="hljs-title function_">toBe</span>(comp.<span class="hljs-property">color</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">styles</span>[<span class="hljs-string">'width'</span>])</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'width style'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(comp.<span class="hljs-property">width</span> + <span class="hljs-string">'px'</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// Removed on 12/02/2016 when ceased public discussion of the `Renderer`. Revive in future?</span></div><div class="hljs-ln-line">      <span class="hljs-comment">// expect(el.properties['customProperty']).toBe(true, 'customProperty');</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'TestBed component overrides:'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">"should override ChildComp's template"</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">Child1Component</span>],</div><div class="hljs-ln-line">      })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">Child1Component</span>, {</div><div class="hljs-ln-line">          <span class="hljs-attr">set</span>: {<span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;span&gt;Fake&lt;/span&gt;'</span>},</div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">Child1Component</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'Fake'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">"should override TestProvidersComp's ValueService provider"</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">TestProvidersComponent</span>],</div><div class="hljs-ln-line">      })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">TestProvidersComponent</span>, {</div><div class="hljs-ln-line">          <span class="hljs-attr">remove</span>: {<span class="hljs-attr">providers</span>: [<span class="hljs-title class_">ValueService</span>]},</div><div class="hljs-ln-line">          <span class="hljs-attr">add</span>: {<span class="hljs-attr">providers</span>: [{<span class="hljs-attr">provide</span>: <span class="hljs-title class_">ValueService</span>, <span class="hljs-attr">useClass</span>: <span class="hljs-title class_">FakeValueService</span>}]},</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-comment">// Or replace them all (this component has only one provider)</span></div><div class="hljs-ln-line">          <span class="hljs-comment">// set:    { providers: [{ provide: ValueService, useClass: FakeValueService }] },</span></div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">TestProvidersComponent</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'injected value: faked value'</span>, <span class="hljs-string">'text'</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// Explore the providerTokens</span></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> tokens = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-property">providerTokens</span>;</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(tokens).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'component ctor'</span>).<span class="hljs-title function_">toContain</span>(fixture.<span class="hljs-property">componentInstance</span>.<span class="hljs-property">constructor</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(tokens).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'TestProvidersComp'</span>).<span class="hljs-title function_">toContain</span>(<span class="hljs-title class_">TestProvidersComponent</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(tokens).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'ValueService'</span>).<span class="hljs-title function_">toContain</span>(<span class="hljs-title class_">ValueService</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">"should override TestViewProvidersComp's ValueService viewProvider"</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">TestViewProvidersComponent</span>],</div><div class="hljs-ln-line">      })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">TestViewProvidersComponent</span>, {</div><div class="hljs-ln-line">          <span class="hljs-comment">// remove: { viewProviders: [ValueService]},</span></div><div class="hljs-ln-line">          <span class="hljs-comment">// add:    { viewProviders: [{ provide: ValueService, useClass: FakeValueService }]</span></div><div class="hljs-ln-line">          <span class="hljs-comment">// },</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-comment">// Or replace them all (this component has only one viewProvider)</span></div><div class="hljs-ln-line">          <span class="hljs-attr">set</span>: {<span class="hljs-attr">viewProviders</span>: [{<span class="hljs-attr">provide</span>: <span class="hljs-title class_">ValueService</span>, <span class="hljs-attr">useClass</span>: <span class="hljs-title class_">FakeValueService</span>}]},</div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">TestViewProvidersComponent</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'injected value: faked value'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">"injected provider should not be same as component's provider"</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-comment">// TestComponent is parent of TestProvidersComponent</span></div><div class="hljs-ln-line">      <span class="hljs-meta">@Component</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">standalone</span>: <span class="hljs-literal">true</span>,</div><div class="hljs-ln-line">        <span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;my-service-comp&gt;&lt;/my-service-comp&gt;'</span>,</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">TestProvidersComponent</span>],</div><div class="hljs-ln-line">      })</div><div class="hljs-ln-line">      <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestComponent</span> {}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// 3 levels of ValueService provider: module, TestComponent, TestProvidersComponent</span></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">TestComponent</span>, <span class="hljs-title class_">TestProvidersComponent</span>],</div><div class="hljs-ln-line">        <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">ValueService</span>],</div><div class="hljs-ln-line">      })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">TestComponent</span>, {</div><div class="hljs-ln-line">          <span class="hljs-attr">set</span>: {<span class="hljs-attr">providers</span>: [{<span class="hljs-attr">provide</span>: <span class="hljs-title class_">ValueService</span>, <span class="hljs-attr">useValue</span>: {}}]},</div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">TestProvidersComponent</span>, {</div><div class="hljs-ln-line">          <span class="hljs-attr">set</span>: {<span class="hljs-attr">providers</span>: [{<span class="hljs-attr">provide</span>: <span class="hljs-title class_">ValueService</span>, <span class="hljs-attr">useClass</span>: <span class="hljs-title class_">FakeValueService</span>}]},</div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">TestComponent</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">let</span> testBedProvider!: <span class="hljs-title class_">ValueService</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// `inject` uses TestBed's injector</span></div><div class="hljs-ln-line">      <span class="hljs-title function_">inject</span>([<span class="hljs-title class_">ValueService</span>], <span class="hljs-function">(<span class="hljs-params">s: ValueService</span>) =&gt;</span> (testBedProvider = s))();</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> tcProvider = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-property">injector</span>.<span class="hljs-title function_">get</span>(<span class="hljs-title class_">ValueService</span>) <span class="hljs-keyword">as</span> <span class="hljs-title class_">ValueService</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> tpcProvider = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-property">children</span>[<span class="hljs-number">0</span>].<span class="hljs-property">injector</span>.<span class="hljs-title function_">get</span>(</div><div class="hljs-ln-line">        <span class="hljs-title class_">ValueService</span>,</div><div class="hljs-ln-line">      ) <span class="hljs-keyword">as</span> <span class="hljs-title class_">FakeValueService</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(testBedProvider).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'testBed/tc not same providers'</span>).<span class="hljs-property">not</span>.<span class="hljs-title function_">toBe</span>(tcProvider);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(testBedProvider).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'testBed/tpc not same providers'</span>).<span class="hljs-property">not</span>.<span class="hljs-title function_">toBe</span>(tpcProvider);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(testBedProvider <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">ValueService</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'testBedProvider is ValueService'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(tcProvider)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'tcProvider is {}'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toEqual</span>({} <span class="hljs-keyword">as</span> <span class="hljs-title class_">ValueService</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(tpcProvider <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">FakeValueService</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'tpcProvider is FakeValueService'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'can access template local variables as references'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [</div><div class="hljs-ln-line">          <span class="hljs-title class_">ShellComponent</span>,</div><div class="hljs-ln-line">          <span class="hljs-title class_">NeedsContentComponent</span>,</div><div class="hljs-ln-line">          <span class="hljs-title class_">Child1Component</span>,</div><div class="hljs-ln-line">          <span class="hljs-title class_">Child2Component</span>,</div><div class="hljs-ln-line">          <span class="hljs-title class_">Child3Component</span>,</div><div class="hljs-ln-line">        ],</div><div class="hljs-ln-line">      })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">ShellComponent</span>, {</div><div class="hljs-ln-line">          <span class="hljs-attr">set</span>: {</div><div class="hljs-ln-line">            <span class="hljs-attr">selector</span>: <span class="hljs-string">'test-shell'</span>,</div><div class="hljs-ln-line">            <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">NeedsContentComponent</span>, <span class="hljs-title class_">Child1Component</span>, <span class="hljs-title class_">Child2Component</span>, <span class="hljs-title class_">Child3Component</span>],</div><div class="hljs-ln-line">            <span class="hljs-attr">template</span>: <span class="hljs-string">`</span></div><div class="hljs-ln-line">          &lt;needs-content #nc&gt;</div><div class="hljs-ln-line">            &lt;child-1 #content text="My"&gt;&lt;/child-1&gt;</div><div class="hljs-ln-line">            &lt;child-2 #content text="dog"&gt;&lt;/child-2&gt;</div><div class="hljs-ln-line">            &lt;child-2 text="has"&gt;&lt;/child-2&gt;</div><div class="hljs-ln-line">            &lt;child-3 #content text="fleas"&gt;&lt;/child-3&gt;</div><div class="hljs-ln-line">            &lt;div #content&gt;!&lt;/div&gt;</div><div class="hljs-ln-line">          &lt;/needs-content&gt;</div><div class="hljs-ln-line">          `,</div><div class="hljs-ln-line">          },</div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">ShellComponent</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// NeedsContentComp is the child of ShellComp</span></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> el = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-property">children</span>[<span class="hljs-number">0</span>];</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = el.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">children</span>.<span class="hljs-title function_">toArray</span>().<span class="hljs-property">length</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'three different child components and an ElementRef with #content'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(<span class="hljs-number">4</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">references</span>[<span class="hljs-string">'nc'</span>]).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'#nc reference to component'</span>).<span class="hljs-title function_">toBe</span>(comp);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// Filter for DebugElements with a #content reference</span></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> contentRefs = el.<span class="hljs-title function_">queryAll</span>(<span class="hljs-function">(<span class="hljs-params">de</span>) =&gt;</span> de.<span class="hljs-property">references</span>[<span class="hljs-string">'content'</span>]);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(contentRefs.<span class="hljs-property">length</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'elements w/ a #content reference'</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-number">4</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'nested (one-deep) component override'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">ParentComponent</span>, <span class="hljs-title class_">FakeChildComponent</span>],</div><div class="hljs-ln-line">      }).<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">ParentComponent</span>, {</div><div class="hljs-ln-line">        <span class="hljs-attr">set</span>: {<span class="hljs-attr">imports</span>: [<span class="hljs-title class_">FakeChildComponent</span>]},</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'ParentComp should use Fake Child component'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">ParentComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'Parent(Fake Child)'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'nested (two-deep) component override'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">ParentComponent</span>, <span class="hljs-title class_">FakeChildWithGrandchildComponent</span>, <span class="hljs-title class_">FakeGrandchildComponent</span>],</div><div class="hljs-ln-line">      }).<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">ParentComponent</span>, {</div><div class="hljs-ln-line">        <span class="hljs-attr">set</span>: {<span class="hljs-attr">imports</span>: [<span class="hljs-title class_">FakeChildWithGrandchildComponent</span>, <span class="hljs-title class_">FakeGrandchildComponent</span>]},</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should use Fake Grandchild component'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">ParentComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'Parent(Fake Child(Fake Grandchild))'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'lifecycle hooks w/ MyIfParentComp'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">fixture</span>: <span class="hljs-title class_">ComponentFixture</span>&lt;<span class="hljs-title class_">MyIfParentComponent</span>&gt;;</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">parent</span>: <span class="hljs-title class_">MyIfParentComponent</span>;</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">child</span>: <span class="hljs-title class_">MyIfChildComponent</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">FormsModule</span>, <span class="hljs-title class_">MyIfChildComponent</span>, <span class="hljs-title class_">MyIfParentComponent</span>],</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">MyIfParentComponent</span>);</div><div class="hljs-ln-line">      parent = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should instantiate parent component'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(parent).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'parent component should exist'</span>).<span class="hljs-property">not</span>.<span class="hljs-title function_">toBeNull</span>();</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'parent component OnInit should NOT be called before first detectChanges()'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(parent.<span class="hljs-property">ngOnInitCalled</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">false</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'parent component OnInit should be called after first detectChanges()'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(parent.<span class="hljs-property">ngOnInitCalled</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'child component should exist after OnInit'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">getChild</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(child <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">MyIfChildComponent</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'should create child'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">"should have called child component's OnInit "</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">getChild</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(child.<span class="hljs-property">ngOnInitCalled</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'child component called OnChanges once'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">getChild</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(child.<span class="hljs-property">ngOnChangesCounter</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-number">1</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'changed parent value flows to child'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">getChild</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      parent.<span class="hljs-property">parentValue</span> = <span class="hljs-string">'foo'</span>;</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(child.<span class="hljs-property">ngOnChangesCounter</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'expected 2 changes: initial value and changed value'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(<span class="hljs-number">2</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(child.<span class="hljs-property">childValue</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'childValue should eq changed parent value'</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'foo'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">// must be async test to see child flow to parent</span></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'changed child value flows to parent'</span>, <span class="hljs-title function_">waitForAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">getChild</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      child.<span class="hljs-property">childValue</span> = <span class="hljs-string">'bar'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {</div><div class="hljs-ln-line">        <span class="hljs-comment">// Wait one JS engine turn!</span></div><div class="hljs-ln-line">        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(), <span class="hljs-number">0</span>);</div><div class="hljs-ln-line">      }).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">        fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">        <span class="hljs-title function_">expect</span>(child.<span class="hljs-property">ngOnChangesCounter</span>)</div><div class="hljs-ln-line">          .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'expected 2 changes: initial value and changed value'</span>)</div><div class="hljs-ln-line">          .<span class="hljs-title function_">toBe</span>(<span class="hljs-number">2</span>);</div><div class="hljs-ln-line">        <span class="hljs-title function_">expect</span>(parent.<span class="hljs-property">parentValue</span>)</div><div class="hljs-ln-line">          .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'parentValue should eq changed parent value'</span>)</div><div class="hljs-ln-line">          .<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'bar'</span>);</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'clicking "Close Child" triggers child OnDestroy'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">getChild</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> btn = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'button'</span>));</div><div class="hljs-ln-line">      <span class="hljs-title function_">click</span>(btn);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(child.<span class="hljs-property">ngOnDestroyCalled</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">////// helpers ///</span></div><div class="hljs-ln-line">    <span class="hljs-comment">/**</span></div><div class="hljs-ln-line">     * Get the MyIfChildComp from parent; fail w/ good message if cannot.</div><div class="hljs-ln-line">     */</div><div class="hljs-ln-line">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">getChild</span>(<span class="hljs-params"></span>) {</div><div class="hljs-ln-line">      <span class="hljs-keyword">let</span> <span class="hljs-attr">childDe</span>: <span class="hljs-title class_">DebugElement</span>; <span class="hljs-comment">// DebugElement that should hold the MyIfChildComp</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// The Hard Way: requires detailed knowledge of the parent template</span></div><div class="hljs-ln-line">      <span class="hljs-keyword">try</span> {</div><div class="hljs-ln-line">        childDe = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-property">children</span>[<span class="hljs-number">4</span>].<span class="hljs-property">children</span>[<span class="hljs-number">0</span>];</div><div class="hljs-ln-line">      } <span class="hljs-keyword">catch</span> (err) {</div><div class="hljs-ln-line">        <span class="hljs-comment">/* we'll report the error */</span></div><div class="hljs-ln-line">      }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// DebugElement.queryAll: if we wanted all of many instances:</span></div><div class="hljs-ln-line">      childDe = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">queryAll</span>(</div><div class="hljs-ln-line">        <span class="hljs-function">(<span class="hljs-params">de</span>) =&gt;</span> de.<span class="hljs-property">componentInstance</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">MyIfChildComponent</span>,</div><div class="hljs-ln-line">      )[<span class="hljs-number">0</span>];</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// WE'LL USE THIS APPROACH !</span></div><div class="hljs-ln-line">      <span class="hljs-comment">// DebugElement.query: find first instance (if any)</span></div><div class="hljs-ln-line">      childDe = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(</div><div class="hljs-ln-line">        <span class="hljs-function">(<span class="hljs-params">de</span>) =&gt;</span> de.<span class="hljs-property">componentInstance</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">MyIfChildComponent</span>,</div><div class="hljs-ln-line">      );</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">if</span> (childDe &amp;&amp; childDe.<span class="hljs-property">componentInstance</span>) {</div><div class="hljs-ln-line">        child = childDe.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      } <span class="hljs-keyword">else</span> {</div><div class="hljs-ln-line">        <span class="hljs-title function_">fail</span>(<span class="hljs-string">'Unable to find MyIfChildComp within MyIfParentComp'</span>);</div><div class="hljs-ln-line">      }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> child;</div><div class="hljs-ln-line">    }</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line">});</div><div class="hljs-ln-line"><span class="hljs-comment">////////// Fakes ///////////</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component</span>({</div><div class="hljs-ln-line">  <span class="hljs-attr">standalone</span>: <span class="hljs-literal">true</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">selector</span>: <span class="hljs-string">'child-1'</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">template</span>: <span class="hljs-string">'Fake Child'</span>,</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FakeChildComponent</span> {}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component</span>({</div><div class="hljs-ln-line">  <span class="hljs-attr">standalone</span>: <span class="hljs-literal">true</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">selector</span>: <span class="hljs-string">'grandchild-1'</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">template</span>: <span class="hljs-string">'Fake Grandchild'</span>,</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FakeGrandchildComponent</span> {}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component</span>({</div><div class="hljs-ln-line">  <span class="hljs-attr">standalone</span>: <span class="hljs-literal">true</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">selector</span>: <span class="hljs-string">'child-1'</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">FakeGrandchildComponent</span>],</div><div class="hljs-ln-line">  <span class="hljs-attr">template</span>: <span class="hljs-string">'Fake Child(&lt;grandchild-1&gt;&lt;/grandchild-1&gt;)'</span>,</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FakeChildWithGrandchildComponent</span> {}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Injectable</span>()</div><div class="hljs-ln-line"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FakeValueService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">ValueService</span> {</div><div class="hljs-ln-line">  <span class="hljs-keyword">override</span> value = <span class="hljs-string">'faked value'</span>;</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="7ount23d7ps19jgpxuanot8p6">将服务类作为参数调用 <code>TestBed.inject()</code>，将它注入到测试中。</p>

    <div class="docs-alert docs-alert-helpful">
    <p data-ng_translator_product="100" data-ng_translator_ref_id="397cjx4fuvzaizn92qxghm59o"><strong>有用提示：</strong> 
<code>TestBed.get()</code> 从 Angular 版本 9 开始已被弃用。 为了帮助减少破坏性变更，Angular 引入了一个新函数 
<code>TestBed.inject()</code>，你应该改用它。</p>

    </div>
    <div class="docs-code" path="adev/src/content/examples/testing/src/app/demo/demo.testbed.spec.ts" visiblelines="54,55,56,57">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">Component</span>, <span class="hljs-title class_">DebugElement</span>, <span class="hljs-title class_">Injectable</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {</div><div class="hljs-ln-line">  <span class="hljs-title class_">ComponentFixture</span>,</div><div class="hljs-ln-line">  fakeAsync,</div><div class="hljs-ln-line">  inject,</div><div class="hljs-ln-line">  <span class="hljs-title class_">TestBed</span>,</div><div class="hljs-ln-line">  tick,</div><div class="hljs-ln-line">  waitForAsync,</div><div class="hljs-ln-line">} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core/testing'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">FormsModule</span>, <span class="hljs-title class_">NgControl</span>, <span class="hljs-title class_">NgModel</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/forms'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">By</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/platform-browser'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {addMatchers, click} <span class="hljs-keyword">from</span> <span class="hljs-string">'../../testing'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {</div><div class="hljs-ln-line">  <span class="hljs-title class_">BankAccountComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">BankAccountParentComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">Child1Component</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">Child2Component</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">Child3Component</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">ExternalTemplateComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">InputComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">IoComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">IoParentComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">LightswitchComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">MasterService</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">MyIfChildComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">MyIfComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">MyIfParentComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">NeedsContentComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">ParentComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">ReversePipeComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">ShellComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">TestProvidersComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">TestViewProvidersComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">ValueService</span>,</div><div class="hljs-ln-line">} <span class="hljs-keyword">from</span> <span class="hljs-string">'./demo'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NotProvided</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">ValueService</span> {</div><div class="hljs-ln-line">  <span class="hljs-comment">/* example below */</span></div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"><span class="hljs-title function_">beforeEach</span>(addMatchers);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-title function_">describe</span>(<span class="hljs-string">'demo (with TestBed):'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">  <span class="hljs-comment">////////  Service Tests  /////////////</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'ValueService'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">service</span>: <span class="hljs-title class_">ValueService</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({<span class="hljs-attr">providers</span>: [<span class="hljs-title class_">ValueService</span>]});</div><div class="hljs-ln-line">      service = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">inject</span>(<span class="hljs-title class_">ValueService</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should use ValueService'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      service = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">inject</span>(<span class="hljs-title class_">ValueService</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(service.<span class="hljs-title function_">getValue</span>()).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'real value'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'can inject a default value when service is not provided'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(<span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">inject</span>(<span class="hljs-title class_">NotProvided</span>, <span class="hljs-literal">null</span>)).<span class="hljs-title function_">toBeNull</span>();</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'test should wait for ValueService.getPromiseValue'</span>, <span class="hljs-title function_">waitForAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      service.<span class="hljs-title function_">getPromiseValue</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> <span class="hljs-title function_">expect</span>(value).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'promise value'</span>));</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'test should wait for ValueService.getObservableValue'</span>, <span class="hljs-title function_">waitForAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      service.<span class="hljs-title function_">getObservableValue</span>().<span class="hljs-title function_">subscribe</span>(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> <span class="hljs-title function_">expect</span>(value).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'observable value'</span>));</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">// Must use done. See https://github.com/angular/angular/issues/10127</span></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'test should wait for ValueService.getObservableDelayValue'</span>, <span class="hljs-function">(<span class="hljs-params">done: DoneFn</span>) =&gt;</span> {</div><div class="hljs-ln-line">      service.<span class="hljs-title function_">getObservableDelayValue</span>().<span class="hljs-title function_">subscribe</span>(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> {</div><div class="hljs-ln-line">        <span class="hljs-title function_">expect</span>(value).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'observable delay value'</span>);</div><div class="hljs-ln-line">        <span class="hljs-title function_">done</span>();</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should allow the use of fakeAsync'</span>, <span class="hljs-title function_">fakeAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">let</span> <span class="hljs-attr">value</span>: <span class="hljs-built_in">any</span>;</div><div class="hljs-ln-line">      service.<span class="hljs-title function_">getPromiseValue</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">val: <span class="hljs-built_in">any</span></span>) =&gt;</span> (value = val));</div><div class="hljs-ln-line">      <span class="hljs-title function_">tick</span>(); <span class="hljs-comment">// Trigger JS engine cycle until all promises resolve.</span></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(value).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'promise value'</span>);</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'MasterService'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">masterService</span>: <span class="hljs-title class_">MasterService</span>;</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">valueServiceSpy</span>: jasmine.<span class="hljs-property">SpyObj</span>&lt;<span class="hljs-title class_">ValueService</span>&gt;;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> spy = jasmine.<span class="hljs-title function_">createSpyObj</span>(<span class="hljs-string">'ValueService'</span>, [<span class="hljs-string">'getValue'</span>]);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-comment">// Provide both the service-to-test and its (spy) dependency</span></div><div class="hljs-ln-line">        <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">MasterService</span>, {<span class="hljs-attr">provide</span>: <span class="hljs-title class_">ValueService</span>, <span class="hljs-attr">useValue</span>: spy}],</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">      <span class="hljs-comment">// Inject both the service-to-test and its (spy) dependency</span></div><div class="hljs-ln-line">      masterService = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">inject</span>(<span class="hljs-title class_">MasterService</span>);</div><div class="hljs-ln-line">      valueServiceSpy = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">inject</span>(<span class="hljs-title class_">ValueService</span>) <span class="hljs-keyword">as</span> jasmine.<span class="hljs-property">SpyObj</span>&lt;<span class="hljs-title class_">ValueService</span>&gt;;</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'#getValue should return stubbed value from a spy'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> stubValue = <span class="hljs-string">'stub value'</span>;</div><div class="hljs-ln-line">      valueServiceSpy.<span class="hljs-property">getValue</span>.<span class="hljs-property">and</span>.<span class="hljs-title function_">returnValue</span>(stubValue);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(masterService.<span class="hljs-title function_">getValue</span>()).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'service returned stub value'</span>).<span class="hljs-title function_">toBe</span>(stubValue);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(valueServiceSpy.<span class="hljs-property">getValue</span>.<span class="hljs-property">calls</span>.<span class="hljs-title function_">count</span>())</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'spy method was called once'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(<span class="hljs-number">1</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(valueServiceSpy.<span class="hljs-property">getValue</span>.<span class="hljs-property">calls</span>.<span class="hljs-title function_">mostRecent</span>().<span class="hljs-property">returnValue</span>).<span class="hljs-title function_">toBe</span>(stubValue);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'use inject within `it`'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({<span class="hljs-attr">providers</span>: [<span class="hljs-title class_">ValueService</span>]});</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should use modified providers'</span>, <span class="hljs-title function_">inject</span>([<span class="hljs-title class_">ValueService</span>], <span class="hljs-function">(<span class="hljs-params">service: ValueService</span>) =&gt;</span> {</div><div class="hljs-ln-line">      service.<span class="hljs-title function_">setValue</span>(<span class="hljs-string">'value modified in beforeEach'</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(service.<span class="hljs-title function_">getValue</span>()).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'value modified in beforeEach'</span>);</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'using waitForAsync(inject) within beforeEach'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">serviceValue</span>: <span class="hljs-built_in">string</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({<span class="hljs-attr">providers</span>: [<span class="hljs-title class_">ValueService</span>]});</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-title function_">waitForAsync</span>(</div><div class="hljs-ln-line">      <span class="hljs-title function_">inject</span>([<span class="hljs-title class_">ValueService</span>], <span class="hljs-function">(<span class="hljs-params">service: ValueService</span>) =&gt;</span> {</div><div class="hljs-ln-line">        service.<span class="hljs-title function_">getPromiseValue</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> (serviceValue = value));</div><div class="hljs-ln-line">      }),</div><div class="hljs-ln-line">    ));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should use asynchronously modified value ... in synchronous test'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(serviceValue).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'promise value'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-comment">/////////// Component Tests //////////////////</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'TestBed component tests'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-comment">// beforeEach(waitForAsync(() =&gt; {</span></div><div class="hljs-ln-line">    <span class="hljs-comment">//   TestBed.configureTestingModule()</span></div><div class="hljs-ln-line">    <span class="hljs-comment">//     // Compile everything in DemoModule</span></div><div class="hljs-ln-line">    <span class="hljs-comment">//     .compileComponents();</span></div><div class="hljs-ln-line">    <span class="hljs-comment">// }));</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should create a component with inline template'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">Child1Component</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'Child'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should create a component with external template'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">ExternalTemplateComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'from external template'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should allow changing members of the component'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">MyIfComponent</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'MyIf()'</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-property">componentInstance</span>.<span class="hljs-property">showMore</span> = <span class="hljs-literal">true</span>;</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'MyIf(More)'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should create a nested component bound to inputs/outputs'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">IoParentComponent</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> heroes = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">queryAll</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'.hero'</span>));</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(heroes.<span class="hljs-property">length</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'has heroes'</span>).<span class="hljs-title function_">toBeGreaterThan</span>(<span class="hljs-number">0</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> hero = comp.<span class="hljs-property">heroes</span>[<span class="hljs-number">0</span>];</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">click</span>(heroes[<span class="hljs-number">0</span>]);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> selected = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'p'</span>));</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(selected).<span class="hljs-title function_">toHaveText</span>(hero.<span class="hljs-property">name</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'can access the instance variable of an `*ngFor` row component'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">IoParentComponent</span>);</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> heroName = comp.<span class="hljs-property">heroes</span>[<span class="hljs-number">0</span>].<span class="hljs-property">name</span>; <span class="hljs-comment">// first hero's name</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> ngForRow = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">directive</span>(<span class="hljs-title class_">IoComponent</span>)); <span class="hljs-comment">// first hero ngForRow</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> hero = ngForRow.<span class="hljs-property">context</span>.<span class="hljs-property">hero</span>; <span class="hljs-comment">// the hero object passed into the row</span></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(hero.<span class="hljs-property">name</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'ngRow.context.hero'</span>).<span class="hljs-title function_">toBe</span>(heroName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> rowComp = ngForRow.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      <span class="hljs-comment">// jasmine.any is an "instance-of-type" test.</span></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(rowComp).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'component is IoComp'</span>).<span class="hljs-title function_">toEqual</span>(jasmine.<span class="hljs-title function_">any</span>(<span class="hljs-title class_">IoComponent</span>));</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(rowComp.<span class="hljs-property">hero</span>.<span class="hljs-property">name</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'component.hero'</span>).<span class="hljs-title function_">toBe</span>(heroName);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should support clicking a button'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">LightswitchComponent</span>);</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> btn = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'button'</span>));</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> span = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'span'</span>)).<span class="hljs-property">nativeElement</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(span.<span class="hljs-property">textContent</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'before click'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toMatch</span>(<span class="hljs-regexp">/is off/i</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">click</span>(btn);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(span.<span class="hljs-property">textContent</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'after click'</span>).<span class="hljs-title function_">toMatch</span>(<span class="hljs-regexp">/is on/i</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">// ngModel is async so we must wait for it with promise-based `whenStable`</span></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should support entering text in input box (ngModel)'</span>, <span class="hljs-title function_">waitForAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> expectedOrigName = <span class="hljs-string">'John'</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> expectedNewName = <span class="hljs-string">'Sally'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">InputComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> input = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'input'</span>)).<span class="hljs-property">nativeElement</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLInputElement</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">name</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">`At start name should be <span class="hljs-subst">${expectedOrigName}</span> `</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(expectedOrigName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// wait until ngModel binds comp.name to input box</span></div><div class="hljs-ln-line">      fixture</div><div class="hljs-ln-line">        .<span class="hljs-title function_">whenStable</span>()</div><div class="hljs-ln-line">        .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">          <span class="hljs-title function_">expect</span>(input.<span class="hljs-property">value</span>)</div><div class="hljs-ln-line">            .<span class="hljs-title function_">withContext</span>(</div><div class="hljs-ln-line">              <span class="hljs-string">`After ngModel updates input box, input.value should be <span class="hljs-subst">${expectedOrigName}</span> `</span>,</div><div class="hljs-ln-line">            )</div><div class="hljs-ln-line">            .<span class="hljs-title function_">toBe</span>(expectedOrigName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-comment">// simulate user entering new name in input</span></div><div class="hljs-ln-line">          input.<span class="hljs-property">value</span> = expectedNewName;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-comment">// that change doesn't flow to the component immediately</span></div><div class="hljs-ln-line">          <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">name</span>)</div><div class="hljs-ln-line">            .<span class="hljs-title function_">withContext</span>(</div><div class="hljs-ln-line">              <span class="hljs-string">`comp.name should still be <span class="hljs-subst">${expectedOrigName}</span> after value change, before binding happens`</span>,</div><div class="hljs-ln-line">            )</div><div class="hljs-ln-line">            .<span class="hljs-title function_">toBe</span>(expectedOrigName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-comment">// Dispatch a DOM event so that Angular learns of input value change.</span></div><div class="hljs-ln-line">          <span class="hljs-comment">// then wait while ngModel pushes input.box value to comp.name</span></div><div class="hljs-ln-line">          input.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">'input'</span>));</div><div class="hljs-ln-line">          <span class="hljs-keyword">return</span> fixture.<span class="hljs-title function_">whenStable</span>();</div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">          <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">name</span>)</div><div class="hljs-ln-line">            .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">`After ngModel updates the model, comp.name should be <span class="hljs-subst">${expectedNewName}</span> `</span>)</div><div class="hljs-ln-line">            .<span class="hljs-title function_">toBe</span>(expectedNewName);</div><div class="hljs-ln-line">        });</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">// fakeAsync version of ngModel input test enables sync test style</span></div><div class="hljs-ln-line">    <span class="hljs-comment">// synchronous `tick` replaces asynchronous promise-base `whenStable`</span></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should support entering text in input box (ngModel) - fakeAsync'</span>, <span class="hljs-title function_">fakeAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> expectedOrigName = <span class="hljs-string">'John'</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> expectedNewName = <span class="hljs-string">'Sally'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">InputComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> input = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'input'</span>)).<span class="hljs-property">nativeElement</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLInputElement</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">name</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">`At start name should be <span class="hljs-subst">${expectedOrigName}</span> `</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(expectedOrigName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// wait until ngModel binds comp.name to input box</span></div><div class="hljs-ln-line">      <span class="hljs-title function_">tick</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(input.<span class="hljs-property">value</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">`After ngModel updates input box, input.value should be <span class="hljs-subst">${expectedOrigName}</span> `</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(expectedOrigName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// simulate user entering new name in input</span></div><div class="hljs-ln-line">      input.<span class="hljs-property">value</span> = expectedNewName;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// that change doesn't flow to the component immediately</span></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">name</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(</div><div class="hljs-ln-line">          <span class="hljs-string">`comp.name should still be <span class="hljs-subst">${expectedOrigName}</span> after value change, before binding happens`</span>,</div><div class="hljs-ln-line">        )</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(expectedOrigName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// Dispatch a DOM event so that Angular learns of input value change.</span></div><div class="hljs-ln-line">      <span class="hljs-comment">// then wait a tick while ngModel pushes input.box value to comp.name</span></div><div class="hljs-ln-line">      input.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">'input'</span>));</div><div class="hljs-ln-line">      <span class="hljs-title function_">tick</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">name</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">`After ngModel updates the model, comp.name should be <span class="hljs-subst">${expectedNewName}</span> `</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(expectedNewName);</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'ReversePipeComp should reverse the input text'</span>, <span class="hljs-title function_">fakeAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> inputText = <span class="hljs-string">'the quick brown fox.'</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> expectedText = <span class="hljs-string">'.xof nworb kciuq eht'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">ReversePipeComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> input = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'input'</span>)).<span class="hljs-property">nativeElement</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLInputElement</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> span = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'span'</span>)).<span class="hljs-property">nativeElement</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLElement</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// simulate user entering new name in input</span></div><div class="hljs-ln-line">      input.<span class="hljs-property">value</span> = inputText;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// Dispatch a DOM event so that Angular learns of input value change.</span></div><div class="hljs-ln-line">      <span class="hljs-comment">// then wait a tick while ngModel pushes input.box value to comp.text</span></div><div class="hljs-ln-line">      <span class="hljs-comment">// and Angular updates the output span</span></div><div class="hljs-ln-line">      input.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">'input'</span>));</div><div class="hljs-ln-line">      <span class="hljs-title function_">tick</span>();</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(span.<span class="hljs-property">textContent</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'output span'</span>).<span class="hljs-title function_">toBe</span>(expectedText);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">text</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'component.text'</span>).<span class="hljs-title function_">toBe</span>(inputText);</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">// Use this technique to find attached directives of any kind</span></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'can examine attached directives and listeners'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">InputComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> inputEl = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'input'</span>));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(inputEl.<span class="hljs-property">providerTokens</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'NgModel directive'</span>).<span class="hljs-title function_">toContain</span>(<span class="hljs-title class_">NgModel</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> ngControl = inputEl.<span class="hljs-property">injector</span>.<span class="hljs-title function_">get</span>(<span class="hljs-title class_">NgControl</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(ngControl).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'NgControl directive'</span>).<span class="hljs-title function_">toEqual</span>(jasmine.<span class="hljs-title function_">any</span>(<span class="hljs-title class_">NgControl</span>));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(inputEl.<span class="hljs-property">listeners</span>.<span class="hljs-property">length</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'several listeners attached'</span>).<span class="hljs-title function_">toBeGreaterThan</span>(<span class="hljs-number">2</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'BankAccountComponent should set attributes, styles, classes, and properties'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">BankAccountParentComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// the only child is debugElement of the BankAccount component</span></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> el = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-property">children</span>[<span class="hljs-number">0</span>];</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> childComp = el.<span class="hljs-property">componentInstance</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">BankAccountComponent</span>;</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(childComp).<span class="hljs-title function_">toEqual</span>(jasmine.<span class="hljs-title function_">any</span>(<span class="hljs-title class_">BankAccountComponent</span>));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">context</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'context is the child component'</span>).<span class="hljs-title function_">toBe</span>(childComp);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">attributes</span>[<span class="hljs-string">'account'</span>]).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'account attribute'</span>).<span class="hljs-title function_">toBe</span>(childComp.<span class="hljs-property">id</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">attributes</span>[<span class="hljs-string">'bank'</span>]).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'bank attribute'</span>).<span class="hljs-title function_">toBe</span>(childComp.<span class="hljs-property">bank</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">classes</span>[<span class="hljs-string">'closed'</span>]).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'closed class'</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">classes</span>[<span class="hljs-string">'open'</span>]).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'open class'</span>).<span class="hljs-title function_">toBeFalsy</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">styles</span>[<span class="hljs-string">'color'</span>]).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'color style'</span>).<span class="hljs-title function_">toBe</span>(comp.<span class="hljs-property">color</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">styles</span>[<span class="hljs-string">'width'</span>])</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'width style'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(comp.<span class="hljs-property">width</span> + <span class="hljs-string">'px'</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// Removed on 12/02/2016 when ceased public discussion of the `Renderer`. Revive in future?</span></div><div class="hljs-ln-line">      <span class="hljs-comment">// expect(el.properties['customProperty']).toBe(true, 'customProperty');</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'TestBed component overrides:'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">"should override ChildComp's template"</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">Child1Component</span>],</div><div class="hljs-ln-line">      })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">Child1Component</span>, {</div><div class="hljs-ln-line">          <span class="hljs-attr">set</span>: {<span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;span&gt;Fake&lt;/span&gt;'</span>},</div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">Child1Component</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'Fake'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">"should override TestProvidersComp's ValueService provider"</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">TestProvidersComponent</span>],</div><div class="hljs-ln-line">      })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">TestProvidersComponent</span>, {</div><div class="hljs-ln-line">          <span class="hljs-attr">remove</span>: {<span class="hljs-attr">providers</span>: [<span class="hljs-title class_">ValueService</span>]},</div><div class="hljs-ln-line">          <span class="hljs-attr">add</span>: {<span class="hljs-attr">providers</span>: [{<span class="hljs-attr">provide</span>: <span class="hljs-title class_">ValueService</span>, <span class="hljs-attr">useClass</span>: <span class="hljs-title class_">FakeValueService</span>}]},</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-comment">// Or replace them all (this component has only one provider)</span></div><div class="hljs-ln-line">          <span class="hljs-comment">// set:    { providers: [{ provide: ValueService, useClass: FakeValueService }] },</span></div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">TestProvidersComponent</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'injected value: faked value'</span>, <span class="hljs-string">'text'</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// Explore the providerTokens</span></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> tokens = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-property">providerTokens</span>;</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(tokens).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'component ctor'</span>).<span class="hljs-title function_">toContain</span>(fixture.<span class="hljs-property">componentInstance</span>.<span class="hljs-property">constructor</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(tokens).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'TestProvidersComp'</span>).<span class="hljs-title function_">toContain</span>(<span class="hljs-title class_">TestProvidersComponent</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(tokens).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'ValueService'</span>).<span class="hljs-title function_">toContain</span>(<span class="hljs-title class_">ValueService</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">"should override TestViewProvidersComp's ValueService viewProvider"</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">TestViewProvidersComponent</span>],</div><div class="hljs-ln-line">      })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">TestViewProvidersComponent</span>, {</div><div class="hljs-ln-line">          <span class="hljs-comment">// remove: { viewProviders: [ValueService]},</span></div><div class="hljs-ln-line">          <span class="hljs-comment">// add:    { viewProviders: [{ provide: ValueService, useClass: FakeValueService }]</span></div><div class="hljs-ln-line">          <span class="hljs-comment">// },</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-comment">// Or replace them all (this component has only one viewProvider)</span></div><div class="hljs-ln-line">          <span class="hljs-attr">set</span>: {<span class="hljs-attr">viewProviders</span>: [{<span class="hljs-attr">provide</span>: <span class="hljs-title class_">ValueService</span>, <span class="hljs-attr">useClass</span>: <span class="hljs-title class_">FakeValueService</span>}]},</div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">TestViewProvidersComponent</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'injected value: faked value'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">"injected provider should not be same as component's provider"</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-comment">// TestComponent is parent of TestProvidersComponent</span></div><div class="hljs-ln-line">      <span class="hljs-meta">@Component</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">standalone</span>: <span class="hljs-literal">true</span>,</div><div class="hljs-ln-line">        <span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;my-service-comp&gt;&lt;/my-service-comp&gt;'</span>,</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">TestProvidersComponent</span>],</div><div class="hljs-ln-line">      })</div><div class="hljs-ln-line">      <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestComponent</span> {}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// 3 levels of ValueService provider: module, TestComponent, TestProvidersComponent</span></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">TestComponent</span>, <span class="hljs-title class_">TestProvidersComponent</span>],</div><div class="hljs-ln-line">        <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">ValueService</span>],</div><div class="hljs-ln-line">      })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">TestComponent</span>, {</div><div class="hljs-ln-line">          <span class="hljs-attr">set</span>: {<span class="hljs-attr">providers</span>: [{<span class="hljs-attr">provide</span>: <span class="hljs-title class_">ValueService</span>, <span class="hljs-attr">useValue</span>: {}}]},</div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">TestProvidersComponent</span>, {</div><div class="hljs-ln-line">          <span class="hljs-attr">set</span>: {<span class="hljs-attr">providers</span>: [{<span class="hljs-attr">provide</span>: <span class="hljs-title class_">ValueService</span>, <span class="hljs-attr">useClass</span>: <span class="hljs-title class_">FakeValueService</span>}]},</div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">TestComponent</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">let</span> testBedProvider!: <span class="hljs-title class_">ValueService</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// `inject` uses TestBed's injector</span></div><div class="hljs-ln-line">      <span class="hljs-title function_">inject</span>([<span class="hljs-title class_">ValueService</span>], <span class="hljs-function">(<span class="hljs-params">s: ValueService</span>) =&gt;</span> (testBedProvider = s))();</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> tcProvider = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-property">injector</span>.<span class="hljs-title function_">get</span>(<span class="hljs-title class_">ValueService</span>) <span class="hljs-keyword">as</span> <span class="hljs-title class_">ValueService</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> tpcProvider = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-property">children</span>[<span class="hljs-number">0</span>].<span class="hljs-property">injector</span>.<span class="hljs-title function_">get</span>(</div><div class="hljs-ln-line">        <span class="hljs-title class_">ValueService</span>,</div><div class="hljs-ln-line">      ) <span class="hljs-keyword">as</span> <span class="hljs-title class_">FakeValueService</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(testBedProvider).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'testBed/tc not same providers'</span>).<span class="hljs-property">not</span>.<span class="hljs-title function_">toBe</span>(tcProvider);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(testBedProvider).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'testBed/tpc not same providers'</span>).<span class="hljs-property">not</span>.<span class="hljs-title function_">toBe</span>(tpcProvider);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(testBedProvider <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">ValueService</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'testBedProvider is ValueService'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(tcProvider)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'tcProvider is {}'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toEqual</span>({} <span class="hljs-keyword">as</span> <span class="hljs-title class_">ValueService</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(tpcProvider <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">FakeValueService</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'tpcProvider is FakeValueService'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'can access template local variables as references'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [</div><div class="hljs-ln-line">          <span class="hljs-title class_">ShellComponent</span>,</div><div class="hljs-ln-line">          <span class="hljs-title class_">NeedsContentComponent</span>,</div><div class="hljs-ln-line">          <span class="hljs-title class_">Child1Component</span>,</div><div class="hljs-ln-line">          <span class="hljs-title class_">Child2Component</span>,</div><div class="hljs-ln-line">          <span class="hljs-title class_">Child3Component</span>,</div><div class="hljs-ln-line">        ],</div><div class="hljs-ln-line">      })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">ShellComponent</span>, {</div><div class="hljs-ln-line">          <span class="hljs-attr">set</span>: {</div><div class="hljs-ln-line">            <span class="hljs-attr">selector</span>: <span class="hljs-string">'test-shell'</span>,</div><div class="hljs-ln-line">            <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">NeedsContentComponent</span>, <span class="hljs-title class_">Child1Component</span>, <span class="hljs-title class_">Child2Component</span>, <span class="hljs-title class_">Child3Component</span>],</div><div class="hljs-ln-line">            <span class="hljs-attr">template</span>: <span class="hljs-string">`</span></div><div class="hljs-ln-line">          &lt;needs-content #nc&gt;</div><div class="hljs-ln-line">            &lt;child-1 #content text="My"&gt;&lt;/child-1&gt;</div><div class="hljs-ln-line">            &lt;child-2 #content text="dog"&gt;&lt;/child-2&gt;</div><div class="hljs-ln-line">            &lt;child-2 text="has"&gt;&lt;/child-2&gt;</div><div class="hljs-ln-line">            &lt;child-3 #content text="fleas"&gt;&lt;/child-3&gt;</div><div class="hljs-ln-line">            &lt;div #content&gt;!&lt;/div&gt;</div><div class="hljs-ln-line">          &lt;/needs-content&gt;</div><div class="hljs-ln-line">          `,</div><div class="hljs-ln-line">          },</div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">ShellComponent</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// NeedsContentComp is the child of ShellComp</span></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> el = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-property">children</span>[<span class="hljs-number">0</span>];</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = el.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">children</span>.<span class="hljs-title function_">toArray</span>().<span class="hljs-property">length</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'three different child components and an ElementRef with #content'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(<span class="hljs-number">4</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">references</span>[<span class="hljs-string">'nc'</span>]).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'#nc reference to component'</span>).<span class="hljs-title function_">toBe</span>(comp);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// Filter for DebugElements with a #content reference</span></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> contentRefs = el.<span class="hljs-title function_">queryAll</span>(<span class="hljs-function">(<span class="hljs-params">de</span>) =&gt;</span> de.<span class="hljs-property">references</span>[<span class="hljs-string">'content'</span>]);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(contentRefs.<span class="hljs-property">length</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'elements w/ a #content reference'</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-number">4</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'nested (one-deep) component override'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">ParentComponent</span>, <span class="hljs-title class_">FakeChildComponent</span>],</div><div class="hljs-ln-line">      }).<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">ParentComponent</span>, {</div><div class="hljs-ln-line">        <span class="hljs-attr">set</span>: {<span class="hljs-attr">imports</span>: [<span class="hljs-title class_">FakeChildComponent</span>]},</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'ParentComp should use Fake Child component'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">ParentComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'Parent(Fake Child)'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'nested (two-deep) component override'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">ParentComponent</span>, <span class="hljs-title class_">FakeChildWithGrandchildComponent</span>, <span class="hljs-title class_">FakeGrandchildComponent</span>],</div><div class="hljs-ln-line">      }).<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">ParentComponent</span>, {</div><div class="hljs-ln-line">        <span class="hljs-attr">set</span>: {<span class="hljs-attr">imports</span>: [<span class="hljs-title class_">FakeChildWithGrandchildComponent</span>, <span class="hljs-title class_">FakeGrandchildComponent</span>]},</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should use Fake Grandchild component'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">ParentComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'Parent(Fake Child(Fake Grandchild))'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'lifecycle hooks w/ MyIfParentComp'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">fixture</span>: <span class="hljs-title class_">ComponentFixture</span>&lt;<span class="hljs-title class_">MyIfParentComponent</span>&gt;;</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">parent</span>: <span class="hljs-title class_">MyIfParentComponent</span>;</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">child</span>: <span class="hljs-title class_">MyIfChildComponent</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">FormsModule</span>, <span class="hljs-title class_">MyIfChildComponent</span>, <span class="hljs-title class_">MyIfParentComponent</span>],</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">MyIfParentComponent</span>);</div><div class="hljs-ln-line">      parent = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should instantiate parent component'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(parent).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'parent component should exist'</span>).<span class="hljs-property">not</span>.<span class="hljs-title function_">toBeNull</span>();</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'parent component OnInit should NOT be called before first detectChanges()'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(parent.<span class="hljs-property">ngOnInitCalled</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">false</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'parent component OnInit should be called after first detectChanges()'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(parent.<span class="hljs-property">ngOnInitCalled</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'child component should exist after OnInit'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">getChild</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(child <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">MyIfChildComponent</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'should create child'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">"should have called child component's OnInit "</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">getChild</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(child.<span class="hljs-property">ngOnInitCalled</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'child component called OnChanges once'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">getChild</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(child.<span class="hljs-property">ngOnChangesCounter</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-number">1</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'changed parent value flows to child'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">getChild</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      parent.<span class="hljs-property">parentValue</span> = <span class="hljs-string">'foo'</span>;</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(child.<span class="hljs-property">ngOnChangesCounter</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'expected 2 changes: initial value and changed value'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(<span class="hljs-number">2</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(child.<span class="hljs-property">childValue</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'childValue should eq changed parent value'</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'foo'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">// must be async test to see child flow to parent</span></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'changed child value flows to parent'</span>, <span class="hljs-title function_">waitForAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">getChild</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      child.<span class="hljs-property">childValue</span> = <span class="hljs-string">'bar'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {</div><div class="hljs-ln-line">        <span class="hljs-comment">// Wait one JS engine turn!</span></div><div class="hljs-ln-line">        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(), <span class="hljs-number">0</span>);</div><div class="hljs-ln-line">      }).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">        fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">        <span class="hljs-title function_">expect</span>(child.<span class="hljs-property">ngOnChangesCounter</span>)</div><div class="hljs-ln-line">          .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'expected 2 changes: initial value and changed value'</span>)</div><div class="hljs-ln-line">          .<span class="hljs-title function_">toBe</span>(<span class="hljs-number">2</span>);</div><div class="hljs-ln-line">        <span class="hljs-title function_">expect</span>(parent.<span class="hljs-property">parentValue</span>)</div><div class="hljs-ln-line">          .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'parentValue should eq changed parent value'</span>)</div><div class="hljs-ln-line">          .<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'bar'</span>);</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'clicking "Close Child" triggers child OnDestroy'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">getChild</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> btn = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'button'</span>));</div><div class="hljs-ln-line">      <span class="hljs-title function_">click</span>(btn);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(child.<span class="hljs-property">ngOnDestroyCalled</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">////// helpers ///</span></div><div class="hljs-ln-line">    <span class="hljs-comment">/**</span></div><div class="hljs-ln-line">     * Get the MyIfChildComp from parent; fail w/ good message if cannot.</div><div class="hljs-ln-line">     */</div><div class="hljs-ln-line">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">getChild</span>(<span class="hljs-params"></span>) {</div><div class="hljs-ln-line">      <span class="hljs-keyword">let</span> <span class="hljs-attr">childDe</span>: <span class="hljs-title class_">DebugElement</span>; <span class="hljs-comment">// DebugElement that should hold the MyIfChildComp</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// The Hard Way: requires detailed knowledge of the parent template</span></div><div class="hljs-ln-line">      <span class="hljs-keyword">try</span> {</div><div class="hljs-ln-line">        childDe = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-property">children</span>[<span class="hljs-number">4</span>].<span class="hljs-property">children</span>[<span class="hljs-number">0</span>];</div><div class="hljs-ln-line">      } <span class="hljs-keyword">catch</span> (err) {</div><div class="hljs-ln-line">        <span class="hljs-comment">/* we'll report the error */</span></div><div class="hljs-ln-line">      }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// DebugElement.queryAll: if we wanted all of many instances:</span></div><div class="hljs-ln-line">      childDe = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">queryAll</span>(</div><div class="hljs-ln-line">        <span class="hljs-function">(<span class="hljs-params">de</span>) =&gt;</span> de.<span class="hljs-property">componentInstance</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">MyIfChildComponent</span>,</div><div class="hljs-ln-line">      )[<span class="hljs-number">0</span>];</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// WE'LL USE THIS APPROACH !</span></div><div class="hljs-ln-line">      <span class="hljs-comment">// DebugElement.query: find first instance (if any)</span></div><div class="hljs-ln-line">      childDe = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(</div><div class="hljs-ln-line">        <span class="hljs-function">(<span class="hljs-params">de</span>) =&gt;</span> de.<span class="hljs-property">componentInstance</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">MyIfChildComponent</span>,</div><div class="hljs-ln-line">      );</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">if</span> (childDe &amp;&amp; childDe.<span class="hljs-property">componentInstance</span>) {</div><div class="hljs-ln-line">        child = childDe.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      } <span class="hljs-keyword">else</span> {</div><div class="hljs-ln-line">        <span class="hljs-title function_">fail</span>(<span class="hljs-string">'Unable to find MyIfChildComp within MyIfParentComp'</span>);</div><div class="hljs-ln-line">      }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> child;</div><div class="hljs-ln-line">    }</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line">});</div><div class="hljs-ln-line"><span class="hljs-comment">////////// Fakes ///////////</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component</span>({</div><div class="hljs-ln-line">  <span class="hljs-attr">standalone</span>: <span class="hljs-literal">true</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">selector</span>: <span class="hljs-string">'child-1'</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">template</span>: <span class="hljs-string">'Fake Child'</span>,</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FakeChildComponent</span> {}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component</span>({</div><div class="hljs-ln-line">  <span class="hljs-attr">standalone</span>: <span class="hljs-literal">true</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">selector</span>: <span class="hljs-string">'grandchild-1'</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">template</span>: <span class="hljs-string">'Fake Grandchild'</span>,</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FakeGrandchildComponent</span> {}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component</span>({</div><div class="hljs-ln-line">  <span class="hljs-attr">standalone</span>: <span class="hljs-literal">true</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">selector</span>: <span class="hljs-string">'child-1'</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">FakeGrandchildComponent</span>],</div><div class="hljs-ln-line">  <span class="hljs-attr">template</span>: <span class="hljs-string">'Fake Child(&lt;grandchild-1&gt;&lt;/grandchild-1&gt;)'</span>,</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FakeChildWithGrandchildComponent</span> {}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Injectable</span>()</div><div class="hljs-ln-line"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FakeValueService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">ValueService</span> {</div><div class="hljs-ln-line">  <span class="hljs-keyword">override</span> value = <span class="hljs-string">'faked value'</span>;</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="4th3om6n4lvjw431y4n981nwj">或者，如果你喜欢把这个服务作为设置代码的一部分进行注入，也可以在 <code>beforeEach()</code> 中做。</p>
<div class="docs-code" path="adev/src/content/examples/testing/src/app/demo/demo.testbed.spec.ts" visiblelines="49,50,51,52">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">Component</span>, <span class="hljs-title class_">DebugElement</span>, <span class="hljs-title class_">Injectable</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {</div><div class="hljs-ln-line">  <span class="hljs-title class_">ComponentFixture</span>,</div><div class="hljs-ln-line">  fakeAsync,</div><div class="hljs-ln-line">  inject,</div><div class="hljs-ln-line">  <span class="hljs-title class_">TestBed</span>,</div><div class="hljs-ln-line">  tick,</div><div class="hljs-ln-line">  waitForAsync,</div><div class="hljs-ln-line">} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core/testing'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">FormsModule</span>, <span class="hljs-title class_">NgControl</span>, <span class="hljs-title class_">NgModel</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/forms'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">By</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/platform-browser'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {addMatchers, click} <span class="hljs-keyword">from</span> <span class="hljs-string">'../../testing'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {</div><div class="hljs-ln-line">  <span class="hljs-title class_">BankAccountComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">BankAccountParentComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">Child1Component</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">Child2Component</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">Child3Component</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">ExternalTemplateComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">InputComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">IoComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">IoParentComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">LightswitchComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">MasterService</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">MyIfChildComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">MyIfComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">MyIfParentComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">NeedsContentComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">ParentComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">ReversePipeComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">ShellComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">TestProvidersComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">TestViewProvidersComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">ValueService</span>,</div><div class="hljs-ln-line">} <span class="hljs-keyword">from</span> <span class="hljs-string">'./demo'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NotProvided</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">ValueService</span> {</div><div class="hljs-ln-line">  <span class="hljs-comment">/* example below */</span></div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"><span class="hljs-title function_">beforeEach</span>(addMatchers);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-title function_">describe</span>(<span class="hljs-string">'demo (with TestBed):'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">  <span class="hljs-comment">////////  Service Tests  /////////////</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'ValueService'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">service</span>: <span class="hljs-title class_">ValueService</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({<span class="hljs-attr">providers</span>: [<span class="hljs-title class_">ValueService</span>]});</div><div class="hljs-ln-line">      service = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">inject</span>(<span class="hljs-title class_">ValueService</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should use ValueService'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      service = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">inject</span>(<span class="hljs-title class_">ValueService</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(service.<span class="hljs-title function_">getValue</span>()).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'real value'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'can inject a default value when service is not provided'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(<span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">inject</span>(<span class="hljs-title class_">NotProvided</span>, <span class="hljs-literal">null</span>)).<span class="hljs-title function_">toBeNull</span>();</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'test should wait for ValueService.getPromiseValue'</span>, <span class="hljs-title function_">waitForAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      service.<span class="hljs-title function_">getPromiseValue</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> <span class="hljs-title function_">expect</span>(value).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'promise value'</span>));</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'test should wait for ValueService.getObservableValue'</span>, <span class="hljs-title function_">waitForAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      service.<span class="hljs-title function_">getObservableValue</span>().<span class="hljs-title function_">subscribe</span>(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> <span class="hljs-title function_">expect</span>(value).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'observable value'</span>));</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">// Must use done. See https://github.com/angular/angular/issues/10127</span></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'test should wait for ValueService.getObservableDelayValue'</span>, <span class="hljs-function">(<span class="hljs-params">done: DoneFn</span>) =&gt;</span> {</div><div class="hljs-ln-line">      service.<span class="hljs-title function_">getObservableDelayValue</span>().<span class="hljs-title function_">subscribe</span>(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> {</div><div class="hljs-ln-line">        <span class="hljs-title function_">expect</span>(value).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'observable delay value'</span>);</div><div class="hljs-ln-line">        <span class="hljs-title function_">done</span>();</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should allow the use of fakeAsync'</span>, <span class="hljs-title function_">fakeAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">let</span> <span class="hljs-attr">value</span>: <span class="hljs-built_in">any</span>;</div><div class="hljs-ln-line">      service.<span class="hljs-title function_">getPromiseValue</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">val: <span class="hljs-built_in">any</span></span>) =&gt;</span> (value = val));</div><div class="hljs-ln-line">      <span class="hljs-title function_">tick</span>(); <span class="hljs-comment">// Trigger JS engine cycle until all promises resolve.</span></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(value).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'promise value'</span>);</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'MasterService'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">masterService</span>: <span class="hljs-title class_">MasterService</span>;</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">valueServiceSpy</span>: jasmine.<span class="hljs-property">SpyObj</span>&lt;<span class="hljs-title class_">ValueService</span>&gt;;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> spy = jasmine.<span class="hljs-title function_">createSpyObj</span>(<span class="hljs-string">'ValueService'</span>, [<span class="hljs-string">'getValue'</span>]);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-comment">// Provide both the service-to-test and its (spy) dependency</span></div><div class="hljs-ln-line">        <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">MasterService</span>, {<span class="hljs-attr">provide</span>: <span class="hljs-title class_">ValueService</span>, <span class="hljs-attr">useValue</span>: spy}],</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">      <span class="hljs-comment">// Inject both the service-to-test and its (spy) dependency</span></div><div class="hljs-ln-line">      masterService = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">inject</span>(<span class="hljs-title class_">MasterService</span>);</div><div class="hljs-ln-line">      valueServiceSpy = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">inject</span>(<span class="hljs-title class_">ValueService</span>) <span class="hljs-keyword">as</span> jasmine.<span class="hljs-property">SpyObj</span>&lt;<span class="hljs-title class_">ValueService</span>&gt;;</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'#getValue should return stubbed value from a spy'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> stubValue = <span class="hljs-string">'stub value'</span>;</div><div class="hljs-ln-line">      valueServiceSpy.<span class="hljs-property">getValue</span>.<span class="hljs-property">and</span>.<span class="hljs-title function_">returnValue</span>(stubValue);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(masterService.<span class="hljs-title function_">getValue</span>()).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'service returned stub value'</span>).<span class="hljs-title function_">toBe</span>(stubValue);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(valueServiceSpy.<span class="hljs-property">getValue</span>.<span class="hljs-property">calls</span>.<span class="hljs-title function_">count</span>())</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'spy method was called once'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(<span class="hljs-number">1</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(valueServiceSpy.<span class="hljs-property">getValue</span>.<span class="hljs-property">calls</span>.<span class="hljs-title function_">mostRecent</span>().<span class="hljs-property">returnValue</span>).<span class="hljs-title function_">toBe</span>(stubValue);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'use inject within `it`'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({<span class="hljs-attr">providers</span>: [<span class="hljs-title class_">ValueService</span>]});</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should use modified providers'</span>, <span class="hljs-title function_">inject</span>([<span class="hljs-title class_">ValueService</span>], <span class="hljs-function">(<span class="hljs-params">service: ValueService</span>) =&gt;</span> {</div><div class="hljs-ln-line">      service.<span class="hljs-title function_">setValue</span>(<span class="hljs-string">'value modified in beforeEach'</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(service.<span class="hljs-title function_">getValue</span>()).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'value modified in beforeEach'</span>);</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'using waitForAsync(inject) within beforeEach'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">serviceValue</span>: <span class="hljs-built_in">string</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({<span class="hljs-attr">providers</span>: [<span class="hljs-title class_">ValueService</span>]});</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-title function_">waitForAsync</span>(</div><div class="hljs-ln-line">      <span class="hljs-title function_">inject</span>([<span class="hljs-title class_">ValueService</span>], <span class="hljs-function">(<span class="hljs-params">service: ValueService</span>) =&gt;</span> {</div><div class="hljs-ln-line">        service.<span class="hljs-title function_">getPromiseValue</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> (serviceValue = value));</div><div class="hljs-ln-line">      }),</div><div class="hljs-ln-line">    ));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should use asynchronously modified value ... in synchronous test'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(serviceValue).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'promise value'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-comment">/////////// Component Tests //////////////////</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'TestBed component tests'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-comment">// beforeEach(waitForAsync(() =&gt; {</span></div><div class="hljs-ln-line">    <span class="hljs-comment">//   TestBed.configureTestingModule()</span></div><div class="hljs-ln-line">    <span class="hljs-comment">//     // Compile everything in DemoModule</span></div><div class="hljs-ln-line">    <span class="hljs-comment">//     .compileComponents();</span></div><div class="hljs-ln-line">    <span class="hljs-comment">// }));</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should create a component with inline template'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">Child1Component</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'Child'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should create a component with external template'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">ExternalTemplateComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'from external template'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should allow changing members of the component'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">MyIfComponent</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'MyIf()'</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-property">componentInstance</span>.<span class="hljs-property">showMore</span> = <span class="hljs-literal">true</span>;</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'MyIf(More)'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should create a nested component bound to inputs/outputs'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">IoParentComponent</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> heroes = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">queryAll</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'.hero'</span>));</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(heroes.<span class="hljs-property">length</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'has heroes'</span>).<span class="hljs-title function_">toBeGreaterThan</span>(<span class="hljs-number">0</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> hero = comp.<span class="hljs-property">heroes</span>[<span class="hljs-number">0</span>];</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">click</span>(heroes[<span class="hljs-number">0</span>]);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> selected = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'p'</span>));</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(selected).<span class="hljs-title function_">toHaveText</span>(hero.<span class="hljs-property">name</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'can access the instance variable of an `*ngFor` row component'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">IoParentComponent</span>);</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> heroName = comp.<span class="hljs-property">heroes</span>[<span class="hljs-number">0</span>].<span class="hljs-property">name</span>; <span class="hljs-comment">// first hero's name</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> ngForRow = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">directive</span>(<span class="hljs-title class_">IoComponent</span>)); <span class="hljs-comment">// first hero ngForRow</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> hero = ngForRow.<span class="hljs-property">context</span>.<span class="hljs-property">hero</span>; <span class="hljs-comment">// the hero object passed into the row</span></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(hero.<span class="hljs-property">name</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'ngRow.context.hero'</span>).<span class="hljs-title function_">toBe</span>(heroName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> rowComp = ngForRow.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      <span class="hljs-comment">// jasmine.any is an "instance-of-type" test.</span></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(rowComp).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'component is IoComp'</span>).<span class="hljs-title function_">toEqual</span>(jasmine.<span class="hljs-title function_">any</span>(<span class="hljs-title class_">IoComponent</span>));</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(rowComp.<span class="hljs-property">hero</span>.<span class="hljs-property">name</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'component.hero'</span>).<span class="hljs-title function_">toBe</span>(heroName);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should support clicking a button'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">LightswitchComponent</span>);</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> btn = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'button'</span>));</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> span = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'span'</span>)).<span class="hljs-property">nativeElement</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(span.<span class="hljs-property">textContent</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'before click'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toMatch</span>(<span class="hljs-regexp">/is off/i</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">click</span>(btn);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(span.<span class="hljs-property">textContent</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'after click'</span>).<span class="hljs-title function_">toMatch</span>(<span class="hljs-regexp">/is on/i</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">// ngModel is async so we must wait for it with promise-based `whenStable`</span></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should support entering text in input box (ngModel)'</span>, <span class="hljs-title function_">waitForAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> expectedOrigName = <span class="hljs-string">'John'</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> expectedNewName = <span class="hljs-string">'Sally'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">InputComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> input = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'input'</span>)).<span class="hljs-property">nativeElement</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLInputElement</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">name</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">`At start name should be <span class="hljs-subst">${expectedOrigName}</span> `</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(expectedOrigName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// wait until ngModel binds comp.name to input box</span></div><div class="hljs-ln-line">      fixture</div><div class="hljs-ln-line">        .<span class="hljs-title function_">whenStable</span>()</div><div class="hljs-ln-line">        .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">          <span class="hljs-title function_">expect</span>(input.<span class="hljs-property">value</span>)</div><div class="hljs-ln-line">            .<span class="hljs-title function_">withContext</span>(</div><div class="hljs-ln-line">              <span class="hljs-string">`After ngModel updates input box, input.value should be <span class="hljs-subst">${expectedOrigName}</span> `</span>,</div><div class="hljs-ln-line">            )</div><div class="hljs-ln-line">            .<span class="hljs-title function_">toBe</span>(expectedOrigName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-comment">// simulate user entering new name in input</span></div><div class="hljs-ln-line">          input.<span class="hljs-property">value</span> = expectedNewName;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-comment">// that change doesn't flow to the component immediately</span></div><div class="hljs-ln-line">          <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">name</span>)</div><div class="hljs-ln-line">            .<span class="hljs-title function_">withContext</span>(</div><div class="hljs-ln-line">              <span class="hljs-string">`comp.name should still be <span class="hljs-subst">${expectedOrigName}</span> after value change, before binding happens`</span>,</div><div class="hljs-ln-line">            )</div><div class="hljs-ln-line">            .<span class="hljs-title function_">toBe</span>(expectedOrigName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-comment">// Dispatch a DOM event so that Angular learns of input value change.</span></div><div class="hljs-ln-line">          <span class="hljs-comment">// then wait while ngModel pushes input.box value to comp.name</span></div><div class="hljs-ln-line">          input.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">'input'</span>));</div><div class="hljs-ln-line">          <span class="hljs-keyword">return</span> fixture.<span class="hljs-title function_">whenStable</span>();</div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">          <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">name</span>)</div><div class="hljs-ln-line">            .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">`After ngModel updates the model, comp.name should be <span class="hljs-subst">${expectedNewName}</span> `</span>)</div><div class="hljs-ln-line">            .<span class="hljs-title function_">toBe</span>(expectedNewName);</div><div class="hljs-ln-line">        });</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">// fakeAsync version of ngModel input test enables sync test style</span></div><div class="hljs-ln-line">    <span class="hljs-comment">// synchronous `tick` replaces asynchronous promise-base `whenStable`</span></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should support entering text in input box (ngModel) - fakeAsync'</span>, <span class="hljs-title function_">fakeAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> expectedOrigName = <span class="hljs-string">'John'</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> expectedNewName = <span class="hljs-string">'Sally'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">InputComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> input = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'input'</span>)).<span class="hljs-property">nativeElement</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLInputElement</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">name</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">`At start name should be <span class="hljs-subst">${expectedOrigName}</span> `</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(expectedOrigName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// wait until ngModel binds comp.name to input box</span></div><div class="hljs-ln-line">      <span class="hljs-title function_">tick</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(input.<span class="hljs-property">value</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">`After ngModel updates input box, input.value should be <span class="hljs-subst">${expectedOrigName}</span> `</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(expectedOrigName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// simulate user entering new name in input</span></div><div class="hljs-ln-line">      input.<span class="hljs-property">value</span> = expectedNewName;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// that change doesn't flow to the component immediately</span></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">name</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(</div><div class="hljs-ln-line">          <span class="hljs-string">`comp.name should still be <span class="hljs-subst">${expectedOrigName}</span> after value change, before binding happens`</span>,</div><div class="hljs-ln-line">        )</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(expectedOrigName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// Dispatch a DOM event so that Angular learns of input value change.</span></div><div class="hljs-ln-line">      <span class="hljs-comment">// then wait a tick while ngModel pushes input.box value to comp.name</span></div><div class="hljs-ln-line">      input.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">'input'</span>));</div><div class="hljs-ln-line">      <span class="hljs-title function_">tick</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">name</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">`After ngModel updates the model, comp.name should be <span class="hljs-subst">${expectedNewName}</span> `</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(expectedNewName);</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'ReversePipeComp should reverse the input text'</span>, <span class="hljs-title function_">fakeAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> inputText = <span class="hljs-string">'the quick brown fox.'</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> expectedText = <span class="hljs-string">'.xof nworb kciuq eht'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">ReversePipeComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> input = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'input'</span>)).<span class="hljs-property">nativeElement</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLInputElement</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> span = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'span'</span>)).<span class="hljs-property">nativeElement</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLElement</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// simulate user entering new name in input</span></div><div class="hljs-ln-line">      input.<span class="hljs-property">value</span> = inputText;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// Dispatch a DOM event so that Angular learns of input value change.</span></div><div class="hljs-ln-line">      <span class="hljs-comment">// then wait a tick while ngModel pushes input.box value to comp.text</span></div><div class="hljs-ln-line">      <span class="hljs-comment">// and Angular updates the output span</span></div><div class="hljs-ln-line">      input.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">'input'</span>));</div><div class="hljs-ln-line">      <span class="hljs-title function_">tick</span>();</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(span.<span class="hljs-property">textContent</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'output span'</span>).<span class="hljs-title function_">toBe</span>(expectedText);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">text</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'component.text'</span>).<span class="hljs-title function_">toBe</span>(inputText);</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">// Use this technique to find attached directives of any kind</span></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'can examine attached directives and listeners'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">InputComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> inputEl = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'input'</span>));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(inputEl.<span class="hljs-property">providerTokens</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'NgModel directive'</span>).<span class="hljs-title function_">toContain</span>(<span class="hljs-title class_">NgModel</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> ngControl = inputEl.<span class="hljs-property">injector</span>.<span class="hljs-title function_">get</span>(<span class="hljs-title class_">NgControl</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(ngControl).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'NgControl directive'</span>).<span class="hljs-title function_">toEqual</span>(jasmine.<span class="hljs-title function_">any</span>(<span class="hljs-title class_">NgControl</span>));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(inputEl.<span class="hljs-property">listeners</span>.<span class="hljs-property">length</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'several listeners attached'</span>).<span class="hljs-title function_">toBeGreaterThan</span>(<span class="hljs-number">2</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'BankAccountComponent should set attributes, styles, classes, and properties'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">BankAccountParentComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// the only child is debugElement of the BankAccount component</span></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> el = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-property">children</span>[<span class="hljs-number">0</span>];</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> childComp = el.<span class="hljs-property">componentInstance</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">BankAccountComponent</span>;</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(childComp).<span class="hljs-title function_">toEqual</span>(jasmine.<span class="hljs-title function_">any</span>(<span class="hljs-title class_">BankAccountComponent</span>));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">context</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'context is the child component'</span>).<span class="hljs-title function_">toBe</span>(childComp);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">attributes</span>[<span class="hljs-string">'account'</span>]).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'account attribute'</span>).<span class="hljs-title function_">toBe</span>(childComp.<span class="hljs-property">id</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">attributes</span>[<span class="hljs-string">'bank'</span>]).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'bank attribute'</span>).<span class="hljs-title function_">toBe</span>(childComp.<span class="hljs-property">bank</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">classes</span>[<span class="hljs-string">'closed'</span>]).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'closed class'</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">classes</span>[<span class="hljs-string">'open'</span>]).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'open class'</span>).<span class="hljs-title function_">toBeFalsy</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">styles</span>[<span class="hljs-string">'color'</span>]).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'color style'</span>).<span class="hljs-title function_">toBe</span>(comp.<span class="hljs-property">color</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">styles</span>[<span class="hljs-string">'width'</span>])</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'width style'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(comp.<span class="hljs-property">width</span> + <span class="hljs-string">'px'</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// Removed on 12/02/2016 when ceased public discussion of the `Renderer`. Revive in future?</span></div><div class="hljs-ln-line">      <span class="hljs-comment">// expect(el.properties['customProperty']).toBe(true, 'customProperty');</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'TestBed component overrides:'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">"should override ChildComp's template"</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">Child1Component</span>],</div><div class="hljs-ln-line">      })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">Child1Component</span>, {</div><div class="hljs-ln-line">          <span class="hljs-attr">set</span>: {<span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;span&gt;Fake&lt;/span&gt;'</span>},</div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">Child1Component</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'Fake'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">"should override TestProvidersComp's ValueService provider"</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">TestProvidersComponent</span>],</div><div class="hljs-ln-line">      })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">TestProvidersComponent</span>, {</div><div class="hljs-ln-line">          <span class="hljs-attr">remove</span>: {<span class="hljs-attr">providers</span>: [<span class="hljs-title class_">ValueService</span>]},</div><div class="hljs-ln-line">          <span class="hljs-attr">add</span>: {<span class="hljs-attr">providers</span>: [{<span class="hljs-attr">provide</span>: <span class="hljs-title class_">ValueService</span>, <span class="hljs-attr">useClass</span>: <span class="hljs-title class_">FakeValueService</span>}]},</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-comment">// Or replace them all (this component has only one provider)</span></div><div class="hljs-ln-line">          <span class="hljs-comment">// set:    { providers: [{ provide: ValueService, useClass: FakeValueService }] },</span></div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">TestProvidersComponent</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'injected value: faked value'</span>, <span class="hljs-string">'text'</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// Explore the providerTokens</span></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> tokens = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-property">providerTokens</span>;</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(tokens).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'component ctor'</span>).<span class="hljs-title function_">toContain</span>(fixture.<span class="hljs-property">componentInstance</span>.<span class="hljs-property">constructor</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(tokens).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'TestProvidersComp'</span>).<span class="hljs-title function_">toContain</span>(<span class="hljs-title class_">TestProvidersComponent</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(tokens).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'ValueService'</span>).<span class="hljs-title function_">toContain</span>(<span class="hljs-title class_">ValueService</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">"should override TestViewProvidersComp's ValueService viewProvider"</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">TestViewProvidersComponent</span>],</div><div class="hljs-ln-line">      })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">TestViewProvidersComponent</span>, {</div><div class="hljs-ln-line">          <span class="hljs-comment">// remove: { viewProviders: [ValueService]},</span></div><div class="hljs-ln-line">          <span class="hljs-comment">// add:    { viewProviders: [{ provide: ValueService, useClass: FakeValueService }]</span></div><div class="hljs-ln-line">          <span class="hljs-comment">// },</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-comment">// Or replace them all (this component has only one viewProvider)</span></div><div class="hljs-ln-line">          <span class="hljs-attr">set</span>: {<span class="hljs-attr">viewProviders</span>: [{<span class="hljs-attr">provide</span>: <span class="hljs-title class_">ValueService</span>, <span class="hljs-attr">useClass</span>: <span class="hljs-title class_">FakeValueService</span>}]},</div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">TestViewProvidersComponent</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'injected value: faked value'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">"injected provider should not be same as component's provider"</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-comment">// TestComponent is parent of TestProvidersComponent</span></div><div class="hljs-ln-line">      <span class="hljs-meta">@Component</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">standalone</span>: <span class="hljs-literal">true</span>,</div><div class="hljs-ln-line">        <span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;my-service-comp&gt;&lt;/my-service-comp&gt;'</span>,</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">TestProvidersComponent</span>],</div><div class="hljs-ln-line">      })</div><div class="hljs-ln-line">      <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestComponent</span> {}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// 3 levels of ValueService provider: module, TestComponent, TestProvidersComponent</span></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">TestComponent</span>, <span class="hljs-title class_">TestProvidersComponent</span>],</div><div class="hljs-ln-line">        <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">ValueService</span>],</div><div class="hljs-ln-line">      })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">TestComponent</span>, {</div><div class="hljs-ln-line">          <span class="hljs-attr">set</span>: {<span class="hljs-attr">providers</span>: [{<span class="hljs-attr">provide</span>: <span class="hljs-title class_">ValueService</span>, <span class="hljs-attr">useValue</span>: {}}]},</div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">TestProvidersComponent</span>, {</div><div class="hljs-ln-line">          <span class="hljs-attr">set</span>: {<span class="hljs-attr">providers</span>: [{<span class="hljs-attr">provide</span>: <span class="hljs-title class_">ValueService</span>, <span class="hljs-attr">useClass</span>: <span class="hljs-title class_">FakeValueService</span>}]},</div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">TestComponent</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">let</span> testBedProvider!: <span class="hljs-title class_">ValueService</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// `inject` uses TestBed's injector</span></div><div class="hljs-ln-line">      <span class="hljs-title function_">inject</span>([<span class="hljs-title class_">ValueService</span>], <span class="hljs-function">(<span class="hljs-params">s: ValueService</span>) =&gt;</span> (testBedProvider = s))();</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> tcProvider = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-property">injector</span>.<span class="hljs-title function_">get</span>(<span class="hljs-title class_">ValueService</span>) <span class="hljs-keyword">as</span> <span class="hljs-title class_">ValueService</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> tpcProvider = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-property">children</span>[<span class="hljs-number">0</span>].<span class="hljs-property">injector</span>.<span class="hljs-title function_">get</span>(</div><div class="hljs-ln-line">        <span class="hljs-title class_">ValueService</span>,</div><div class="hljs-ln-line">      ) <span class="hljs-keyword">as</span> <span class="hljs-title class_">FakeValueService</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(testBedProvider).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'testBed/tc not same providers'</span>).<span class="hljs-property">not</span>.<span class="hljs-title function_">toBe</span>(tcProvider);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(testBedProvider).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'testBed/tpc not same providers'</span>).<span class="hljs-property">not</span>.<span class="hljs-title function_">toBe</span>(tpcProvider);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(testBedProvider <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">ValueService</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'testBedProvider is ValueService'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(tcProvider)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'tcProvider is {}'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toEqual</span>({} <span class="hljs-keyword">as</span> <span class="hljs-title class_">ValueService</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(tpcProvider <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">FakeValueService</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'tpcProvider is FakeValueService'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'can access template local variables as references'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [</div><div class="hljs-ln-line">          <span class="hljs-title class_">ShellComponent</span>,</div><div class="hljs-ln-line">          <span class="hljs-title class_">NeedsContentComponent</span>,</div><div class="hljs-ln-line">          <span class="hljs-title class_">Child1Component</span>,</div><div class="hljs-ln-line">          <span class="hljs-title class_">Child2Component</span>,</div><div class="hljs-ln-line">          <span class="hljs-title class_">Child3Component</span>,</div><div class="hljs-ln-line">        ],</div><div class="hljs-ln-line">      })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">ShellComponent</span>, {</div><div class="hljs-ln-line">          <span class="hljs-attr">set</span>: {</div><div class="hljs-ln-line">            <span class="hljs-attr">selector</span>: <span class="hljs-string">'test-shell'</span>,</div><div class="hljs-ln-line">            <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">NeedsContentComponent</span>, <span class="hljs-title class_">Child1Component</span>, <span class="hljs-title class_">Child2Component</span>, <span class="hljs-title class_">Child3Component</span>],</div><div class="hljs-ln-line">            <span class="hljs-attr">template</span>: <span class="hljs-string">`</span></div><div class="hljs-ln-line">          &lt;needs-content #nc&gt;</div><div class="hljs-ln-line">            &lt;child-1 #content text="My"&gt;&lt;/child-1&gt;</div><div class="hljs-ln-line">            &lt;child-2 #content text="dog"&gt;&lt;/child-2&gt;</div><div class="hljs-ln-line">            &lt;child-2 text="has"&gt;&lt;/child-2&gt;</div><div class="hljs-ln-line">            &lt;child-3 #content text="fleas"&gt;&lt;/child-3&gt;</div><div class="hljs-ln-line">            &lt;div #content&gt;!&lt;/div&gt;</div><div class="hljs-ln-line">          &lt;/needs-content&gt;</div><div class="hljs-ln-line">          `,</div><div class="hljs-ln-line">          },</div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">ShellComponent</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// NeedsContentComp is the child of ShellComp</span></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> el = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-property">children</span>[<span class="hljs-number">0</span>];</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = el.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">children</span>.<span class="hljs-title function_">toArray</span>().<span class="hljs-property">length</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'three different child components and an ElementRef with #content'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(<span class="hljs-number">4</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">references</span>[<span class="hljs-string">'nc'</span>]).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'#nc reference to component'</span>).<span class="hljs-title function_">toBe</span>(comp);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// Filter for DebugElements with a #content reference</span></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> contentRefs = el.<span class="hljs-title function_">queryAll</span>(<span class="hljs-function">(<span class="hljs-params">de</span>) =&gt;</span> de.<span class="hljs-property">references</span>[<span class="hljs-string">'content'</span>]);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(contentRefs.<span class="hljs-property">length</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'elements w/ a #content reference'</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-number">4</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'nested (one-deep) component override'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">ParentComponent</span>, <span class="hljs-title class_">FakeChildComponent</span>],</div><div class="hljs-ln-line">      }).<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">ParentComponent</span>, {</div><div class="hljs-ln-line">        <span class="hljs-attr">set</span>: {<span class="hljs-attr">imports</span>: [<span class="hljs-title class_">FakeChildComponent</span>]},</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'ParentComp should use Fake Child component'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">ParentComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'Parent(Fake Child)'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'nested (two-deep) component override'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">ParentComponent</span>, <span class="hljs-title class_">FakeChildWithGrandchildComponent</span>, <span class="hljs-title class_">FakeGrandchildComponent</span>],</div><div class="hljs-ln-line">      }).<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">ParentComponent</span>, {</div><div class="hljs-ln-line">        <span class="hljs-attr">set</span>: {<span class="hljs-attr">imports</span>: [<span class="hljs-title class_">FakeChildWithGrandchildComponent</span>, <span class="hljs-title class_">FakeGrandchildComponent</span>]},</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should use Fake Grandchild component'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">ParentComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'Parent(Fake Child(Fake Grandchild))'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'lifecycle hooks w/ MyIfParentComp'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">fixture</span>: <span class="hljs-title class_">ComponentFixture</span>&lt;<span class="hljs-title class_">MyIfParentComponent</span>&gt;;</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">parent</span>: <span class="hljs-title class_">MyIfParentComponent</span>;</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">child</span>: <span class="hljs-title class_">MyIfChildComponent</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">FormsModule</span>, <span class="hljs-title class_">MyIfChildComponent</span>, <span class="hljs-title class_">MyIfParentComponent</span>],</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">MyIfParentComponent</span>);</div><div class="hljs-ln-line">      parent = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should instantiate parent component'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(parent).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'parent component should exist'</span>).<span class="hljs-property">not</span>.<span class="hljs-title function_">toBeNull</span>();</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'parent component OnInit should NOT be called before first detectChanges()'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(parent.<span class="hljs-property">ngOnInitCalled</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">false</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'parent component OnInit should be called after first detectChanges()'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(parent.<span class="hljs-property">ngOnInitCalled</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'child component should exist after OnInit'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">getChild</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(child <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">MyIfChildComponent</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'should create child'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">"should have called child component's OnInit "</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">getChild</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(child.<span class="hljs-property">ngOnInitCalled</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'child component called OnChanges once'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">getChild</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(child.<span class="hljs-property">ngOnChangesCounter</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-number">1</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'changed parent value flows to child'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">getChild</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      parent.<span class="hljs-property">parentValue</span> = <span class="hljs-string">'foo'</span>;</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(child.<span class="hljs-property">ngOnChangesCounter</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'expected 2 changes: initial value and changed value'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(<span class="hljs-number">2</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(child.<span class="hljs-property">childValue</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'childValue should eq changed parent value'</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'foo'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">// must be async test to see child flow to parent</span></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'changed child value flows to parent'</span>, <span class="hljs-title function_">waitForAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">getChild</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      child.<span class="hljs-property">childValue</span> = <span class="hljs-string">'bar'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {</div><div class="hljs-ln-line">        <span class="hljs-comment">// Wait one JS engine turn!</span></div><div class="hljs-ln-line">        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(), <span class="hljs-number">0</span>);</div><div class="hljs-ln-line">      }).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">        fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">        <span class="hljs-title function_">expect</span>(child.<span class="hljs-property">ngOnChangesCounter</span>)</div><div class="hljs-ln-line">          .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'expected 2 changes: initial value and changed value'</span>)</div><div class="hljs-ln-line">          .<span class="hljs-title function_">toBe</span>(<span class="hljs-number">2</span>);</div><div class="hljs-ln-line">        <span class="hljs-title function_">expect</span>(parent.<span class="hljs-property">parentValue</span>)</div><div class="hljs-ln-line">          .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'parentValue should eq changed parent value'</span>)</div><div class="hljs-ln-line">          .<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'bar'</span>);</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'clicking "Close Child" triggers child OnDestroy'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">getChild</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> btn = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'button'</span>));</div><div class="hljs-ln-line">      <span class="hljs-title function_">click</span>(btn);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(child.<span class="hljs-property">ngOnDestroyCalled</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">////// helpers ///</span></div><div class="hljs-ln-line">    <span class="hljs-comment">/**</span></div><div class="hljs-ln-line">     * Get the MyIfChildComp from parent; fail w/ good message if cannot.</div><div class="hljs-ln-line">     */</div><div class="hljs-ln-line">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">getChild</span>(<span class="hljs-params"></span>) {</div><div class="hljs-ln-line">      <span class="hljs-keyword">let</span> <span class="hljs-attr">childDe</span>: <span class="hljs-title class_">DebugElement</span>; <span class="hljs-comment">// DebugElement that should hold the MyIfChildComp</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// The Hard Way: requires detailed knowledge of the parent template</span></div><div class="hljs-ln-line">      <span class="hljs-keyword">try</span> {</div><div class="hljs-ln-line">        childDe = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-property">children</span>[<span class="hljs-number">4</span>].<span class="hljs-property">children</span>[<span class="hljs-number">0</span>];</div><div class="hljs-ln-line">      } <span class="hljs-keyword">catch</span> (err) {</div><div class="hljs-ln-line">        <span class="hljs-comment">/* we'll report the error */</span></div><div class="hljs-ln-line">      }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// DebugElement.queryAll: if we wanted all of many instances:</span></div><div class="hljs-ln-line">      childDe = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">queryAll</span>(</div><div class="hljs-ln-line">        <span class="hljs-function">(<span class="hljs-params">de</span>) =&gt;</span> de.<span class="hljs-property">componentInstance</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">MyIfChildComponent</span>,</div><div class="hljs-ln-line">      )[<span class="hljs-number">0</span>];</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// WE'LL USE THIS APPROACH !</span></div><div class="hljs-ln-line">      <span class="hljs-comment">// DebugElement.query: find first instance (if any)</span></div><div class="hljs-ln-line">      childDe = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(</div><div class="hljs-ln-line">        <span class="hljs-function">(<span class="hljs-params">de</span>) =&gt;</span> de.<span class="hljs-property">componentInstance</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">MyIfChildComponent</span>,</div><div class="hljs-ln-line">      );</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">if</span> (childDe &amp;&amp; childDe.<span class="hljs-property">componentInstance</span>) {</div><div class="hljs-ln-line">        child = childDe.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      } <span class="hljs-keyword">else</span> {</div><div class="hljs-ln-line">        <span class="hljs-title function_">fail</span>(<span class="hljs-string">'Unable to find MyIfChildComp within MyIfParentComp'</span>);</div><div class="hljs-ln-line">      }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> child;</div><div class="hljs-ln-line">    }</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line">});</div><div class="hljs-ln-line"><span class="hljs-comment">////////// Fakes ///////////</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component</span>({</div><div class="hljs-ln-line">  <span class="hljs-attr">standalone</span>: <span class="hljs-literal">true</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">selector</span>: <span class="hljs-string">'child-1'</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">template</span>: <span class="hljs-string">'Fake Child'</span>,</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FakeChildComponent</span> {}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component</span>({</div><div class="hljs-ln-line">  <span class="hljs-attr">standalone</span>: <span class="hljs-literal">true</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">selector</span>: <span class="hljs-string">'grandchild-1'</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">template</span>: <span class="hljs-string">'Fake Grandchild'</span>,</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FakeGrandchildComponent</span> {}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component</span>({</div><div class="hljs-ln-line">  <span class="hljs-attr">standalone</span>: <span class="hljs-literal">true</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">selector</span>: <span class="hljs-string">'child-1'</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">FakeGrandchildComponent</span>],</div><div class="hljs-ln-line">  <span class="hljs-attr">template</span>: <span class="hljs-string">'Fake Child(&lt;grandchild-1&gt;&lt;/grandchild-1&gt;)'</span>,</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FakeChildWithGrandchildComponent</span> {}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Injectable</span>()</div><div class="hljs-ln-line"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FakeValueService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">ValueService</span> {</div><div class="hljs-ln-line">  <span class="hljs-keyword">override</span> value = <span class="hljs-string">'faked value'</span>;</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="4z8cgjvz5ruvrypj4nqyjtgtw">测试带依赖的服务时，需要在 <code>providers</code> 数组中提供 mock。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="2w2maamnho2eash8h1ya8oeo0">在下面的例子中，mock 是一个间谍对象。</p>
<div class="docs-code" path="adev/src/content/examples/testing/src/app/demo/demo.testbed.spec.ts" visiblelines="88,89,90,91,92,93,94,95,96,97,98,99,100,101">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">Component</span>, <span class="hljs-title class_">DebugElement</span>, <span class="hljs-title class_">Injectable</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {</div><div class="hljs-ln-line">  <span class="hljs-title class_">ComponentFixture</span>,</div><div class="hljs-ln-line">  fakeAsync,</div><div class="hljs-ln-line">  inject,</div><div class="hljs-ln-line">  <span class="hljs-title class_">TestBed</span>,</div><div class="hljs-ln-line">  tick,</div><div class="hljs-ln-line">  waitForAsync,</div><div class="hljs-ln-line">} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core/testing'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">FormsModule</span>, <span class="hljs-title class_">NgControl</span>, <span class="hljs-title class_">NgModel</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/forms'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">By</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/platform-browser'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {addMatchers, click} <span class="hljs-keyword">from</span> <span class="hljs-string">'../../testing'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {</div><div class="hljs-ln-line">  <span class="hljs-title class_">BankAccountComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">BankAccountParentComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">Child1Component</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">Child2Component</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">Child3Component</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">ExternalTemplateComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">InputComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">IoComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">IoParentComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">LightswitchComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">MasterService</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">MyIfChildComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">MyIfComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">MyIfParentComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">NeedsContentComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">ParentComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">ReversePipeComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">ShellComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">TestProvidersComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">TestViewProvidersComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">ValueService</span>,</div><div class="hljs-ln-line">} <span class="hljs-keyword">from</span> <span class="hljs-string">'./demo'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NotProvided</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">ValueService</span> {</div><div class="hljs-ln-line">  <span class="hljs-comment">/* example below */</span></div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"><span class="hljs-title function_">beforeEach</span>(addMatchers);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-title function_">describe</span>(<span class="hljs-string">'demo (with TestBed):'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">  <span class="hljs-comment">////////  Service Tests  /////////////</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'ValueService'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">service</span>: <span class="hljs-title class_">ValueService</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({<span class="hljs-attr">providers</span>: [<span class="hljs-title class_">ValueService</span>]});</div><div class="hljs-ln-line">      service = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">inject</span>(<span class="hljs-title class_">ValueService</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should use ValueService'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      service = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">inject</span>(<span class="hljs-title class_">ValueService</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(service.<span class="hljs-title function_">getValue</span>()).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'real value'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'can inject a default value when service is not provided'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(<span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">inject</span>(<span class="hljs-title class_">NotProvided</span>, <span class="hljs-literal">null</span>)).<span class="hljs-title function_">toBeNull</span>();</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'test should wait for ValueService.getPromiseValue'</span>, <span class="hljs-title function_">waitForAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      service.<span class="hljs-title function_">getPromiseValue</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> <span class="hljs-title function_">expect</span>(value).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'promise value'</span>));</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'test should wait for ValueService.getObservableValue'</span>, <span class="hljs-title function_">waitForAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      service.<span class="hljs-title function_">getObservableValue</span>().<span class="hljs-title function_">subscribe</span>(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> <span class="hljs-title function_">expect</span>(value).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'observable value'</span>));</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">// Must use done. See https://github.com/angular/angular/issues/10127</span></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'test should wait for ValueService.getObservableDelayValue'</span>, <span class="hljs-function">(<span class="hljs-params">done: DoneFn</span>) =&gt;</span> {</div><div class="hljs-ln-line">      service.<span class="hljs-title function_">getObservableDelayValue</span>().<span class="hljs-title function_">subscribe</span>(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> {</div><div class="hljs-ln-line">        <span class="hljs-title function_">expect</span>(value).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'observable delay value'</span>);</div><div class="hljs-ln-line">        <span class="hljs-title function_">done</span>();</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should allow the use of fakeAsync'</span>, <span class="hljs-title function_">fakeAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">let</span> <span class="hljs-attr">value</span>: <span class="hljs-built_in">any</span>;</div><div class="hljs-ln-line">      service.<span class="hljs-title function_">getPromiseValue</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">val: <span class="hljs-built_in">any</span></span>) =&gt;</span> (value = val));</div><div class="hljs-ln-line">      <span class="hljs-title function_">tick</span>(); <span class="hljs-comment">// Trigger JS engine cycle until all promises resolve.</span></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(value).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'promise value'</span>);</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'MasterService'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">masterService</span>: <span class="hljs-title class_">MasterService</span>;</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">valueServiceSpy</span>: jasmine.<span class="hljs-property">SpyObj</span>&lt;<span class="hljs-title class_">ValueService</span>&gt;;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> spy = jasmine.<span class="hljs-title function_">createSpyObj</span>(<span class="hljs-string">'ValueService'</span>, [<span class="hljs-string">'getValue'</span>]);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-comment">// Provide both the service-to-test and its (spy) dependency</span></div><div class="hljs-ln-line">        <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">MasterService</span>, {<span class="hljs-attr">provide</span>: <span class="hljs-title class_">ValueService</span>, <span class="hljs-attr">useValue</span>: spy}],</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">      <span class="hljs-comment">// Inject both the service-to-test and its (spy) dependency</span></div><div class="hljs-ln-line">      masterService = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">inject</span>(<span class="hljs-title class_">MasterService</span>);</div><div class="hljs-ln-line">      valueServiceSpy = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">inject</span>(<span class="hljs-title class_">ValueService</span>) <span class="hljs-keyword">as</span> jasmine.<span class="hljs-property">SpyObj</span>&lt;<span class="hljs-title class_">ValueService</span>&gt;;</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'#getValue should return stubbed value from a spy'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> stubValue = <span class="hljs-string">'stub value'</span>;</div><div class="hljs-ln-line">      valueServiceSpy.<span class="hljs-property">getValue</span>.<span class="hljs-property">and</span>.<span class="hljs-title function_">returnValue</span>(stubValue);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(masterService.<span class="hljs-title function_">getValue</span>()).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'service returned stub value'</span>).<span class="hljs-title function_">toBe</span>(stubValue);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(valueServiceSpy.<span class="hljs-property">getValue</span>.<span class="hljs-property">calls</span>.<span class="hljs-title function_">count</span>())</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'spy method was called once'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(<span class="hljs-number">1</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(valueServiceSpy.<span class="hljs-property">getValue</span>.<span class="hljs-property">calls</span>.<span class="hljs-title function_">mostRecent</span>().<span class="hljs-property">returnValue</span>).<span class="hljs-title function_">toBe</span>(stubValue);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'use inject within `it`'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({<span class="hljs-attr">providers</span>: [<span class="hljs-title class_">ValueService</span>]});</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should use modified providers'</span>, <span class="hljs-title function_">inject</span>([<span class="hljs-title class_">ValueService</span>], <span class="hljs-function">(<span class="hljs-params">service: ValueService</span>) =&gt;</span> {</div><div class="hljs-ln-line">      service.<span class="hljs-title function_">setValue</span>(<span class="hljs-string">'value modified in beforeEach'</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(service.<span class="hljs-title function_">getValue</span>()).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'value modified in beforeEach'</span>);</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'using waitForAsync(inject) within beforeEach'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">serviceValue</span>: <span class="hljs-built_in">string</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({<span class="hljs-attr">providers</span>: [<span class="hljs-title class_">ValueService</span>]});</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-title function_">waitForAsync</span>(</div><div class="hljs-ln-line">      <span class="hljs-title function_">inject</span>([<span class="hljs-title class_">ValueService</span>], <span class="hljs-function">(<span class="hljs-params">service: ValueService</span>) =&gt;</span> {</div><div class="hljs-ln-line">        service.<span class="hljs-title function_">getPromiseValue</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> (serviceValue = value));</div><div class="hljs-ln-line">      }),</div><div class="hljs-ln-line">    ));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should use asynchronously modified value ... in synchronous test'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(serviceValue).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'promise value'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-comment">/////////// Component Tests //////////////////</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'TestBed component tests'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-comment">// beforeEach(waitForAsync(() =&gt; {</span></div><div class="hljs-ln-line">    <span class="hljs-comment">//   TestBed.configureTestingModule()</span></div><div class="hljs-ln-line">    <span class="hljs-comment">//     // Compile everything in DemoModule</span></div><div class="hljs-ln-line">    <span class="hljs-comment">//     .compileComponents();</span></div><div class="hljs-ln-line">    <span class="hljs-comment">// }));</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should create a component with inline template'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">Child1Component</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'Child'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should create a component with external template'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">ExternalTemplateComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'from external template'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should allow changing members of the component'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">MyIfComponent</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'MyIf()'</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-property">componentInstance</span>.<span class="hljs-property">showMore</span> = <span class="hljs-literal">true</span>;</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'MyIf(More)'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should create a nested component bound to inputs/outputs'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">IoParentComponent</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> heroes = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">queryAll</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'.hero'</span>));</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(heroes.<span class="hljs-property">length</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'has heroes'</span>).<span class="hljs-title function_">toBeGreaterThan</span>(<span class="hljs-number">0</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> hero = comp.<span class="hljs-property">heroes</span>[<span class="hljs-number">0</span>];</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">click</span>(heroes[<span class="hljs-number">0</span>]);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> selected = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'p'</span>));</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(selected).<span class="hljs-title function_">toHaveText</span>(hero.<span class="hljs-property">name</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'can access the instance variable of an `*ngFor` row component'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">IoParentComponent</span>);</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> heroName = comp.<span class="hljs-property">heroes</span>[<span class="hljs-number">0</span>].<span class="hljs-property">name</span>; <span class="hljs-comment">// first hero's name</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> ngForRow = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">directive</span>(<span class="hljs-title class_">IoComponent</span>)); <span class="hljs-comment">// first hero ngForRow</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> hero = ngForRow.<span class="hljs-property">context</span>.<span class="hljs-property">hero</span>; <span class="hljs-comment">// the hero object passed into the row</span></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(hero.<span class="hljs-property">name</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'ngRow.context.hero'</span>).<span class="hljs-title function_">toBe</span>(heroName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> rowComp = ngForRow.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      <span class="hljs-comment">// jasmine.any is an "instance-of-type" test.</span></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(rowComp).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'component is IoComp'</span>).<span class="hljs-title function_">toEqual</span>(jasmine.<span class="hljs-title function_">any</span>(<span class="hljs-title class_">IoComponent</span>));</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(rowComp.<span class="hljs-property">hero</span>.<span class="hljs-property">name</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'component.hero'</span>).<span class="hljs-title function_">toBe</span>(heroName);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should support clicking a button'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">LightswitchComponent</span>);</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> btn = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'button'</span>));</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> span = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'span'</span>)).<span class="hljs-property">nativeElement</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(span.<span class="hljs-property">textContent</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'before click'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toMatch</span>(<span class="hljs-regexp">/is off/i</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">click</span>(btn);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(span.<span class="hljs-property">textContent</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'after click'</span>).<span class="hljs-title function_">toMatch</span>(<span class="hljs-regexp">/is on/i</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">// ngModel is async so we must wait for it with promise-based `whenStable`</span></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should support entering text in input box (ngModel)'</span>, <span class="hljs-title function_">waitForAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> expectedOrigName = <span class="hljs-string">'John'</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> expectedNewName = <span class="hljs-string">'Sally'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">InputComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> input = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'input'</span>)).<span class="hljs-property">nativeElement</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLInputElement</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">name</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">`At start name should be <span class="hljs-subst">${expectedOrigName}</span> `</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(expectedOrigName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// wait until ngModel binds comp.name to input box</span></div><div class="hljs-ln-line">      fixture</div><div class="hljs-ln-line">        .<span class="hljs-title function_">whenStable</span>()</div><div class="hljs-ln-line">        .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">          <span class="hljs-title function_">expect</span>(input.<span class="hljs-property">value</span>)</div><div class="hljs-ln-line">            .<span class="hljs-title function_">withContext</span>(</div><div class="hljs-ln-line">              <span class="hljs-string">`After ngModel updates input box, input.value should be <span class="hljs-subst">${expectedOrigName}</span> `</span>,</div><div class="hljs-ln-line">            )</div><div class="hljs-ln-line">            .<span class="hljs-title function_">toBe</span>(expectedOrigName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-comment">// simulate user entering new name in input</span></div><div class="hljs-ln-line">          input.<span class="hljs-property">value</span> = expectedNewName;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-comment">// that change doesn't flow to the component immediately</span></div><div class="hljs-ln-line">          <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">name</span>)</div><div class="hljs-ln-line">            .<span class="hljs-title function_">withContext</span>(</div><div class="hljs-ln-line">              <span class="hljs-string">`comp.name should still be <span class="hljs-subst">${expectedOrigName}</span> after value change, before binding happens`</span>,</div><div class="hljs-ln-line">            )</div><div class="hljs-ln-line">            .<span class="hljs-title function_">toBe</span>(expectedOrigName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-comment">// Dispatch a DOM event so that Angular learns of input value change.</span></div><div class="hljs-ln-line">          <span class="hljs-comment">// then wait while ngModel pushes input.box value to comp.name</span></div><div class="hljs-ln-line">          input.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">'input'</span>));</div><div class="hljs-ln-line">          <span class="hljs-keyword">return</span> fixture.<span class="hljs-title function_">whenStable</span>();</div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">          <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">name</span>)</div><div class="hljs-ln-line">            .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">`After ngModel updates the model, comp.name should be <span class="hljs-subst">${expectedNewName}</span> `</span>)</div><div class="hljs-ln-line">            .<span class="hljs-title function_">toBe</span>(expectedNewName);</div><div class="hljs-ln-line">        });</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">// fakeAsync version of ngModel input test enables sync test style</span></div><div class="hljs-ln-line">    <span class="hljs-comment">// synchronous `tick` replaces asynchronous promise-base `whenStable`</span></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should support entering text in input box (ngModel) - fakeAsync'</span>, <span class="hljs-title function_">fakeAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> expectedOrigName = <span class="hljs-string">'John'</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> expectedNewName = <span class="hljs-string">'Sally'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">InputComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> input = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'input'</span>)).<span class="hljs-property">nativeElement</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLInputElement</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">name</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">`At start name should be <span class="hljs-subst">${expectedOrigName}</span> `</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(expectedOrigName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// wait until ngModel binds comp.name to input box</span></div><div class="hljs-ln-line">      <span class="hljs-title function_">tick</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(input.<span class="hljs-property">value</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">`After ngModel updates input box, input.value should be <span class="hljs-subst">${expectedOrigName}</span> `</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(expectedOrigName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// simulate user entering new name in input</span></div><div class="hljs-ln-line">      input.<span class="hljs-property">value</span> = expectedNewName;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// that change doesn't flow to the component immediately</span></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">name</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(</div><div class="hljs-ln-line">          <span class="hljs-string">`comp.name should still be <span class="hljs-subst">${expectedOrigName}</span> after value change, before binding happens`</span>,</div><div class="hljs-ln-line">        )</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(expectedOrigName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// Dispatch a DOM event so that Angular learns of input value change.</span></div><div class="hljs-ln-line">      <span class="hljs-comment">// then wait a tick while ngModel pushes input.box value to comp.name</span></div><div class="hljs-ln-line">      input.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">'input'</span>));</div><div class="hljs-ln-line">      <span class="hljs-title function_">tick</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">name</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">`After ngModel updates the model, comp.name should be <span class="hljs-subst">${expectedNewName}</span> `</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(expectedNewName);</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'ReversePipeComp should reverse the input text'</span>, <span class="hljs-title function_">fakeAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> inputText = <span class="hljs-string">'the quick brown fox.'</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> expectedText = <span class="hljs-string">'.xof nworb kciuq eht'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">ReversePipeComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> input = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'input'</span>)).<span class="hljs-property">nativeElement</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLInputElement</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> span = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'span'</span>)).<span class="hljs-property">nativeElement</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLElement</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// simulate user entering new name in input</span></div><div class="hljs-ln-line">      input.<span class="hljs-property">value</span> = inputText;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// Dispatch a DOM event so that Angular learns of input value change.</span></div><div class="hljs-ln-line">      <span class="hljs-comment">// then wait a tick while ngModel pushes input.box value to comp.text</span></div><div class="hljs-ln-line">      <span class="hljs-comment">// and Angular updates the output span</span></div><div class="hljs-ln-line">      input.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">'input'</span>));</div><div class="hljs-ln-line">      <span class="hljs-title function_">tick</span>();</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(span.<span class="hljs-property">textContent</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'output span'</span>).<span class="hljs-title function_">toBe</span>(expectedText);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">text</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'component.text'</span>).<span class="hljs-title function_">toBe</span>(inputText);</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">// Use this technique to find attached directives of any kind</span></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'can examine attached directives and listeners'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">InputComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> inputEl = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'input'</span>));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(inputEl.<span class="hljs-property">providerTokens</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'NgModel directive'</span>).<span class="hljs-title function_">toContain</span>(<span class="hljs-title class_">NgModel</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> ngControl = inputEl.<span class="hljs-property">injector</span>.<span class="hljs-title function_">get</span>(<span class="hljs-title class_">NgControl</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(ngControl).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'NgControl directive'</span>).<span class="hljs-title function_">toEqual</span>(jasmine.<span class="hljs-title function_">any</span>(<span class="hljs-title class_">NgControl</span>));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(inputEl.<span class="hljs-property">listeners</span>.<span class="hljs-property">length</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'several listeners attached'</span>).<span class="hljs-title function_">toBeGreaterThan</span>(<span class="hljs-number">2</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'BankAccountComponent should set attributes, styles, classes, and properties'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">BankAccountParentComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// the only child is debugElement of the BankAccount component</span></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> el = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-property">children</span>[<span class="hljs-number">0</span>];</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> childComp = el.<span class="hljs-property">componentInstance</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">BankAccountComponent</span>;</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(childComp).<span class="hljs-title function_">toEqual</span>(jasmine.<span class="hljs-title function_">any</span>(<span class="hljs-title class_">BankAccountComponent</span>));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">context</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'context is the child component'</span>).<span class="hljs-title function_">toBe</span>(childComp);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">attributes</span>[<span class="hljs-string">'account'</span>]).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'account attribute'</span>).<span class="hljs-title function_">toBe</span>(childComp.<span class="hljs-property">id</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">attributes</span>[<span class="hljs-string">'bank'</span>]).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'bank attribute'</span>).<span class="hljs-title function_">toBe</span>(childComp.<span class="hljs-property">bank</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">classes</span>[<span class="hljs-string">'closed'</span>]).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'closed class'</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">classes</span>[<span class="hljs-string">'open'</span>]).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'open class'</span>).<span class="hljs-title function_">toBeFalsy</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">styles</span>[<span class="hljs-string">'color'</span>]).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'color style'</span>).<span class="hljs-title function_">toBe</span>(comp.<span class="hljs-property">color</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">styles</span>[<span class="hljs-string">'width'</span>])</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'width style'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(comp.<span class="hljs-property">width</span> + <span class="hljs-string">'px'</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// Removed on 12/02/2016 when ceased public discussion of the `Renderer`. Revive in future?</span></div><div class="hljs-ln-line">      <span class="hljs-comment">// expect(el.properties['customProperty']).toBe(true, 'customProperty');</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'TestBed component overrides:'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">"should override ChildComp's template"</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">Child1Component</span>],</div><div class="hljs-ln-line">      })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">Child1Component</span>, {</div><div class="hljs-ln-line">          <span class="hljs-attr">set</span>: {<span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;span&gt;Fake&lt;/span&gt;'</span>},</div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">Child1Component</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'Fake'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">"should override TestProvidersComp's ValueService provider"</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">TestProvidersComponent</span>],</div><div class="hljs-ln-line">      })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">TestProvidersComponent</span>, {</div><div class="hljs-ln-line">          <span class="hljs-attr">remove</span>: {<span class="hljs-attr">providers</span>: [<span class="hljs-title class_">ValueService</span>]},</div><div class="hljs-ln-line">          <span class="hljs-attr">add</span>: {<span class="hljs-attr">providers</span>: [{<span class="hljs-attr">provide</span>: <span class="hljs-title class_">ValueService</span>, <span class="hljs-attr">useClass</span>: <span class="hljs-title class_">FakeValueService</span>}]},</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-comment">// Or replace them all (this component has only one provider)</span></div><div class="hljs-ln-line">          <span class="hljs-comment">// set:    { providers: [{ provide: ValueService, useClass: FakeValueService }] },</span></div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">TestProvidersComponent</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'injected value: faked value'</span>, <span class="hljs-string">'text'</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// Explore the providerTokens</span></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> tokens = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-property">providerTokens</span>;</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(tokens).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'component ctor'</span>).<span class="hljs-title function_">toContain</span>(fixture.<span class="hljs-property">componentInstance</span>.<span class="hljs-property">constructor</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(tokens).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'TestProvidersComp'</span>).<span class="hljs-title function_">toContain</span>(<span class="hljs-title class_">TestProvidersComponent</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(tokens).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'ValueService'</span>).<span class="hljs-title function_">toContain</span>(<span class="hljs-title class_">ValueService</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">"should override TestViewProvidersComp's ValueService viewProvider"</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">TestViewProvidersComponent</span>],</div><div class="hljs-ln-line">      })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">TestViewProvidersComponent</span>, {</div><div class="hljs-ln-line">          <span class="hljs-comment">// remove: { viewProviders: [ValueService]},</span></div><div class="hljs-ln-line">          <span class="hljs-comment">// add:    { viewProviders: [{ provide: ValueService, useClass: FakeValueService }]</span></div><div class="hljs-ln-line">          <span class="hljs-comment">// },</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-comment">// Or replace them all (this component has only one viewProvider)</span></div><div class="hljs-ln-line">          <span class="hljs-attr">set</span>: {<span class="hljs-attr">viewProviders</span>: [{<span class="hljs-attr">provide</span>: <span class="hljs-title class_">ValueService</span>, <span class="hljs-attr">useClass</span>: <span class="hljs-title class_">FakeValueService</span>}]},</div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">TestViewProvidersComponent</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'injected value: faked value'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">"injected provider should not be same as component's provider"</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-comment">// TestComponent is parent of TestProvidersComponent</span></div><div class="hljs-ln-line">      <span class="hljs-meta">@Component</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">standalone</span>: <span class="hljs-literal">true</span>,</div><div class="hljs-ln-line">        <span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;my-service-comp&gt;&lt;/my-service-comp&gt;'</span>,</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">TestProvidersComponent</span>],</div><div class="hljs-ln-line">      })</div><div class="hljs-ln-line">      <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestComponent</span> {}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// 3 levels of ValueService provider: module, TestComponent, TestProvidersComponent</span></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">TestComponent</span>, <span class="hljs-title class_">TestProvidersComponent</span>],</div><div class="hljs-ln-line">        <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">ValueService</span>],</div><div class="hljs-ln-line">      })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">TestComponent</span>, {</div><div class="hljs-ln-line">          <span class="hljs-attr">set</span>: {<span class="hljs-attr">providers</span>: [{<span class="hljs-attr">provide</span>: <span class="hljs-title class_">ValueService</span>, <span class="hljs-attr">useValue</span>: {}}]},</div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">TestProvidersComponent</span>, {</div><div class="hljs-ln-line">          <span class="hljs-attr">set</span>: {<span class="hljs-attr">providers</span>: [{<span class="hljs-attr">provide</span>: <span class="hljs-title class_">ValueService</span>, <span class="hljs-attr">useClass</span>: <span class="hljs-title class_">FakeValueService</span>}]},</div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">TestComponent</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">let</span> testBedProvider!: <span class="hljs-title class_">ValueService</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// `inject` uses TestBed's injector</span></div><div class="hljs-ln-line">      <span class="hljs-title function_">inject</span>([<span class="hljs-title class_">ValueService</span>], <span class="hljs-function">(<span class="hljs-params">s: ValueService</span>) =&gt;</span> (testBedProvider = s))();</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> tcProvider = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-property">injector</span>.<span class="hljs-title function_">get</span>(<span class="hljs-title class_">ValueService</span>) <span class="hljs-keyword">as</span> <span class="hljs-title class_">ValueService</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> tpcProvider = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-property">children</span>[<span class="hljs-number">0</span>].<span class="hljs-property">injector</span>.<span class="hljs-title function_">get</span>(</div><div class="hljs-ln-line">        <span class="hljs-title class_">ValueService</span>,</div><div class="hljs-ln-line">      ) <span class="hljs-keyword">as</span> <span class="hljs-title class_">FakeValueService</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(testBedProvider).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'testBed/tc not same providers'</span>).<span class="hljs-property">not</span>.<span class="hljs-title function_">toBe</span>(tcProvider);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(testBedProvider).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'testBed/tpc not same providers'</span>).<span class="hljs-property">not</span>.<span class="hljs-title function_">toBe</span>(tpcProvider);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(testBedProvider <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">ValueService</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'testBedProvider is ValueService'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(tcProvider)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'tcProvider is {}'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toEqual</span>({} <span class="hljs-keyword">as</span> <span class="hljs-title class_">ValueService</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(tpcProvider <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">FakeValueService</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'tpcProvider is FakeValueService'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'can access template local variables as references'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [</div><div class="hljs-ln-line">          <span class="hljs-title class_">ShellComponent</span>,</div><div class="hljs-ln-line">          <span class="hljs-title class_">NeedsContentComponent</span>,</div><div class="hljs-ln-line">          <span class="hljs-title class_">Child1Component</span>,</div><div class="hljs-ln-line">          <span class="hljs-title class_">Child2Component</span>,</div><div class="hljs-ln-line">          <span class="hljs-title class_">Child3Component</span>,</div><div class="hljs-ln-line">        ],</div><div class="hljs-ln-line">      })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">ShellComponent</span>, {</div><div class="hljs-ln-line">          <span class="hljs-attr">set</span>: {</div><div class="hljs-ln-line">            <span class="hljs-attr">selector</span>: <span class="hljs-string">'test-shell'</span>,</div><div class="hljs-ln-line">            <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">NeedsContentComponent</span>, <span class="hljs-title class_">Child1Component</span>, <span class="hljs-title class_">Child2Component</span>, <span class="hljs-title class_">Child3Component</span>],</div><div class="hljs-ln-line">            <span class="hljs-attr">template</span>: <span class="hljs-string">`</span></div><div class="hljs-ln-line">          &lt;needs-content #nc&gt;</div><div class="hljs-ln-line">            &lt;child-1 #content text="My"&gt;&lt;/child-1&gt;</div><div class="hljs-ln-line">            &lt;child-2 #content text="dog"&gt;&lt;/child-2&gt;</div><div class="hljs-ln-line">            &lt;child-2 text="has"&gt;&lt;/child-2&gt;</div><div class="hljs-ln-line">            &lt;child-3 #content text="fleas"&gt;&lt;/child-3&gt;</div><div class="hljs-ln-line">            &lt;div #content&gt;!&lt;/div&gt;</div><div class="hljs-ln-line">          &lt;/needs-content&gt;</div><div class="hljs-ln-line">          `,</div><div class="hljs-ln-line">          },</div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">ShellComponent</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// NeedsContentComp is the child of ShellComp</span></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> el = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-property">children</span>[<span class="hljs-number">0</span>];</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = el.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">children</span>.<span class="hljs-title function_">toArray</span>().<span class="hljs-property">length</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'three different child components and an ElementRef with #content'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(<span class="hljs-number">4</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">references</span>[<span class="hljs-string">'nc'</span>]).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'#nc reference to component'</span>).<span class="hljs-title function_">toBe</span>(comp);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// Filter for DebugElements with a #content reference</span></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> contentRefs = el.<span class="hljs-title function_">queryAll</span>(<span class="hljs-function">(<span class="hljs-params">de</span>) =&gt;</span> de.<span class="hljs-property">references</span>[<span class="hljs-string">'content'</span>]);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(contentRefs.<span class="hljs-property">length</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'elements w/ a #content reference'</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-number">4</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'nested (one-deep) component override'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">ParentComponent</span>, <span class="hljs-title class_">FakeChildComponent</span>],</div><div class="hljs-ln-line">      }).<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">ParentComponent</span>, {</div><div class="hljs-ln-line">        <span class="hljs-attr">set</span>: {<span class="hljs-attr">imports</span>: [<span class="hljs-title class_">FakeChildComponent</span>]},</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'ParentComp should use Fake Child component'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">ParentComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'Parent(Fake Child)'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'nested (two-deep) component override'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">ParentComponent</span>, <span class="hljs-title class_">FakeChildWithGrandchildComponent</span>, <span class="hljs-title class_">FakeGrandchildComponent</span>],</div><div class="hljs-ln-line">      }).<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">ParentComponent</span>, {</div><div class="hljs-ln-line">        <span class="hljs-attr">set</span>: {<span class="hljs-attr">imports</span>: [<span class="hljs-title class_">FakeChildWithGrandchildComponent</span>, <span class="hljs-title class_">FakeGrandchildComponent</span>]},</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should use Fake Grandchild component'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">ParentComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'Parent(Fake Child(Fake Grandchild))'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'lifecycle hooks w/ MyIfParentComp'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">fixture</span>: <span class="hljs-title class_">ComponentFixture</span>&lt;<span class="hljs-title class_">MyIfParentComponent</span>&gt;;</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">parent</span>: <span class="hljs-title class_">MyIfParentComponent</span>;</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">child</span>: <span class="hljs-title class_">MyIfChildComponent</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">FormsModule</span>, <span class="hljs-title class_">MyIfChildComponent</span>, <span class="hljs-title class_">MyIfParentComponent</span>],</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">MyIfParentComponent</span>);</div><div class="hljs-ln-line">      parent = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should instantiate parent component'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(parent).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'parent component should exist'</span>).<span class="hljs-property">not</span>.<span class="hljs-title function_">toBeNull</span>();</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'parent component OnInit should NOT be called before first detectChanges()'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(parent.<span class="hljs-property">ngOnInitCalled</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">false</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'parent component OnInit should be called after first detectChanges()'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(parent.<span class="hljs-property">ngOnInitCalled</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'child component should exist after OnInit'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">getChild</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(child <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">MyIfChildComponent</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'should create child'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">"should have called child component's OnInit "</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">getChild</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(child.<span class="hljs-property">ngOnInitCalled</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'child component called OnChanges once'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">getChild</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(child.<span class="hljs-property">ngOnChangesCounter</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-number">1</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'changed parent value flows to child'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">getChild</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      parent.<span class="hljs-property">parentValue</span> = <span class="hljs-string">'foo'</span>;</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(child.<span class="hljs-property">ngOnChangesCounter</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'expected 2 changes: initial value and changed value'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(<span class="hljs-number">2</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(child.<span class="hljs-property">childValue</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'childValue should eq changed parent value'</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'foo'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">// must be async test to see child flow to parent</span></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'changed child value flows to parent'</span>, <span class="hljs-title function_">waitForAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">getChild</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      child.<span class="hljs-property">childValue</span> = <span class="hljs-string">'bar'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {</div><div class="hljs-ln-line">        <span class="hljs-comment">// Wait one JS engine turn!</span></div><div class="hljs-ln-line">        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(), <span class="hljs-number">0</span>);</div><div class="hljs-ln-line">      }).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">        fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">        <span class="hljs-title function_">expect</span>(child.<span class="hljs-property">ngOnChangesCounter</span>)</div><div class="hljs-ln-line">          .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'expected 2 changes: initial value and changed value'</span>)</div><div class="hljs-ln-line">          .<span class="hljs-title function_">toBe</span>(<span class="hljs-number">2</span>);</div><div class="hljs-ln-line">        <span class="hljs-title function_">expect</span>(parent.<span class="hljs-property">parentValue</span>)</div><div class="hljs-ln-line">          .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'parentValue should eq changed parent value'</span>)</div><div class="hljs-ln-line">          .<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'bar'</span>);</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'clicking "Close Child" triggers child OnDestroy'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">getChild</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> btn = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'button'</span>));</div><div class="hljs-ln-line">      <span class="hljs-title function_">click</span>(btn);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(child.<span class="hljs-property">ngOnDestroyCalled</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">////// helpers ///</span></div><div class="hljs-ln-line">    <span class="hljs-comment">/**</span></div><div class="hljs-ln-line">     * Get the MyIfChildComp from parent; fail w/ good message if cannot.</div><div class="hljs-ln-line">     */</div><div class="hljs-ln-line">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">getChild</span>(<span class="hljs-params"></span>) {</div><div class="hljs-ln-line">      <span class="hljs-keyword">let</span> <span class="hljs-attr">childDe</span>: <span class="hljs-title class_">DebugElement</span>; <span class="hljs-comment">// DebugElement that should hold the MyIfChildComp</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// The Hard Way: requires detailed knowledge of the parent template</span></div><div class="hljs-ln-line">      <span class="hljs-keyword">try</span> {</div><div class="hljs-ln-line">        childDe = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-property">children</span>[<span class="hljs-number">4</span>].<span class="hljs-property">children</span>[<span class="hljs-number">0</span>];</div><div class="hljs-ln-line">      } <span class="hljs-keyword">catch</span> (err) {</div><div class="hljs-ln-line">        <span class="hljs-comment">/* we'll report the error */</span></div><div class="hljs-ln-line">      }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// DebugElement.queryAll: if we wanted all of many instances:</span></div><div class="hljs-ln-line">      childDe = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">queryAll</span>(</div><div class="hljs-ln-line">        <span class="hljs-function">(<span class="hljs-params">de</span>) =&gt;</span> de.<span class="hljs-property">componentInstance</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">MyIfChildComponent</span>,</div><div class="hljs-ln-line">      )[<span class="hljs-number">0</span>];</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// WE'LL USE THIS APPROACH !</span></div><div class="hljs-ln-line">      <span class="hljs-comment">// DebugElement.query: find first instance (if any)</span></div><div class="hljs-ln-line">      childDe = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(</div><div class="hljs-ln-line">        <span class="hljs-function">(<span class="hljs-params">de</span>) =&gt;</span> de.<span class="hljs-property">componentInstance</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">MyIfChildComponent</span>,</div><div class="hljs-ln-line">      );</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">if</span> (childDe &amp;&amp; childDe.<span class="hljs-property">componentInstance</span>) {</div><div class="hljs-ln-line">        child = childDe.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      } <span class="hljs-keyword">else</span> {</div><div class="hljs-ln-line">        <span class="hljs-title function_">fail</span>(<span class="hljs-string">'Unable to find MyIfChildComp within MyIfParentComp'</span>);</div><div class="hljs-ln-line">      }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> child;</div><div class="hljs-ln-line">    }</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line">});</div><div class="hljs-ln-line"><span class="hljs-comment">////////// Fakes ///////////</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component</span>({</div><div class="hljs-ln-line">  <span class="hljs-attr">standalone</span>: <span class="hljs-literal">true</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">selector</span>: <span class="hljs-string">'child-1'</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">template</span>: <span class="hljs-string">'Fake Child'</span>,</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FakeChildComponent</span> {}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component</span>({</div><div class="hljs-ln-line">  <span class="hljs-attr">standalone</span>: <span class="hljs-literal">true</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">selector</span>: <span class="hljs-string">'grandchild-1'</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">template</span>: <span class="hljs-string">'Fake Grandchild'</span>,</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FakeGrandchildComponent</span> {}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component</span>({</div><div class="hljs-ln-line">  <span class="hljs-attr">standalone</span>: <span class="hljs-literal">true</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">selector</span>: <span class="hljs-string">'child-1'</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">FakeGrandchildComponent</span>],</div><div class="hljs-ln-line">  <span class="hljs-attr">template</span>: <span class="hljs-string">'Fake Child(&lt;grandchild-1&gt;&lt;/grandchild-1&gt;)'</span>,</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FakeChildWithGrandchildComponent</span> {}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Injectable</span>()</div><div class="hljs-ln-line"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FakeValueService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">ValueService</span> {</div><div class="hljs-ln-line">  <span class="hljs-keyword">override</span> value = <span class="hljs-string">'faked value'</span>;</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="a74rd5bz78usbo01mfwn1upto">该测试会像以前一样使用该间谍。</p>
<div class="docs-code" path="adev/src/content/examples/testing/src/app/demo/demo.testbed.spec.ts" visiblelines="103,104,105,106,107,108,109,110,111,112">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">Component</span>, <span class="hljs-title class_">DebugElement</span>, <span class="hljs-title class_">Injectable</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {</div><div class="hljs-ln-line">  <span class="hljs-title class_">ComponentFixture</span>,</div><div class="hljs-ln-line">  fakeAsync,</div><div class="hljs-ln-line">  inject,</div><div class="hljs-ln-line">  <span class="hljs-title class_">TestBed</span>,</div><div class="hljs-ln-line">  tick,</div><div class="hljs-ln-line">  waitForAsync,</div><div class="hljs-ln-line">} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core/testing'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">FormsModule</span>, <span class="hljs-title class_">NgControl</span>, <span class="hljs-title class_">NgModel</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/forms'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">By</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/platform-browser'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {addMatchers, click} <span class="hljs-keyword">from</span> <span class="hljs-string">'../../testing'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {</div><div class="hljs-ln-line">  <span class="hljs-title class_">BankAccountComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">BankAccountParentComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">Child1Component</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">Child2Component</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">Child3Component</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">ExternalTemplateComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">InputComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">IoComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">IoParentComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">LightswitchComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">MasterService</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">MyIfChildComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">MyIfComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">MyIfParentComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">NeedsContentComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">ParentComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">ReversePipeComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">ShellComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">TestProvidersComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">TestViewProvidersComponent</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">ValueService</span>,</div><div class="hljs-ln-line">} <span class="hljs-keyword">from</span> <span class="hljs-string">'./demo'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NotProvided</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">ValueService</span> {</div><div class="hljs-ln-line">  <span class="hljs-comment">/* example below */</span></div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"><span class="hljs-title function_">beforeEach</span>(addMatchers);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-title function_">describe</span>(<span class="hljs-string">'demo (with TestBed):'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">  <span class="hljs-comment">////////  Service Tests  /////////////</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'ValueService'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">service</span>: <span class="hljs-title class_">ValueService</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({<span class="hljs-attr">providers</span>: [<span class="hljs-title class_">ValueService</span>]});</div><div class="hljs-ln-line">      service = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">inject</span>(<span class="hljs-title class_">ValueService</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should use ValueService'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      service = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">inject</span>(<span class="hljs-title class_">ValueService</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(service.<span class="hljs-title function_">getValue</span>()).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'real value'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'can inject a default value when service is not provided'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(<span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">inject</span>(<span class="hljs-title class_">NotProvided</span>, <span class="hljs-literal">null</span>)).<span class="hljs-title function_">toBeNull</span>();</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'test should wait for ValueService.getPromiseValue'</span>, <span class="hljs-title function_">waitForAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      service.<span class="hljs-title function_">getPromiseValue</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> <span class="hljs-title function_">expect</span>(value).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'promise value'</span>));</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'test should wait for ValueService.getObservableValue'</span>, <span class="hljs-title function_">waitForAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      service.<span class="hljs-title function_">getObservableValue</span>().<span class="hljs-title function_">subscribe</span>(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> <span class="hljs-title function_">expect</span>(value).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'observable value'</span>));</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">// Must use done. See https://github.com/angular/angular/issues/10127</span></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'test should wait for ValueService.getObservableDelayValue'</span>, <span class="hljs-function">(<span class="hljs-params">done: DoneFn</span>) =&gt;</span> {</div><div class="hljs-ln-line">      service.<span class="hljs-title function_">getObservableDelayValue</span>().<span class="hljs-title function_">subscribe</span>(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> {</div><div class="hljs-ln-line">        <span class="hljs-title function_">expect</span>(value).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'observable delay value'</span>);</div><div class="hljs-ln-line">        <span class="hljs-title function_">done</span>();</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should allow the use of fakeAsync'</span>, <span class="hljs-title function_">fakeAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">let</span> <span class="hljs-attr">value</span>: <span class="hljs-built_in">any</span>;</div><div class="hljs-ln-line">      service.<span class="hljs-title function_">getPromiseValue</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">val: <span class="hljs-built_in">any</span></span>) =&gt;</span> (value = val));</div><div class="hljs-ln-line">      <span class="hljs-title function_">tick</span>(); <span class="hljs-comment">// Trigger JS engine cycle until all promises resolve.</span></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(value).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'promise value'</span>);</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'MasterService'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">masterService</span>: <span class="hljs-title class_">MasterService</span>;</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">valueServiceSpy</span>: jasmine.<span class="hljs-property">SpyObj</span>&lt;<span class="hljs-title class_">ValueService</span>&gt;;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> spy = jasmine.<span class="hljs-title function_">createSpyObj</span>(<span class="hljs-string">'ValueService'</span>, [<span class="hljs-string">'getValue'</span>]);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-comment">// Provide both the service-to-test and its (spy) dependency</span></div><div class="hljs-ln-line">        <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">MasterService</span>, {<span class="hljs-attr">provide</span>: <span class="hljs-title class_">ValueService</span>, <span class="hljs-attr">useValue</span>: spy}],</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">      <span class="hljs-comment">// Inject both the service-to-test and its (spy) dependency</span></div><div class="hljs-ln-line">      masterService = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">inject</span>(<span class="hljs-title class_">MasterService</span>);</div><div class="hljs-ln-line">      valueServiceSpy = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">inject</span>(<span class="hljs-title class_">ValueService</span>) <span class="hljs-keyword">as</span> jasmine.<span class="hljs-property">SpyObj</span>&lt;<span class="hljs-title class_">ValueService</span>&gt;;</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'#getValue should return stubbed value from a spy'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> stubValue = <span class="hljs-string">'stub value'</span>;</div><div class="hljs-ln-line">      valueServiceSpy.<span class="hljs-property">getValue</span>.<span class="hljs-property">and</span>.<span class="hljs-title function_">returnValue</span>(stubValue);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(masterService.<span class="hljs-title function_">getValue</span>()).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'service returned stub value'</span>).<span class="hljs-title function_">toBe</span>(stubValue);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(valueServiceSpy.<span class="hljs-property">getValue</span>.<span class="hljs-property">calls</span>.<span class="hljs-title function_">count</span>())</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'spy method was called once'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(<span class="hljs-number">1</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(valueServiceSpy.<span class="hljs-property">getValue</span>.<span class="hljs-property">calls</span>.<span class="hljs-title function_">mostRecent</span>().<span class="hljs-property">returnValue</span>).<span class="hljs-title function_">toBe</span>(stubValue);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'use inject within `it`'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({<span class="hljs-attr">providers</span>: [<span class="hljs-title class_">ValueService</span>]});</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should use modified providers'</span>, <span class="hljs-title function_">inject</span>([<span class="hljs-title class_">ValueService</span>], <span class="hljs-function">(<span class="hljs-params">service: ValueService</span>) =&gt;</span> {</div><div class="hljs-ln-line">      service.<span class="hljs-title function_">setValue</span>(<span class="hljs-string">'value modified in beforeEach'</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(service.<span class="hljs-title function_">getValue</span>()).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'value modified in beforeEach'</span>);</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'using waitForAsync(inject) within beforeEach'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">serviceValue</span>: <span class="hljs-built_in">string</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({<span class="hljs-attr">providers</span>: [<span class="hljs-title class_">ValueService</span>]});</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-title function_">waitForAsync</span>(</div><div class="hljs-ln-line">      <span class="hljs-title function_">inject</span>([<span class="hljs-title class_">ValueService</span>], <span class="hljs-function">(<span class="hljs-params">service: ValueService</span>) =&gt;</span> {</div><div class="hljs-ln-line">        service.<span class="hljs-title function_">getPromiseValue</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> (serviceValue = value));</div><div class="hljs-ln-line">      }),</div><div class="hljs-ln-line">    ));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should use asynchronously modified value ... in synchronous test'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(serviceValue).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'promise value'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-comment">/////////// Component Tests //////////////////</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'TestBed component tests'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-comment">// beforeEach(waitForAsync(() =&gt; {</span></div><div class="hljs-ln-line">    <span class="hljs-comment">//   TestBed.configureTestingModule()</span></div><div class="hljs-ln-line">    <span class="hljs-comment">//     // Compile everything in DemoModule</span></div><div class="hljs-ln-line">    <span class="hljs-comment">//     .compileComponents();</span></div><div class="hljs-ln-line">    <span class="hljs-comment">// }));</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should create a component with inline template'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">Child1Component</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'Child'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should create a component with external template'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">ExternalTemplateComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'from external template'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should allow changing members of the component'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">MyIfComponent</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'MyIf()'</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-property">componentInstance</span>.<span class="hljs-property">showMore</span> = <span class="hljs-literal">true</span>;</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'MyIf(More)'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should create a nested component bound to inputs/outputs'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">IoParentComponent</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> heroes = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">queryAll</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'.hero'</span>));</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(heroes.<span class="hljs-property">length</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'has heroes'</span>).<span class="hljs-title function_">toBeGreaterThan</span>(<span class="hljs-number">0</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> hero = comp.<span class="hljs-property">heroes</span>[<span class="hljs-number">0</span>];</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">click</span>(heroes[<span class="hljs-number">0</span>]);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> selected = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'p'</span>));</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(selected).<span class="hljs-title function_">toHaveText</span>(hero.<span class="hljs-property">name</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'can access the instance variable of an `*ngFor` row component'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">IoParentComponent</span>);</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> heroName = comp.<span class="hljs-property">heroes</span>[<span class="hljs-number">0</span>].<span class="hljs-property">name</span>; <span class="hljs-comment">// first hero's name</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> ngForRow = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">directive</span>(<span class="hljs-title class_">IoComponent</span>)); <span class="hljs-comment">// first hero ngForRow</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> hero = ngForRow.<span class="hljs-property">context</span>.<span class="hljs-property">hero</span>; <span class="hljs-comment">// the hero object passed into the row</span></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(hero.<span class="hljs-property">name</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'ngRow.context.hero'</span>).<span class="hljs-title function_">toBe</span>(heroName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> rowComp = ngForRow.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      <span class="hljs-comment">// jasmine.any is an "instance-of-type" test.</span></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(rowComp).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'component is IoComp'</span>).<span class="hljs-title function_">toEqual</span>(jasmine.<span class="hljs-title function_">any</span>(<span class="hljs-title class_">IoComponent</span>));</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(rowComp.<span class="hljs-property">hero</span>.<span class="hljs-property">name</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'component.hero'</span>).<span class="hljs-title function_">toBe</span>(heroName);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should support clicking a button'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">LightswitchComponent</span>);</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> btn = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'button'</span>));</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> span = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'span'</span>)).<span class="hljs-property">nativeElement</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(span.<span class="hljs-property">textContent</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'before click'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toMatch</span>(<span class="hljs-regexp">/is off/i</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">click</span>(btn);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(span.<span class="hljs-property">textContent</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'after click'</span>).<span class="hljs-title function_">toMatch</span>(<span class="hljs-regexp">/is on/i</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">// ngModel is async so we must wait for it with promise-based `whenStable`</span></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should support entering text in input box (ngModel)'</span>, <span class="hljs-title function_">waitForAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> expectedOrigName = <span class="hljs-string">'John'</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> expectedNewName = <span class="hljs-string">'Sally'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">InputComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> input = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'input'</span>)).<span class="hljs-property">nativeElement</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLInputElement</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">name</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">`At start name should be <span class="hljs-subst">${expectedOrigName}</span> `</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(expectedOrigName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// wait until ngModel binds comp.name to input box</span></div><div class="hljs-ln-line">      fixture</div><div class="hljs-ln-line">        .<span class="hljs-title function_">whenStable</span>()</div><div class="hljs-ln-line">        .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">          <span class="hljs-title function_">expect</span>(input.<span class="hljs-property">value</span>)</div><div class="hljs-ln-line">            .<span class="hljs-title function_">withContext</span>(</div><div class="hljs-ln-line">              <span class="hljs-string">`After ngModel updates input box, input.value should be <span class="hljs-subst">${expectedOrigName}</span> `</span>,</div><div class="hljs-ln-line">            )</div><div class="hljs-ln-line">            .<span class="hljs-title function_">toBe</span>(expectedOrigName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-comment">// simulate user entering new name in input</span></div><div class="hljs-ln-line">          input.<span class="hljs-property">value</span> = expectedNewName;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-comment">// that change doesn't flow to the component immediately</span></div><div class="hljs-ln-line">          <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">name</span>)</div><div class="hljs-ln-line">            .<span class="hljs-title function_">withContext</span>(</div><div class="hljs-ln-line">              <span class="hljs-string">`comp.name should still be <span class="hljs-subst">${expectedOrigName}</span> after value change, before binding happens`</span>,</div><div class="hljs-ln-line">            )</div><div class="hljs-ln-line">            .<span class="hljs-title function_">toBe</span>(expectedOrigName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-comment">// Dispatch a DOM event so that Angular learns of input value change.</span></div><div class="hljs-ln-line">          <span class="hljs-comment">// then wait while ngModel pushes input.box value to comp.name</span></div><div class="hljs-ln-line">          input.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">'input'</span>));</div><div class="hljs-ln-line">          <span class="hljs-keyword">return</span> fixture.<span class="hljs-title function_">whenStable</span>();</div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">          <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">name</span>)</div><div class="hljs-ln-line">            .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">`After ngModel updates the model, comp.name should be <span class="hljs-subst">${expectedNewName}</span> `</span>)</div><div class="hljs-ln-line">            .<span class="hljs-title function_">toBe</span>(expectedNewName);</div><div class="hljs-ln-line">        });</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">// fakeAsync version of ngModel input test enables sync test style</span></div><div class="hljs-ln-line">    <span class="hljs-comment">// synchronous `tick` replaces asynchronous promise-base `whenStable`</span></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should support entering text in input box (ngModel) - fakeAsync'</span>, <span class="hljs-title function_">fakeAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> expectedOrigName = <span class="hljs-string">'John'</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> expectedNewName = <span class="hljs-string">'Sally'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">InputComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> input = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'input'</span>)).<span class="hljs-property">nativeElement</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLInputElement</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">name</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">`At start name should be <span class="hljs-subst">${expectedOrigName}</span> `</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(expectedOrigName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// wait until ngModel binds comp.name to input box</span></div><div class="hljs-ln-line">      <span class="hljs-title function_">tick</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(input.<span class="hljs-property">value</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">`After ngModel updates input box, input.value should be <span class="hljs-subst">${expectedOrigName}</span> `</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(expectedOrigName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// simulate user entering new name in input</span></div><div class="hljs-ln-line">      input.<span class="hljs-property">value</span> = expectedNewName;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// that change doesn't flow to the component immediately</span></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">name</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(</div><div class="hljs-ln-line">          <span class="hljs-string">`comp.name should still be <span class="hljs-subst">${expectedOrigName}</span> after value change, before binding happens`</span>,</div><div class="hljs-ln-line">        )</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(expectedOrigName);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// Dispatch a DOM event so that Angular learns of input value change.</span></div><div class="hljs-ln-line">      <span class="hljs-comment">// then wait a tick while ngModel pushes input.box value to comp.name</span></div><div class="hljs-ln-line">      input.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">'input'</span>));</div><div class="hljs-ln-line">      <span class="hljs-title function_">tick</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">name</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">`After ngModel updates the model, comp.name should be <span class="hljs-subst">${expectedNewName}</span> `</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(expectedNewName);</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'ReversePipeComp should reverse the input text'</span>, <span class="hljs-title function_">fakeAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> inputText = <span class="hljs-string">'the quick brown fox.'</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> expectedText = <span class="hljs-string">'.xof nworb kciuq eht'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">ReversePipeComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> input = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'input'</span>)).<span class="hljs-property">nativeElement</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLInputElement</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> span = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'span'</span>)).<span class="hljs-property">nativeElement</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLElement</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// simulate user entering new name in input</span></div><div class="hljs-ln-line">      input.<span class="hljs-property">value</span> = inputText;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// Dispatch a DOM event so that Angular learns of input value change.</span></div><div class="hljs-ln-line">      <span class="hljs-comment">// then wait a tick while ngModel pushes input.box value to comp.text</span></div><div class="hljs-ln-line">      <span class="hljs-comment">// and Angular updates the output span</span></div><div class="hljs-ln-line">      input.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">'input'</span>));</div><div class="hljs-ln-line">      <span class="hljs-title function_">tick</span>();</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(span.<span class="hljs-property">textContent</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'output span'</span>).<span class="hljs-title function_">toBe</span>(expectedText);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">text</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'component.text'</span>).<span class="hljs-title function_">toBe</span>(inputText);</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">// Use this technique to find attached directives of any kind</span></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'can examine attached directives and listeners'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">InputComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> inputEl = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'input'</span>));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(inputEl.<span class="hljs-property">providerTokens</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'NgModel directive'</span>).<span class="hljs-title function_">toContain</span>(<span class="hljs-title class_">NgModel</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> ngControl = inputEl.<span class="hljs-property">injector</span>.<span class="hljs-title function_">get</span>(<span class="hljs-title class_">NgControl</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(ngControl).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'NgControl directive'</span>).<span class="hljs-title function_">toEqual</span>(jasmine.<span class="hljs-title function_">any</span>(<span class="hljs-title class_">NgControl</span>));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(inputEl.<span class="hljs-property">listeners</span>.<span class="hljs-property">length</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'several listeners attached'</span>).<span class="hljs-title function_">toBeGreaterThan</span>(<span class="hljs-number">2</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'BankAccountComponent should set attributes, styles, classes, and properties'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">BankAccountParentComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// the only child is debugElement of the BankAccount component</span></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> el = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-property">children</span>[<span class="hljs-number">0</span>];</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> childComp = el.<span class="hljs-property">componentInstance</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">BankAccountComponent</span>;</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(childComp).<span class="hljs-title function_">toEqual</span>(jasmine.<span class="hljs-title function_">any</span>(<span class="hljs-title class_">BankAccountComponent</span>));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">context</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'context is the child component'</span>).<span class="hljs-title function_">toBe</span>(childComp);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">attributes</span>[<span class="hljs-string">'account'</span>]).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'account attribute'</span>).<span class="hljs-title function_">toBe</span>(childComp.<span class="hljs-property">id</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">attributes</span>[<span class="hljs-string">'bank'</span>]).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'bank attribute'</span>).<span class="hljs-title function_">toBe</span>(childComp.<span class="hljs-property">bank</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">classes</span>[<span class="hljs-string">'closed'</span>]).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'closed class'</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">classes</span>[<span class="hljs-string">'open'</span>]).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'open class'</span>).<span class="hljs-title function_">toBeFalsy</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">styles</span>[<span class="hljs-string">'color'</span>]).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'color style'</span>).<span class="hljs-title function_">toBe</span>(comp.<span class="hljs-property">color</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">styles</span>[<span class="hljs-string">'width'</span>])</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'width style'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(comp.<span class="hljs-property">width</span> + <span class="hljs-string">'px'</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// Removed on 12/02/2016 when ceased public discussion of the `Renderer`. Revive in future?</span></div><div class="hljs-ln-line">      <span class="hljs-comment">// expect(el.properties['customProperty']).toBe(true, 'customProperty');</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'TestBed component overrides:'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">"should override ChildComp's template"</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">Child1Component</span>],</div><div class="hljs-ln-line">      })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">Child1Component</span>, {</div><div class="hljs-ln-line">          <span class="hljs-attr">set</span>: {<span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;span&gt;Fake&lt;/span&gt;'</span>},</div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">Child1Component</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'Fake'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">"should override TestProvidersComp's ValueService provider"</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">TestProvidersComponent</span>],</div><div class="hljs-ln-line">      })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">TestProvidersComponent</span>, {</div><div class="hljs-ln-line">          <span class="hljs-attr">remove</span>: {<span class="hljs-attr">providers</span>: [<span class="hljs-title class_">ValueService</span>]},</div><div class="hljs-ln-line">          <span class="hljs-attr">add</span>: {<span class="hljs-attr">providers</span>: [{<span class="hljs-attr">provide</span>: <span class="hljs-title class_">ValueService</span>, <span class="hljs-attr">useClass</span>: <span class="hljs-title class_">FakeValueService</span>}]},</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-comment">// Or replace them all (this component has only one provider)</span></div><div class="hljs-ln-line">          <span class="hljs-comment">// set:    { providers: [{ provide: ValueService, useClass: FakeValueService }] },</span></div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">TestProvidersComponent</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'injected value: faked value'</span>, <span class="hljs-string">'text'</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// Explore the providerTokens</span></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> tokens = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-property">providerTokens</span>;</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(tokens).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'component ctor'</span>).<span class="hljs-title function_">toContain</span>(fixture.<span class="hljs-property">componentInstance</span>.<span class="hljs-property">constructor</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(tokens).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'TestProvidersComp'</span>).<span class="hljs-title function_">toContain</span>(<span class="hljs-title class_">TestProvidersComponent</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(tokens).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'ValueService'</span>).<span class="hljs-title function_">toContain</span>(<span class="hljs-title class_">ValueService</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">"should override TestViewProvidersComp's ValueService viewProvider"</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">TestViewProvidersComponent</span>],</div><div class="hljs-ln-line">      })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">TestViewProvidersComponent</span>, {</div><div class="hljs-ln-line">          <span class="hljs-comment">// remove: { viewProviders: [ValueService]},</span></div><div class="hljs-ln-line">          <span class="hljs-comment">// add:    { viewProviders: [{ provide: ValueService, useClass: FakeValueService }]</span></div><div class="hljs-ln-line">          <span class="hljs-comment">// },</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-comment">// Or replace them all (this component has only one viewProvider)</span></div><div class="hljs-ln-line">          <span class="hljs-attr">set</span>: {<span class="hljs-attr">viewProviders</span>: [{<span class="hljs-attr">provide</span>: <span class="hljs-title class_">ValueService</span>, <span class="hljs-attr">useClass</span>: <span class="hljs-title class_">FakeValueService</span>}]},</div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">TestViewProvidersComponent</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'injected value: faked value'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">"injected provider should not be same as component's provider"</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-comment">// TestComponent is parent of TestProvidersComponent</span></div><div class="hljs-ln-line">      <span class="hljs-meta">@Component</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">standalone</span>: <span class="hljs-literal">true</span>,</div><div class="hljs-ln-line">        <span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;my-service-comp&gt;&lt;/my-service-comp&gt;'</span>,</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">TestProvidersComponent</span>],</div><div class="hljs-ln-line">      })</div><div class="hljs-ln-line">      <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestComponent</span> {}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// 3 levels of ValueService provider: module, TestComponent, TestProvidersComponent</span></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">TestComponent</span>, <span class="hljs-title class_">TestProvidersComponent</span>],</div><div class="hljs-ln-line">        <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">ValueService</span>],</div><div class="hljs-ln-line">      })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">TestComponent</span>, {</div><div class="hljs-ln-line">          <span class="hljs-attr">set</span>: {<span class="hljs-attr">providers</span>: [{<span class="hljs-attr">provide</span>: <span class="hljs-title class_">ValueService</span>, <span class="hljs-attr">useValue</span>: {}}]},</div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">TestProvidersComponent</span>, {</div><div class="hljs-ln-line">          <span class="hljs-attr">set</span>: {<span class="hljs-attr">providers</span>: [{<span class="hljs-attr">provide</span>: <span class="hljs-title class_">ValueService</span>, <span class="hljs-attr">useClass</span>: <span class="hljs-title class_">FakeValueService</span>}]},</div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">TestComponent</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">let</span> testBedProvider!: <span class="hljs-title class_">ValueService</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// `inject` uses TestBed's injector</span></div><div class="hljs-ln-line">      <span class="hljs-title function_">inject</span>([<span class="hljs-title class_">ValueService</span>], <span class="hljs-function">(<span class="hljs-params">s: ValueService</span>) =&gt;</span> (testBedProvider = s))();</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> tcProvider = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-property">injector</span>.<span class="hljs-title function_">get</span>(<span class="hljs-title class_">ValueService</span>) <span class="hljs-keyword">as</span> <span class="hljs-title class_">ValueService</span>;</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> tpcProvider = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-property">children</span>[<span class="hljs-number">0</span>].<span class="hljs-property">injector</span>.<span class="hljs-title function_">get</span>(</div><div class="hljs-ln-line">        <span class="hljs-title class_">ValueService</span>,</div><div class="hljs-ln-line">      ) <span class="hljs-keyword">as</span> <span class="hljs-title class_">FakeValueService</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(testBedProvider).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'testBed/tc not same providers'</span>).<span class="hljs-property">not</span>.<span class="hljs-title function_">toBe</span>(tcProvider);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(testBedProvider).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'testBed/tpc not same providers'</span>).<span class="hljs-property">not</span>.<span class="hljs-title function_">toBe</span>(tpcProvider);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(testBedProvider <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">ValueService</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'testBedProvider is ValueService'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(tcProvider)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'tcProvider is {}'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toEqual</span>({} <span class="hljs-keyword">as</span> <span class="hljs-title class_">ValueService</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(tpcProvider <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">FakeValueService</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'tpcProvider is FakeValueService'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'can access template local variables as references'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [</div><div class="hljs-ln-line">          <span class="hljs-title class_">ShellComponent</span>,</div><div class="hljs-ln-line">          <span class="hljs-title class_">NeedsContentComponent</span>,</div><div class="hljs-ln-line">          <span class="hljs-title class_">Child1Component</span>,</div><div class="hljs-ln-line">          <span class="hljs-title class_">Child2Component</span>,</div><div class="hljs-ln-line">          <span class="hljs-title class_">Child3Component</span>,</div><div class="hljs-ln-line">        ],</div><div class="hljs-ln-line">      })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">ShellComponent</span>, {</div><div class="hljs-ln-line">          <span class="hljs-attr">set</span>: {</div><div class="hljs-ln-line">            <span class="hljs-attr">selector</span>: <span class="hljs-string">'test-shell'</span>,</div><div class="hljs-ln-line">            <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">NeedsContentComponent</span>, <span class="hljs-title class_">Child1Component</span>, <span class="hljs-title class_">Child2Component</span>, <span class="hljs-title class_">Child3Component</span>],</div><div class="hljs-ln-line">            <span class="hljs-attr">template</span>: <span class="hljs-string">`</span></div><div class="hljs-ln-line">          &lt;needs-content #nc&gt;</div><div class="hljs-ln-line">            &lt;child-1 #content text="My"&gt;&lt;/child-1&gt;</div><div class="hljs-ln-line">            &lt;child-2 #content text="dog"&gt;&lt;/child-2&gt;</div><div class="hljs-ln-line">            &lt;child-2 text="has"&gt;&lt;/child-2&gt;</div><div class="hljs-ln-line">            &lt;child-3 #content text="fleas"&gt;&lt;/child-3&gt;</div><div class="hljs-ln-line">            &lt;div #content&gt;!&lt;/div&gt;</div><div class="hljs-ln-line">          &lt;/needs-content&gt;</div><div class="hljs-ln-line">          `,</div><div class="hljs-ln-line">          },</div><div class="hljs-ln-line">        })</div><div class="hljs-ln-line">        .<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">ShellComponent</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// NeedsContentComp is the child of ShellComp</span></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> el = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-property">children</span>[<span class="hljs-number">0</span>];</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> comp = el.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(comp.<span class="hljs-property">children</span>.<span class="hljs-title function_">toArray</span>().<span class="hljs-property">length</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'three different child components and an ElementRef with #content'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(<span class="hljs-number">4</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(el.<span class="hljs-property">references</span>[<span class="hljs-string">'nc'</span>]).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'#nc reference to component'</span>).<span class="hljs-title function_">toBe</span>(comp);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// Filter for DebugElements with a #content reference</span></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> contentRefs = el.<span class="hljs-title function_">queryAll</span>(<span class="hljs-function">(<span class="hljs-params">de</span>) =&gt;</span> de.<span class="hljs-property">references</span>[<span class="hljs-string">'content'</span>]);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(contentRefs.<span class="hljs-property">length</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'elements w/ a #content reference'</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-number">4</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'nested (one-deep) component override'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">ParentComponent</span>, <span class="hljs-title class_">FakeChildComponent</span>],</div><div class="hljs-ln-line">      }).<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">ParentComponent</span>, {</div><div class="hljs-ln-line">        <span class="hljs-attr">set</span>: {<span class="hljs-attr">imports</span>: [<span class="hljs-title class_">FakeChildComponent</span>]},</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'ParentComp should use Fake Child component'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">ParentComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'Parent(Fake Child)'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'nested (two-deep) component override'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">ParentComponent</span>, <span class="hljs-title class_">FakeChildWithGrandchildComponent</span>, <span class="hljs-title class_">FakeGrandchildComponent</span>],</div><div class="hljs-ln-line">      }).<span class="hljs-title function_">overrideComponent</span>(<span class="hljs-title class_">ParentComponent</span>, {</div><div class="hljs-ln-line">        <span class="hljs-attr">set</span>: {<span class="hljs-attr">imports</span>: [<span class="hljs-title class_">FakeChildWithGrandchildComponent</span>, <span class="hljs-title class_">FakeGrandchildComponent</span>]},</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should use Fake Grandchild component'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">ParentComponent</span>);</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(fixture).<span class="hljs-title function_">toHaveText</span>(<span class="hljs-string">'Parent(Fake Child(Fake Grandchild))'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'lifecycle hooks w/ MyIfParentComp'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">fixture</span>: <span class="hljs-title class_">ComponentFixture</span>&lt;<span class="hljs-title class_">MyIfParentComponent</span>&gt;;</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">parent</span>: <span class="hljs-title class_">MyIfParentComponent</span>;</div><div class="hljs-ln-line">    <span class="hljs-keyword">let</span> <span class="hljs-attr">child</span>: <span class="hljs-title class_">MyIfChildComponent</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">configureTestingModule</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">FormsModule</span>, <span class="hljs-title class_">MyIfChildComponent</span>, <span class="hljs-title class_">MyIfParentComponent</span>],</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture = <span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">MyIfParentComponent</span>);</div><div class="hljs-ln-line">      parent = fixture.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'should instantiate parent component'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(parent).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'parent component should exist'</span>).<span class="hljs-property">not</span>.<span class="hljs-title function_">toBeNull</span>();</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'parent component OnInit should NOT be called before first detectChanges()'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(parent.<span class="hljs-property">ngOnInitCalled</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">false</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'parent component OnInit should be called after first detectChanges()'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(parent.<span class="hljs-property">ngOnInitCalled</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'child component should exist after OnInit'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">getChild</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(child <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">MyIfChildComponent</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'should create child'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">"should have called child component's OnInit "</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">getChild</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(child.<span class="hljs-property">ngOnInitCalled</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'child component called OnChanges once'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">getChild</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(child.<span class="hljs-property">ngOnChangesCounter</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-number">1</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'changed parent value flows to child'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">getChild</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      parent.<span class="hljs-property">parentValue</span> = <span class="hljs-string">'foo'</span>;</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(child.<span class="hljs-property">ngOnChangesCounter</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'expected 2 changes: initial value and changed value'</span>)</div><div class="hljs-ln-line">        .<span class="hljs-title function_">toBe</span>(<span class="hljs-number">2</span>);</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(child.<span class="hljs-property">childValue</span>).<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'childValue should eq changed parent value'</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'foo'</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">// must be async test to see child flow to parent</span></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'changed child value flows to parent'</span>, <span class="hljs-title function_">waitForAsync</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">getChild</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      child.<span class="hljs-property">childValue</span> = <span class="hljs-string">'bar'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {</div><div class="hljs-ln-line">        <span class="hljs-comment">// Wait one JS engine turn!</span></div><div class="hljs-ln-line">        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(), <span class="hljs-number">0</span>);</div><div class="hljs-ln-line">      }).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">        fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">        <span class="hljs-title function_">expect</span>(child.<span class="hljs-property">ngOnChangesCounter</span>)</div><div class="hljs-ln-line">          .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'expected 2 changes: initial value and changed value'</span>)</div><div class="hljs-ln-line">          .<span class="hljs-title function_">toBe</span>(<span class="hljs-number">2</span>);</div><div class="hljs-ln-line">        <span class="hljs-title function_">expect</span>(parent.<span class="hljs-property">parentValue</span>)</div><div class="hljs-ln-line">          .<span class="hljs-title function_">withContext</span>(<span class="hljs-string">'parentValue should eq changed parent value'</span>)</div><div class="hljs-ln-line">          .<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'bar'</span>);</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">    }));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-title function_">it</span>(<span class="hljs-string">'clicking "Close Child" triggers child OnDestroy'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">getChild</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> btn = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(<span class="hljs-title class_">By</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'button'</span>));</div><div class="hljs-ln-line">      <span class="hljs-title function_">click</span>(btn);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      fixture.<span class="hljs-title function_">detectChanges</span>();</div><div class="hljs-ln-line">      <span class="hljs-title function_">expect</span>(child.<span class="hljs-property">ngOnDestroyCalled</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">////// helpers ///</span></div><div class="hljs-ln-line">    <span class="hljs-comment">/**</span></div><div class="hljs-ln-line">     * Get the MyIfChildComp from parent; fail w/ good message if cannot.</div><div class="hljs-ln-line">     */</div><div class="hljs-ln-line">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">getChild</span>(<span class="hljs-params"></span>) {</div><div class="hljs-ln-line">      <span class="hljs-keyword">let</span> <span class="hljs-attr">childDe</span>: <span class="hljs-title class_">DebugElement</span>; <span class="hljs-comment">// DebugElement that should hold the MyIfChildComp</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// The Hard Way: requires detailed knowledge of the parent template</span></div><div class="hljs-ln-line">      <span class="hljs-keyword">try</span> {</div><div class="hljs-ln-line">        childDe = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-property">children</span>[<span class="hljs-number">4</span>].<span class="hljs-property">children</span>[<span class="hljs-number">0</span>];</div><div class="hljs-ln-line">      } <span class="hljs-keyword">catch</span> (err) {</div><div class="hljs-ln-line">        <span class="hljs-comment">/* we'll report the error */</span></div><div class="hljs-ln-line">      }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// DebugElement.queryAll: if we wanted all of many instances:</span></div><div class="hljs-ln-line">      childDe = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">queryAll</span>(</div><div class="hljs-ln-line">        <span class="hljs-function">(<span class="hljs-params">de</span>) =&gt;</span> de.<span class="hljs-property">componentInstance</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">MyIfChildComponent</span>,</div><div class="hljs-ln-line">      )[<span class="hljs-number">0</span>];</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-comment">// WE'LL USE THIS APPROACH !</span></div><div class="hljs-ln-line">      <span class="hljs-comment">// DebugElement.query: find first instance (if any)</span></div><div class="hljs-ln-line">      childDe = fixture.<span class="hljs-property">debugElement</span>.<span class="hljs-title function_">query</span>(</div><div class="hljs-ln-line">        <span class="hljs-function">(<span class="hljs-params">de</span>) =&gt;</span> de.<span class="hljs-property">componentInstance</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">MyIfChildComponent</span>,</div><div class="hljs-ln-line">      );</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">if</span> (childDe &amp;&amp; childDe.<span class="hljs-property">componentInstance</span>) {</div><div class="hljs-ln-line">        child = childDe.<span class="hljs-property">componentInstance</span>;</div><div class="hljs-ln-line">      } <span class="hljs-keyword">else</span> {</div><div class="hljs-ln-line">        <span class="hljs-title function_">fail</span>(<span class="hljs-string">'Unable to find MyIfChildComp within MyIfParentComp'</span>);</div><div class="hljs-ln-line">      }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> child;</div><div class="hljs-ln-line">    }</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line">});</div><div class="hljs-ln-line"><span class="hljs-comment">////////// Fakes ///////////</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component</span>({</div><div class="hljs-ln-line">  <span class="hljs-attr">standalone</span>: <span class="hljs-literal">true</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">selector</span>: <span class="hljs-string">'child-1'</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">template</span>: <span class="hljs-string">'Fake Child'</span>,</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FakeChildComponent</span> {}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component</span>({</div><div class="hljs-ln-line">  <span class="hljs-attr">standalone</span>: <span class="hljs-literal">true</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">selector</span>: <span class="hljs-string">'grandchild-1'</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">template</span>: <span class="hljs-string">'Fake Grandchild'</span>,</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FakeGrandchildComponent</span> {}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component</span>({</div><div class="hljs-ln-line">  <span class="hljs-attr">standalone</span>: <span class="hljs-literal">true</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">selector</span>: <span class="hljs-string">'child-1'</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">FakeGrandchildComponent</span>],</div><div class="hljs-ln-line">  <span class="hljs-attr">template</span>: <span class="hljs-string">'Fake Child(&lt;grandchild-1&gt;&lt;/grandchild-1&gt;)'</span>,</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FakeChildWithGrandchildComponent</span> {}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Injectable</span>()</div><div class="hljs-ln-line"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FakeValueService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">ValueService</span> {</div><div class="hljs-ln-line">  <span class="hljs-keyword">override</span> value = <span class="hljs-string">'faked value'</span>;</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div>
  <h2 id="testing-without-beforeeach">
    <a href="#testing-without-beforeeach" class="docs-anchor" tabindex="-1" aria-label="Link to Testing without <code>beforeEach()</code>" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="8hmp76l0ixeh50wekgin9f0l">没有 <code>beforeEach()</code> 的测试</a>
  </h2>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="5vd0qcjso8sqt0yb18tfqr85a">本指南中的大多数测试套件调用 
<code>beforeEach()</code> 来设置每个 
<code>it()</code> 测试的前提条件，并依赖 
<code>TestBed</code> 来创建类和注入服务。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="eulufckahfwu8m2li4vtqglw4">还有另一种测试方法从不调用 
<code>beforeEach()</code>，并且更喜欢显式创建类，而不是使用 
<code>TestBed</code>。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="321ibwe3fxio8vakprsfgxmgk">你可以用这种风格重写 <code>MasterService</code> 中的一个测试。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="5xsq550pzo096tw8x0iyqqhh9">首先，在 <em>setup</em> 函数中放入可供复用的预备代码，而不用 <code>beforeEach()</code>。</p>
<div class="docs-code" path="adev/src/content/examples/testing/src/app/demo/demo.spec.ts" visiblelines="82,83,84,85,86,87,88,89" header="app/demo/demo.spec.ts (setup)">
    <div class="docs-code-header"><h3 data-ng_translator_product="100" data-ng_translator_ref_id="2eqi8y4kovbsy53zfgdchqmhk">app/demo/demo.spec.ts (设置)</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {LightswitchComponent, MasterService, ValueService, ReversePipe} <span class="hljs-keyword">from</span> <span class="hljs-string">'./demo'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">///////// Fakes /////////</div><div class="hljs-ln-line">export <span class="hljs-keyword">class</span> FakeValueService extends ValueService {</div><div class="hljs-ln-line">  override <span class="hljs-keyword">value</span> = <span class="hljs-string">'faked service value'</span>;</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line">////////////////////////</div><div class="hljs-ln-line">describe(<span class="hljs-string">'demo (no TestBed):'</span>, () =&gt; {</div><div class="hljs-ln-line">  // Straight Jasmine testing <span class="hljs-keyword">without</span> Angular<span class="hljs-string">'s testing support</span></div><div class="hljs-ln-line">  describe('ValueServic<span class="hljs-string">e', () =&gt; {</span></div><div class="hljs-ln-line">    let service: ValueService;</div><div class="hljs-ln-line">    beforeEach(() =&gt; {</div><div class="hljs-ln-line">      service = new ValueService();</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('#getValue should <span class="hljs-keyword">return</span> <span class="hljs-type">real</span> valu<span class="hljs-string">e', () =&gt; {</span></div><div class="hljs-ln-line">      expect(service.getValue()).toBe('<span class="hljs-type">real</span> valu<span class="hljs-string">e');</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('#getObservableValue should <span class="hljs-keyword">return</span> <span class="hljs-keyword">value</span> <span class="hljs-keyword">from</span> observabl<span class="hljs-string">e', (done: DoneFn) =&gt; {</span></div><div class="hljs-ln-line">      service.getObservableValue().subscribe((value) =&gt; {</div><div class="hljs-ln-line">        expect(value).toBe('observable valu<span class="hljs-string">e');</span></div><div class="hljs-ln-line">        done();</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('#getPromiseValue should <span class="hljs-keyword">return</span> <span class="hljs-keyword">value</span> <span class="hljs-keyword">from</span> a promis<span class="hljs-string">e', (done: DoneFn) =&gt; {</span></div><div class="hljs-ln-line">      service.getPromiseValue().then((value) =&gt; {</div><div class="hljs-ln-line">        expect(value).toBe('promise valu<span class="hljs-string">e');</span></div><div class="hljs-ln-line">        done();</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  // MasterService requires injection of a ValueService</div><div class="hljs-ln-line">  describe('MasterService <span class="hljs-keyword">without</span> Angular testing support<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">    let masterService: MasterService;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('#getValue should <span class="hljs-keyword">return</span> <span class="hljs-type">real</span> <span class="hljs-keyword">value</span> <span class="hljs-keyword">from</span> the <span class="hljs-type">real</span> servic<span class="hljs-string">e', () =&gt; {</span></div><div class="hljs-ln-line">      masterService = new MasterService(new ValueService());</div><div class="hljs-ln-line">      expect(masterService.getValue()).toBe('<span class="hljs-type">real</span> valu<span class="hljs-string">e');</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('#getValue should <span class="hljs-keyword">return</span> faked <span class="hljs-keyword">value</span> <span class="hljs-keyword">from</span> a fakeServic<span class="hljs-string">e', () =&gt; {</span></div><div class="hljs-ln-line">      masterService = new MasterService(new FakeValueService());</div><div class="hljs-ln-line">      expect(masterService.getValue()).toBe('faked service valu<span class="hljs-string">e');</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('#getValue should <span class="hljs-keyword">return</span> faked <span class="hljs-keyword">value</span> <span class="hljs-keyword">from</span> a fake <span class="hljs-keyword">object</span><span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">      const fake = {getValue: () =&gt; 'fake valu<span class="hljs-string">e'};</span></div><div class="hljs-ln-line">      masterService = new MasterService(fake as ValueService);</div><div class="hljs-ln-line">      expect(masterService.getValue()).toBe('fake valu<span class="hljs-string">e');</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('#getValue should <span class="hljs-keyword">return</span> stubbed <span class="hljs-keyword">value</span> <span class="hljs-keyword">from</span> a spy<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">      // create `getValue` spy on an object representing the ValueService</div><div class="hljs-ln-line">      const valueServiceSpy = jasmine.createSpyObj('ValueServic<span class="hljs-string">e', ['</span>getValu<span class="hljs-string">e']);</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      // set the value to return when the `getValue` spy is called.</div><div class="hljs-ln-line">      const stubValue = 'stub valu<span class="hljs-string">e';</span></div><div class="hljs-ln-line">      valueServiceSpy.getValue.and.returnValue(stubValue);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      masterService = new MasterService(valueServiceSpy);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      expect(masterService.getValue()).withContext('service returned stub valu<span class="hljs-string">e').toBe(stubValue);</span></div><div class="hljs-ln-line">      expect(valueServiceSpy.getValue.calls.count())</div><div class="hljs-ln-line">        .withContext('spy <span class="hljs-keyword">method</span> was <span class="hljs-keyword">called</span> onc<span class="hljs-string">e')</span></div><div class="hljs-ln-line">        .toBe(1);</div><div class="hljs-ln-line">      expect(valueServiceSpy.getValue.calls.mostRecent().returnValue).toBe(stubValue);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  describe('MasterService (<span class="hljs-keyword">no</span> beforeEach)<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">    it('#getValue should <span class="hljs-keyword">return</span> stubbed <span class="hljs-keyword">value</span> <span class="hljs-keyword">from</span> a spy<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">      const {masterService, stubValue, valueServiceSpy} = setup();</div><div class="hljs-ln-line">      expect(masterService.getValue()).withContext('service returned stub valu<span class="hljs-string">e').toBe(stubValue);</span></div><div class="hljs-ln-line">      expect(valueServiceSpy.getValue.calls.count())</div><div class="hljs-ln-line">        .withContext('spy <span class="hljs-keyword">method</span> was <span class="hljs-keyword">called</span> onc<span class="hljs-string">e')</span></div><div class="hljs-ln-line">        .toBe(1);</div><div class="hljs-ln-line">      expect(valueServiceSpy.getValue.calls.mostRecent().returnValue).toBe(stubValue);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    function setup() {</div><div class="hljs-ln-line">      const valueServiceSpy = jasmine.createSpyObj('ValueServic<span class="hljs-string">e', ['</span>getValu<span class="hljs-string">e']);</span></div><div class="hljs-ln-line">      const stubValue = 'stub valu<span class="hljs-string">e';</span></div><div class="hljs-ln-line">      const masterService = new MasterService(valueServiceSpy);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      valueServiceSpy.getValue.and.returnValue(stubValue);</div><div class="hljs-ln-line">      return {masterService, stubValue, valueServiceSpy};</div><div class="hljs-ln-line">    }</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  describe('ReversePip<span class="hljs-string">e', () =&gt; {</span></div><div class="hljs-ln-line">    let pipe: ReversePipe;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    beforeEach(() =&gt; {</div><div class="hljs-ln-line">      pipe = new ReversePipe();</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('transforms "abc" <span class="hljs-keyword">to</span> "cba"<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">      expect(pipe.transform('abc<span class="hljs-string">')).toBe('</span>cba<span class="hljs-string">');</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('<span class="hljs-keyword">no</span> change <span class="hljs-keyword">to</span> palindrome: "able was I ere I saw elba"<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">      const palindrome = 'able was I ere I saw elba<span class="hljs-string">';</span></div><div class="hljs-ln-line">      expect(pipe.transform(palindrome)).toBe(palindrome);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  describe('LightswitchComp<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">    it('#clicked() should toggle #isOn<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">      const comp = new LightswitchComponent();</div><div class="hljs-ln-line">      expect(comp.isOn).withContext('<span class="hljs-keyword">off</span> at first<span class="hljs-string">').toBe(false);</span></div><div class="hljs-ln-line">      comp.clicked();</div><div class="hljs-ln-line">      expect(comp.isOn).withContext('<span class="hljs-keyword">on</span> <span class="hljs-keyword">after</span> click<span class="hljs-string">').toBe(true);</span></div><div class="hljs-ln-line">      comp.clicked();</div><div class="hljs-ln-line">      expect(comp.isOn).withContext('<span class="hljs-keyword">off</span> <span class="hljs-keyword">after</span> second click<span class="hljs-string">').toBe(false);</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('#clicked() should <span class="hljs-keyword">set</span> #message <span class="hljs-keyword">to</span> "is on"<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">      const comp = new LightswitchComponent();</div><div class="hljs-ln-line">      expect(comp.message)</div><div class="hljs-ln-line">        .withContext('<span class="hljs-keyword">off</span> at first<span class="hljs-string">')</span></div><div class="hljs-ln-line">        .toMatch(/is off/i);</div><div class="hljs-ln-line">      comp.clicked();</div><div class="hljs-ln-line">      expect(comp.message).withContext('<span class="hljs-keyword">on</span> <span class="hljs-keyword">after</span> clicked<span class="hljs-string">').toMatch(/is on/i);</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line">});</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="5nsqdtoy065szepduau034ivc"><code>setup()</code> 函数返回一个包含测试可能引用的变量（如 <code>masterService</code>）的对象字面量。你并没有在 <code>describe()</code> 的函数体中定义<em>半全局</em>变量（比如 <code>let masterService: MasterService</code>）。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="au1eazpmx9pnhooctuxghzqaf">然后，每个测试都会在第一行调用 <code>setup()</code>，然后继续执行那些操纵被测主体和断言期望值的步骤。</p>
<div class="docs-code" path="adev/src/content/examples/testing/src/app/demo/demo.spec.ts" visiblelines="73,74,75,76,77,78,79,80">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {LightswitchComponent, MasterService, ValueService, ReversePipe} <span class="hljs-keyword">from</span> <span class="hljs-string">'./demo'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">///////// Fakes /////////</div><div class="hljs-ln-line">export <span class="hljs-keyword">class</span> FakeValueService extends ValueService {</div><div class="hljs-ln-line">  override <span class="hljs-keyword">value</span> = <span class="hljs-string">'faked service value'</span>;</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line">////////////////////////</div><div class="hljs-ln-line">describe(<span class="hljs-string">'demo (no TestBed):'</span>, () =&gt; {</div><div class="hljs-ln-line">  // Straight Jasmine testing <span class="hljs-keyword">without</span> Angular<span class="hljs-string">'s testing support</span></div><div class="hljs-ln-line">  describe('ValueServic<span class="hljs-string">e', () =&gt; {</span></div><div class="hljs-ln-line">    let service: ValueService;</div><div class="hljs-ln-line">    beforeEach(() =&gt; {</div><div class="hljs-ln-line">      service = new ValueService();</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('#getValue should <span class="hljs-keyword">return</span> <span class="hljs-type">real</span> valu<span class="hljs-string">e', () =&gt; {</span></div><div class="hljs-ln-line">      expect(service.getValue()).toBe('<span class="hljs-type">real</span> valu<span class="hljs-string">e');</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('#getObservableValue should <span class="hljs-keyword">return</span> <span class="hljs-keyword">value</span> <span class="hljs-keyword">from</span> observabl<span class="hljs-string">e', (done: DoneFn) =&gt; {</span></div><div class="hljs-ln-line">      service.getObservableValue().subscribe((value) =&gt; {</div><div class="hljs-ln-line">        expect(value).toBe('observable valu<span class="hljs-string">e');</span></div><div class="hljs-ln-line">        done();</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('#getPromiseValue should <span class="hljs-keyword">return</span> <span class="hljs-keyword">value</span> <span class="hljs-keyword">from</span> a promis<span class="hljs-string">e', (done: DoneFn) =&gt; {</span></div><div class="hljs-ln-line">      service.getPromiseValue().then((value) =&gt; {</div><div class="hljs-ln-line">        expect(value).toBe('promise valu<span class="hljs-string">e');</span></div><div class="hljs-ln-line">        done();</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  // MasterService requires injection of a ValueService</div><div class="hljs-ln-line">  describe('MasterService <span class="hljs-keyword">without</span> Angular testing support<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">    let masterService: MasterService;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('#getValue should <span class="hljs-keyword">return</span> <span class="hljs-type">real</span> <span class="hljs-keyword">value</span> <span class="hljs-keyword">from</span> the <span class="hljs-type">real</span> servic<span class="hljs-string">e', () =&gt; {</span></div><div class="hljs-ln-line">      masterService = new MasterService(new ValueService());</div><div class="hljs-ln-line">      expect(masterService.getValue()).toBe('<span class="hljs-type">real</span> valu<span class="hljs-string">e');</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('#getValue should <span class="hljs-keyword">return</span> faked <span class="hljs-keyword">value</span> <span class="hljs-keyword">from</span> a fakeServic<span class="hljs-string">e', () =&gt; {</span></div><div class="hljs-ln-line">      masterService = new MasterService(new FakeValueService());</div><div class="hljs-ln-line">      expect(masterService.getValue()).toBe('faked service valu<span class="hljs-string">e');</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('#getValue should <span class="hljs-keyword">return</span> faked <span class="hljs-keyword">value</span> <span class="hljs-keyword">from</span> a fake <span class="hljs-keyword">object</span><span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">      const fake = {getValue: () =&gt; 'fake valu<span class="hljs-string">e'};</span></div><div class="hljs-ln-line">      masterService = new MasterService(fake as ValueService);</div><div class="hljs-ln-line">      expect(masterService.getValue()).toBe('fake valu<span class="hljs-string">e');</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('#getValue should <span class="hljs-keyword">return</span> stubbed <span class="hljs-keyword">value</span> <span class="hljs-keyword">from</span> a spy<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">      // create `getValue` spy on an object representing the ValueService</div><div class="hljs-ln-line">      const valueServiceSpy = jasmine.createSpyObj('ValueServic<span class="hljs-string">e', ['</span>getValu<span class="hljs-string">e']);</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      // set the value to return when the `getValue` spy is called.</div><div class="hljs-ln-line">      const stubValue = 'stub valu<span class="hljs-string">e';</span></div><div class="hljs-ln-line">      valueServiceSpy.getValue.and.returnValue(stubValue);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      masterService = new MasterService(valueServiceSpy);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      expect(masterService.getValue()).withContext('service returned stub valu<span class="hljs-string">e').toBe(stubValue);</span></div><div class="hljs-ln-line">      expect(valueServiceSpy.getValue.calls.count())</div><div class="hljs-ln-line">        .withContext('spy <span class="hljs-keyword">method</span> was <span class="hljs-keyword">called</span> onc<span class="hljs-string">e')</span></div><div class="hljs-ln-line">        .toBe(1);</div><div class="hljs-ln-line">      expect(valueServiceSpy.getValue.calls.mostRecent().returnValue).toBe(stubValue);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  describe('MasterService (<span class="hljs-keyword">no</span> beforeEach)<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">    it('#getValue should <span class="hljs-keyword">return</span> stubbed <span class="hljs-keyword">value</span> <span class="hljs-keyword">from</span> a spy<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">      const {masterService, stubValue, valueServiceSpy} = setup();</div><div class="hljs-ln-line">      expect(masterService.getValue()).withContext('service returned stub valu<span class="hljs-string">e').toBe(stubValue);</span></div><div class="hljs-ln-line">      expect(valueServiceSpy.getValue.calls.count())</div><div class="hljs-ln-line">        .withContext('spy <span class="hljs-keyword">method</span> was <span class="hljs-keyword">called</span> onc<span class="hljs-string">e')</span></div><div class="hljs-ln-line">        .toBe(1);</div><div class="hljs-ln-line">      expect(valueServiceSpy.getValue.calls.mostRecent().returnValue).toBe(stubValue);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    function setup() {</div><div class="hljs-ln-line">      const valueServiceSpy = jasmine.createSpyObj('ValueServic<span class="hljs-string">e', ['</span>getValu<span class="hljs-string">e']);</span></div><div class="hljs-ln-line">      const stubValue = 'stub valu<span class="hljs-string">e';</span></div><div class="hljs-ln-line">      const masterService = new MasterService(valueServiceSpy);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      valueServiceSpy.getValue.and.returnValue(stubValue);</div><div class="hljs-ln-line">      return {masterService, stubValue, valueServiceSpy};</div><div class="hljs-ln-line">    }</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  describe('ReversePip<span class="hljs-string">e', () =&gt; {</span></div><div class="hljs-ln-line">    let pipe: ReversePipe;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    beforeEach(() =&gt; {</div><div class="hljs-ln-line">      pipe = new ReversePipe();</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('transforms "abc" <span class="hljs-keyword">to</span> "cba"<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">      expect(pipe.transform('abc<span class="hljs-string">')).toBe('</span>cba<span class="hljs-string">');</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('<span class="hljs-keyword">no</span> change <span class="hljs-keyword">to</span> palindrome: "able was I ere I saw elba"<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">      const palindrome = 'able was I ere I saw elba<span class="hljs-string">';</span></div><div class="hljs-ln-line">      expect(pipe.transform(palindrome)).toBe(palindrome);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  describe('LightswitchComp<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">    it('#clicked() should toggle #isOn<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">      const comp = new LightswitchComponent();</div><div class="hljs-ln-line">      expect(comp.isOn).withContext('<span class="hljs-keyword">off</span> at first<span class="hljs-string">').toBe(false);</span></div><div class="hljs-ln-line">      comp.clicked();</div><div class="hljs-ln-line">      expect(comp.isOn).withContext('<span class="hljs-keyword">on</span> <span class="hljs-keyword">after</span> click<span class="hljs-string">').toBe(true);</span></div><div class="hljs-ln-line">      comp.clicked();</div><div class="hljs-ln-line">      expect(comp.isOn).withContext('<span class="hljs-keyword">off</span> <span class="hljs-keyword">after</span> second click<span class="hljs-string">').toBe(false);</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('#clicked() should <span class="hljs-keyword">set</span> #message <span class="hljs-keyword">to</span> "is on"<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">      const comp = new LightswitchComponent();</div><div class="hljs-ln-line">      expect(comp.message)</div><div class="hljs-ln-line">        .withContext('<span class="hljs-keyword">off</span> at first<span class="hljs-string">')</span></div><div class="hljs-ln-line">        .toMatch(/is off/i);</div><div class="hljs-ln-line">      comp.clicked();</div><div class="hljs-ln-line">      expect(comp.message).withContext('<span class="hljs-keyword">on</span> <span class="hljs-keyword">after</span> clicked<span class="hljs-string">').toMatch(/is on/i);</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line">});</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_ref_id="6c7bb2cmg9yw0rhb90p1yx2b8">注意看测试如何使用
<a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment" target="_blank"><em>解构赋值</em></a>来提取它所需的设置变量。</p>
<div class="docs-code" path="adev/src/content/examples/testing/src/app/demo/demo.spec.ts" visiblelines="74">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {LightswitchComponent, MasterService, ValueService, ReversePipe} <span class="hljs-keyword">from</span> <span class="hljs-string">'./demo'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">///////// Fakes /////////</div><div class="hljs-ln-line">export <span class="hljs-keyword">class</span> FakeValueService extends ValueService {</div><div class="hljs-ln-line">  override <span class="hljs-keyword">value</span> = <span class="hljs-string">'faked service value'</span>;</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line">////////////////////////</div><div class="hljs-ln-line">describe(<span class="hljs-string">'demo (no TestBed):'</span>, () =&gt; {</div><div class="hljs-ln-line">  // Straight Jasmine testing <span class="hljs-keyword">without</span> Angular<span class="hljs-string">'s testing support</span></div><div class="hljs-ln-line">  describe('ValueServic<span class="hljs-string">e', () =&gt; {</span></div><div class="hljs-ln-line">    let service: ValueService;</div><div class="hljs-ln-line">    beforeEach(() =&gt; {</div><div class="hljs-ln-line">      service = new ValueService();</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('#getValue should <span class="hljs-keyword">return</span> <span class="hljs-type">real</span> valu<span class="hljs-string">e', () =&gt; {</span></div><div class="hljs-ln-line">      expect(service.getValue()).toBe('<span class="hljs-type">real</span> valu<span class="hljs-string">e');</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('#getObservableValue should <span class="hljs-keyword">return</span> <span class="hljs-keyword">value</span> <span class="hljs-keyword">from</span> observabl<span class="hljs-string">e', (done: DoneFn) =&gt; {</span></div><div class="hljs-ln-line">      service.getObservableValue().subscribe((value) =&gt; {</div><div class="hljs-ln-line">        expect(value).toBe('observable valu<span class="hljs-string">e');</span></div><div class="hljs-ln-line">        done();</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('#getPromiseValue should <span class="hljs-keyword">return</span> <span class="hljs-keyword">value</span> <span class="hljs-keyword">from</span> a promis<span class="hljs-string">e', (done: DoneFn) =&gt; {</span></div><div class="hljs-ln-line">      service.getPromiseValue().then((value) =&gt; {</div><div class="hljs-ln-line">        expect(value).toBe('promise valu<span class="hljs-string">e');</span></div><div class="hljs-ln-line">        done();</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  // MasterService requires injection of a ValueService</div><div class="hljs-ln-line">  describe('MasterService <span class="hljs-keyword">without</span> Angular testing support<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">    let masterService: MasterService;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('#getValue should <span class="hljs-keyword">return</span> <span class="hljs-type">real</span> <span class="hljs-keyword">value</span> <span class="hljs-keyword">from</span> the <span class="hljs-type">real</span> servic<span class="hljs-string">e', () =&gt; {</span></div><div class="hljs-ln-line">      masterService = new MasterService(new ValueService());</div><div class="hljs-ln-line">      expect(masterService.getValue()).toBe('<span class="hljs-type">real</span> valu<span class="hljs-string">e');</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('#getValue should <span class="hljs-keyword">return</span> faked <span class="hljs-keyword">value</span> <span class="hljs-keyword">from</span> a fakeServic<span class="hljs-string">e', () =&gt; {</span></div><div class="hljs-ln-line">      masterService = new MasterService(new FakeValueService());</div><div class="hljs-ln-line">      expect(masterService.getValue()).toBe('faked service valu<span class="hljs-string">e');</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('#getValue should <span class="hljs-keyword">return</span> faked <span class="hljs-keyword">value</span> <span class="hljs-keyword">from</span> a fake <span class="hljs-keyword">object</span><span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">      const fake = {getValue: () =&gt; 'fake valu<span class="hljs-string">e'};</span></div><div class="hljs-ln-line">      masterService = new MasterService(fake as ValueService);</div><div class="hljs-ln-line">      expect(masterService.getValue()).toBe('fake valu<span class="hljs-string">e');</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('#getValue should <span class="hljs-keyword">return</span> stubbed <span class="hljs-keyword">value</span> <span class="hljs-keyword">from</span> a spy<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">      // create `getValue` spy on an object representing the ValueService</div><div class="hljs-ln-line">      const valueServiceSpy = jasmine.createSpyObj('ValueServic<span class="hljs-string">e', ['</span>getValu<span class="hljs-string">e']);</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      // set the value to return when the `getValue` spy is called.</div><div class="hljs-ln-line">      const stubValue = 'stub valu<span class="hljs-string">e';</span></div><div class="hljs-ln-line">      valueServiceSpy.getValue.and.returnValue(stubValue);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      masterService = new MasterService(valueServiceSpy);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      expect(masterService.getValue()).withContext('service returned stub valu<span class="hljs-string">e').toBe(stubValue);</span></div><div class="hljs-ln-line">      expect(valueServiceSpy.getValue.calls.count())</div><div class="hljs-ln-line">        .withContext('spy <span class="hljs-keyword">method</span> was <span class="hljs-keyword">called</span> onc<span class="hljs-string">e')</span></div><div class="hljs-ln-line">        .toBe(1);</div><div class="hljs-ln-line">      expect(valueServiceSpy.getValue.calls.mostRecent().returnValue).toBe(stubValue);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  describe('MasterService (<span class="hljs-keyword">no</span> beforeEach)<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">    it('#getValue should <span class="hljs-keyword">return</span> stubbed <span class="hljs-keyword">value</span> <span class="hljs-keyword">from</span> a spy<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">      const {masterService, stubValue, valueServiceSpy} = setup();</div><div class="hljs-ln-line">      expect(masterService.getValue()).withContext('service returned stub valu<span class="hljs-string">e').toBe(stubValue);</span></div><div class="hljs-ln-line">      expect(valueServiceSpy.getValue.calls.count())</div><div class="hljs-ln-line">        .withContext('spy <span class="hljs-keyword">method</span> was <span class="hljs-keyword">called</span> onc<span class="hljs-string">e')</span></div><div class="hljs-ln-line">        .toBe(1);</div><div class="hljs-ln-line">      expect(valueServiceSpy.getValue.calls.mostRecent().returnValue).toBe(stubValue);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    function setup() {</div><div class="hljs-ln-line">      const valueServiceSpy = jasmine.createSpyObj('ValueServic<span class="hljs-string">e', ['</span>getValu<span class="hljs-string">e']);</span></div><div class="hljs-ln-line">      const stubValue = 'stub valu<span class="hljs-string">e';</span></div><div class="hljs-ln-line">      const masterService = new MasterService(valueServiceSpy);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      valueServiceSpy.getValue.and.returnValue(stubValue);</div><div class="hljs-ln-line">      return {masterService, stubValue, valueServiceSpy};</div><div class="hljs-ln-line">    }</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  describe('ReversePip<span class="hljs-string">e', () =&gt; {</span></div><div class="hljs-ln-line">    let pipe: ReversePipe;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    beforeEach(() =&gt; {</div><div class="hljs-ln-line">      pipe = new ReversePipe();</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('transforms "abc" <span class="hljs-keyword">to</span> "cba"<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">      expect(pipe.transform('abc<span class="hljs-string">')).toBe('</span>cba<span class="hljs-string">');</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('<span class="hljs-keyword">no</span> change <span class="hljs-keyword">to</span> palindrome: "able was I ere I saw elba"<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">      const palindrome = 'able was I ere I saw elba<span class="hljs-string">';</span></div><div class="hljs-ln-line">      expect(pipe.transform(palindrome)).toBe(palindrome);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  describe('LightswitchComp<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">    it('#clicked() should toggle #isOn<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">      const comp = new LightswitchComponent();</div><div class="hljs-ln-line">      expect(comp.isOn).withContext('<span class="hljs-keyword">off</span> at first<span class="hljs-string">').toBe(false);</span></div><div class="hljs-ln-line">      comp.clicked();</div><div class="hljs-ln-line">      expect(comp.isOn).withContext('<span class="hljs-keyword">on</span> <span class="hljs-keyword">after</span> click<span class="hljs-string">').toBe(true);</span></div><div class="hljs-ln-line">      comp.clicked();</div><div class="hljs-ln-line">      expect(comp.isOn).withContext('<span class="hljs-keyword">off</span> <span class="hljs-keyword">after</span> second click<span class="hljs-string">').toBe(false);</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it('#clicked() should <span class="hljs-keyword">set</span> #message <span class="hljs-keyword">to</span> "is on"<span class="hljs-string">', () =&gt; {</span></div><div class="hljs-ln-line">      const comp = new LightswitchComponent();</div><div class="hljs-ln-line">      expect(comp.message)</div><div class="hljs-ln-line">        .withContext('<span class="hljs-keyword">off</span> at first<span class="hljs-string">')</span></div><div class="hljs-ln-line">        .toMatch(/is off/i);</div><div class="hljs-ln-line">      comp.clicked();</div><div class="hljs-ln-line">      expect(comp.message).withContext('<span class="hljs-keyword">on</span> <span class="hljs-keyword">after</span> clicked<span class="hljs-string">').toMatch(/is on/i);</span></div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line">});</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="aql3iah3951xogduq73aj0n6h">许多开发人员都觉得这种方法比传统的 <code>beforeEach()</code> 风格更清晰明了。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="1sj6j1e08ti7ill2ao17i0m0g">虽然此测试指南遵循传统风格，并且默认的
<a href="https://github.com/angular/angular-cli" target="_blank">CLI 原理图</a>会生成包含 
<code>beforeEach()</code> 和 
<code>TestBed</code> 的测试文件，还是可以在自己的项目中采用
<em>这种替代方法</em>。</p>

  <h2 id="testing-http-services">
    <a href="#testing-http-services" class="docs-anchor" tabindex="-1" aria-label="Link to Testing HTTP services" data-ng_translator_product="100" data-ng_translator_ref_id="8np8ctrbx57ylxl7502b5csrq">测试 HTTP 服务</a>
  </h2>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="16igjrx9mhb27qzkdh8a1nj3e">进行 HTTP 调用到远程服务器的数据服务通常会注入并委托给 Angular 的 
<a href="guide/http/testing"><code>HttpClient</code></a> 服务来进行 XHR 调用。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="5c58e35fy48mt6aio92w0zsjw">你可以像测试任何具有依赖项的服务一样，使用注入的 
<code>HttpClient</code> 测试间谍来测试数据服务。</p>
<div class="docs-code" path="adev/src/content/examples/testing/src/app/model/hero.service.spec.ts" visiblelines="12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55" header="app/model/hero.service.spec.ts (tests with spies)">
    <div class="docs-code-header"><h3 data-ng_translator_product="100" data-ng_translator_ref_id="1329tcpv4h3xeyi6k5jd18smh">app/model/hero.service.spec.ts (带测试间谍的测试)</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {HttpClientTestingModule, HttpTestingController} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/common/http/testing'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-regexp">//</span> Other imports</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {TestBed} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core/testing'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {HttpClient, HttpResponse, HttpErrorResponse} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/common/http'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {asyncData, asyncError} <span class="hljs-keyword">from</span> <span class="hljs-string">'../../testing/async-observable-helpers'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {Hero} <span class="hljs-keyword">from</span> <span class="hljs-string">'./hero'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {HeroService} <span class="hljs-keyword">from</span> <span class="hljs-string">'./hero.service'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">describe(<span class="hljs-string">'HeroesService (with spies)'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">  let httpClientSpy: jasmine.SpyObj&lt;HttpClient&gt;;</div><div class="hljs-ln-line">  let heroService: HeroService;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  beforeEach(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-regexp">//</span> TODO: spy <span class="hljs-literal">on</span> other methods too</div><div class="hljs-ln-line">    httpClientSpy = jasmine.createSpyObj(<span class="hljs-string">'HttpClient'</span>, [<span class="hljs-string">'get'</span>]);</div><div class="hljs-ln-line">    heroService = <span class="hljs-keyword">new</span> HeroService(httpClientSpy);</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  it(<span class="hljs-string">'should return expected heroes (HttpClient called once)'</span>, <span class="hljs-function"><span class="hljs-params">(done: DoneFn)</span> =&gt;</span> {</div><div class="hljs-ln-line">    const expectedHeroes: Hero[] = [</div><div class="hljs-ln-line">      {id: <span class="hljs-number">1</span>, name: <span class="hljs-string">'A'</span>},</div><div class="hljs-ln-line">      {id: <span class="hljs-number">2</span>, name: <span class="hljs-string">'B'</span>},</div><div class="hljs-ln-line">    ];</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    httpClientSpy.get.<span class="hljs-keyword">and</span>.returnValue(asyncData(expectedHeroes));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    heroService.getHeroes().subscribe({</div><div class="hljs-ln-line">      next: <span class="hljs-function"><span class="hljs-params">(heroes)</span> =&gt;</span> {</div><div class="hljs-ln-line">        expect(heroes).withContext(<span class="hljs-string">'expected heroes'</span>).toEqual(expectedHeroes);</div><div class="hljs-ln-line">        done();</div><div class="hljs-ln-line">      },</div><div class="hljs-ln-line">      error: done.fail,</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">    expect(httpClientSpy.get.calls.count()).withContext(<span class="hljs-string">'one call'</span>).toBe(<span class="hljs-number">1</span>);</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  it(<span class="hljs-string">'should return an error when the server returns a 404'</span>, <span class="hljs-function"><span class="hljs-params">(done: DoneFn)</span> =&gt;</span> {</div><div class="hljs-ln-line">    const errorResponse = <span class="hljs-keyword">new</span> HttpErrorResponse({</div><div class="hljs-ln-line">      error: <span class="hljs-string">'test 404 error'</span>,</div><div class="hljs-ln-line">      status: <span class="hljs-number">404</span>,</div><div class="hljs-ln-line">      statusText: <span class="hljs-string">'Not Found'</span>,</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    httpClientSpy.get.<span class="hljs-keyword">and</span>.returnValue(asyncError(errorResponse));</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    heroService.getHeroes().subscribe({</div><div class="hljs-ln-line">      next: <span class="hljs-function"><span class="hljs-params">(heroes)</span> =&gt;</span> done.fail(<span class="hljs-string">'expected an error, not heroes'</span>),</div><div class="hljs-ln-line">      error: <span class="hljs-function"><span class="hljs-params">(error)</span> =&gt;</span> {</div><div class="hljs-ln-line">        expect(error.message).toContain(<span class="hljs-string">'test 404 error'</span>);</div><div class="hljs-ln-line">        done();</div><div class="hljs-ln-line">      },</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line">});</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">describe(<span class="hljs-string">'HeroesService (with mocks)'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">  let httpClient: HttpClient;</div><div class="hljs-ln-line">  let httpTestingController: HttpTestingController;</div><div class="hljs-ln-line">  let heroService: HeroService;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  beforeEach(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">    TestBed.configureTestingModule({</div><div class="hljs-ln-line">      <span class="hljs-regexp">//</span> Import the HttpClient mocking services</div><div class="hljs-ln-line">      imports: [HttpClientTestingModule],</div><div class="hljs-ln-line">      <span class="hljs-regexp">//</span> Provide the service-under-test</div><div class="hljs-ln-line">      providers: [HeroService],</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-regexp">//</span> Inject the http, test controller, <span class="hljs-keyword">and</span> service-under-test</div><div class="hljs-ln-line">    <span class="hljs-regexp">//</span> <span class="hljs-keyword">as</span> they will be referenced <span class="hljs-keyword">by</span> each test.</div><div class="hljs-ln-line">    httpClient = TestBed.inject(HttpClient);</div><div class="hljs-ln-line">    httpTestingController = TestBed.inject(HttpTestingController);</div><div class="hljs-ln-line">    heroService = TestBed.inject(HeroService);</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  afterEach(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-regexp">//</span> After every test, assert that there are <span class="hljs-literal">no</span> more pending requests.</div><div class="hljs-ln-line">    httpTestingController.verify();</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-regexp">/// HeroService method tests begin ///</span></div><div class="hljs-ln-line">  describe(<span class="hljs-string">'#getHeroes'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">    let expectedHeroes: Hero[];</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    beforeEach(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">      heroService = TestBed.inject(HeroService);</div><div class="hljs-ln-line">      expectedHeroes = [</div><div class="hljs-ln-line">        {id: <span class="hljs-number">1</span>, name: <span class="hljs-string">'A'</span>},</div><div class="hljs-ln-line">        {id: <span class="hljs-number">2</span>, name: <span class="hljs-string">'B'</span>},</div><div class="hljs-ln-line">      ] <span class="hljs-keyword">as</span> Hero[];</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it(<span class="hljs-string">'should return expected heroes (called once)'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">      heroService.getHeroes().subscribe({</div><div class="hljs-ln-line">        next: <span class="hljs-function"><span class="hljs-params">(heroes)</span> =&gt;</span></div><div class="hljs-ln-line">          expect(heroes).withContext(<span class="hljs-string">'should return expected heroes'</span>).toEqual(expectedHeroes),</div><div class="hljs-ln-line">        error: fail,</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-regexp">//</span> HeroService should have made one request to GET heroes <span class="hljs-keyword">from</span> expected URL</div><div class="hljs-ln-line">      const req = httpTestingController.expectOne(heroService.heroesUrl);</div><div class="hljs-ln-line">      expect(req.request.method).toEqual(<span class="hljs-string">'GET'</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-regexp">//</span> Respond <span class="hljs-keyword">with</span> the mock heroes</div><div class="hljs-ln-line">      req.flush(expectedHeroes);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it(<span class="hljs-string">'should be OK returning no heroes'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">      heroService.getHeroes().subscribe({</div><div class="hljs-ln-line">        next: <span class="hljs-function"><span class="hljs-params">(heroes)</span> =&gt;</span></div><div class="hljs-ln-line">          expect(heroes.length).withContext(<span class="hljs-string">'should have empty heroes array'</span>).toEqual(<span class="hljs-number">0</span>),</div><div class="hljs-ln-line">        error: fail,</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      const req = httpTestingController.expectOne(heroService.heroesUrl);</div><div class="hljs-ln-line">      req.flush([]); <span class="hljs-regexp">//</span> Respond <span class="hljs-keyword">with</span> <span class="hljs-literal">no</span> heroes</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it(<span class="hljs-string">'should turn 404 into a user-friendly error'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">      const msg = <span class="hljs-string">'Deliberate 404'</span>;</div><div class="hljs-ln-line">      heroService.getHeroes().subscribe({</div><div class="hljs-ln-line">        next: <span class="hljs-function"><span class="hljs-params">(heroes)</span> =&gt;</span> fail(<span class="hljs-string">'expected to fail'</span>),</div><div class="hljs-ln-line">        error: <span class="hljs-function"><span class="hljs-params">(error)</span> =&gt;</span> expect(error.message).toContain(msg),</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      const req = httpTestingController.expectOne(heroService.heroesUrl);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-regexp">//</span> respond <span class="hljs-keyword">with</span> a <span class="hljs-number">404</span> <span class="hljs-keyword">and</span> the error message <span class="hljs-keyword">in</span> the body</div><div class="hljs-ln-line">      req.flush(msg, {status: <span class="hljs-number">404</span>, statusText: <span class="hljs-string">'Not Found'</span>});</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it(<span class="hljs-string">'should return expected heroes (called multiple times)'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">      heroService.getHeroes().subscribe();</div><div class="hljs-ln-line">      heroService.getHeroes().subscribe();</div><div class="hljs-ln-line">      heroService.getHeroes().subscribe({</div><div class="hljs-ln-line">        next: <span class="hljs-function"><span class="hljs-params">(heroes)</span> =&gt;</span></div><div class="hljs-ln-line">          expect(heroes).withContext(<span class="hljs-string">'should return expected heroes'</span>).toEqual(expectedHeroes),</div><div class="hljs-ln-line">        error: fail,</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      const requests = httpTestingController.match(heroService.heroesUrl);</div><div class="hljs-ln-line">      expect(requests.length).withContext(<span class="hljs-string">'calls to getHeroes()'</span>).toEqual(<span class="hljs-number">3</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-regexp">//</span> Respond to each request <span class="hljs-keyword">with</span> different mock hero results</div><div class="hljs-ln-line">      requests[<span class="hljs-number">0</span>].flush([]);</div><div class="hljs-ln-line">      requests[<span class="hljs-number">1</span>].flush([{id: <span class="hljs-number">1</span>, name: <span class="hljs-string">'bob'</span>}]);</div><div class="hljs-ln-line">      requests[<span class="hljs-number">2</span>].flush(expectedHeroes);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  describe(<span class="hljs-string">'#updateHero'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-regexp">//</span> Expecting the query form <span class="hljs-keyword">of</span> URL so should <span class="hljs-keyword">not</span> <span class="hljs-number">404</span> <span class="hljs-keyword">when</span> id <span class="hljs-keyword">not</span> found</div><div class="hljs-ln-line">    const makeUrl = <span class="hljs-function"><span class="hljs-params">(id: number)</span> =&gt;</span> `<span class="language-javascript">${heroService.<span class="hljs-property">heroesUrl</span>}/?id=${id}</span>`;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it(<span class="hljs-string">'should update a hero and return it'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">      const updateHero: Hero = {id: <span class="hljs-number">1</span>, name: <span class="hljs-string">'A'</span>};</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      heroService.updateHero(updateHero).subscribe({</div><div class="hljs-ln-line">        next: <span class="hljs-function"><span class="hljs-params">(data)</span> =&gt;</span> expect(data).withContext(<span class="hljs-string">'should return the hero'</span>).toEqual(updateHero),</div><div class="hljs-ln-line">        error: fail,</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-regexp">//</span> HeroService should have made one request to PUT hero</div><div class="hljs-ln-line">      const req = httpTestingController.expectOne(heroService.heroesUrl);</div><div class="hljs-ln-line">      expect(req.request.method).toEqual(<span class="hljs-string">'PUT'</span>);</div><div class="hljs-ln-line">      expect(req.request.body).toEqual(updateHero);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-regexp">//</span> Expect server to <span class="hljs-keyword">return</span> the hero after PUT</div><div class="hljs-ln-line">      const expectedResponse = <span class="hljs-keyword">new</span> HttpResponse({</div><div class="hljs-ln-line">        status: <span class="hljs-number">200</span>,</div><div class="hljs-ln-line">        statusText: <span class="hljs-string">'OK'</span>,</div><div class="hljs-ln-line">        body: updateHero,</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line">      req.event(expectedResponse);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it(<span class="hljs-string">'should turn 404 error into user-facing error'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</div><div class="hljs-ln-line">      const msg = <span class="hljs-string">'Deliberate 404'</span>;</div><div class="hljs-ln-line">      const updateHero: Hero = {id: <span class="hljs-number">1</span>, name: <span class="hljs-string">'A'</span>};</div><div class="hljs-ln-line">      heroService.updateHero(updateHero).subscribe({</div><div class="hljs-ln-line">        next: <span class="hljs-function"><span class="hljs-params">(heroes)</span> =&gt;</span> fail(<span class="hljs-string">'expected to fail'</span>),</div><div class="hljs-ln-line">        error: <span class="hljs-function"><span class="hljs-params">(error)</span> =&gt;</span> expect(error.message).toContain(msg),</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      const req = httpTestingController.expectOne(heroService.heroesUrl);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-regexp">//</span> respond <span class="hljs-keyword">with</span> a <span class="hljs-number">404</span> <span class="hljs-keyword">and</span> the error message <span class="hljs-keyword">in</span> the body</div><div class="hljs-ln-line">      req.flush(msg, {status: <span class="hljs-number">404</span>, statusText: <span class="hljs-string">'Not Found'</span>});</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    it(<span class="hljs-string">'should turn network error into user-facing error'</span>, <span class="hljs-function"><span class="hljs-params">(done)</span> =&gt;</span> {</div><div class="hljs-ln-line">      <span class="hljs-regexp">//</span> Create mock ProgressEvent <span class="hljs-keyword">with</span> type `<span class="language-javascript">error</span>`, raised <span class="hljs-keyword">when</span> something goes wrong at</div><div class="hljs-ln-line">      <span class="hljs-regexp">//</span> the network level. Connection timeout, DNS error, offline, etc.</div><div class="hljs-ln-line">      const errorEvent = <span class="hljs-keyword">new</span> ProgressEvent(<span class="hljs-string">'error'</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      const updateHero: Hero = {id: <span class="hljs-number">1</span>, name: <span class="hljs-string">'A'</span>};</div><div class="hljs-ln-line">      heroService.updateHero(updateHero).subscribe({</div><div class="hljs-ln-line">        next: <span class="hljs-function"><span class="hljs-params">(heroes)</span> =&gt;</span> fail(<span class="hljs-string">'expected to fail'</span>),</div><div class="hljs-ln-line">        error: <span class="hljs-function"><span class="hljs-params">(error)</span> =&gt;</span> {</div><div class="hljs-ln-line">          expect(error).toBe(errorEvent);</div><div class="hljs-ln-line">          done();</div><div class="hljs-ln-line">        },</div><div class="hljs-ln-line">      });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      const req = httpTestingController.expectOne(heroService.heroesUrl);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-regexp">//</span> Respond <span class="hljs-keyword">with</span> mock error</div><div class="hljs-ln-line">      req.error(errorEvent);</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-regexp">//</span> TODO: test other HeroService methods</div><div class="hljs-ln-line">});</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div>
    <div class="docs-alert docs-alert-important">
    <p data-ng_translator_product="100" data-ng_translator_ref_id="bbfv5h1sjkizequ3oe2c4xq1q"><strong>重要：</strong> 
<code>HeroService</code> 方法返回 
<code>可观察者</code>。你必须
<em>订阅</em>一个可观察者以 (a) 使其执行和 (b) 断言方法是成功还是失败。</p>

    </div>
    <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="6llv84iojyvbxidelw3fz74b7"><code>subscribe()</code> 方法会接受成功（<code>next</code>）和失败（<code>error</code>）回调。确保你会同时提供<em>这两个</em>回调函数，以便捕获错误。如果不这样做就会产生一个异步的、没有被捕获的可观察者的错误，测试运行器可能会把它归因于一个完全不相关的测试。</p>

  <h2 id="httpclienttestingmodule">
    <a href="#httpclienttestingmodule" class="docs-anchor" tabindex="-1" aria-label="Link to <code>HttpClientTestingModule</code>"><code>HttpClientTestingModule</code></a>
  </h2>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="3lfa2n48d2wg2af3nn4dfge5e">数据服务与 
<code>HttpClient</code> 之间的扩展交互可能复杂且难以用测试间谍来模拟。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="bfgt3eyq8abuj4p1yttpikkgp"><code>HttpClientTestingModule</code> 可以使这些测试场景更易于管理。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="e30eejp6in2qi6q235tikbqtp">尽管此指南附带的
<em>代码示例</em>演示了 
<code>HttpClientTestingModule</code>，但此页面将其推迟到 
<a href="guide/http/testing">Http 指南</a>，该指南详细介绍了使用 
<code>HttpClientTestingModule</code> 进行测试。</p>
