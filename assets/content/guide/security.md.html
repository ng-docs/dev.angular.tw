<header class="docs-header">
      <docs-breadcrumb></docs-breadcrumb>

      
  <!-- Page title -->
  <div class="docs-page-title">
    <h1 tabindex="-1">安全性</h1>
    <a class="docs-github-links" target="_blank" href="https://github.com/angular/angular/edit/main/adev/src/content/guide/security.md" title="Edit this page" aria-label="Edit this page">
      <!-- Pencil -->
      <docs-icon role="presentation">edit</docs-icon>
    </a>
  </div>
    </header>
    <p>本主題介紹了 Angular 內建的針對常見 Web 應用漏洞和攻擊（如跨站指令碼攻擊）的保護。
它不涵蓋應用級別的安全性，例如身份驗證和授權。</p>
<p>有關下面描述的攻擊和緩解措施的更多訊息，請參閱 <a href="https://www.owasp.org/index.php/Category:OWASP_Guide_Project" target="_blank">開放 Web 應用安全專案 (OWASP) 指南</a>。</p>
<p><a id="report-issues"></a></p>

    <div class="docs-callout docs-callout-helpful">
      <h3>報告漏洞</h3>
      <p>Angular 是 Google <a href="https://bughunters.google.com/about/rules/6521337925468160/google-open-source-software-vulnerability-reward-program-rules" target="_blank">開源軟體漏洞獎勵計劃</a> 的一部分。對於 Angular 中的漏洞，請在 <a href="https://bughunters.google.com/report" target="_blank">https://bughunters.google.com</a> 送出你的報告。</p>
<p>有關 Google 如何處理安全問題的更多訊息，請參閱 <a href="https://www.google.com/about/appsecurity" target="_blank">Google 的安全理念</a>。</p>

    </div>
    
  <h2 id="best-practices">
    <a href="#best-practices" class="docs-anchor" tabindex="-1" aria-label="Link to Best practices">最佳實踐</a>
  </h2>
  <p>以下是一些確保你的 Angular 應用安全的最佳實踐。</p>

    <ol class="docs-ordered-list">
      <li><strong>保持 Angular 函式庫為最新版本</strong> - Angular 函式庫會定期更新，這些更新可能會修復以前版本中發現的安全缺陷。檢視 Angular <a href="https://github.com/angular/angular/blob/main/CHANGELOG.md" target="_blank">變更日誌</a> 以獲取與安全相關的更新。</li>
<li><strong>不要修改你的 Angular 副本</strong> - 私有的、自定義的 Angular 版本往往落後於當前版本，並且可能不包含重要的安全修復和增強功能。相反，請與社群分享你的 Angular 改進並送出拉取請求。</li>
<li><strong>避免使用文件中標記為『<em>安全風險</em>』的 Angular API</strong> - 有關更多訊息，請參閱本頁的 <a href="#trusting-safe-values">信任安全值</a> 部分。</li>

    </ol>
    
  <h2 id="preventing-cross-site-scripting-xss">
    <a href="#preventing-cross-site-scripting-xss" class="docs-anchor" tabindex="-1" aria-label="Link to Preventing cross-site scripting (XSS)">防止跨站指令碼 (XSS)</a>
  </h2>
  <p><a href="https://en.wikipedia.org/wiki/Cross-site_scripting" target="_blank">跨站指令碼 (XSS)</a> 使攻擊者能夠將惡意程式碼注入到網頁中。
這樣的程式碼隨後可以竊取使用者和登入資料，或執行冒充使用者的操作。
這是 Web 上最常見的攻擊之一。</p>
<p>要阻止 XSS 攻擊，你必須阻止惡意程式碼進入文件物件模型 (DOM)。
例如，如果攻擊者可以誘騙你將 <code>&lt;script&gt;</code> 標記插入到 DOM 中，他們就可以在你的網站上執行任意程式碼。
攻擊不僅限於 <code>&lt;script&gt;</code> 標記，DOM 中的許多元素和屬性都允許程式碼執行，例如 <code>&lt;img alt="" onerror="..."&gt;</code> 和 <code>&lt;a href="javascript:..."&gt;</code>。
如果受攻擊者控制的資料進入 DOM，請注意安全漏洞。</p>

  <h3 id="angulars-cross-site-scripting-security-model">
    <a href="#angulars-cross-site-scripting-security-model" class="docs-anchor" tabindex="-1" aria-label="Link to Angular's cross-site scripting security model">Angular 的跨站指令碼安全模型</a>
  </h3>
  <p>為了系統地阻止 XSS 錯誤，Angular 預設將所有值都視為不受信任的。
當透過範本繫結或內嵌將值插入到 DOM 中時，Angular 會對不受信任的值進行無害化和轉義。
如果某個值已經在 Angular 外部進行了無害化處理，並且被認為是安全的，請透過將 <a href="#trusting-safe-values">值標記為受信任</a> 來告知 Angular。</p>
<p>與用於渲染的值不同，Angular 範本預設被認為是受信任的，並且應被視為可執行程式碼。
永遠不要透過連線使用者輸入和範本語法來建立範本。
這樣做會使攻擊者能夠將<a href="https://en.wikipedia.org/wiki/Code_injection" target="_blank">任意程式碼注入</a>到你的應用中。
為了防止這些漏洞，在生產部署中始終使用預設的 <a href="#use-the-aot-template-compiler">預先編譯 (AoT) 範本編譯器</a>。</p>
<p>可以透過使用內容安全策略和受信任型別來提供額外的保護層。
這些 Web 平台屬性在 DOM 級別執行，這是防止 XSS 問題的最有效位置。在這裡，它們無法使用其他較低級別的 API 繞過。
因此，強烈建議利用這些屬性。為此，請為應用設定<a href="#content-security-policy">內容安全策略</a>，並啟用<a href="#enforcing-trusted-types">受信任型別強制執行</a>。</p>

  <h3 id="sanitization-and-security-contexts">
    <a href="#sanitization-and-security-contexts" class="docs-anchor" tabindex="-1" aria-label="Link to Sanitization and security contexts">無害化和安全上下文</a>
  </h3>
  <p><em>無害化</em>是對不受信任的值的檢查，將其轉換為可以安全插入到 DOM 中的值。
在許多情況下，無害化根本不會更改值。
無害化取決於上下文。
例如，在 CSS 中無害的值在 URL 中可能很危險。</p>
<p>Angular 定義了以下安全上下文：</p>

  <div class="docs-table docs-scroll-track-transparent">
    <table>
      <thead>
        <tr>
<th align="left">安全上下文</th>
<th align="left">詳情</th>
</tr>

      </thead>
      <tbody>
        <tr>
<td align="left">HTML</td>
<td align="left">當將值解釋為 HTML 時使用，例如，當繫結到 <code>innerHtml</code> 時。</td>
</tr>
<tr>
<td align="left">樣式</td>
<td align="left">當將 CSS 繫結到 <code>style</code> 屬性時使用。</td>
</tr>
<tr>
<td align="left">URL</td>
<td align="left">用於 URL 屬性，例如 <code>&lt;a href&gt;</code>。</td>
</tr>
<tr>
<td align="left">資源 URL</td>
<td align="left">作為程式碼載入和執行的 URL，例如，在 <code>&lt;script src&gt;</code> 中。</td>
</tr>

      </tbody>
    </table>
  </div>
  <p>Angular 對 HTML 和 URL 的不受信任值進行無害化處理。對資源 URL 進行無害化處理是不可能的，因為它們包含任意程式碼。
在開發模式下，當 Angular 不得不在無害化期間更改值時，它會列印控制台警告。</p>

  <h3 id="sanitization-example">
    <a href="#sanitization-example" class="docs-anchor" tabindex="-1" aria-label="Link to Sanitization example">無害化範例</a>
  </h3>
  <p>以下範本繫結了 <code>htmlSnippet</code> 的值。一次是透過將其內嵌到元素的內容中，另一次是透過將其繫結到元素的 <code>innerHTML</code> 屬性：</p>
<div class="docs-code" path="adev/src/content/examples/security/src/app/inner-html-binding.component.html" header="src/app/inner-html-binding.component.html">
    <div class="docs-code-header"><h3>src/app/inner-html-binding.component.html</h3></div>
    <pre class="docs-mini-scroll-track">      <pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">h3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;Binding innerHTML&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">h3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;Bound value:&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">p</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"e2e-inner-html-interpolated"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;{{ htmlSnippet }}&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;Result of binding to innerHTML:&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">p</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"e2e-inner-html-bound"</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> [innerHTML]</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"htmlSnippet"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;</span></span><span class="line"></span></code></pre>
    </pre>
  </div><p>內嵌內容始終會被轉義——HTML 不會被解釋，並且瀏覽器會在元素的文字內容中顯示尖括號。</p>
<p>為了解釋 HTML，請將其繫結到 HTML 屬性，例如 <code>innerHTML</code>。
請注意，將攻擊者可能控制的值繫結到 <code>innerHTML</code> 通常會導致 XSS 漏洞。
例如，可以按以下方式執行 JavaScript：</p>
<div class="docs-code" path="adev/src/content/examples/security/src/app/inner-html-binding.component.ts" visiblelines="6,7,8,9,10,11" header="src/app/inner-html-binding.component.ts (class)">
    <div class="docs-code-header"><h3>src/app/inner-html-binding.component.ts (類別)</h3></div>
    <pre class="docs-mini-scroll-track">      <pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {Component} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> '@angular/core'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span><span class="line"></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Component</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">({</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  selector: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">'app-inner-html-binding'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  templateUrl: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">'./inner-html-binding.component.html'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">})</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> InnerHtmlBindingComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {</span></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">  // For example, a user/attacker-controlled value from a URL.</span></span><span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70">  htmlSnippet</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> 'Template &lt;script&gt;alert("0wned")&lt;/script&gt; &lt;b&gt;Syntax&lt;/b&gt;'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span><span class="line"></span></code></pre>
    </pre>
  </div><p>Angular 識別出該值是不安全的，並自動對其進行無害化處理，這會刪除 <code>script</code> 元素，但保留安全內容，例如 <code>&lt;b&gt;</code> 元素。</p>
<img alt="A screenshot showing interpolated and bound HTML values" src="assets/images/guide/security/binding-inner-html.png#small">


  <h3 id="direct-use-of-the-dom-apis-and-explicit-sanitization-calls">
    <a href="#direct-use-of-the-dom-apis-and-explicit-sanitization-calls" class="docs-anchor" tabindex="-1" aria-label="Link to Direct use of the DOM APIs and explicit sanitization calls">直接使用 DOM API 和顯式無害化呼叫</a>
  </h3>
  <p>除非你強制執行受信任型別，否則內建的瀏覽器 DOM API 不會自動保護你免受安全漏洞的侵害。
例如，<code>document</code>、透過 <code>ElementRef</code> 可用的節點以及許多第三方 API 都包含不安全的方法。
同樣，如果你與其他操縱 DOM 的函式庫進行互動，你可能不會像使用 Angular 內嵌那樣進行相同的自動無害化處理。
避免直接與 DOM 互動，而應儘可能使用 Angular 範本。</p>
<p>對於不可避免的情況，請使用內建的 Angular 無害化函式。
使用 <a href="api/platform-browser/DomSanitizer#sanitize">DomSanitizer.sanitize</a> 方法和適當的 <code>SecurityContext</code> 對不受信任的值進行無害化處理。
該函式還接受使用 <code>bypassSecurityTrust</code> 函式標記為受信任的值，並且不對其進行無害化處理，如<a href="#trusting-safe-values">下文所述</a>。</p>

  <h3 id="trusting-safe-values">
    <a href="#trusting-safe-values" class="docs-anchor" tabindex="-1" aria-label="Link to Trusting safe values">信任安全值</a>
  </h3>
  <p>有時，應用確實需要包含可執行程式碼、顯示來自某些 URL 的 <code>&lt;iframe&gt;</code> 或構造潛在危險的 URL。
為了防止在這些情況下進行自動無害化處理，請告知 Angular 你已檢查過某個值，檢查了它的建立方式，並確保它是安全的。
<em>務必小心</em>。
如果你信任可能有害的值，則會在你的應用中引入安全漏洞。
如有疑問，請尋求專業的安全審閱人員。</p>
<p>要將值標記為受信任，請注入 <code>DomSanitizer</code> 並呼叫以下方法之一：</p>

  <ul class="docs-list">
    <li><code>bypassSecurityTrustHtml</code></li>
<li><code>bypassSecurityTrustScript</code></li>
<li><code>bypassSecurityTrustStyle</code></li>
<li><code>bypassSecurityTrustUrl</code></li>
<li><code>bypassSecurityTrustResourceUrl</code></li>

  </ul>
  <p>請記住，值是否安全取決於上下文，因此請為你的預期值用途選擇正確的上下文。
假設以下範本需要將 URL 繫結到 <code>javascript:alert(...)</code> 呼叫：</p>
<div class="docs-code" path="adev/src/content/examples/security/src/app/bypass-security.component.html" visiblelines="2,3,4,5" header="src/app/bypass-security.component.html (URL)">
    <div class="docs-code-header"><h3>src/app/bypass-security.component.html (URL)</h3></div>
    <pre class="docs-mini-scroll-track">      <pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">h3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;Bypass Security Component&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">h3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;</span></span><span class="line"></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">h4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;An untrusted URL:&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">h4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">a</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"e2e-dangerous-url"</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> [href]</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"dangerousUrl"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;Click me&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">h4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;A trusted URL:&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">h4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">a</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"e2e-trusted-url"</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> [href]</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"trustedUrl"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;Click me&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;</span></span><span class="line"></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">h4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;Resource URL:&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">h4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;Showing: {{ dangerousVideoUrl }}&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;Trusted:&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">iframe</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"e2e-iframe-trusted-src"</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> width</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"640"</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> height</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"390"</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> [src]</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"videoUrl"</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> title</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"trusted video url"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">iframe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;Untrusted:&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">iframe</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"e2e-iframe-untrusted-src"</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> width</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"640"</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> height</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"390"</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> [src]</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"dangerousVideoUrl"</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> title</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"unTrusted video url"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">iframe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;</span></span><span class="line"></span></code></pre>
    </pre>
  </div><p>通常，Angular 會自動對 URL 進行無害化處理，停用危險程式碼，並在開發模式下，將此操作記錄到控制台。
為了防止這種情況，請使用 <code>bypassSecurityTrustUrl</code> 呼叫將 URL 值標記為受信任的 URL：</p>
<div class="docs-code" path="adev/src/content/examples/security/src/app/bypass-security.component.ts" visiblelines="13,14,15,16,17,18,19" header="src/app/bypass-security.component.ts (trust-url)">
    <div class="docs-code-header"><h3>src/app/bypass-security.component.ts (trust-url)</h3></div>
    <pre class="docs-mini-scroll-track">      <pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {Component, inject} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> '@angular/core'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {DomSanitizer, SafeResourceUrl, SafeUrl} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> '@angular/platform-browser'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span><span class="line"></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Component</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">({</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  selector: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">'app-bypass-security'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  templateUrl: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">'./bypass-security.component.html'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">})</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> BypassSecurityComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {</span></span><span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70">  dangerousUrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span><span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70">  trustedUrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> SafeUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span><span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70">  dangerousVideoUrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">!:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span><span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70">  videoUrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">!:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> SafeResourceUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span><span class="line"></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">  private</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70"> sanitizer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> inject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(DomSanitizer);</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">() {</span></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    // javascript: URLs are dangerous if attacker controlled.</span></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    // Angular sanitizes them in data binding, but you can</span></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    // explicitly tell Angular to trust this value:</span></span><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.dangerousUrl </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> 'javascript:alert("Hi there")'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.trustedUrl </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.sanitizer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">bypassSecurityTrustUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.dangerousUrl);</span></span><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">updateVideoUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">'PUBnlbjZFAI'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  }</span></span><span class="line"></span><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">  updateVideoUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70">id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) {</span></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    // Appending an ID to a YouTube URL is safe.</span></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    // Always make sure to construct SafeValue objects as</span></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    // close as possible to the input data so</span></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    // that it's easier to check if the value is safe.</span></span><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.dangerousVideoUrl </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> 'https://www.youtube.com/embed/'</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> id;</span></span><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.videoUrl </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.sanitizer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">bypassSecurityTrustResourceUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.dangerousVideoUrl);</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  }</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span><span class="line"></span></code></pre>
    </pre>
  </div><img alt="A screenshot showing an alert box created from a trusted URL" src="assets/images/guide/security/bypass-security-component.png#medium">

<p>如果你需要將使用者輸入轉換為受信任的值，請使用元件方法。
以下範本允許使用者輸入 YouTube 影片 ID 並在 <code>&lt;iframe&gt;</code> 中載入相應的影片。
<code>&lt;iframe src&gt;</code> 屬性是資源 URL 安全上下文，因為不受信任的來源可能會偷偷放入檔案下載，而毫無戒心的使用者可能會執行這些檔案。
為了防止這種情況，請調用元件上的方法來構造受信任的影片 URL，這將使 Angular 允許繫結到 <code>&lt;iframe src&gt;</code> 中：</p>
<div class="docs-code" path="adev/src/content/examples/security/src/app/bypass-security.component.html" visiblelines="7,8,9,10,11,12,13,14" header="src/app/bypass-security.component.html (iframe)">
    <div class="docs-code-header"><h3>src/app/bypass-security.component.html (iframe)</h3></div>
    <pre class="docs-mini-scroll-track">      <pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">h3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;Bypass Security Component&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">h3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;</span></span><span class="line"></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">h4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;An untrusted URL:&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">h4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">a</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"e2e-dangerous-url"</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> [href]</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"dangerousUrl"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;Click me&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">h4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;A trusted URL:&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">h4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">a</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"e2e-trusted-url"</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> [href]</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"trustedUrl"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;Click me&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;</span></span><span class="line"></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">h4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;Resource URL:&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">h4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;Showing: {{ dangerousVideoUrl }}&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;Trusted:&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">iframe</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"e2e-iframe-trusted-src"</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> width</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"640"</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> height</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"390"</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> [src]</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"videoUrl"</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> title</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"trusted video url"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">iframe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;Untrusted:&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">iframe</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"e2e-iframe-untrusted-src"</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> width</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"640"</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> height</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"390"</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> [src]</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"dangerousVideoUrl"</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> title</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"unTrusted video url"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">iframe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;</span></span><span class="line"></span></code></pre>
    </pre>
  </div><div class="docs-code" path="adev/src/content/examples/security/src/app/bypass-security.component.ts" visiblelines="23,24,25,26,27,28,29,30" header="src/app/bypass-security.component.ts (trust-video-url)">
    <div class="docs-code-header"><h3>src/app/bypass-security.component.ts (trust-video-url)</h3></div>
    <pre class="docs-mini-scroll-track">      <pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {Component, inject} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> '@angular/core'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {DomSanitizer, SafeResourceUrl, SafeUrl} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> '@angular/platform-browser'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span><span class="line"></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Component</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">({</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  selector: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">'app-bypass-security'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  templateUrl: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">'./bypass-security.component.html'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">})</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> BypassSecurityComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {</span></span><span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70">  dangerousUrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span><span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70">  trustedUrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> SafeUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span><span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70">  dangerousVideoUrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">!:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span><span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70">  videoUrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">!:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> SafeResourceUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span><span class="line"></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">  private</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70"> sanitizer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> inject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(DomSanitizer);</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">() {</span></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    // javascript: URLs are dangerous if attacker controlled.</span></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    // Angular sanitizes them in data binding, but you can</span></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    // explicitly tell Angular to trust this value:</span></span><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.dangerousUrl </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> 'javascript:alert("Hi there")'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.trustedUrl </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.sanitizer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">bypassSecurityTrustUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.dangerousUrl);</span></span><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">updateVideoUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">'PUBnlbjZFAI'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  }</span></span><span class="line"></span><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">  updateVideoUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70">id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) {</span></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    // Appending an ID to a YouTube URL is safe.</span></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    // Always make sure to construct SafeValue objects as</span></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    // close as possible to the input data so</span></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    // that it's easier to check if the value is safe.</span></span><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.dangerousVideoUrl </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> 'https://www.youtube.com/embed/'</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> id;</span></span><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.videoUrl </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.sanitizer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">bypassSecurityTrustResourceUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.dangerousVideoUrl);</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  }</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span><span class="line"></span></code></pre>
    </pre>
  </div>
  <h3 id="content-security-policy">
    <a href="#content-security-policy" class="docs-anchor" tabindex="-1" aria-label="Link to Content security policy">內容安全策略</a>
  </h3>
  <p>內容安全策略 (CSP) 是一種深度防禦技術，用於防止 XSS。
要啟用 CSP，請設定你的 Web 伺服器以回傳適當的 <code>Content-Security-Policy</code> HTTP 標頭。
在 Google Developers 網站上的 <a href="https://developers.google.com/web/fundamentals/security/csp" target="_blank">Web Fundamentals 指南</a> 中閱讀有關內容安全策略的更多訊息。</p>
<p>全新的 Angular 應用所需的最低策略是：</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span>default-src 'self'; style-src 'self' 'nonce-randomNonceGoesHere'; script-src 'self' 'nonce-randomNonceGoesHere';</span></span></code></pre>
    </pre>
  </div><p>在為你的 Angular 應用啟動伺服器時，伺服器應在每個請求的 HTTP 標頭中包含一個隨機生成的 nonce。
你必須將此 nonce 提供給 Angular，以便該框架可以渲染 <code>&lt;style&gt;</code> 元素。
你可以透過以下兩種方式之一為 Angular 設定 nonce：</p>

    <ol class="docs-ordered-list">
      <li>在根應用元素上將 <code>ngCspNonce</code> 屬性設定為 <code>&lt;app ngCspNonce="randomNonceGoesHere"&gt;&lt;/app&gt;</code>。如果你有權訪問伺服器端範本，該範本可以在構造回應時將 nonce 新增到標頭和 <code>index.html</code>，請使用此方法。</li>
<li>使用 <code>CSP_NONCE</code> 注入令牌來提供 nonce。如果你可以在執行時訪問 nonce，並且希望能夠快取 <code>index.html</code>，請使用此方法。</li>

    </ol>
    <div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {bootstrapApplication, CSP_NONCE} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> '@angular/core'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {AppComponent} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> './app/app.component'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span><span class="line"></span><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">bootstrapApplication</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(AppComponent, {</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  providers: [{</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    provide: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">CSP_NONCE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    useValue: globalThis.myRandomNonceValue</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  }]</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">});</span></span></code></pre>
    </pre>
  </div>
    <div class="docs-callout docs-callout-helpful">
      <h3>唯一的 nonce</h3>
      <p>始終確保你提供的 nonce 是<strong>每個請求都唯一</strong>的，並且它們是不可預測或不可猜測的。
如果攻擊者可以預測未來的 nonce，他們就可以繞過 CSP 提供的保護。</p>

    </div>
    <p>如果你的專案中無法生成 nonce，你可以透過將 <code>'unsafe-inline'</code> 新增到 CSP 標頭的 <code>style-src</code> 部分來允許行內樣式。</p>

  <div class="docs-table docs-scroll-track-transparent">
    <table>
      <thead>
        <tr>
<th align="left">節</th>
<th align="left">詳情</th>
</tr>

      </thead>
      <tbody>
        <tr>
<td align="left"><code>default-src 'self';</code></td>
<td align="left">允許頁面從同一來源載入所有必需的資源。</td>
</tr>
<tr>
<td align="left"><code>style-src 'self' 'nonce-randomNonceGoesHere';</code></td>
<td align="left">允許頁面從同一來源 (<code>'self'</code>) 載入全域樣式，以及 Angular 使用 <code>nonce-randomNonceGoesHere</code> 插入的樣式。</td>
</tr>
<tr>
<td align="left"><code>script-src 'self' 'nonce-randomNonceGoesHere';</code></td>
<td align="left">允許頁面從同一來源 (<code>'self'</code>) 載入 JavaScript，以及 Angular CLI 使用 <code>nonce-randomNonceGoesHere</code> 插入的指令碼。僅當使用關鍵 CSS 行內時才需要這樣做。</td>
</tr>

      </tbody>
    </table>
  </div>
  <p>Angular 本身僅需要這些設定即可正常執行。
隨著專案的增長，你可能需要擴充套件 CSP 設定以適應特定於你的應用的額外屬性。</p>

  <h3 id="enforcing-trusted-types">
    <a href="#enforcing-trusted-types" class="docs-anchor" tabindex="-1" aria-label="Link to Enforcing Trusted Types">強制執行受信任型別</a>
  </h3>
  <p>建議你使用 <a href="https://w3c.github.io/trusted-types/dist/spec/" target="_blank">受信任型別</a>，以此來幫助保護你的應用免受跨站指令碼攻擊。
受信任型別是一個 <a href="https://en.wikipedia.org/wiki/Web_platform" target="_blank">Web 平台</a>屬性，可以透過強制執行更安全的編碼實踐來幫助你防止跨站指令碼攻擊。
受信任型別還可以幫助簡化應用程式碼的審計。</p>

    <div class="docs-callout docs-callout-helpful">
      <h3>受信任型別</h3>
      <p>受信任型別可能尚未在你的應用所面向的所有瀏覽器中都可用。
如果啟用了受信任型別的應用在不支援受信任型別的瀏覽器中執行，則應用的屬性將得以保留。你的應用透過 Angular 的 DomSanitizer 來防禦 XSS 攻擊。
有關當前瀏覽器支援，請參閱 <a href="https://caniuse.com/trusted-types" target="_blank">caniuse.com/trusted-types</a>。</p>

    </div>
    <p>要為你的應用強制執行受信任型別，你必須設定應用的 Web 伺服器以發出帶有以下 Angular 策略之一的 HTTP 標頭：</p>

  <div class="docs-table docs-scroll-track-transparent">
    <table>
      <thead>
        <tr>
<th align="left">策略</th>
<th align="left">詳情</th>
</tr>

      </thead>
      <tbody>
        <tr>
<td align="left"><code>angular</code></td>
<td align="left">此策略用於 Angular 內部經過安全審查的程式碼，並且是在強制執行受信任型別時 Angular 正常執行所必需的。任何行內範本值或由 Angular 無害化處理的內容都將被此策略視為安全。</td>
</tr>
<tr>
<td align="left"><code>angular#bundler</code></td>
<td align="left">Angular CLI 打捆器在建立惰性程式碼區塊檔案時使用此策略。</td>
</tr>
<tr>
<td align="left"><code>angular#unsafe-bypass</code></td>
<td align="left">對於使用 Angular 的 <a href="api/platform-browser/DomSanitizer">DomSanitizer</a> 中任何繞過安全性的方法（例如 <code>bypassSecurityTrustHtml</code>）的應用，將使用此策略。任何使用這些方法的應用都必須啟用此策略。</td>
</tr>
<tr>
<td align="left"><code>angular#unsafe-jit</code></td>
<td align="left">此策略由 <a href="api/core/Compiler">即時 (JiT) 編譯器</a> 使用。如果你的應用直接與 JiT 編譯器互動，或者正在使用 <a href="api/platform-browser-dynamic/platformBrowserDynamic">platform browser dynamic</a> 在 JiT 模式下執行，則必須啟用此策略。</td>
</tr>
<tr>
<td align="left"><code>angular#unsafe-upgrade</code></td>
<td align="left">此策略由 <a href="api/upgrade/static/UpgradeModule">@angular/upgrade</a> 套件使用。如果你的應用是 AngularJS 混合應用，則必須啟用此策略。</td>
</tr>

      </tbody>
    </table>
  </div>
  <p>你應該在以下位置設定受信任型別的 HTTP 標頭：</p>

  <ul class="docs-list">
    <li>生產環境服務基礎設施</li>
<li>Angular CLI (<code>ng serve</code>)，在 <code>angular.json</code> 檔案中使用 <code>headers</code> 屬性，用於本地開發和端到端測試</li>
<li>Karma (<code>ng test</code>)，在 <code>karma.config.js</code> 檔案中使用 <code>customHeaders</code> 屬性，用於單元測試</li>

  </ul>
  <p>以下是專門為受信任型別和 Angular 設定的標頭範例：</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Content-Security-Policy: trusted-types angular; require-trusted-types-for 'script';</span></span></code></pre>
    </pre>
  </div><p>以下是專門為受信任型別和 Angular 應用設定的標頭範例，這些應用使用了 Angular 的 <a href="api/platform-browser/DomSanitizer">DomSanitizer</a> 中任何繞過安全性的方法：</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Content-Security-Policy: trusted-types angular angular#unsafe-bypass; require-trusted-types-for 'script';</span></span></code></pre>
    </pre>
  </div><p>以下是專門為受信任型別和使用 JiT 的 Angular 應用設定的標頭範例：</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Content-Security-Policy: trusted-types angular angular#unsafe-jit; require-trusted-types-for 'script';</span></span></code></pre>
    </pre>
  </div><p>以下是專門為受信任型別和使用模組延遲載入的 Angular 應用設定的標頭範例：</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Content-Security-Policy: trusted-types angular angular#bundler; require-trusted-types-for 'script';</span></span></code></pre>
    </pre>
  </div>
    <div class="docs-callout docs-callout-helpful">
      <h3>社群貢獻</h3>
      <p>要了解有關排查受信任型別設定的更多訊息，以下資源可能會有所幫助：</p>
<p><a href="https://web.dev/trusted-types/#how-to-use-trusted-types" target="_blank">使用受信任型別防止基於 DOM 的跨站指令碼漏洞</a></p>

    </div>
    
  <h3 id="use-the-aot-template-compiler">
    <a href="#use-the-aot-template-compiler" class="docs-anchor" tabindex="-1" aria-label="Link to Use the AOT template compiler">使用預先 (AoT) 範本編譯器</a>
  </h3>
  <p>預先 (AoT) 範本編譯器可防止一整類別稱為範本注入的漏洞，並大大提高應用效能。
預先 (AoT) 範本編譯器是 Angular CLI 應用使用的預設編譯器，你應該在所有生產部署中使用它。</p>
<p>預先 (AoT) 編譯器的替代方案是即時 (JiT) 編譯器，它在執行時在瀏覽器中將範本編譯為可執行的範本程式碼。
Angular 信任範本程式碼，因此動態生成範本並對其進行編譯，特別是包含使用者資料的範本，會繞過 Angular 的內建保護。這是一種安全反模式。
有關以安全方式動態建立表單的訊息，請參閱<a href="guide/forms/dynamic-forms">動態表單</a>指南。</p>

  <h3 id="server-side-xss-protection">
    <a href="#server-side-xss-protection" class="docs-anchor" tabindex="-1" aria-label="Link to Server-side XSS protection">伺服器端 XSS 保護</a>
  </h3>
  <p>在服務器上建立的 HTML 容易受到注入攻擊。
將範本程式碼注入到 Angular 應用中與將可執行程式碼注入到應用中相同：
它使攻擊者可以完全控制應用。
為防止這種情況，請使用一種範本語言，該語言可以自動轉義值，以防止伺服器上的 XSS 漏洞。
不要使用範本語言在服務器端建立 Angular 範本。這會帶來引入範本注入漏洞的高風險。</p>

  <h2 id="http-level-vulnerabilities">
    <a href="#http-level-vulnerabilities" class="docs-anchor" tabindex="-1" aria-label="Link to HTTP-level vulnerabilities">HTTP 級別的漏洞</a>
  </h2>
  <p>Angular 內建了對防止兩種常見的 HTTP 漏洞（跨站請求偽造 (CSRF 或 XSRF) 和跨站指令碼套件含 (XSSI)）的支援。
這兩種漏洞都必須主要在服務器端緩解，但 Angular 提供了輔助工具，使用戶端的整合更容易。</p>

  <h3 id="cross-site-request-forgery">
    <a href="#cross-site-request-forgery" class="docs-anchor" tabindex="-1" aria-label="Link to Cross-site request forgery">跨站請求偽造</a>
  </h3>
  <p>在跨站請求偽造 (CSRF 或 XSRF) 中，攻擊者誘騙使用者訪問包含惡意程式碼的不同網頁（例如 <code>evil.com</code>）。此網頁秘密地嚮應用的 Web 伺服器（例如 <code>example-bank.com</code>）傳送惡意請求。</p>
<p>假設使用者已登入到 <code>example-bank.com</code> 上的應用。
使用者開啟一封電子郵件，然後單擊指向 <code>evil.com</code> 的連結，該連結在新標籤頁中開啟。</p>
<p><code>evil.com</code> 頁面立即向 <code>example-bank.com</code> 傳送惡意請求。
可能這是一個將資金從使用者帳戶轉移到攻擊者帳戶的請求。
瀏覽器會自動將 <code>example-bank.com</code> Cookie（包括身份驗證 Cookie）與此請求一起傳送。</p>
<p>如果 <code>example-bank.com</code> 伺服器缺少 XSRF 保護，則它無法區分來自應用的合法請求和來自 <code>evil.com</code> 的偽造請求。</p>
<p>為防止這種情況，應用必須確保使用者請求來自真實的應用，而不是來自其他站點。
伺服器和用戶端必須合作以阻止此攻擊。</p>
<p>在一種常見的反 XSRF 技術中，應用伺服器在 Cookie 中傳送一個隨機建立的身份驗證令牌。
用戶端程式碼讀取 Cookie，並在所有後續請求中新增帶有令牌的自定義請求標頭。
伺服器將收到的 Cookie 值與請求標頭值進行比較，如果值丟失或不對應，則拒絕該請求。</p>
<p>此技術之所以有效，是因為所有瀏覽器都實現了<em>同源策略</em>。
只有來自設定 Cookie 的網站的程式碼才能讀取該站點的 Cookie，並在對該站點的請求中設定自定義標頭。
這意味著只有你的應用可以讀取此 Cookie 令牌並設定自定義標頭。
<code>evil.com</code> 上的惡意程式碼無法做到這一點。</p>

  <h3 id="httpclient-xsrf-csrf-security">
    <a href="#httpclient-xsrf-csrf-security" class="docs-anchor" tabindex="-1" aria-label="Link to <code>HttpClient</code> XSRF/CSRF security"><code>HttpClient</code> XSRF/CSRF 安全性</a>
  </h3>
  <p><code>HttpClient</code> 支援一種用於防止 XSRF 攻擊的<a href="https://en.wikipedia.org/wiki/Cross-site_request_forgery#Cookie-to-header_token" target="_blank">常用機制</a>。當執行 HTTP 請求時，攔截器會從 Cookie 中讀取令牌（預設為 <code>XSRF-TOKEN</code>），並將其設定為 HTTP 標頭 <code>X-XSRF-TOKEN</code>。由於只有在你網域名稱上執行的程式碼才能讀取 Cookie，因此後端可以確定 HTTP 請求來自你的用戶端應用，而不是攻擊者。</p>
<p>預設情況下，攔截器會在所有修改請求（例如 <code>POST</code>）上，向相對 URL 傳送此標頭，但不會在 GET/HEAD 請求或帶有絕對 URL 的請求上傳送。</p>

    <div class="docs-callout docs-callout-helpful">
      <h3>為什麼不保護 GET 請求？</h3>
      <p>只有當請求可以更改後端狀態時，才需要 CSRF 保護。CSRF 攻擊的本質是跨域，Web 的<a href="https://developer.mozilla.org/docs/Web/Security/Same-origin_policy" target="_blank">同源策略</a>會阻止攻擊頁面檢索已認證的 GET 請求的結果。</p>

    </div>
    <p>為了利用這一點，你的伺服器需要在頁面載入時或首次 GET 請求時，在名為 <code>XSRF-TOKEN</code> 的 JavaScript 可讀會話 Cookie 中設定一個令牌。在後續請求中，伺服器可以驗證 Cookie 是否與 <code>X-XSRF-TOKEN</code> HTTP 標頭對應，從而確保只有在你域上執行的程式碼才能傳送請求。該令牌對於每個使用者都必須是唯一的，並且必須可由伺服器驗證；這可以防止用戶端偽造自己的令牌。將令牌設定為你的站點的身份驗證 Cookie 的摘要，並加鹽以提高安全性。</p>
<p>為了防止在多個 Angular 應用共享同一網域名稱或子域的環境中發生衝突，請為每個應用指定唯一的 Cookie 名稱。</p>

    <div class="docs-callout docs-callout-important">
      <h3>HttpClient 僅支援 XSRF 保護方案的用戶端部分</h3>
      <p>必須設定你的後端服務，以便為你的頁面設定 Cookie，並驗證所有符合條件的請求中都存在標頭。否則，Angular 的預設保護將失效。</p>

    </div>
    
  <h3 id="configure-custom-cookie-header-names">
    <a href="#configure-custom-cookie-header-names" class="docs-anchor" tabindex="-1" aria-label="Link to Configure custom cookie/header names">設定自定義 Cookie/標頭名稱</a>
  </h3>
  <p>如果你的後端服務對 XSRF 令牌 Cookie 或標頭使用了不同的名稱，請使用 <code>withXsrfConfiguration</code> 來覆蓋預設值。</p>
<p>如下所示，將其新增到 <code>provideHttpClient</code> 呼叫中：</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> appConfig</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> ApplicationConfig</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  providers: [</span></span><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">    provideHttpClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span></span><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">      withXsrfConfiguration</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">({</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        cookieName: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">'CUSTOM_XSRF_TOKEN'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        headerName: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">'X-Custom-Xsrf-Header'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">      }),</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    ),</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  ]</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">};</span></span></code></pre>
    </pre>
  </div>
  <h3 id="disabling-xsrf-protection">
    <a href="#disabling-xsrf-protection" class="docs-anchor" tabindex="-1" aria-label="Link to Disabling XSRF protection">停用 XSRF 保護</a>
  </h3>
  <p>如果內建的 XSRF 保護機制不適用於你的應用，你可以使用 <code>withNoXsrfProtection</code> 屬性來停用它：</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> appConfig</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> ApplicationConfig</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  providers: [</span></span><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">    provideHttpClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span></span><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">      withNoXsrfProtection</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(),</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    ),</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  ]</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">};</span></span></code></pre>
    </pre>
  </div><p>有關開放 Web 應用安全專案 (OWASP) 中 CSRF 的訊息，請參閱<a href="https://owasp.org/www-community/attacks/csrf" target="_blank">跨站請求偽造 (CSRF)</a>和<a href="https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html" target="_blank">跨站請求偽造 (CSRF) 防禦速查表</a>。斯坦福大學的論文<a href="https://seclab.stanford.edu/websec/csrf/csrf.pdf" target="_blank">跨站請求偽造的可靠防禦</a>是詳細訊息的豐富來源。</p>
<p>另請參閱 Dave Smith 在 AngularConnect 2016 上關於 XSRF 的<a href="https://www.youtube.com/watch?v=9inczw6qtpY" title="Cross" site request funkery securing your angular apps from evil doers target="_blank">演講</a>。</p>

  <h3 id="cross-site-script-inclusion-xssi">
    <a href="#cross-site-script-inclusion-xssi" class="docs-anchor" tabindex="-1" aria-label="Link to Cross-site script inclusion (XSSI)">跨站指令碼套件含 (XSSI)</a>
  </h3>
  <p>跨站指令碼套件含，也稱為 JSON 漏洞，可能允許攻擊者的網站從 JSON API 讀取資料。這種攻擊在舊版瀏覽器上有效，它透過覆蓋內建的 JavaScript 物件建構式函式，然後使用 <code>&lt;script&gt;</code> 標籤包含 API URL。</p>
<p>僅當回傳的 JSON 可作為 JavaScript 執行時，此攻擊才會成功。伺服器可以透過為所有 JSON 回應新增字首使其不可執行來防止攻擊，按照慣例，使用眾所周知的字串 <code>")]}',\n"</code>。</p>
<p>Angular 的 <code>HttpClient</code> 函式庫識別此約定，並在進一步解析之前，自動從所有回應中剝離字串 <code>")]}',\n"</code>。</p>
<p>有關更多訊息，請參閱此<a href="https://security.googleblog.com/2011/05/website-security-for-webmasters.html" target="_blank">Google Web 安全部落格文章</a>的 XSSI 部分。</p>

  <h2 id="auditing-angular-applications">
    <a href="#auditing-angular-applications" class="docs-anchor" tabindex="-1" aria-label="Link to Auditing Angular applications">審計 Angular 應用</a>
  </h2>
  <p>Angular 應用必須遵循與常規 Web 應用相同的安全原則，並且必須像常規 Web 應用一樣進行審計。在安全審查中應該審計的 Angular 特有的 API（例如 <a href="#trusting-safe-values"><em>bypassSecurityTrust</em></a> 方法）在文件中被標記為安全敏感。</p>
