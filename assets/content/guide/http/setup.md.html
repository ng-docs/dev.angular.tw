<header class="docs-header">
      <docs-breadcrumb></docs-breadcrumb>

      
  <!-- Page title -->
  <div class="docs-page-title">
    <h1 tabindex="-1" data-ng_translator_product="100" data-ng_translator_ref_id="amo917mn2jybk8ubjvmfaragj">设置
<code>HttpClient</code></h1>
    <a class="docs-github-links" target="_blank" href="https://github.com/angular/angular/edit/main/adev/src/content/guide/http/setup.md" title="Edit this page" aria-label="Edit this page">
      <!-- Pencil -->
      <docs-icon role="presentation">edit</docs-icon>
    </a>
  </div>
    </header>
    <p data-ng_translator_product="100" data-ng_translator_ref_id="efki14b1olxjxsy32gl1gwnm1">在你的应用中使用
<code>HttpClient</code>之前，必须通过
<a href="guide/di">依赖注入</a>进行配置。</p>

  <h2 id="providing-httpclient-through-dependency-injection">
    <a href="#providing-httpclient-through-dependency-injection" class="docs-anchor" tabindex="-1" aria-label="Link to Providing <code>HttpClient</code> through dependency injection" data-ng_translator_product="100" data-ng_translator_ref_id="ovi65k8gi1xsax5tsex46wok">通过依赖注入提供 
<code>HttpClient</code></a>
  </h2>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="cli7guaz7mk4w2ya0pi5jvl09"><code>HttpClient</code>是通过
<code>provideHttpClient</code>辅助函数提供的，大多数应用会在
<code>app.config.ts</code>中的应用
<code>providers</code>中包含它。</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">appConfig</span>: <span class="hljs-title class_">ApplicationConfig</span> = {</div><div class="hljs-ln-line">  <span class="hljs-attr">providers</span>: [</div><div class="hljs-ln-line">    <span class="hljs-title function_">provideHttpClient</span>(),</div><div class="hljs-ln-line">  ]</div><div class="hljs-ln-line">};</div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_ref_id="dgtro55t3c1vt5kfuhstfhz9d">如果你的应用使用基于NgModule的引导程序，则可以在应用的NgModule的providers中包含
<code>provideHttpClient</code>：</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-meta">@NgModule</span>({</div><div class="hljs-ln-line">  <span class="hljs-attr">providers</span>: [</div><div class="hljs-ln-line">    <span class="hljs-title function_">provideHttpClient</span>(),</div><div class="hljs-ln-line">  ],</div><div class="hljs-ln-line">  <span class="hljs-comment">// ... other application configuration</span></div><div class="hljs-ln-line">})</div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppModule</span> {}</div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_ref_id="5vx3lja7gv19l6vvu9cg49d6f">然后你可以将
<code>HttpClient</code>服务作为组件、服务或其他类的依赖项进行注入：</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-meta">@Injectable</span>({<span class="hljs-attr">providedIn</span>: <span class="hljs-string">'root'</span>})</div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigService</span> {</div><div class="hljs-ln-line">  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> http: HttpClient</span>) {</div><div class="hljs-ln-line">    <span class="hljs-comment">// This service can now make HTTP requests via `this.http`.</span></div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line">}</div></code>
    </pre>
  </div>
  <h2 id="configuring-features-of-httpclient">
    <a href="#configuring-features-of-httpclient" class="docs-anchor" tabindex="-1" aria-label="Link to Configuring features of <code>HttpClient</code>" data-ng_translator_product="100" data-ng_translator_ref_id="5ai5ua1kyh2jjn8oxn2r6snbp">配置 
<code>HttpClient</code> 的特性</a>
  </h2>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="9c3pb3o5m7isdprfz3gjtyooz"><code>provideHttpClient</code> 接受一些可选的特性配置，用于启用或配置客户端不同方面的行为。本节详细介绍这些可选特性及其用法。</p>

  <h3 id="withfetch">
    <a href="#withfetch" class="docs-anchor" tabindex="-1" aria-label="Link to <code>withFetch</code>"><code>withFetch</code></a>
  </h3>
  <div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">appConfig</span>: <span class="hljs-title class_">ApplicationConfig</span> = {</div><div class="hljs-ln-line">  <span class="hljs-attr">providers</span>: [</div><div class="hljs-ln-line">    <span class="hljs-title function_">provideHttpClient</span>(</div><div class="hljs-ln-line">      <span class="hljs-title function_">withFetch</span>(),</div><div class="hljs-ln-line">    ),</div><div class="hljs-ln-line">  ]</div><div class="hljs-ln-line">};</div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_ref_id="2f8zboyxswdppb0ru58620935">默认情况下，
<code>HttpClient</code> 使用 
<a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest" target="_blank"><code>XMLHttpRequest</code></a> API 发起请求。
<code>withFetch</code> 特性将客户端切换为使用 
<a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API" target="_blank"><code>fetch</code></a> API。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="2d8kmww5oy7bh7a7204i2hlwz"><code>fetch</code> 是一个更现代的 API，且在某些 
<code>XMLHttpRequest</code> 不支持的环境中可用。但它有一些限制，比如不会产生上传进度事件。</p>

  <h3 id="withinterceptors">
    <a href="#withinterceptors" class="docs-anchor" tabindex="-1" aria-label="Link to <code>withInterceptors(...)</code>"><code>withInterceptors(...)</code></a>
  </h3>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="13thnhdwzs31n5frdvd4hfa5i"><code>withInterceptors</code> 配置一组拦截器函数，这些函数会处理通过 
<code>HttpClient</code> 发起的请求。查看更多信息，请参阅 
<a href="guide/http/interceptors">拦截器指南</a>。</p>

  <h3 id="withinterceptorsfromdi">
    <a href="#withinterceptorsfromdi" class="docs-anchor" tabindex="-1" aria-label="Link to <code>withInterceptorsFromDi()</code>"><code>withInterceptorsFromDi()</code></a>
  </h3>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="6k0aa6u84nuo89l5dm6w8pnl6"><code>withInterceptorsFromDi</code> 在 
<code>HttpClient</code> 配置中包含基于类的旧式拦截器。查看更多信息，请参阅 
<a href="guide/http/interceptors">拦截器指南</a>。</p>

    <div class="docs-alert docs-alert-helpful">
    <p data-ng_translator_product="100" data-ng_translator_ref_id="ducng2fm2ykuflkvhci6d6pa1"><strong>提示：</strong> 函数式拦截器（通过 
<code>withInterceptors</code>）有更可预测的顺序，我们推荐使用它们而不是基于 DI 的拦截器。</p>

    </div>
    
  <h3 id="withrequestsmadeviaparent">
    <a href="#withrequestsmadeviaparent" class="docs-anchor" tabindex="-1" aria-label="Link to <code>withRequestsMadeViaParent()</code>"><code>withRequestsMadeViaParent()</code></a>
  </h3>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="5xq86ob3lg2923g900sm0oxp2">默认情况下，当你在特定注入器中使用 
<code>provideHttpClient</code> 配置 
<code>HttpClient</code> 时，此配置会覆盖父注入器中可能存在的任何 
<code>HttpClient</code> 配置。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="9larfhopgah2fjmu1u306a5jt">当你添加 
<code>withRequestsMadeViaParent()</code> 时，
<code>HttpClient</code> 被配置为将请求传递给父注入器中的 
<code>HttpClient</code> 实例，一旦它们通过了此级别上配置的任何拦截器。这在你想要在子注入器中
<em>添加</em>拦截器的同时，仍然通过父注入器的拦截器发送请求时非常有用。</p>

    <div class="docs-alert docs-alert-critical">
    <p data-ng_translator_product="100" data-ng_translator_ref_id="bm5wvt67rxvsnciqxazwlyuly"><strong>注意：</strong> 你必须在当前注入器之上配置一个 
<code>HttpClient</code> 实例，否则此选项无效，并且在你尝试使用它时会出现运行时错误。</p>

    </div>
    
  <h3 id="withjsonpsupport">
    <a href="#withjsonpsupport" class="docs-anchor" tabindex="-1" aria-label="Link to <code>withJsonpSupport()</code>"><code>withJsonpSupport()</code></a>
  </h3>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="1m6o40580o5t4qmyvqx5p6lyw">包含 
<code>withJsonpSupport</code> 将启用 
<code>HttpClient</code> 的 
<code>.jsonp()</code> 方法，该方法通过 
<a href="https://en.wikipedia.org/wiki/JSONP" target="_blank">JSONP 约定</a> 发起 GET 请求以跨域加载数据。</p>

    <div class="docs-alert docs-alert-helpful">
    <p data-ng_translator_product="100" data-ng_translator_ref_id="aruztv8nj35yzu4kv5ll15mbs"><strong>提示：</strong> 在可能的情况下，优先使用 
<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" target="_blank">CORS</a> 进行跨域请求，而不是使用 JSONP。</p>

    </div>
    
  <h3 id="withxsrfconfiguration">
    <a href="#withxsrfconfiguration" class="docs-anchor" tabindex="-1" aria-label="Link to <code>withXsrfConfiguration(...)</code>"><code>withXsrfConfiguration(...)</code></a>
  </h3>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="6t0q5jadalg1c3r6ufg5lgf5f">包括此选项可以自定义 
<code>HttpClient</code> 内置的 XSRF 安全功能。查看更多信息，请参阅 
<a href="best-practices/security">安全指南</a>。</p>

  <h3 id="withnoxsrfprotection">
    <a href="#withnoxsrfprotection" class="docs-anchor" tabindex="-1" aria-label="Link to <code>withNoXsrfProtection()</code>"><code>withNoXsrfProtection()</code></a>
  </h3>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="3mbsf0utyat2nzhwwlbxeycbw">包括此选项将禁用 
<code>HttpClient</code> 内置的 XSRF 安全功能。查看更多信息，请参阅 
<a href="best-practices/security">安全指南</a>。</p>

  <h2 id="httpclientmodule-based-configuration">
    <a href="#httpclientmodule-based-configuration" class="docs-anchor" tabindex="-1" aria-label="Link to <code>HttpClientModule</code>-based configuration" data-ng_translator_product="100" data-ng_translator_ref_id="1lrolf2wvj3bd13n03nduxnhe"><code>HttpClientModule</code> 基于的配置</a>
  </h2>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="aaydrufzesn8hlg2gdei267i3">某些应用可能使用基于 NgModules 的旧 API 配置 
<code>HttpClient</code>。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="1nqkri4c2bamw310bmjq98yj3">此表列出了 
<code>@angular/common/http</code> 提供的 NgModules 以及它们如何与上述提供者配置函数相关。</p>

  <div class="docs-table docs-scroll-track-transparent">
    <table>
      <thead>
        <tr>
<th><strong>NgModule</strong></th>
<th data-ng_translator_product="100" data-ng_translator_ref_id="s5upgmydjnohlannaiv0rzn1"><code>provideHttpClient()</code> 等效</th>
</tr>

      </thead>
      <tbody>
        <tr>
<td><code>HttpClientModule</code></td>
<td><code>provideHttpClient(withInterceptorsFromDi())</code></td>
</tr>
<tr>
<td><code>HttpClientJsonpModule</code></td>
<td><code>withJsonpSupport()</code></td>
</tr>
<tr>
<td><code>HttpClientXsrfModule.withOptions(...)</code></td>
<td><code>withXsrfConfiguration(...)</code></td>
</tr>
<tr>
<td><code>HttpClientXsrfModule.disable()</code></td>
<td><code>withNoXsrfProtection()</code></td>
</tr>

      </tbody>
    </table>
  </div>
  
    <div class="docs-callout docs-callout-important">
      <h3 data-ng_translator_product="100" data-ng_translator_ref_id="5o05yiq24xu9c5hhkn1olmd9l">在多个注入器中使用 HttpClientModule 时要谨慎</h3>
      <p data-ng_translator_product="100" data-ng_translator_ref_id="e16k6sek8loyajwv9jxnb5bxf">当 
<code>HttpClientModule</code> 存在于多个注入器中时，拦截器的行为定义不明确，取决于确切的选项和提供者/导入顺序。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="eivlkk0ykx18y60fq1a0u22gc">在多注入器配置中，优先使用 
<code>provideHttpClient</code>，因为它具有更稳定的行为。请参阅上述 
<code>withRequestsMadeViaParent</code> 特性。</p>

    </div>
    