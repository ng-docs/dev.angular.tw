<header class="docs-header">
      <docs-breadcrumb></docs-breadcrumb>

      
  <!-- Page title -->
  <div class="docs-page-title">
    <h1 tabindex="-1" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="bj26fyjitoxu8l9ytnse5nhrn">验证表单输入</h1>
    <a class="docs-github-links" target="_blank" href="https://github.com/angular/angular/edit/main/adev/src/content/guide/forms/form-validation.md" title="Edit this page" aria-label="Edit this page">
      <!-- Pencil -->
      <docs-icon role="presentation">edit</docs-icon>
    </a>
  </div>
    </header>
    <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="51ppuvd6dlw056yznt9nijcid">通过验证用户输入的准确性和完整性，可以提高整体的数据质量。该页面显示了如何从 UI 验证用户输入，以及如何在响应式表单和模板驱动表单中显示有用的验证消息。</p>

  <h2 id="validating-input-in-template-driven-forms">
    <a href="#validating-input-in-template-driven-forms" class="docs-anchor" tabindex="-1" aria-label="Link to Validating input in template-driven forms" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="dbkihv4jjzmuwck4huui2dk46">在模板驱动表单中验证输入</a>
  </h2>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="2ij3japeffmsv7cgbympvd0u8">要向模板驱动表单添加验证，你需要添加与 
<a href="https://developer.mozilla.org/docs/Web/Guide/HTML/HTML5/Constraint_validation" target="_blank">原生 HTML 表单验证</a>中相同的验证属性。Angular 使用指令将这些属性与框架中的验证函数匹配。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="5magj4jokuo6qldet5fc8zc4y">每当表单控件中的值发生变化时，Angular 就会进行验证，并生成一个验证错误的列表（对应着 <code>INVALID</code> 状态）或者 null（对应着 VALID 状态）。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="tyn5fk9qelfp7jwxzwqi0clv">然后你可以通过将 
<code>ngModel</code> 导出到一个本地模板变量来检查控件的状态。以下示例将 
<code>NgModel</code> 导出到一个名为 
<code>name</code> 的变量中：</p>
<div class="docs-code" path="adev/src/content/examples/form-validation/src/app/template/actor-form-template.component.html" visiblelines="8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25" header="template/actor-form-template.component.html (name)">
    <div class="docs-code-header"><h3>template/actor-form-template.component.html (name)</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Template-Driven Form<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></div><div class="hljs-ln-line">  <span class="hljs-tag">&lt;<span class="hljs-name">form</span> #<span class="hljs-attr">actorForm</span>=<span class="hljs-string">"ngForm"</span> <span class="hljs-attr">appUnambiguousRole</span>&gt;</span></div><div class="hljs-ln-line">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> [<span class="hljs-attr">hidden</span>]=<span class="hljs-string">"actorForm.submitted"</span>&gt;</span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"cross-validation"</span> [<span class="hljs-attr">class.cross-validation-error</span>]=<span class="hljs-string">"actorForm.hasError('unambiguousRole') &amp;&amp; (actorForm.touched || actorForm.dirty)"</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"name"</span>&gt;</span>Name<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span></span></div><div class="hljs-ln-line">                <span class="hljs-attr">required</span> <span class="hljs-attr">minlength</span>=<span class="hljs-string">"4"</span> <span class="hljs-attr">appForbiddenName</span>=<span class="hljs-string">"bob"</span></div><div class="hljs-ln-line">                [(<span class="hljs-attr">ngModel</span>)]=<span class="hljs-string">"actor.name"</span> #<span class="hljs-attr">name</span>=<span class="hljs-string">"ngModel"</span>&gt;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"name.invalid &amp;&amp; (name.dirty || name.touched)"</span></span></div><div class="hljs-ln-line">              <span class="hljs-attr">class</span>=<span class="hljs-string">"alert"</span>&gt;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"name.hasError('required')"</span>&gt;</span></div><div class="hljs-ln-line">              Name is required.</div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"name.hasError('minlength')"</span>&gt;</span></div><div class="hljs-ln-line">              Name must be at least 4 characters long.</div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"name.hasError('forbiddenName')"</span>&gt;</span></div><div class="hljs-ln-line">              Name cannot be Bob.</div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"role"</span>&gt;</span>Role<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span></span></div><div class="hljs-ln-line">                 <span class="hljs-attr">id</span>=<span class="hljs-string">"role"</span></div><div class="hljs-ln-line">                 <span class="hljs-attr">name</span>=<span class="hljs-string">"role"</span></div><div class="hljs-ln-line">                 #<span class="hljs-attr">role</span>=<span class="hljs-string">"ngModel"</span></div><div class="hljs-ln-line">                 [(<span class="hljs-attr">ngModel</span>)]=<span class="hljs-string">"actor.role"</span></div><div class="hljs-ln-line">                 [<span class="hljs-attr">ngModelOptions</span>]=<span class="hljs-string">"{ updateOn: 'blur' }"</span></div><div class="hljs-ln-line">                 <span class="hljs-attr">appUniqueRole</span>&gt;</div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"role.pending"</span>&gt;</span>Validating...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"role.invalid"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"alert role-errors"</span>&gt;</span></div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"role.hasError('uniqueRole')"</span>&gt;</span></div><div class="hljs-ln-line">              Role is already taken.</div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"actorForm.hasError('unambiguousRole') &amp;&amp; (actorForm.touched || actorForm.dirty)"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"cross-validation-error-message alert"</span>&gt;</span></div><div class="hljs-ln-line">            Name cannot match role.</div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"skill"</span>&gt;</span>Skill<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"skill"</span></span></div><div class="hljs-ln-line">                <span class="hljs-attr">name</span>=<span class="hljs-string">"skill"</span></div><div class="hljs-ln-line">                <span class="hljs-attr">required</span> [(<span class="hljs-attr">ngModel</span>)]=<span class="hljs-string">"actor.skill"</span></div><div class="hljs-ln-line">                #<span class="hljs-attr">skill</span>=<span class="hljs-string">"ngModel"</span>&gt;</div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> *<span class="hljs-attr">ngFor</span>=<span class="hljs-string">"let skill of skills"</span> [<span class="hljs-attr">value</span>]=<span class="hljs-string">"skill"</span>&gt;</span><span class="hljs-template-variable">{{ <span class="hljs-name">skill</span> }}</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"skill.errors &amp;&amp; skill.touched"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"alert"</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"skill.errors['required']"</span>&gt;</span>Power is required.<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Complete the form to enable the Submit button.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span></span></div><div class="hljs-ln-line">              [<span class="hljs-attr">disabled</span>]=<span class="hljs-string">"actorForm.invalid"</span>&gt;Submit<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span></span></div><div class="hljs-ln-line">              (<span class="hljs-attr">click</span>)=<span class="hljs-string">"actorForm.resetForm({})"</span>&gt;Reset<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></div><div class="hljs-ln-line">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"submitted-message"</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"actorForm.submitted"</span>&gt;</span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>You've submitted your actor, <span class="hljs-template-variable">{{ <span class="hljs-name">actorForm.value.name</span> }}</span><span class="language-xml">!<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> (<span class="hljs-attr">click</span>)=<span class="hljs-string">"actorForm.resetForm({})"</span>&gt;</span>Add new actor<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></div><div class="hljs-ln-line">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></div><div class="hljs-ln-line"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="94l08uixa1k9s9zevdi3k04kz">注意这个例子讲解的如下特性。</p>

  <ul class="docs-list">
    <li><p data-ng_translator_product="100" data-ng_translator_ref_id="6s42hwickj68mppn0bdo3vrna"><code>&lt;input&gt;</code> 元素带有 HTML 验证属性：
<code>required</code> 和 
<code>minlength</code>。同时它还带有一个自定义验证指令 
<code>forbiddenName</code>。更多信息请参见 
<a href="#defining-custom-validators">自定义验证器</a> 部分。</p>
</li>
<li><p data-ng_translator_product="100" data-ng_translator_ref_id="dg2ra8f3kgyma0bbhf5g3pd1g"><code>#name="ngModel"</code> 将 
<code>NgModel</code> 导出到一个名为 
<code>name</code> 的本地变量中。
<code>NgModel</code> 镜像了其底层 
<code>FormControl</code> 实例的许多属性，因此你可以在模板中使用它来检查控件状态，如 
<code>valid</code> 和 
<code>dirty</code>。有关完整的控件属性列表，请参见 
<a href="api/forms/AbstractControl">AbstractControl</a> API 参考。</p>

  <ul class="docs-list">
    <li><p data-ng_translator_product="100" data-ng_translator_ref_id="48ic2rxxivofztlr54nbss81d"><code>*ngIf</code> 在 
<code>&lt;div&gt;</code> 元素上仅当 
<code>name</code> 无效且控件为 
<code>dirty</code> 或 
<code>touched</code> 时显示一组嵌套的消息 
<code>divs</code>。</p>
</li>
<li><p data-ng_translator_product="100" data-ng_translator_ref_id="f4zfh86660nac3g42pb3c584b">每个嵌套的 
<code>&lt;div&gt;</code> 可以为可能的验证错误之一显示自定义消息。有针对 
<code>required</code>、
<code>minlength</code> 和 
<code>forbiddenName</code> 的消息。</p>
</li>

  </ul>
  </li>

  </ul>
  
    <div class="docs-alert docs-alert-helpful">
    <p data-ng_translator_product="100" data-ng_translator_ref_id="c4a65qrxcwnoas3bgt6dwnnbt"><strong>提示：</strong>为了防止验证器在用户有机会编辑表单之前显示错误，你应该检查控件的 
<code>dirty</code> 或 
<code>touched</code> 状态。</p>

    </div>
    
  <ul class="docs-list">
    <li data-ng_translator_product="100" data-ng_translator_ref_id="26wc1ws2d6feqar5hci39idbd">当用户更改被监视字段中的值时，控件被标记为「脏」</li>
<li data-ng_translator_product="100" data-ng_translator_ref_id="4jkh7bj1v9skeyq9ofod5arf4">当用户离开表单控件元素时，控件被标记为「已触碰」</li>

  </ul>
  
  <h2 id="validating-input-in-reactive-forms">
    <a href="#validating-input-in-reactive-forms" class="docs-anchor" tabindex="-1" aria-label="Link to Validating input in reactive forms" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="du18fhr2olw0m3u6uqtp5sx71">在响应式表单中验证输入</a>
  </h2>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="duq6cyr85xttgw86wwomwooea">在响应式表单中，事实之源是组件类。你无需通过模板中的 attributes 添加验证器，而是直接将验证器函数添加到组件类中的表单控件模型。然后 Angular 每当控件的值发生变化时就会调用这些函数。</p>

  <h3 id="validator-functions">
    <a href="#validator-functions" class="docs-anchor" tabindex="-1" aria-label="Link to Validator functions" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="amf6d696khzdbvd2xpvhh26ly">验证器（Validator）函数</a>
  </h3>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="34hgwf1yk4ec4ywdycujf02c2">验证器函数可以是同步函数，也可以是异步函数。</p>

  <div class="docs-table docs-scroll-track-transparent">
    <table>
      <thead>
        <tr>
<th align="left" data-ng_translator_product="100" data-ng_translator_ref_id="82i7dvenvfj5p8di6db66t0kz">验证器类型</th>
<th align="left" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="3prlgfrx5eo2xqncnnob4crxu">详情</th>
</tr>

      </thead>
      <tbody>
        <tr>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="e7wuhqwfs6pereev4zssztnpe">同步验证器</td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="6xqzs27yk4e7chsjc2fi6k4mh">同步函数，它们接收一个控件实例并立即返回一组验证错误或 
<code>null</code>。在实例化 
<code>FormControl</code> 时将这些作为第二个参数传入。</td>
</tr>
<tr>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="6nzklv7afq05vys55yuubb34c">异步验证器</td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="74iocvppg7s6eje4wn5g0jiag">异步函数（接收一个控件实例并返回一个 Promise 或可观察者，后者会发出一组验证错误或 
<code>null</code>）。在实例化 
<code>FormControl</code> 时，将这些异步函数作为第三个参数传入。</td>
</tr>

      </tbody>
    </table>
  </div>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="2uudkg3ldpu84yrbwnyf2zj4c">出于性能方面的考虑，只有在所有同步验证器都通过之后，Angular 才会运行异步验证器。当每一个异步验证器都执行完之后，才会设置这些验证错误。</p>

  <h3 id="built-in-validator-functions">
    <a href="#built-in-validator-functions" class="docs-anchor" tabindex="-1" aria-label="Link to Built-in validator functions" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="bims18gn3avu2ay176kkt0q0w">内置验证器函数</a>
  </h3>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="42zhy0mg67imgze3m97hq1ic">你可以选择
<a href="#defining-custom-validators">编写你自己的验证器函数</a>，或使用一些 Angular 的内置验证器。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="1efy2zlzfypjjhw9rew757xcq">与模板驱动表单中可用作属性的相同内置验证器，例如 
<code>required</code> 和 
<code>minlength</code>，都可以作为 
<code>Validators</code> 类中的函数来使用。 要查看所有内置验证器的完整列表，请参阅 
<a href="api/forms/Validators">Validators</a> API 参考。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="9ky9hath0nachlwm0oyosdwsp">要将演员表单更新为响应式表单，请使用一些相同的内置验证器 —这一次，以函数形式，就像下面的示例一样。</p>
<div class="docs-code" path="adev/src/content/examples/form-validation/src/app/reactive/actor-form-reactive.component.1.ts" visiblelines="16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34" header="reactive/actor-form-reactive.component.ts (validator functions)">
    <div class="docs-code-header"><h3 data-ng_translator_product="100" data-ng_translator_ref_id="8yffzdxira1coid83g0460asf">reactive/actor-form-reactive.component.ts（验证器函数）</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {Component, OnInit} from <span class="hljs-string">'@angular/core'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {FormControl, FormGroup, Validators} from <span class="hljs-string">'@angular/forms'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {forbiddenNameValidator} from <span class="hljs-string">'../shared/forbidden-name.directive'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component({</span></div><div class="hljs-ln-line">  selector: <span class="hljs-string">'app-actor-form-reactive'</span>,</div><div class="hljs-ln-line">  templateUrl: <span class="hljs-string">'./actor-form-reactive.component.html'</span>,</div><div class="hljs-ln-line">  styleUrls: [<span class="hljs-string">'./actor-form-reactive.component.css'</span>],</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line">export <span class="hljs-keyword">class</span> <span class="hljs-title class_">HeroFormReactiveComponent</span> <span class="hljs-title">implements</span> <span class="hljs-title">OnInit</span> {</div><div class="hljs-ln-line">  skills = [<span class="hljs-string">'Method Acting'</span>, <span class="hljs-string">'Singing'</span>, <span class="hljs-string">'Dancing'</span>, <span class="hljs-string">'Swordfighting'</span>];</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  actor = {name: <span class="hljs-string">'Tom Cruise'</span>, role: <span class="hljs-string">'Romeo'</span>, skill: <span class="hljs-keyword">this</span>.skills[<span class="hljs-number">3</span>]};</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  actorForm!: FormGroup;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  ngOnInit(): void {</div><div class="hljs-ln-line">    <span class="hljs-keyword">this</span>.actorForm = new FormGroup({</div><div class="hljs-ln-line">      name: new FormControl(<span class="hljs-keyword">this</span>.actor.name, [</div><div class="hljs-ln-line">        Validators.required,</div><div class="hljs-ln-line">        Validators.minLength(<span class="hljs-number">4</span>),</div><div class="hljs-ln-line">        forbiddenNameValidator(/bob/i), <span class="hljs-comment">// &lt;-- Here's how you pass in the custom validator.</span></div><div class="hljs-ln-line">      ]),</div><div class="hljs-ln-line">      role: new FormControl(<span class="hljs-keyword">this</span>.actor.role),</div><div class="hljs-ln-line">      skill: new FormControl(<span class="hljs-keyword">this</span>.actor.skill, Validators.required),</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-keyword">get</span> name() {</div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.actorForm.<span class="hljs-keyword">get</span>(<span class="hljs-string">'name'</span>);</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-keyword">get</span> skill() {</div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.actorForm.<span class="hljs-keyword">get</span>(<span class="hljs-string">'skill'</span>);</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_ref_id="dq78tu9sh0q91dm04c0y52scz">在这个示例中，
<code>name</code> 控件设置了两个内置验证器 —
<code>Validators.required</code> 和 
<code>Validators.minLength(4)</code>— 以及一个自定义验证器 
<code>forbiddenNameValidator</code>。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="dcb6il8ls9h0qqn7izygeavgl">所有这些验证器都是同步的，所以它们作为第二个参数传递。注意，你可以通过把这些函数放到一个数组中传入来支持多个验证器。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="1349joww93wq568y1doo60sm1">这个例子还添加了一些 getter 方法。在响应式表单中，你通常会通过它所属的控件组（FormGroup）的 <code>get</code> 方法来访问表单控件，但有时候为模板定义一些 getter 作为简短形式。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="bpm3fq0bqpsy5kzdang8fjfrd">如果你到模板中找到 <code>name</code> 输入框，就会发现它和模板驱动的例子很相似。</p>
<div class="docs-code" path="adev/src/content/examples/form-validation/src/app/reactive/actor-form-reactive.component.html" visiblelines="12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27" header="reactive/actor-form-reactive.component.html (name with error msg)">
    <div class="docs-code-header"><h3 data-ng_translator_product="100" data-ng_translator_ref_id="cloazb9tayc7p8f6x8vgvj1o8">reactive/actor-form-reactive.component.html（带错误消息的名称）</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span></span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Reactive Form<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-tag">&lt;<span class="hljs-name">form</span> [<span class="hljs-attr">formGroup</span>]=<span class="hljs-string">"actorForm"</span> #<span class="hljs-attr">formDir</span>=<span class="hljs-string">"ngForm"</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> [<span class="hljs-attr">hidden</span>]=<span class="hljs-string">"formDir.submitted"</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"cross-validation"</span> [<span class="hljs-attr">class.cross-validation-error</span>]=<span class="hljs-string">"actorForm.hasError('unambiguousRole') &amp;&amp; (actorForm.touched || actorForm.dirty)"</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"name"</span>&gt;</span>Name<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span></span></div><div class="hljs-ln-line">                <span class="hljs-attr">formControlName</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">required</span>&gt;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"name.invalid &amp;&amp; (name.dirty || name.touched)"</span></span></div><div class="hljs-ln-line">              <span class="hljs-attr">class</span>=<span class="hljs-string">"alert alert-danger"</span>&gt;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"name.hasError('required')"</span>&gt;</span></div><div class="hljs-ln-line">              Name is required.</div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"name.hasError('minlength')"</span>&gt;</span></div><div class="hljs-ln-line">              Name must be at least 4 characters long.</div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"name.hasError('forbiddenName')"</span>&gt;</span></div><div class="hljs-ln-line">              Name cannot be Bob.</div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"role"</span>&gt;</span>Role<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"role"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span></span></div><div class="hljs-ln-line">              <span class="hljs-attr">formControlName</span>=<span class="hljs-string">"role"</span>&gt;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"role.pending"</span>&gt;</span>Validating...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"role.invalid"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"alert alert-danger role-errors"</span>&gt;</span></div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"role.hasError('uniqueRole')"</span>&gt;</span></div><div class="hljs-ln-line">              Role is already taken.</div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"actorForm.hasError('unambiguousRole') &amp;&amp; (actorForm.touched || actorForm.dirty)"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"cross-validation-error-message alert alert-danger"</span>&gt;</span></div><div class="hljs-ln-line">            Name cannot match role or audiences will be confused.</div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"skill"</span>&gt;</span>Skill<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"skill"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span></span></div><div class="hljs-ln-line">            <span class="hljs-attr">formControlName</span>=<span class="hljs-string">"skill"</span> <span class="hljs-attr">required</span>&gt;</div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> *<span class="hljs-attr">ngFor</span>=<span class="hljs-string">"let skill of skills"</span> [<span class="hljs-attr">value</span>]=<span class="hljs-string">"skill"</span>&gt;</span><span class="hljs-template-variable">{{ <span class="hljs-name">skill</span> }}</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"skill.invalid &amp;&amp; skill.touched"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"alert alert-danger"</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"skill.hasError('required')"</span>&gt;</span>Skill is required.<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Complete the form to enable the Submit button.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span></span></div><div class="hljs-ln-line">              <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-default"</span></div><div class="hljs-ln-line">              [<span class="hljs-attr">disabled</span>]=<span class="hljs-string">"actorForm.invalid"</span>&gt;Submit<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-default"</span></span></div><div class="hljs-ln-line">             (<span class="hljs-attr">click</span>)=<span class="hljs-string">"formDir.resetForm({})"</span>&gt;Reset<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></div><div class="hljs-ln-line">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"submitted-message"</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"formDir.submitted"</span>&gt;</span></div><div class="hljs-ln-line">    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>You've submitted your actor, <span class="hljs-template-variable">{{ <span class="hljs-name">actorForm.value.name</span> }}</span><span class="language-xml">!<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span></div><div class="hljs-ln-line">    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> (<span class="hljs-attr">click</span>)=<span class="hljs-string">"formDir.resetForm({})"</span>&gt;</span>Add new actor<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></div><div class="hljs-ln-line">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_ref_id="bip19tcjrzpljrfe5u8zpr47l">这个表单与模板驱动版本不同之处在于不再导出任何指令。相反，它使用组件类中定义的 
<code>name</code> getter。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="5at0s5kig9doa1veypw1c7nfp">请注意，模板中仍然存在 
<code>required</code> 属性。虽然这对于验证来说并非必需，但应保留以确保无障碍性目的。</p>

  <h2 id="defining-custom-validators">
    <a href="#defining-custom-validators" class="docs-anchor" tabindex="-1" aria-label="Link to Defining custom validators" data-ng_translator_product="100" data-ng_translator_ref_id="3t2lod2adzkf2j35tv9vkpxxo">定义自定义验证器</a>
  </h2>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="a9a1an41xm2g5inzx26e3ri4e">内置的验证器并不是总能精确匹配应用中的用例，因此有时你需要创建一个自定义验证器。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="dva6bm27pqizfuf5relot9zqv">考虑上一个示例中的 
<code>forbiddenNameValidator</code> 函数。以下是该函数的定义。</p>
<div class="docs-code" path="adev/src/content/examples/form-validation/src/app/shared/forbidden-name.directive.ts" visiblelines="9,10,11,12,13,14,15" header="shared/forbidden-name.directive.ts (forbiddenNameValidator)">
    <div class="docs-code-header"><h3 data-ng_translator_product="100" data-ng_translator_ref_id="j0299e70pa4xywsqctmbqp5w">shared/forbidden-name.directive.ts（forbiddenNameValidator）</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {Directive, Input} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {</div><div class="hljs-ln-line">  AbstractControl,</div><div class="hljs-ln-line">  NG_VALIDATORS,</div><div class="hljs-ln-line">  ValidationErrors,</div><div class="hljs-ln-line">  Validator,</div><div class="hljs-ln-line">  ValidatorFn,</div><div class="hljs-ln-line">} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/forms'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-comment">/** An actor's name can't match the given regular expression */</span></div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> forbiddenNameValidator(nameRe: <span class="hljs-built_in">RegExp</span>): ValidatorFn {</div><div class="hljs-ln-line">  <span class="hljs-keyword">return</span> (control: AbstractControl): ValidationErrors | <span class="hljs-literal">null</span> =&gt; {</div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> forbidden = nameRe.test(control.value);</div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> forbidden ? {forbiddenName: {value: control.value}} : <span class="hljs-literal">null</span>;</div><div class="hljs-ln-line">  };</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">@Directive({</div><div class="hljs-ln-line">  selector: <span class="hljs-string">'[appForbiddenName]'</span>,</div><div class="hljs-ln-line">  providers: [{provide: NG_VALIDATORS, useExisting: ForbiddenValidatorDirective, multi: <span class="hljs-literal">true</span>}],</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ForbiddenValidatorDirective</span> implements Validator {</div><div class="hljs-ln-line">  @Input(<span class="hljs-string">'appForbiddenName'</span>) forbiddenName = <span class="hljs-string">''</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  validate(control: AbstractControl): ValidationErrors | <span class="hljs-literal">null</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> this.forbiddenName</div><div class="hljs-ln-line">      ? forbiddenNameValidator(<span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(this.forbiddenName, <span class="hljs-string">'i'</span>))(control)</div><div class="hljs-ln-line">      : <span class="hljs-literal">null</span>;</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_ref_id="bi28130d3ui3ql1x13gypsapa">该函数是一个工厂，它接受一个正则表达式来检测 
<em>特定的</em> 禁止名称，并返回一个验证器函数。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="bx6iqxtr94r7lipu8flwircae">在此示例中，禁止的名称是 "bob"，因此该验证器会拒绝任何包含 "bob" 的演员名称。 在其他地方，它可能会拒绝 "alice" 或匹配配置的正则表达式的任何名称。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="5kztweoain277b3rgnug66x8r"><code>forbiddenNameValidator</code> 工厂返回配置好的验证器函数。该函数接受一个 Angular 控件对象，如果控件值有效<em>则</em>返回 null，
<em>否则</em> 返回一个验证错误对象。验证错误对象通常有一个属性，其名称是验证键 
<code>'forbiddenName'</code>，其值是可以插入到错误消息中的任意值字典 
<code>{name}</code>。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="5ltloli20i6wr3xhtf2a2ulw7">自定义异步验证器和同步验证器很像，只是它们必须返回一个稍后会输出 null 或“验证错误对象”的承诺（Promise）或可观察者，如果是可观察者，那么它必须在某个时间点被完成（complete），那时候这个表单就会使用它输出的最后一个值作为验证结果。（译注：HTTP 服务是自动完成的，但是某些自定义的可观察者可能需要手动调用 complete 方法）</p>

  <h3 id="adding-custom-validators-to-reactive-forms">
    <a href="#adding-custom-validators-to-reactive-forms" class="docs-anchor" tabindex="-1" aria-label="Link to Adding custom validators to reactive forms" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="87mg3i59lghrl409j005lr6rx">为响应式表单添加自定义验证器</a>
  </h3>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="3jm33ktfmnf3sv1hfuv3hule2">在响应式表单中，通过直接将函数传递给 
<code>FormControl</code> 来添加自定义验证器。</p>
<div class="docs-code" path="adev/src/content/examples/form-validation/src/app/reactive/actor-form-reactive.component.1.ts" visiblelines="17,18,19,20,21,22,23,24,25" header="reactive/actor-form-reactive.component.ts (validator functions)">
    <div class="docs-code-header"><h3 data-ng_translator_product="100" data-ng_translator_ref_id="8yffzdxira1coid83g0460asf">reactive/actor-form-reactive.component.ts（验证器函数）</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {Component, OnInit} from <span class="hljs-string">'@angular/core'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {FormControl, FormGroup, Validators} from <span class="hljs-string">'@angular/forms'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {forbiddenNameValidator} from <span class="hljs-string">'../shared/forbidden-name.directive'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component({</span></div><div class="hljs-ln-line">  selector: <span class="hljs-string">'app-actor-form-reactive'</span>,</div><div class="hljs-ln-line">  templateUrl: <span class="hljs-string">'./actor-form-reactive.component.html'</span>,</div><div class="hljs-ln-line">  styleUrls: [<span class="hljs-string">'./actor-form-reactive.component.css'</span>],</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line">export <span class="hljs-keyword">class</span> <span class="hljs-title class_">HeroFormReactiveComponent</span> <span class="hljs-title">implements</span> <span class="hljs-title">OnInit</span> {</div><div class="hljs-ln-line">  skills = [<span class="hljs-string">'Method Acting'</span>, <span class="hljs-string">'Singing'</span>, <span class="hljs-string">'Dancing'</span>, <span class="hljs-string">'Swordfighting'</span>];</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  actor = {name: <span class="hljs-string">'Tom Cruise'</span>, role: <span class="hljs-string">'Romeo'</span>, skill: <span class="hljs-keyword">this</span>.skills[<span class="hljs-number">3</span>]};</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  actorForm!: FormGroup;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  ngOnInit(): void {</div><div class="hljs-ln-line">    <span class="hljs-keyword">this</span>.actorForm = new FormGroup({</div><div class="hljs-ln-line">      name: new FormControl(<span class="hljs-keyword">this</span>.actor.name, [</div><div class="hljs-ln-line">        Validators.required,</div><div class="hljs-ln-line">        Validators.minLength(<span class="hljs-number">4</span>),</div><div class="hljs-ln-line">        forbiddenNameValidator(/bob/i), <span class="hljs-comment">// &lt;-- Here's how you pass in the custom validator.</span></div><div class="hljs-ln-line">      ]),</div><div class="hljs-ln-line">      role: new FormControl(<span class="hljs-keyword">this</span>.actor.role),</div><div class="hljs-ln-line">      skill: new FormControl(<span class="hljs-keyword">this</span>.actor.skill, Validators.required),</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-keyword">get</span> name() {</div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.actorForm.<span class="hljs-keyword">get</span>(<span class="hljs-string">'name'</span>);</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-keyword">get</span> skill() {</div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.actorForm.<span class="hljs-keyword">get</span>(<span class="hljs-string">'skill'</span>);</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div>
  <h3 id="adding-custom-validators-to-template-driven-forms">
    <a href="#adding-custom-validators-to-template-driven-forms" class="docs-anchor" tabindex="-1" aria-label="Link to Adding custom validators to template-driven forms" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="ayx63any6vp2jdglbgisl5sqc">为模板驱动表单添加自定义验证器</a>
  </h3>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="4zap7cjedwav6mg9qfi1dxdpl">在模板驱动表单中，要为模板添加一个指令，该指令包含了 validator 函数。比如，对应的 <code>ForbiddenValidatorDirective</code> 用作 <code>forbiddenNameValidator</code> 的包装器。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="19uzlahw4hrt6uwvakjmzxv0s">Angular 可以识别指令在验证过程中的作用，因为指令向 
<code>NG_VALIDATORS</code> 提供者注册了自身，如以下示例所示。 
<code>NG_VALIDATORS</code> 是一个预定义的提供者，具有可扩展的验证器集合。</p>
<div class="docs-code" path="adev/src/content/examples/form-validation/src/app/shared/forbidden-name.directive.ts" visiblelines="19" header="shared/forbidden-name.directive.ts (providers)">
    <div class="docs-code-header"><h3 data-ng_translator_product="100" data-ng_translator_ref_id="9zgzeoc1qpgicrk2wehg4svhq">shared/forbidden-name.directive.ts（提供者）</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {Directive, Input} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {</div><div class="hljs-ln-line">  AbstractControl,</div><div class="hljs-ln-line">  NG_VALIDATORS,</div><div class="hljs-ln-line">  ValidationErrors,</div><div class="hljs-ln-line">  Validator,</div><div class="hljs-ln-line">  ValidatorFn,</div><div class="hljs-ln-line">} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/forms'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-comment">/** An actor's name can't match the given regular expression */</span></div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> forbiddenNameValidator(nameRe: <span class="hljs-built_in">RegExp</span>): ValidatorFn {</div><div class="hljs-ln-line">  <span class="hljs-keyword">return</span> (control: AbstractControl): ValidationErrors | <span class="hljs-literal">null</span> =&gt; {</div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> forbidden = nameRe.test(control.value);</div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> forbidden ? {forbiddenName: {value: control.value}} : <span class="hljs-literal">null</span>;</div><div class="hljs-ln-line">  };</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">@Directive({</div><div class="hljs-ln-line">  selector: <span class="hljs-string">'[appForbiddenName]'</span>,</div><div class="hljs-ln-line">  providers: [{provide: NG_VALIDATORS, useExisting: ForbiddenValidatorDirective, multi: <span class="hljs-literal">true</span>}],</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ForbiddenValidatorDirective</span> implements Validator {</div><div class="hljs-ln-line">  @Input(<span class="hljs-string">'appForbiddenName'</span>) forbiddenName = <span class="hljs-string">''</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  validate(control: AbstractControl): ValidationErrors | <span class="hljs-literal">null</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> this.forbiddenName</div><div class="hljs-ln-line">      ? forbiddenNameValidator(<span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(this.forbiddenName, <span class="hljs-string">'i'</span>))(control)</div><div class="hljs-ln-line">      : <span class="hljs-literal">null</span>;</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_ref_id="9jt84tajum2xtxe8iyqiq99lu">然后，指令类实现了 
<code>Validator</code> 接口，以便可以轻松地与 Angular 表单集成。 以下是指令的其余部分，帮助你了解它是如何组合在一起的。</p>
<div class="docs-code" path="adev/src/content/examples/form-validation/src/app/shared/forbidden-name.directive.ts" visiblelines="17,18,19,20,21,22,23,24,25,26,27,28,29" header="shared/forbidden-name.directive.ts (directive)">
    <div class="docs-code-header"><h3 data-ng_translator_product="100" data-ng_translator_ref_id="7d2reseklggjnzkhrb9hn1o4e">shared/forbidden-name.directive.ts（指令）</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {Directive, Input} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {</div><div class="hljs-ln-line">  AbstractControl,</div><div class="hljs-ln-line">  NG_VALIDATORS,</div><div class="hljs-ln-line">  ValidationErrors,</div><div class="hljs-ln-line">  Validator,</div><div class="hljs-ln-line">  ValidatorFn,</div><div class="hljs-ln-line">} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/forms'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-comment">/** An actor's name can't match the given regular expression */</span></div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> forbiddenNameValidator(nameRe: <span class="hljs-built_in">RegExp</span>): ValidatorFn {</div><div class="hljs-ln-line">  <span class="hljs-keyword">return</span> (control: AbstractControl): ValidationErrors | <span class="hljs-literal">null</span> =&gt; {</div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> forbidden = nameRe.test(control.value);</div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> forbidden ? {forbiddenName: {value: control.value}} : <span class="hljs-literal">null</span>;</div><div class="hljs-ln-line">  };</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">@Directive({</div><div class="hljs-ln-line">  selector: <span class="hljs-string">'[appForbiddenName]'</span>,</div><div class="hljs-ln-line">  providers: [{provide: NG_VALIDATORS, useExisting: ForbiddenValidatorDirective, multi: <span class="hljs-literal">true</span>}],</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ForbiddenValidatorDirective</span> implements Validator {</div><div class="hljs-ln-line">  @Input(<span class="hljs-string">'appForbiddenName'</span>) forbiddenName = <span class="hljs-string">''</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  validate(control: AbstractControl): ValidationErrors | <span class="hljs-literal">null</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> this.forbiddenName</div><div class="hljs-ln-line">      ? forbiddenNameValidator(<span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(this.forbiddenName, <span class="hljs-string">'i'</span>))(control)</div><div class="hljs-ln-line">      : <span class="hljs-literal">null</span>;</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="bhquk7538vcvgngkk9r9m5he1">一旦 <code>ForbiddenValidatorDirective</code> 写好了，你只要把 <code>forbiddenName</code> 选择器添加到输入框上就可以激活这个验证器了。比如：</p>
<div class="docs-code" path="adev/src/content/examples/form-validation/src/app/template/actor-form-template.component.html" visiblelines="8,9,10" header="template/actor-form-template.component.html (forbidden-name-input)">
    <div class="docs-code-header"><h3 data-ng_translator_product="100" data-ng_translator_ref_id="bx44uhtwswa0fzoelkzduazpp">template/actor-form-template.component.html（禁止名称输入）</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Template-Driven Form<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></div><div class="hljs-ln-line">  <span class="hljs-tag">&lt;<span class="hljs-name">form</span> #<span class="hljs-attr">actorForm</span>=<span class="hljs-string">"ngForm"</span> <span class="hljs-attr">appUnambiguousRole</span>&gt;</span></div><div class="hljs-ln-line">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> [<span class="hljs-attr">hidden</span>]=<span class="hljs-string">"actorForm.submitted"</span>&gt;</span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"cross-validation"</span> [<span class="hljs-attr">class.cross-validation-error</span>]=<span class="hljs-string">"actorForm.hasError('unambiguousRole') &amp;&amp; (actorForm.touched || actorForm.dirty)"</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"name"</span>&gt;</span>Name<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span></span></div><div class="hljs-ln-line">                <span class="hljs-attr">required</span> <span class="hljs-attr">minlength</span>=<span class="hljs-string">"4"</span> <span class="hljs-attr">appForbiddenName</span>=<span class="hljs-string">"bob"</span></div><div class="hljs-ln-line">                [(<span class="hljs-attr">ngModel</span>)]=<span class="hljs-string">"actor.name"</span> #<span class="hljs-attr">name</span>=<span class="hljs-string">"ngModel"</span>&gt;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"name.invalid &amp;&amp; (name.dirty || name.touched)"</span></span></div><div class="hljs-ln-line">              <span class="hljs-attr">class</span>=<span class="hljs-string">"alert"</span>&gt;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"name.hasError('required')"</span>&gt;</span></div><div class="hljs-ln-line">              Name is required.</div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"name.hasError('minlength')"</span>&gt;</span></div><div class="hljs-ln-line">              Name must be at least 4 characters long.</div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"name.hasError('forbiddenName')"</span>&gt;</span></div><div class="hljs-ln-line">              Name cannot be Bob.</div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"role"</span>&gt;</span>Role<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span></span></div><div class="hljs-ln-line">                 <span class="hljs-attr">id</span>=<span class="hljs-string">"role"</span></div><div class="hljs-ln-line">                 <span class="hljs-attr">name</span>=<span class="hljs-string">"role"</span></div><div class="hljs-ln-line">                 #<span class="hljs-attr">role</span>=<span class="hljs-string">"ngModel"</span></div><div class="hljs-ln-line">                 [(<span class="hljs-attr">ngModel</span>)]=<span class="hljs-string">"actor.role"</span></div><div class="hljs-ln-line">                 [<span class="hljs-attr">ngModelOptions</span>]=<span class="hljs-string">"{ updateOn: 'blur' }"</span></div><div class="hljs-ln-line">                 <span class="hljs-attr">appUniqueRole</span>&gt;</div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"role.pending"</span>&gt;</span>Validating...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"role.invalid"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"alert role-errors"</span>&gt;</span></div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"role.hasError('uniqueRole')"</span>&gt;</span></div><div class="hljs-ln-line">              Role is already taken.</div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"actorForm.hasError('unambiguousRole') &amp;&amp; (actorForm.touched || actorForm.dirty)"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"cross-validation-error-message alert"</span>&gt;</span></div><div class="hljs-ln-line">            Name cannot match role.</div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"skill"</span>&gt;</span>Skill<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"skill"</span></span></div><div class="hljs-ln-line">                <span class="hljs-attr">name</span>=<span class="hljs-string">"skill"</span></div><div class="hljs-ln-line">                <span class="hljs-attr">required</span> [(<span class="hljs-attr">ngModel</span>)]=<span class="hljs-string">"actor.skill"</span></div><div class="hljs-ln-line">                #<span class="hljs-attr">skill</span>=<span class="hljs-string">"ngModel"</span>&gt;</div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> *<span class="hljs-attr">ngFor</span>=<span class="hljs-string">"let skill of skills"</span> [<span class="hljs-attr">value</span>]=<span class="hljs-string">"skill"</span>&gt;</span><span class="hljs-template-variable">{{ <span class="hljs-name">skill</span> }}</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"skill.errors &amp;&amp; skill.touched"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"alert"</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"skill.errors['required']"</span>&gt;</span>Power is required.<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Complete the form to enable the Submit button.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span></span></div><div class="hljs-ln-line">              [<span class="hljs-attr">disabled</span>]=<span class="hljs-string">"actorForm.invalid"</span>&gt;Submit<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span></span></div><div class="hljs-ln-line">              (<span class="hljs-attr">click</span>)=<span class="hljs-string">"actorForm.resetForm({})"</span>&gt;Reset<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></div><div class="hljs-ln-line">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"submitted-message"</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"actorForm.submitted"</span>&gt;</span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>You've submitted your actor, <span class="hljs-template-variable">{{ <span class="hljs-name">actorForm.value.name</span> }}</span><span class="language-xml">!<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> (<span class="hljs-attr">click</span>)=<span class="hljs-string">"actorForm.resetForm({})"</span>&gt;</span>Add new actor<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></div><div class="hljs-ln-line">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></div><div class="hljs-ln-line"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div></code>
    </pre>
  </div>
    <div class="docs-alert docs-alert-helpful">
    <p data-ng_translator_product="100" data-ng_translator_ref_id="a95lx8hiwxt3x80du1grmruln"><strong>提示：</strong>请注意，自定义验证指令是使用 
<code>useExisting</code> 而不是 
<code>useClass</code> 实例化的。 注册的验证器必须是 
<em>本实例</em> 的 
<code>ForbiddenValidatorDirective</code> 实例 —该实例在表单中，其 
<code>forbiddenName</code> 属性绑定到 "bob"。</p>

    </div>
    <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="f3kbuz9h1icarmak3k49xw4dg">如果用 <code>useClass</code> 来代替 <code>useExisting</code>，就会注册一个新的类实例，而它是没有 <code>forbiddenName</code> 的。</p>

  <h2 id="control-status-css-classes">
    <a href="#control-status-css-classes" class="docs-anchor" tabindex="-1" aria-label="Link to Control status CSS classes" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="a22sgpj699qql2r1ygca7zu05">控件状态 CSS 类</a>
  </h2>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="6gwuz687fz490vx6kyo2b8884">Angular 会自动把很多控件属性作为 CSS 类映射到控件所在的元素上。你可以使用这些类来根据表单状态给表单控件元素添加样式。目前支持下列类：</p>

  <ul class="docs-list">
    <li><code>.ng-valid</code></li>
<li><code>.ng-invalid</code></li>
<li><code>.ng-pending</code></li>
<li><code>.ng-pristine</code></li>
<li><code>.ng-dirty</code></li>
<li><code>.ng-untouched</code></li>
<li><code>.ng-touched</code></li>
<li data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="22c97js42v789ykdpvpwn0qd3"><code>.ng-submitted</code>（只对 form 元素添加）</li>

  </ul>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="5fgeskd58fubtjpvcy3eacwtx">在下面的例子中，actor 表单使用 
<code>.ng-valid</code> 和 
<code>.ng-invalid</code> 类来设置每个表单控件边框的颜色。</p>
<div class="docs-code" path="adev/src/content/examples/form-validation/src/assets/forms.css" header="forms.css (status classes)">
    <div class="docs-code-header"><h3 data-ng_translator_product="100" data-ng_translator_ref_id="aef98lsfhj6r8gqsqd61qtz71">forms.css（状态类）</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-selector-class">.ng-valid</span><span class="hljs-selector-attr">[required]</span>, <span class="hljs-selector-class">.ng-valid</span><span class="hljs-selector-class">.required</span>  {</div><div class="hljs-ln-line">  <span class="hljs-attribute">border-left</span>: <span class="hljs-number">5px</span> solid <span class="hljs-number">#42A948</span>; <span class="hljs-comment">/* green */</span></div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-selector-class">.ng-invalid</span><span class="hljs-selector-pseudo">:not</span>(<span class="hljs-selector-tag">form</span>)  {</div><div class="hljs-ln-line">  <span class="hljs-attribute">border-left</span>: <span class="hljs-number">5px</span> solid <span class="hljs-number">#a94442</span>; <span class="hljs-comment">/* red */</span></div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-selector-class">.alert</span> <span class="hljs-selector-tag">div</span> {</div><div class="hljs-ln-line">  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fed3d3</span>;</div><div class="hljs-ln-line">  <span class="hljs-attribute">color</span>: <span class="hljs-number">#820000</span>;</div><div class="hljs-ln-line">  <span class="hljs-attribute">padding</span>: <span class="hljs-number">1rem</span>;</div><div class="hljs-ln-line">  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">1rem</span>;</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-selector-class">.form-group</span> {</div><div class="hljs-ln-line">  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">1rem</span>;</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-selector-tag">label</span> {</div><div class="hljs-ln-line">  <span class="hljs-attribute">display</span>: block;</div><div class="hljs-ln-line">  <span class="hljs-attribute">margin-bottom</span>: .<span class="hljs-number">5rem</span>;</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">select {</div><div class="hljs-ln-line">  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;</div><div class="hljs-ln-line">  <span class="hljs-attribute">padding</span>: .<span class="hljs-number">5rem</span>;</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div>
  <h2 id="cross-field-validation">
    <a href="#cross-field-validation" class="docs-anchor" tabindex="-1" aria-label="Link to Cross-field validation" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="9q8bc1s6dc4lp6njff6wl5mvy">跨字段交叉验证</a>
  </h2>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="7kdp47zw4piix193y7ay59v6g">跨字段验证器是一个
<a href="#defining-custom-validators" title="Read" about custom validators>自定义验证器</a>，比较表单中不同字段的值，并以组合方式接受或拒绝它们。例如，你可能有一个表单提供互斥选项，即用户可以选择 A 或 B，但不能同时选择。某些字段值可能也依赖于其他字段值；用户可能只能在选择 A 时选择 B。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="8ktokn5pujzeav7zhqlx3yoao">下列交叉验证的例子说明了如何进行如下操作：</p>

  <ul class="docs-list">
    <li data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="aohhs6rp79tuq1v7fhg193epa">根据两个兄弟控件的值验证响应式表单或模板驱动表单的输入，</li>
<li data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="8qld11rh7x2gya1ywkz3fn2yy">当用户与表单交互过，且验证失败后，就会显示描述性的错误信息。</li>

  </ul>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="bwxb0n7i2fpy4surc09oqs7be">这些示例使用跨字段验证来确保演员在角色中不重用相同的名字，通过填写 Actor 表单来实现。验证器通过检查演员名字和角色不匹配来完成此操作。</p>

  <h3 id="adding-cross-validation-to-reactive-forms">
    <a href="#adding-cross-validation-to-reactive-forms" class="docs-anchor" tabindex="-1" aria-label="Link to Adding cross-validation to reactive forms" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="f8p2e0p8pyoo3egrzuy4ca15">为响应式表单添加交叉验证</a>
  </h3>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="dfl51r12ritfc5yaz8ts817wd">该表单具有以下结构：</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">const</span> actorForm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormGroup</span>({</div><div class="hljs-ln-line">  <span class="hljs-string">'name'</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormControl</span>(),</div><div class="hljs-ln-line">  <span class="hljs-string">'role'</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormControl</span>(),</div><div class="hljs-ln-line">  <span class="hljs-string">'skill'</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormControl</span>()</div><div class="hljs-ln-line">});</div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_ref_id="14booqp41wgglihagsc24ljcr">注意，
<code>name</code> 和 
<code>role</code> 是兄弟控件。要在单个自定义验证器中验证这两个控件，必须在一个共有的祖先控件中执行验证：即 
<code>FormGroup</code>。你需要查询 
<code>FormGroup</code> 的子控件，以便比较它们的值。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="axh6hw1tm0pys7icr7rzdmakb">要将验证器添加到 
<code>FormGroup</code>，在创建时将新的验证器作为第二个参数传入。</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">const</span> actorForm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormGroup</span>({</div><div class="hljs-ln-line">  <span class="hljs-string">'name'</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormControl</span>(),</div><div class="hljs-ln-line">  <span class="hljs-string">'role'</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormControl</span>(),</div><div class="hljs-ln-line">  <span class="hljs-string">'skill'</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormControl</span>()</div><div class="hljs-ln-line">}, { <span class="hljs-attr">validators</span>: unambiguousRoleValidator });</div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="60a4vq9w9dfr6rzet9nx2exxe">验证器的代码如下。</p>
<div class="docs-code" path="adev/src/content/examples/form-validation/src/app/shared/unambiguous-role.directive.ts" visiblelines="9,10,11,12,13,14,15,16,17" header="shared/unambiguous-role.directive.ts">
    <div class="docs-code-header"><h3>shared/unambiguous-role.directive.ts</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {Directive} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {</div><div class="hljs-ln-line">  AbstractControl,</div><div class="hljs-ln-line">  NG_VALIDATORS,</div><div class="hljs-ln-line">  ValidationErrors,</div><div class="hljs-ln-line">  <span class="hljs-keyword">Validator</span>,</div><div class="hljs-ln-line">  ValidatorFn,</div><div class="hljs-ln-line">} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/forms'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-comment">/** An actor's name can't match the actor's role */</span></div><div class="hljs-ln-line">export const unambiguousRoleValidator: ValidatorFn = (</div><div class="hljs-ln-line">  control: AbstractControl,</div><div class="hljs-ln-line">): ValidationErrors | <span class="hljs-keyword">null</span> =&gt; {</div><div class="hljs-ln-line">  const <span class="hljs-type">name</span> = control.<span class="hljs-keyword">get</span>(<span class="hljs-string">'name'</span>);</div><div class="hljs-ln-line">  const <span class="hljs-keyword">role</span> = control.<span class="hljs-keyword">get</span>(<span class="hljs-string">'role'</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-keyword">return</span> <span class="hljs-type">name</span> &amp;&amp; <span class="hljs-keyword">role</span> &amp;&amp; <span class="hljs-type">name</span>.<span class="hljs-keyword">value</span> === <span class="hljs-keyword">role</span>.<span class="hljs-keyword">value</span> ? {unambiguousRole: <span class="hljs-keyword">true</span>} : <span class="hljs-keyword">null</span>;</div><div class="hljs-ln-line">};</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">@Directive({</div><div class="hljs-ln-line">  selector: <span class="hljs-string">'[appUnambiguousRole]'</span>,</div><div class="hljs-ln-line">  providers: [</div><div class="hljs-ln-line">    {provide: NG_VALIDATORS, useExisting: UnambiguousRoleValidatorDirective, multi: <span class="hljs-keyword">true</span>},</div><div class="hljs-ln-line">  ],</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line">export <span class="hljs-keyword">class</span> UnambiguousRoleValidatorDirective implements <span class="hljs-keyword">Validator</span> {</div><div class="hljs-ln-line">  <span class="hljs-keyword">validate</span>(control: AbstractControl): ValidationErrors | <span class="hljs-keyword">null</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> unambiguousRoleValidator(control);</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_ref_id="e9fh5xmu7oab52obcjj363un9"><code>unambiguousRoleValidator</code> 验证器实现了 
<code>ValidatorFn</code> 接口。它接收一个 Angular 控件对象作为参数，并在表单有效时返回 null，否则返回 
<code>ValidationErrors</code>。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="btpihhkprcdqunfjbiuc83jsw">验证器通过调用 
<code>FormGroup</code> 的 
<a href="api/forms/AbstractControl#get">get</a> 方法来检索子控件，然后比较 
<code>name</code> 和 
<code>role</code> 控件的值。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="dyxl1veqvjgyr1lp6lrlwkovz">如果值不匹配，角色是明确的，两个都是有效的，验证器返回 null。如果它们匹配，演员的角色是模糊的，验证器必须通过返回一个错误对象来标记表单为无效。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="4j36i4svvistox1xi04lrgke4">为了提供更好的用户体验，当表单无效时，模板还会显示一条恰当的错误信息。</p>
<div class="docs-code" path="adev/src/content/examples/form-validation/src/app/reactive/actor-form-reactive.component.html" visiblelines="43,44,45" header="reactive/actor-form-template.component.html">
    <div class="docs-code-header"><h3>reactive/actor-form-template.component.html</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span></span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Reactive Form<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-tag">&lt;<span class="hljs-name">form</span> [<span class="hljs-attr">formGroup</span>]=<span class="hljs-string">"actorForm"</span> #<span class="hljs-attr">formDir</span>=<span class="hljs-string">"ngForm"</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> [<span class="hljs-attr">hidden</span>]=<span class="hljs-string">"formDir.submitted"</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"cross-validation"</span> [<span class="hljs-attr">class.cross-validation-error</span>]=<span class="hljs-string">"actorForm.hasError('unambiguousRole') &amp;&amp; (actorForm.touched || actorForm.dirty)"</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"name"</span>&gt;</span>Name<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span></span></div><div class="hljs-ln-line">                <span class="hljs-attr">formControlName</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">required</span>&gt;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"name.invalid &amp;&amp; (name.dirty || name.touched)"</span></span></div><div class="hljs-ln-line">              <span class="hljs-attr">class</span>=<span class="hljs-string">"alert alert-danger"</span>&gt;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"name.hasError('required')"</span>&gt;</span></div><div class="hljs-ln-line">              Name is required.</div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"name.hasError('minlength')"</span>&gt;</span></div><div class="hljs-ln-line">              Name must be at least 4 characters long.</div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"name.hasError('forbiddenName')"</span>&gt;</span></div><div class="hljs-ln-line">              Name cannot be Bob.</div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"role"</span>&gt;</span>Role<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"role"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span></span></div><div class="hljs-ln-line">              <span class="hljs-attr">formControlName</span>=<span class="hljs-string">"role"</span>&gt;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"role.pending"</span>&gt;</span>Validating...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"role.invalid"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"alert alert-danger role-errors"</span>&gt;</span></div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"role.hasError('uniqueRole')"</span>&gt;</span></div><div class="hljs-ln-line">              Role is already taken.</div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"actorForm.hasError('unambiguousRole') &amp;&amp; (actorForm.touched || actorForm.dirty)"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"cross-validation-error-message alert alert-danger"</span>&gt;</span></div><div class="hljs-ln-line">            Name cannot match role or audiences will be confused.</div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"skill"</span>&gt;</span>Skill<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"skill"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span></span></div><div class="hljs-ln-line">            <span class="hljs-attr">formControlName</span>=<span class="hljs-string">"skill"</span> <span class="hljs-attr">required</span>&gt;</div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> *<span class="hljs-attr">ngFor</span>=<span class="hljs-string">"let skill of skills"</span> [<span class="hljs-attr">value</span>]=<span class="hljs-string">"skill"</span>&gt;</span><span class="hljs-template-variable">{{ <span class="hljs-name">skill</span> }}</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"skill.invalid &amp;&amp; skill.touched"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"alert alert-danger"</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"skill.hasError('required')"</span>&gt;</span>Skill is required.<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Complete the form to enable the Submit button.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span></span></div><div class="hljs-ln-line">              <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-default"</span></div><div class="hljs-ln-line">              [<span class="hljs-attr">disabled</span>]=<span class="hljs-string">"actorForm.invalid"</span>&gt;Submit<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-default"</span></span></div><div class="hljs-ln-line">             (<span class="hljs-attr">click</span>)=<span class="hljs-string">"formDir.resetForm({})"</span>&gt;Reset<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></div><div class="hljs-ln-line">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"submitted-message"</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"formDir.submitted"</span>&gt;</span></div><div class="hljs-ln-line">    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>You've submitted your actor, <span class="hljs-template-variable">{{ <span class="hljs-name">actorForm.value.name</span> }}</span><span class="language-xml">!<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span></div><div class="hljs-ln-line">    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> (<span class="hljs-attr">click</span>)=<span class="hljs-string">"formDir.resetForm({})"</span>&gt;</span>Add new actor<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></div><div class="hljs-ln-line">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_ref_id="6x13cqb0pmaa34dtnnu5b3n5l">此 
<code>*ngIf</code> 显示错误，如果 
<code>FormGroup</code> 有由 
<code>unambiguousRoleValidator</code> 验证器返回的跨字段验证错误，但只有在用户完成
<a href="#control-status-css-classes">与表单交互</a>时。</p>

  <h3 id="adding-cross-validation-to-template-driven-forms">
    <a href="#adding-cross-validation-to-template-driven-forms" class="docs-anchor" tabindex="-1" aria-label="Link to Adding cross-validation to template-driven forms" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="befoa6xj926n609b9ihppm0hp">为模板驱动表单添加交叉验证</a>
  </h3>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="70kw9k97coda2uxvupx1wvcvl">对于模板驱动表单，必须创建一个指令来包装验证器函数。你将该指令提供为验证器，使用 
<a href="/api/forms/NG_VALIDATORS"><code>NG_VALIDATORS</code> 令牌</a>，如下例所示。</p>
<div class="docs-code" path="adev/src/content/examples/form-validation/src/app/shared/unambiguous-role.directive.ts" visiblelines="19,20,21,22,23,24,25,26,27,28,29" header="shared/unambiguous-role.directive.ts">
    <div class="docs-code-header"><h3>shared/unambiguous-role.directive.ts</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {Directive} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {</div><div class="hljs-ln-line">  AbstractControl,</div><div class="hljs-ln-line">  NG_VALIDATORS,</div><div class="hljs-ln-line">  ValidationErrors,</div><div class="hljs-ln-line">  <span class="hljs-keyword">Validator</span>,</div><div class="hljs-ln-line">  ValidatorFn,</div><div class="hljs-ln-line">} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/forms'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-comment">/** An actor's name can't match the actor's role */</span></div><div class="hljs-ln-line">export const unambiguousRoleValidator: ValidatorFn = (</div><div class="hljs-ln-line">  control: AbstractControl,</div><div class="hljs-ln-line">): ValidationErrors | <span class="hljs-keyword">null</span> =&gt; {</div><div class="hljs-ln-line">  const <span class="hljs-type">name</span> = control.<span class="hljs-keyword">get</span>(<span class="hljs-string">'name'</span>);</div><div class="hljs-ln-line">  const <span class="hljs-keyword">role</span> = control.<span class="hljs-keyword">get</span>(<span class="hljs-string">'role'</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-keyword">return</span> <span class="hljs-type">name</span> &amp;&amp; <span class="hljs-keyword">role</span> &amp;&amp; <span class="hljs-type">name</span>.<span class="hljs-keyword">value</span> === <span class="hljs-keyword">role</span>.<span class="hljs-keyword">value</span> ? {unambiguousRole: <span class="hljs-keyword">true</span>} : <span class="hljs-keyword">null</span>;</div><div class="hljs-ln-line">};</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">@Directive({</div><div class="hljs-ln-line">  selector: <span class="hljs-string">'[appUnambiguousRole]'</span>,</div><div class="hljs-ln-line">  providers: [</div><div class="hljs-ln-line">    {provide: NG_VALIDATORS, useExisting: UnambiguousRoleValidatorDirective, multi: <span class="hljs-keyword">true</span>},</div><div class="hljs-ln-line">  ],</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line">export <span class="hljs-keyword">class</span> UnambiguousRoleValidatorDirective implements <span class="hljs-keyword">Validator</span> {</div><div class="hljs-ln-line">  <span class="hljs-keyword">validate</span>(control: AbstractControl): ValidationErrors | <span class="hljs-keyword">null</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> unambiguousRoleValidator(control);</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="91evp1jl23mbsg0vnubaoumle">你必须把这个新指令添加到 HTML 模板中。由于验证器必须注册在表单的最高层，因此下列模板会把该指令放在 <code>form</code> 标签上。</p>
<div class="docs-code" path="adev/src/content/examples/form-validation/src/app/template/actor-form-template.component.html" visiblelines="3" header="template/actor-form-template.component.html">
    <div class="docs-code-header"><h3>template/actor-form-template.component.html</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Template-Driven Form<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></div><div class="hljs-ln-line">  <span class="hljs-tag">&lt;<span class="hljs-name">form</span> #<span class="hljs-attr">actorForm</span>=<span class="hljs-string">"ngForm"</span> <span class="hljs-attr">appUnambiguousRole</span>&gt;</span></div><div class="hljs-ln-line">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> [<span class="hljs-attr">hidden</span>]=<span class="hljs-string">"actorForm.submitted"</span>&gt;</span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"cross-validation"</span> [<span class="hljs-attr">class.cross-validation-error</span>]=<span class="hljs-string">"actorForm.hasError('unambiguousRole') &amp;&amp; (actorForm.touched || actorForm.dirty)"</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"name"</span>&gt;</span>Name<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span></span></div><div class="hljs-ln-line">                <span class="hljs-attr">required</span> <span class="hljs-attr">minlength</span>=<span class="hljs-string">"4"</span> <span class="hljs-attr">appForbiddenName</span>=<span class="hljs-string">"bob"</span></div><div class="hljs-ln-line">                [(<span class="hljs-attr">ngModel</span>)]=<span class="hljs-string">"actor.name"</span> #<span class="hljs-attr">name</span>=<span class="hljs-string">"ngModel"</span>&gt;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"name.invalid &amp;&amp; (name.dirty || name.touched)"</span></span></div><div class="hljs-ln-line">              <span class="hljs-attr">class</span>=<span class="hljs-string">"alert"</span>&gt;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"name.hasError('required')"</span>&gt;</span></div><div class="hljs-ln-line">              Name is required.</div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"name.hasError('minlength')"</span>&gt;</span></div><div class="hljs-ln-line">              Name must be at least 4 characters long.</div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"name.hasError('forbiddenName')"</span>&gt;</span></div><div class="hljs-ln-line">              Name cannot be Bob.</div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"role"</span>&gt;</span>Role<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span></span></div><div class="hljs-ln-line">                 <span class="hljs-attr">id</span>=<span class="hljs-string">"role"</span></div><div class="hljs-ln-line">                 <span class="hljs-attr">name</span>=<span class="hljs-string">"role"</span></div><div class="hljs-ln-line">                 #<span class="hljs-attr">role</span>=<span class="hljs-string">"ngModel"</span></div><div class="hljs-ln-line">                 [(<span class="hljs-attr">ngModel</span>)]=<span class="hljs-string">"actor.role"</span></div><div class="hljs-ln-line">                 [<span class="hljs-attr">ngModelOptions</span>]=<span class="hljs-string">"{ updateOn: 'blur' }"</span></div><div class="hljs-ln-line">                 <span class="hljs-attr">appUniqueRole</span>&gt;</div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"role.pending"</span>&gt;</span>Validating...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"role.invalid"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"alert role-errors"</span>&gt;</span></div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"role.hasError('uniqueRole')"</span>&gt;</span></div><div class="hljs-ln-line">              Role is already taken.</div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"actorForm.hasError('unambiguousRole') &amp;&amp; (actorForm.touched || actorForm.dirty)"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"cross-validation-error-message alert"</span>&gt;</span></div><div class="hljs-ln-line">            Name cannot match role.</div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"skill"</span>&gt;</span>Skill<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"skill"</span></span></div><div class="hljs-ln-line">                <span class="hljs-attr">name</span>=<span class="hljs-string">"skill"</span></div><div class="hljs-ln-line">                <span class="hljs-attr">required</span> [(<span class="hljs-attr">ngModel</span>)]=<span class="hljs-string">"actor.skill"</span></div><div class="hljs-ln-line">                #<span class="hljs-attr">skill</span>=<span class="hljs-string">"ngModel"</span>&gt;</div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> *<span class="hljs-attr">ngFor</span>=<span class="hljs-string">"let skill of skills"</span> [<span class="hljs-attr">value</span>]=<span class="hljs-string">"skill"</span>&gt;</span><span class="hljs-template-variable">{{ <span class="hljs-name">skill</span> }}</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"skill.errors &amp;&amp; skill.touched"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"alert"</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"skill.errors['required']"</span>&gt;</span>Power is required.<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Complete the form to enable the Submit button.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span></span></div><div class="hljs-ln-line">              [<span class="hljs-attr">disabled</span>]=<span class="hljs-string">"actorForm.invalid"</span>&gt;Submit<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span></span></div><div class="hljs-ln-line">              (<span class="hljs-attr">click</span>)=<span class="hljs-string">"actorForm.resetForm({})"</span>&gt;Reset<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></div><div class="hljs-ln-line">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"submitted-message"</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"actorForm.submitted"</span>&gt;</span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>You've submitted your actor, <span class="hljs-template-variable">{{ <span class="hljs-name">actorForm.value.name</span> }}</span><span class="language-xml">!<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> (<span class="hljs-attr">click</span>)=<span class="hljs-string">"actorForm.resetForm({})"</span>&gt;</span>Add new actor<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></div><div class="hljs-ln-line">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></div><div class="hljs-ln-line"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="5087lmja6dkip06nqjvsmxg54">为了提供更好的用户体验，当表单无效时，我们要显示一个恰当的错误信息。</p>
<div class="docs-code" path="adev/src/content/examples/form-validation/src/app/template/actor-form-template.component.html" visiblelines="45,46,47" header="template/actor-form-template.component.html">
    <div class="docs-code-header"><h3>template/actor-form-template.component.html</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Template-Driven Form<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></div><div class="hljs-ln-line">  <span class="hljs-tag">&lt;<span class="hljs-name">form</span> #<span class="hljs-attr">actorForm</span>=<span class="hljs-string">"ngForm"</span> <span class="hljs-attr">appUnambiguousRole</span>&gt;</span></div><div class="hljs-ln-line">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> [<span class="hljs-attr">hidden</span>]=<span class="hljs-string">"actorForm.submitted"</span>&gt;</span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"cross-validation"</span> [<span class="hljs-attr">class.cross-validation-error</span>]=<span class="hljs-string">"actorForm.hasError('unambiguousRole') &amp;&amp; (actorForm.touched || actorForm.dirty)"</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"name"</span>&gt;</span>Name<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span></span></div><div class="hljs-ln-line">                <span class="hljs-attr">required</span> <span class="hljs-attr">minlength</span>=<span class="hljs-string">"4"</span> <span class="hljs-attr">appForbiddenName</span>=<span class="hljs-string">"bob"</span></div><div class="hljs-ln-line">                [(<span class="hljs-attr">ngModel</span>)]=<span class="hljs-string">"actor.name"</span> #<span class="hljs-attr">name</span>=<span class="hljs-string">"ngModel"</span>&gt;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"name.invalid &amp;&amp; (name.dirty || name.touched)"</span></span></div><div class="hljs-ln-line">              <span class="hljs-attr">class</span>=<span class="hljs-string">"alert"</span>&gt;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"name.hasError('required')"</span>&gt;</span></div><div class="hljs-ln-line">              Name is required.</div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"name.hasError('minlength')"</span>&gt;</span></div><div class="hljs-ln-line">              Name must be at least 4 characters long.</div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"name.hasError('forbiddenName')"</span>&gt;</span></div><div class="hljs-ln-line">              Name cannot be Bob.</div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"role"</span>&gt;</span>Role<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span></span></div><div class="hljs-ln-line">                 <span class="hljs-attr">id</span>=<span class="hljs-string">"role"</span></div><div class="hljs-ln-line">                 <span class="hljs-attr">name</span>=<span class="hljs-string">"role"</span></div><div class="hljs-ln-line">                 #<span class="hljs-attr">role</span>=<span class="hljs-string">"ngModel"</span></div><div class="hljs-ln-line">                 [(<span class="hljs-attr">ngModel</span>)]=<span class="hljs-string">"actor.role"</span></div><div class="hljs-ln-line">                 [<span class="hljs-attr">ngModelOptions</span>]=<span class="hljs-string">"{ updateOn: 'blur' }"</span></div><div class="hljs-ln-line">                 <span class="hljs-attr">appUniqueRole</span>&gt;</div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"role.pending"</span>&gt;</span>Validating...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"role.invalid"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"alert role-errors"</span>&gt;</span></div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"role.hasError('uniqueRole')"</span>&gt;</span></div><div class="hljs-ln-line">              Role is already taken.</div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"actorForm.hasError('unambiguousRole') &amp;&amp; (actorForm.touched || actorForm.dirty)"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"cross-validation-error-message alert"</span>&gt;</span></div><div class="hljs-ln-line">            Name cannot match role.</div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"skill"</span>&gt;</span>Skill<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"skill"</span></span></div><div class="hljs-ln-line">                <span class="hljs-attr">name</span>=<span class="hljs-string">"skill"</span></div><div class="hljs-ln-line">                <span class="hljs-attr">required</span> [(<span class="hljs-attr">ngModel</span>)]=<span class="hljs-string">"actor.skill"</span></div><div class="hljs-ln-line">                #<span class="hljs-attr">skill</span>=<span class="hljs-string">"ngModel"</span>&gt;</div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> *<span class="hljs-attr">ngFor</span>=<span class="hljs-string">"let skill of skills"</span> [<span class="hljs-attr">value</span>]=<span class="hljs-string">"skill"</span>&gt;</span><span class="hljs-template-variable">{{ <span class="hljs-name">skill</span> }}</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"skill.errors &amp;&amp; skill.touched"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"alert"</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"skill.errors['required']"</span>&gt;</span>Power is required.<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Complete the form to enable the Submit button.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span></span></div><div class="hljs-ln-line">              [<span class="hljs-attr">disabled</span>]=<span class="hljs-string">"actorForm.invalid"</span>&gt;Submit<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span></span></div><div class="hljs-ln-line">              (<span class="hljs-attr">click</span>)=<span class="hljs-string">"actorForm.resetForm({})"</span>&gt;Reset<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></div><div class="hljs-ln-line">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"submitted-message"</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"actorForm.submitted"</span>&gt;</span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>You've submitted your actor, <span class="hljs-template-variable">{{ <span class="hljs-name">actorForm.value.name</span> }}</span><span class="language-xml">!<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> (<span class="hljs-attr">click</span>)=<span class="hljs-string">"actorForm.resetForm({})"</span>&gt;</span>Add new actor<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></div><div class="hljs-ln-line">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></div><div class="hljs-ln-line"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="1uckgqpdzo61c0amns3msb668">这在模板驱动表单和响应式表单中都是一样的。</p>

  <h2 id="creating-asynchronous-validators">
    <a href="#creating-asynchronous-validators" class="docs-anchor" tabindex="-1" aria-label="Link to Creating asynchronous validators" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="ab360yrsxcqh7wvgxltku3obb">创建异步验证器</a>
  </h2>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="2xu4jo0cs5gf0gutw09ecai1t">异步验证器实现了 
<code>AsyncValidatorFn</code> 和 
<code>AsyncValidator</code> 接口。 这些与它们的同步对应物非常相似，但有以下区别。</p>

  <ul class="docs-list">
    <li data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="5ftz9vjrnff3ebgdby4720mm6"><code>validate()</code> 函数必须返回一个 Promise 或可观察者，</li>
<li data-ng_translator_product="100" data-ng_translator_ref_id="4q86w1bm9y7r5ula74b8uv5na">返回的可观察者必须是有限的，这意味着它必须在某个时刻完成。 要将一个无限可观察者转换为有限的，可以通过过滤操作符（如 
<code>first</code>、
<code>last</code>、
<code>take</code> 或 
<code>takeUntil</code>）管道化该可观察者。</li>

  </ul>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="2jun0frqvwdnfpf4bhv531ypz">异步验证在同步验证完成后才会发生，并且只有在同步验证成功时才会执行。如果更基本的验证方法已经发现了无效输入，那么这种检查顺序就可以让表单避免使用昂贵的异步验证流程（比如 HTTP 请求）。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="3peq983pp18xyzuiowvngqcz4">异步验证开始之后，表单控件就会进入 <code>pending</code> 状态。可以检查控件的 <code>pending</code> 属性，并用它来给出对验证中的视觉反馈。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="4o3u25dd0vxfoalvtyht6n0vf">一种常见的 UI 模式是在执行异步验证时显示 Spinner（转轮）。下面的例子展示了如何在模板驱动表单中实现这一点。</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> [(<span class="hljs-attr">ngModel</span>)]=<span class="hljs-string">"name"</span> #<span class="hljs-attr">model</span>=<span class="hljs-string">"ngModel"</span> <span class="hljs-attr">appSomeAsyncValidator</span>&gt;</span></div><div class="hljs-ln-line"><span class="hljs-tag">&lt;<span class="hljs-name">app-spinner</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"model.pending"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">app-spinner</span>&gt;</span></div></code>
    </pre>
  </div>
  <h3 id="implementing-a-custom-async-validator">
    <a href="#implementing-a-custom-async-validator" class="docs-anchor" tabindex="-1" aria-label="Link to Implementing a custom async validator" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="43u236xu5itxwr6kvoyjpvapr">实现自定义异步验证器</a>
  </h3>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="5bm9dazow3k4fzs04pzh7ylxv">在以下示例中，异步验证器确保为某个角色选定的演员没有被之前选定。 新演员不断地试镜，旧演员则不断退休，因此无法提前获取可用角色的列表。 为了验证潜在的角色条目，验证器必须启动一个异步操作来查询当前所有已选演员的中央数据库。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="9a4zaj9nkekh541dgw8ljo0ou">以下代码创建了验证器类 
<code>UniqueRoleValidator</code>，它实现了 
<code>AsyncValidator</code> 接口。</p>
<div class="docs-code" path="adev/src/content/examples/form-validation/src/app/shared/role.directive.ts" visiblelines="11,12,13,14,15,16,17,18,19,20,21">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">Directive</span>, forwardRef, <span class="hljs-title class_">Injectable</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {</div><div class="hljs-ln-line">  <span class="hljs-title class_">AsyncValidator</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">AbstractControl</span>,</div><div class="hljs-ln-line">  <span class="hljs-variable constant_">NG_ASYNC_VALIDATORS</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">ValidationErrors</span>,</div><div class="hljs-ln-line">} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/forms'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {catchError, map} <span class="hljs-keyword">from</span> <span class="hljs-string">'rxjs/operators'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">ActorsService</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'./actors.service'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">Observable</span>, <span class="hljs-keyword">of</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'rxjs'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Injectable</span>({<span class="hljs-attr">providedIn</span>: <span class="hljs-string">'root'</span>})</div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UniqueRoleValidator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AsyncValidator</span> {</div><div class="hljs-ln-line">  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> actorsService: ActorsService</span>) {}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">validate</span>(<span class="hljs-attr">control</span>: <span class="hljs-title class_">AbstractControl</span>): <span class="hljs-title class_">Observable</span>&lt;<span class="hljs-title class_">ValidationErrors</span> | <span class="hljs-literal">null</span>&gt; {</div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">actorsService</span>.<span class="hljs-title function_">isRoleTaken</span>(control.<span class="hljs-property">value</span>).<span class="hljs-title function_">pipe</span>(</div><div class="hljs-ln-line">      <span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">isTaken</span>) =&gt;</span> (isTaken ? {<span class="hljs-attr">uniqueRole</span>: <span class="hljs-literal">true</span>} : <span class="hljs-literal">null</span>)),</div><div class="hljs-ln-line">      <span class="hljs-title function_">catchError</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">of</span>(<span class="hljs-literal">null</span>)),</div><div class="hljs-ln-line">    );</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Directive</span>({</div><div class="hljs-ln-line">  <span class="hljs-attr">selector</span>: <span class="hljs-string">'[appUniqueRole]'</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">providers</span>: [</div><div class="hljs-ln-line">    {</div><div class="hljs-ln-line">      <span class="hljs-attr">provide</span>: <span class="hljs-variable constant_">NG_ASYNC_VALIDATORS</span>,</div><div class="hljs-ln-line">      <span class="hljs-attr">useExisting</span>: <span class="hljs-title function_">forwardRef</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">UniqueRoleValidatorDirective</span>),</div><div class="hljs-ln-line">      <span class="hljs-attr">multi</span>: <span class="hljs-literal">true</span>,</div><div class="hljs-ln-line">    },</div><div class="hljs-ln-line">  ],</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UniqueRoleValidatorDirective</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AsyncValidator</span> {</div><div class="hljs-ln-line">  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> validator: UniqueRoleValidator</span>) {}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">validate</span>(<span class="hljs-attr">control</span>: <span class="hljs-title class_">AbstractControl</span>): <span class="hljs-title class_">Observable</span>&lt;<span class="hljs-title class_">ValidationErrors</span> | <span class="hljs-literal">null</span>&gt; {</div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">validator</span>.<span class="hljs-title function_">validate</span>(control);</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_ref_id="3vqdm0watk31n0313n806bqru">构造函数注入了 
<code>ActorsService</code>，该服务定义了如下接口。</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ActorsService</span> {</div><div class="hljs-ln-line">  <span class="hljs-attr">isRoleTaken</span>: <span class="hljs-function">(<span class="hljs-params">role: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-title class_">Observable</span>&lt;<span class="hljs-built_in">boolean</span>&gt;;</div><div class="hljs-ln-line">}</div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_ref_id="dazm2mrogejtb6ks1lamm8fa9">在实际的应用中，
<code>ActorsService</code> 将负责向演员数据库发出 HTTP 请求，以检查该角色是否可用。 从验证器的角度来看，服务的实际实现并不重要，因此示例代码只需针对 
<code>ActorsService</code> 接口编写即可。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="6xmkxqt8uqju35tif23c0u0f0">验证开始时，
<code>UnambiguousRoleValidator</code> 将当前控件值委托给 
<code>ActorsService</code> 的 
<code>isRoleTaken()</code> 方法。 此时控件被标记为 
<code>pending</code>，并保持此状态，直到 
<code>validate()</code> 方法返回的可观察者链完成。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="111fznsn8170aqsrg6w2kqsyn"><code>isRoleTaken()</code> 方法派发一个 HTTP 请求，检查该角色是否可用，并返回 
<code>Observable&lt;boolean&gt;</code> 作为结果。 
<code>validate()</code> 方法通过 
<code>map</code> 操作符管道化响应，并将其转换为验证结果。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="25yxvk50l3ptcv7rki0xu0g3e">然后，该方法像任何验证器一样，如果表单有效则返回 
<code>null</code>，否则返回 
<code>ValidationErrors</code>。 此验证器使用 
<code>catchError</code> 操作符处理任何潜在的错误。 在这种情况下，验证器将 
<code>isRoleTaken()</code> 错误视为成功验证，因为验证请求失败并不一定意味着该角色无效。 你可以不同地处理错误并返回 
<code>ValidationError</code> 对象。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="9djywv3wtg6bnwezi8hd0auuo">一段时间过后，这条可观察者链完成，异步验证也就完成了。<code>pending</code> 标志位也设置为 <code>false</code>，该表单的有效性也已更新。</p>

  <h3 id="adding-async-validators-to-reactive-forms">
    <a href="#adding-async-validators-to-reactive-forms" class="docs-anchor" tabindex="-1" aria-label="Link to Adding async validators to reactive forms" data-ng_translator_product="100" data-ng_translator_ref_id="cdo4hz1rwj9fkis2lh110nucl">将异步验证器添加到响应式表单</a>
  </h3>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="66wmkr0y8vof68v67dym7nd4n">要以响应式表单使用异步验证器，请首先将验证器注入组件类的构造函数。</p>
<div class="docs-code" path="adev/src/content/examples/form-validation/src/app/reactive/actor-form-reactive.component.2.ts" visiblelines="47">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {Component, OnInit} from <span class="hljs-string">'@angular/core'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {FormControl, FormGroup, Validators} from <span class="hljs-string">'@angular/forms'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {forbiddenNameValidator} from <span class="hljs-string">'../shared/forbidden-name.directive'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {UniqueRoleValidator} from <span class="hljs-string">'../shared/role.directive'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component({</span></div><div class="hljs-ln-line">  selector: <span class="hljs-string">'app-actor-form-reactive'</span>,</div><div class="hljs-ln-line">  templateUrl: <span class="hljs-string">'./actor-form-reactive.component.html'</span>,</div><div class="hljs-ln-line">  styleUrls: [<span class="hljs-string">'./actor-form-reactive.component.css'</span>],</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line">export <span class="hljs-keyword">class</span> <span class="hljs-title class_">HeroFormReactiveComponent</span> <span class="hljs-title">implements</span> <span class="hljs-title">OnInit</span> {</div><div class="hljs-ln-line">  skills = [<span class="hljs-string">'Method Acting'</span>, <span class="hljs-string">'Singing'</span>, <span class="hljs-string">'Dancing'</span>, <span class="hljs-string">'Swordfighting'</span>];</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  actor = {name: <span class="hljs-string">'Tom Cruise'</span>, role: <span class="hljs-string">'Romeo'</span>, skill: <span class="hljs-keyword">this</span>.skills[<span class="hljs-number">3</span>]};</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  actorForm!: FormGroup;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  ngOnInit(): void {</div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> roleControl = new FormControl(<span class="hljs-string">''</span>, {</div><div class="hljs-ln-line">      asyncValidators: [<span class="hljs-keyword">this</span>.roleValidator.validate.bind(<span class="hljs-keyword">this</span>.roleValidator)],</div><div class="hljs-ln-line">      updateOn: <span class="hljs-string">'blur'</span>,</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">    roleControl.setValue(<span class="hljs-keyword">this</span>.actor.role);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">this</span>.actorForm = new FormGroup({</div><div class="hljs-ln-line">      name: new FormControl(<span class="hljs-keyword">this</span>.actor.name, [</div><div class="hljs-ln-line">        Validators.required,</div><div class="hljs-ln-line">        Validators.minLength(<span class="hljs-number">4</span>),</div><div class="hljs-ln-line">        forbiddenNameValidator(/bob/i),</div><div class="hljs-ln-line">      ]),</div><div class="hljs-ln-line">      role: roleControl,</div><div class="hljs-ln-line">      skill: new FormControl(<span class="hljs-keyword">this</span>.actor.skill, Validators.required),</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-keyword">get</span> name() {</div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.actorForm.<span class="hljs-keyword">get</span>(<span class="hljs-string">'name'</span>);</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-keyword">get</span> skill() {</div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.actorForm.<span class="hljs-keyword">get</span>(<span class="hljs-string">'skill'</span>);</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-keyword">get</span> role() {</div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.actorForm.<span class="hljs-keyword">get</span>(<span class="hljs-string">'role'</span>);</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-keyword">constructor</span>(<span class="hljs-keyword">private</span> roleValidator: UniqueRoleValidator) {}</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_ref_id="e4safe2gtnprfqotjax1bgyvl">然后，将验证函数直接传递给 
<code>FormControl</code> 以应用它。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="9hk4z9hs930du5y7hd9jipz4f">在以下示例中，通过将 
<code>UnambiguousRoleValidator</code> 的 
<code>validate</code> 函数传递给控件的 
<code>asyncValidators</code> 选项，并将其绑定到注入 
<code>ActorFormReactiveComponent</code> 的 
<code>UnambiguousRoleValidator</code> 实例，来将其应用于 
<code>roleControl</code>。 
<code>asyncValidators</code> 的值可以是单个异步验证函数，也可以是多个函数的数组。 要了解更多关于 
<code>FormControl</code> 选项的信息，请参阅 
<a href="api/forms/AbstractControlOptions">AbstractControlOptions</a> API 参考。</p>
<div class="docs-code" path="adev/src/content/examples/form-validation/src/app/reactive/actor-form-reactive.component.2.ts" visiblelines="18,19,20,21">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {Component, OnInit} from <span class="hljs-string">'@angular/core'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {FormControl, FormGroup, Validators} from <span class="hljs-string">'@angular/forms'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {forbiddenNameValidator} from <span class="hljs-string">'../shared/forbidden-name.directive'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {UniqueRoleValidator} from <span class="hljs-string">'../shared/role.directive'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Component({</span></div><div class="hljs-ln-line">  selector: <span class="hljs-string">'app-actor-form-reactive'</span>,</div><div class="hljs-ln-line">  templateUrl: <span class="hljs-string">'./actor-form-reactive.component.html'</span>,</div><div class="hljs-ln-line">  styleUrls: [<span class="hljs-string">'./actor-form-reactive.component.css'</span>],</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line">export <span class="hljs-keyword">class</span> <span class="hljs-title class_">HeroFormReactiveComponent</span> <span class="hljs-title">implements</span> <span class="hljs-title">OnInit</span> {</div><div class="hljs-ln-line">  skills = [<span class="hljs-string">'Method Acting'</span>, <span class="hljs-string">'Singing'</span>, <span class="hljs-string">'Dancing'</span>, <span class="hljs-string">'Swordfighting'</span>];</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  actor = {name: <span class="hljs-string">'Tom Cruise'</span>, role: <span class="hljs-string">'Romeo'</span>, skill: <span class="hljs-keyword">this</span>.skills[<span class="hljs-number">3</span>]};</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  actorForm!: FormGroup;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  ngOnInit(): void {</div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> roleControl = new FormControl(<span class="hljs-string">''</span>, {</div><div class="hljs-ln-line">      asyncValidators: [<span class="hljs-keyword">this</span>.roleValidator.validate.bind(<span class="hljs-keyword">this</span>.roleValidator)],</div><div class="hljs-ln-line">      updateOn: <span class="hljs-string">'blur'</span>,</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">    roleControl.setValue(<span class="hljs-keyword">this</span>.actor.role);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">this</span>.actorForm = new FormGroup({</div><div class="hljs-ln-line">      name: new FormControl(<span class="hljs-keyword">this</span>.actor.name, [</div><div class="hljs-ln-line">        Validators.required,</div><div class="hljs-ln-line">        Validators.minLength(<span class="hljs-number">4</span>),</div><div class="hljs-ln-line">        forbiddenNameValidator(/bob/i),</div><div class="hljs-ln-line">      ]),</div><div class="hljs-ln-line">      role: roleControl,</div><div class="hljs-ln-line">      skill: new FormControl(<span class="hljs-keyword">this</span>.actor.skill, Validators.required),</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-keyword">get</span> name() {</div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.actorForm.<span class="hljs-keyword">get</span>(<span class="hljs-string">'name'</span>);</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-keyword">get</span> skill() {</div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.actorForm.<span class="hljs-keyword">get</span>(<span class="hljs-string">'skill'</span>);</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-keyword">get</span> role() {</div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.actorForm.<span class="hljs-keyword">get</span>(<span class="hljs-string">'role'</span>);</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-keyword">constructor</span>(<span class="hljs-keyword">private</span> roleValidator: UniqueRoleValidator) {}</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div>
  <h3 id="adding-async-validators-to-template-driven-forms">
    <a href="#adding-async-validators-to-template-driven-forms" class="docs-anchor" tabindex="-1" aria-label="Link to Adding async validators to template-driven forms" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="7x6cdftbus1shbq2sd7gj02qy">将异步验证器添加到模板驱动表单</a>
  </h3>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="8hhr66lokxplr632ndjcx597u">要在模板驱动表单中使用异步验证器，创建一个新指令并在其上注册 
<code>NG_ASYNC_VALIDATORS</code> 提供者。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="eoc1wo6vtoxxl2ol4422mpfed">在下面的示例中，该指令注入了包含实际验证逻辑的 
<code>UniqueRoleValidator</code> 类，并在 
<code>validate</code> 函数中调用它，由 Angular 在应该进行验证时触发。</p>
<div class="docs-code" path="adev/src/content/examples/form-validation/src/app/shared/role.directive.ts" visiblelines="23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">Directive</span>, forwardRef, <span class="hljs-title class_">Injectable</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {</div><div class="hljs-ln-line">  <span class="hljs-title class_">AsyncValidator</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">AbstractControl</span>,</div><div class="hljs-ln-line">  <span class="hljs-variable constant_">NG_ASYNC_VALIDATORS</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">ValidationErrors</span>,</div><div class="hljs-ln-line">} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/forms'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {catchError, map} <span class="hljs-keyword">from</span> <span class="hljs-string">'rxjs/operators'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">ActorsService</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'./actors.service'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">Observable</span>, <span class="hljs-keyword">of</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'rxjs'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Injectable</span>({<span class="hljs-attr">providedIn</span>: <span class="hljs-string">'root'</span>})</div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UniqueRoleValidator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AsyncValidator</span> {</div><div class="hljs-ln-line">  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> actorsService: ActorsService</span>) {}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">validate</span>(<span class="hljs-attr">control</span>: <span class="hljs-title class_">AbstractControl</span>): <span class="hljs-title class_">Observable</span>&lt;<span class="hljs-title class_">ValidationErrors</span> | <span class="hljs-literal">null</span>&gt; {</div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">actorsService</span>.<span class="hljs-title function_">isRoleTaken</span>(control.<span class="hljs-property">value</span>).<span class="hljs-title function_">pipe</span>(</div><div class="hljs-ln-line">      <span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">isTaken</span>) =&gt;</span> (isTaken ? {<span class="hljs-attr">uniqueRole</span>: <span class="hljs-literal">true</span>} : <span class="hljs-literal">null</span>)),</div><div class="hljs-ln-line">      <span class="hljs-title function_">catchError</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">of</span>(<span class="hljs-literal">null</span>)),</div><div class="hljs-ln-line">    );</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-meta">@Directive</span>({</div><div class="hljs-ln-line">  <span class="hljs-attr">selector</span>: <span class="hljs-string">'[appUniqueRole]'</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">providers</span>: [</div><div class="hljs-ln-line">    {</div><div class="hljs-ln-line">      <span class="hljs-attr">provide</span>: <span class="hljs-variable constant_">NG_ASYNC_VALIDATORS</span>,</div><div class="hljs-ln-line">      <span class="hljs-attr">useExisting</span>: <span class="hljs-title function_">forwardRef</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">UniqueRoleValidatorDirective</span>),</div><div class="hljs-ln-line">      <span class="hljs-attr">multi</span>: <span class="hljs-literal">true</span>,</div><div class="hljs-ln-line">    },</div><div class="hljs-ln-line">  ],</div><div class="hljs-ln-line">})</div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UniqueRoleValidatorDirective</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AsyncValidator</span> {</div><div class="hljs-ln-line">  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> validator: UniqueRoleValidator</span>) {}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">validate</span>(<span class="hljs-attr">control</span>: <span class="hljs-title class_">AbstractControl</span>): <span class="hljs-title class_">Observable</span>&lt;<span class="hljs-title class_">ValidationErrors</span> | <span class="hljs-literal">null</span>&gt; {</div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">validator</span>.<span class="hljs-title function_">validate</span>(control);</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="66wd5dgdz0xtmeua4csg4ujp5">然后，与使用同步验证器一样，将指令的选择器添加到输入以激活它。</p>
<div class="docs-code" path="adev/src/content/examples/form-validation/src/app/template/actor-form-template.component.html" visiblelines="30,31,32,33,34,35,36" header="template/actor-form-template.component.html (unique-unambiguous-role-input)">
    <div class="docs-code-header"><h3>template/actor-form-template.component.html (unique-unambiguous-role-input)</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Template-Driven Form<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></div><div class="hljs-ln-line">  <span class="hljs-tag">&lt;<span class="hljs-name">form</span> #<span class="hljs-attr">actorForm</span>=<span class="hljs-string">"ngForm"</span> <span class="hljs-attr">appUnambiguousRole</span>&gt;</span></div><div class="hljs-ln-line">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> [<span class="hljs-attr">hidden</span>]=<span class="hljs-string">"actorForm.submitted"</span>&gt;</span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"cross-validation"</span> [<span class="hljs-attr">class.cross-validation-error</span>]=<span class="hljs-string">"actorForm.hasError('unambiguousRole') &amp;&amp; (actorForm.touched || actorForm.dirty)"</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"name"</span>&gt;</span>Name<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span></span></div><div class="hljs-ln-line">                <span class="hljs-attr">required</span> <span class="hljs-attr">minlength</span>=<span class="hljs-string">"4"</span> <span class="hljs-attr">appForbiddenName</span>=<span class="hljs-string">"bob"</span></div><div class="hljs-ln-line">                [(<span class="hljs-attr">ngModel</span>)]=<span class="hljs-string">"actor.name"</span> #<span class="hljs-attr">name</span>=<span class="hljs-string">"ngModel"</span>&gt;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"name.invalid &amp;&amp; (name.dirty || name.touched)"</span></span></div><div class="hljs-ln-line">              <span class="hljs-attr">class</span>=<span class="hljs-string">"alert"</span>&gt;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"name.hasError('required')"</span>&gt;</span></div><div class="hljs-ln-line">              Name is required.</div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"name.hasError('minlength')"</span>&gt;</span></div><div class="hljs-ln-line">              Name must be at least 4 characters long.</div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"name.hasError('forbiddenName')"</span>&gt;</span></div><div class="hljs-ln-line">              Name cannot be Bob.</div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"role"</span>&gt;</span>Role<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span></span></div><div class="hljs-ln-line">                 <span class="hljs-attr">id</span>=<span class="hljs-string">"role"</span></div><div class="hljs-ln-line">                 <span class="hljs-attr">name</span>=<span class="hljs-string">"role"</span></div><div class="hljs-ln-line">                 #<span class="hljs-attr">role</span>=<span class="hljs-string">"ngModel"</span></div><div class="hljs-ln-line">                 [(<span class="hljs-attr">ngModel</span>)]=<span class="hljs-string">"actor.role"</span></div><div class="hljs-ln-line">                 [<span class="hljs-attr">ngModelOptions</span>]=<span class="hljs-string">"{ updateOn: 'blur' }"</span></div><div class="hljs-ln-line">                 <span class="hljs-attr">appUniqueRole</span>&gt;</div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"role.pending"</span>&gt;</span>Validating...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"role.invalid"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"alert role-errors"</span>&gt;</span></div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"role.hasError('uniqueRole')"</span>&gt;</span></div><div class="hljs-ln-line">              Role is already taken.</div><div class="hljs-ln-line">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"actorForm.hasError('unambiguousRole') &amp;&amp; (actorForm.touched || actorForm.dirty)"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"cross-validation-error-message alert"</span>&gt;</span></div><div class="hljs-ln-line">            Name cannot match role.</div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"skill"</span>&gt;</span>Skill<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"skill"</span></span></div><div class="hljs-ln-line">                <span class="hljs-attr">name</span>=<span class="hljs-string">"skill"</span></div><div class="hljs-ln-line">                <span class="hljs-attr">required</span> [(<span class="hljs-attr">ngModel</span>)]=<span class="hljs-string">"actor.skill"</span></div><div class="hljs-ln-line">                #<span class="hljs-attr">skill</span>=<span class="hljs-string">"ngModel"</span>&gt;</div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> *<span class="hljs-attr">ngFor</span>=<span class="hljs-string">"let skill of skills"</span> [<span class="hljs-attr">value</span>]=<span class="hljs-string">"skill"</span>&gt;</span><span class="hljs-template-variable">{{ <span class="hljs-name">skill</span> }}</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"skill.errors &amp;&amp; skill.touched"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"alert"</span>&gt;</span></div><div class="hljs-ln-line">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"skill.errors['required']"</span>&gt;</span>Power is required.<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Complete the form to enable the Submit button.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span></span></div><div class="hljs-ln-line">              [<span class="hljs-attr">disabled</span>]=<span class="hljs-string">"actorForm.invalid"</span>&gt;Submit<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span></span></div><div class="hljs-ln-line">              (<span class="hljs-attr">click</span>)=<span class="hljs-string">"actorForm.resetForm({})"</span>&gt;Reset<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></div><div class="hljs-ln-line">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"submitted-message"</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"actorForm.submitted"</span>&gt;</span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>You've submitted your actor, <span class="hljs-template-variable">{{ <span class="hljs-name">actorForm.value.name</span> }}</span><span class="language-xml">!<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span></div><div class="hljs-ln-line">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> (<span class="hljs-attr">click</span>)=<span class="hljs-string">"actorForm.resetForm({})"</span>&gt;</span>Add new actor<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></div><div class="hljs-ln-line">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line">  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></div><div class="hljs-ln-line"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="hljs-ln-line"></div></code>
    </pre>
  </div>
  <h3 id="optimizing-performance-of-async-validators">
    <a href="#optimizing-performance-of-async-validators" class="docs-anchor" tabindex="-1" aria-label="Link to Optimizing performance of async validators" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="gj9ccjmjj25izq58bzsqxsej">优化异步验证器的性能</a>
  </h3>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="bvj9tyk4rcpl1rr5f10zt9avw">默认情况下，所有验证程序在每次表单值更改后都会运行。对于同步验证器，这通常不会对应用性能产生明显的影响。但是，异步验证器通常会执行某种 HTTP 请求来验证控件。每次按键后调度一次 HTTP 请求都会给后端 API 带来压力，应该尽可能避免。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="btfh38009s8ww1b56in132hh6">你可以把 <code>updateOn</code> 属性从 <code>change</code>（默认值）改成 <code>submit</code> 或 <code>blur</code> 来推迟表单验证的更新时机。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="4cz1gu9jz2tzatsiijygcbz0j">使用模板驱动表单时，可以在模板中设置该属性。</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> [(<span class="hljs-attr">ngModel</span>)]=<span class="hljs-string">"name"</span> [<span class="hljs-attr">ngModelOptions</span>]=<span class="hljs-string">"{updateOn: 'blur'}"</span>&gt;</span></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_ref_id="cx8h60f6n56xdlhcz5cik12i5">对于响应式表单，在 
<code>FormControl</code> 实例中设置该属性。</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">new</span> <span class="hljs-title class_">FormControl</span>(<span class="hljs-string">''</span>, {<span class="hljs-attr">updateOn</span>: <span class="hljs-string">'blur'</span>});</div></code>
    </pre>
  </div>
  <h2 id="interaction-with-native-html-form-validation">
    <a href="#interaction-with-native-html-form-validation" class="docs-anchor" tabindex="-1" aria-label="Link to Interaction with native HTML form validation" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="cb8jvh5r2sjl3l5n1nk0bgxs3">与原生 HTML 表单验证器交互</a>
  </h2>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="1i5ps0d92kxil54kn3k1x0ngk">默认情况下，Angular 通过在封闭的 
<code>&lt;form&gt;</code> 上添加 
<code>novalidate</code> 属性来禁用
<a href="https://developer.mozilla.org/docs/Web/Guide/HTML/Constraint_validation" target="_blank">原生 HTML 表单验证</a>，并使用指令将这些属性与框架中的验证器函数匹配。如果你想将原生验证
<strong>与</strong>基于 Angular 的验证结合使用，可以通过 
<code>ngNativeValidate</code> 指令重新启用它。详见
<a href="api/forms/NgForm#native-dom-validation-ui">API 文档</a>。</p>
