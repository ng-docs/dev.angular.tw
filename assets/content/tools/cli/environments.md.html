<header class="docs-header">
      <docs-breadcrumb></docs-breadcrumb>

      
  <!-- Page title -->
  <div class="docs-page-title">
    <h1 tabindex="-1" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="4ma6kdja1brkmk7k888c0uj86">配置应用环境</h1>
    <a class="docs-github-links" target="_blank" href="https://github.com/angular/angular/edit/main/adev/src/content/tools/cli/environments.md" title="Edit this page" aria-label="Edit this page">
      <!-- Pencil -->
      <docs-icon role="presentation">edit</docs-icon>
    </a>
  </div>
    </header>
    <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="72k4p493u1zq6xuh66dum2lx8">你可以为项目定义不同的命名构建配置，例如 <code>development</code> 和 <code>staging</code>，具有不同的默认值。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="cd2pn37lnpw2e6m8ghwdkk3je">每个命名配置都可以为各个构建目标提供默认值，例如
<code>build</code>、
<code>serve</code>和
<code>test</code>。然后，
<a href="tools/cli">Angular CLI</a>的
<code>build</code>、
<code>serve</code>和
<code>test</code>命令可以替换文件，以适应目标环境。</p>

  <h2 id="angular-cli-configurations">
    <a href="#angular-cli-configurations" class="docs-anchor" tabindex="-1" aria-label="Link to Angular CLI configurations" data-ng_translator_product="100" data-ng_translator_ref_id="5cs39khnyv3jtdrksqvfqzujg">Angular CLI 配置</a>
  </h2>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="seabs7ce51ro1p3gobjq4440">Angular CLI 构建器支持一个
<code>configurations</code>对象，允许根据命令行提供的配置覆盖构建器的特定选项。</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">  <span class="hljs-attr">"projects"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">    <span class="hljs-attr">"my-app"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">      <span class="hljs-attr">"architect"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">        <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">          <span class="hljs-attr">"builder"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"@angular-devkit/build-angular:browser"</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">          <span class="hljs-attr">"options"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">            <span class="hljs-comment">// By default, disable source map generation.</span></div><div class="hljs-ln-line">            <span class="hljs-attr">"sourceMap"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span></div><div class="hljs-ln-line">          <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">          <span class="hljs-attr">"configurations"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">            <span class="hljs-comment">// For the `debug` configuration, enable source maps.</span></div><div class="hljs-ln-line">            <span class="hljs-attr">"debug"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">              <span class="hljs-attr">"sourceMap"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span></div><div class="hljs-ln-line">            <span class="hljs-punctuation">}</span></div><div class="hljs-ln-line">          <span class="hljs-punctuation">}</span></div><div class="hljs-ln-line">        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">        …</div><div class="hljs-ln-line">      <span class="hljs-punctuation">}</span></div><div class="hljs-ln-line">    <span class="hljs-punctuation">}</span></div><div class="hljs-ln-line">  <span class="hljs-punctuation">}</span></div><div class="hljs-ln-line"><span class="hljs-punctuation">}</span></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_ref_id="3b6290fbo3vrm167stv7r7fcu">你可以使用
<code>--configuration</code>选项选择要使用的配置。</p>
<div class="docs-code shell">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line">ng build --configuration debug</div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_ref_id="8o617mtggo0aqclrdout4xdi9">配置可以应用于任何 Angular CLI 构建器。可以使用逗号分隔符指定多个配置。配置按顺序应用，具有冲突选项的值取自最后一个配置。</p>
<div class="docs-code shell">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line">ng build --configuration debug,production,customer-facing</div></code>
    </pre>
  </div>
  <h2 id="configure-environment-specific-defaults">
    <a href="#configure-environment-specific-defaults" class="docs-anchor" tabindex="-1" aria-label="Link to Configure environment-specific defaults" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="bduetr5d2s7esxw285ejrymc6">配置针对特定环境的默认值</a>
  </h2>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="9prn2shff1o4qn95yaz4uk9b6"><code>@angular-devkit/build-angular:browser</code>支持文件替换功能，一种在执行构建之前替换源文件的选项。结合
<code>--configuration</code>使用，可以为你的应用配置环境特定数据提供一种机制。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="f3yb8htwbd30p15x6of2dcgna">首先通过
<a href="cli/generate#environments-command">生成环境</a>创建
<code>src/environments/</code>目录，并配置项目以使用文件替换。</p>
<div class="docs-code shell">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line">ng generate environments</div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_ref_id="7zd9l5ueh5g0tuw5tkqcp6iym">项目的
<code>src/environments/</code>目录包含基本配置文件
<code>environment.ts</code>，为生产环境提供默认配置。你可以在针对特定目标的配置文件中覆盖额外环境（如
<code>development</code>和
<code>staging</code>）的默认值。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="4reizjf10jcs1ftw359bt1ndz">比如：</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line">my-app/src/environments</div><div class="hljs-ln-line">├── environment.development.ts</div><div class="hljs-ln-line">├── environment.staging.ts</div><div class="hljs-ln-line">└── environment.ts</div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="2crrbos1h23l4zzftumq9rghn">基础环境 <code>environment.ts</code> 包含了默认的环境设置。比如：</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> environment = {</div><div class="hljs-ln-line">  <span class="hljs-attr">production</span>: <span class="hljs-literal">true</span></div><div class="hljs-ln-line">};</div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="4p0cwwztefuyaat7et6q6kq0r">当没有指定环境时，<code>build</code> 命令就会用它作为构建目标。你可以添加其它变量，可以用该环境对象附加属性的形式，也可以用独立对象的形式。比如：以下内容将会把一个变量添加到默认环境中：</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> environment = {</div><div class="hljs-ln-line">  <span class="hljs-attr">production</span>: <span class="hljs-literal">true</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">apiUrl</span>: <span class="hljs-string">'http://my-prod-url'</span></div><div class="hljs-ln-line">};</div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="9zz71iyiwvc46yt23jyunl3mr">你可以添加特定于目标的配置文件，例如 <code>environment.development.ts</code>。以下内容为开发构建目标设置了默认值：</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> environment = {</div><div class="hljs-ln-line">  <span class="hljs-attr">production</span>: <span class="hljs-literal">false</span>,</div><div class="hljs-ln-line">  <span class="hljs-attr">apiUrl</span>: <span class="hljs-string">'http://my-dev-url'</span></div><div class="hljs-ln-line">};</div></code>
    </pre>
  </div>
  <h2 id="using-environment-specific-variables-in-your-app">
    <a href="#using-environment-specific-variables-in-your-app" class="docs-anchor" tabindex="-1" aria-label="Link to Using environment-specific variables in your app" data-ng_translator_product="100" data-ng_translator_ref_id="bho9hv9x3zox5xp2qg8omtwfz">在应用中使用针对特定环境的变量</a>
  </h2>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="a2sdvcc2pzgw2sp1y08manamh">要使用已定义的配置环境，组件必须导入原始版的环境文件：</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> { environment } <span class="hljs-keyword">from</span> <span class="hljs-string">'./environments/environment'</span>;</div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_ref_id="9hiltcxghmf8s1ba2nav74ov4">这确保了 build 和 serve 命令能够找到特定构建目标的配置。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="7qoq2yyn2t00sfus44vvlvltl">组件文件（<code>app.component.ts</code>）中的下列代码可以使用该配置文件中定义的环境变量。</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> { environment } <span class="hljs-keyword">from</span> <span class="hljs-string">'./../environments/environment'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-comment">// Fetches from `http://my-prod-url` in production, `http://my-dev-url` in development.</span></div><div class="hljs-ln-line"><span class="hljs-title function_">fetch</span>(environment.<span class="hljs-property">apiUrl</span>);</div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="9zr7qsau8pnnnbkr7gpmtkc71">CLI 的主配置文件 <code>angular.json</code> 中的每个构建目标下都包含了一个 <code>fileReplacements</code> 区段。这能让你把 TypeScript 程序中的任何文件替换为针对特定目标的版本。当构建目标需要包含针对特定环境（比如生产或预生产）的代码或变量时，这非常有用。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="ej1qy58gkgzkqiroh2v152jmm">默认情况下不会替换任何文件，但
<code>ng generate environments</code>会自动设置此配置。你可以通过直接编辑
<code>angular.json</code>配置来更改或添加特定构建目标的文件替换。</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-attr">"configurations"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">    <span class="hljs-attr">"development"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">      <span class="hljs-attr">"fileReplacements"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></div><div class="hljs-ln-line">          <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">            <span class="hljs-attr">"replace"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"src/environments/environment.ts"</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">            <span class="hljs-attr">"with"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"src/environments/environment.development.ts"</span></div><div class="hljs-ln-line">          <span class="hljs-punctuation">}</span></div><div class="hljs-ln-line">        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">        …</div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="esn3mk7f8pk9269pbi6w8bb0v">这意味着当你使用 <code>ng build --configuration development</code> 构建开发配置时，<code>src/environments/environment.ts</code> 文件将替换为特定于目标的版本 <code>src/environments/environment.development.ts</code>。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="b74zd4au4hk2ixrea77856p1c">要添加一个暂存环境，创建一个名为
<code>src/environments/environment.staging.ts</code>的
<code>src/environments/environment.ts</code>副本，然后在
<code>angular.json</code>中添加一个
<code>staging</code>配置：</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-attr">"configurations"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">    <span class="hljs-attr">"development"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> … <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">    <span class="hljs-attr">"production"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> … <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">    <span class="hljs-attr">"staging"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">      <span class="hljs-attr">"fileReplacements"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></div><div class="hljs-ln-line">        <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">          <span class="hljs-attr">"replace"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"src/environments/environment.ts"</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">          <span class="hljs-attr">"with"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"src/environments/environment.staging.ts"</span></div><div class="hljs-ln-line">        <span class="hljs-punctuation">}</span></div><div class="hljs-ln-line">      <span class="hljs-punctuation">]</span></div><div class="hljs-ln-line">    <span class="hljs-punctuation">}</span></div><div class="hljs-ln-line">  <span class="hljs-punctuation">}</span></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="b9hnii6g591zv57yd9j8xv8fb">你还可以往目标环境中添加更多配置项。你的构建目标支持的任何选项都可以在构建目标配置中进行覆盖。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="4aaxm18q5irqc0m5qn6o45ucf">要想使用预生产环境（staging）的配置进行构建，请运行下列命令：</p>
<div class="docs-code shell">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line">ng build --configuration staging</div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_ref_id="6qch7gx7xvxc2dtnkxeb2xgyq">默认情况下，
<code>build</code>目标包含
<code>production</code>和
<code>development</code>配置，而
<code>ng serve</code>使用应用的开发构建。如果设置
<code>buildTarget</code>选项，也可以配置
<code>ng serve</code>使用目标构建配置。</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-attr">"serve"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">    <span class="hljs-attr">"builder"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"@angular-devkit/build-angular:dev-server"</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">    <span class="hljs-attr">"options"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> … <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">    <span class="hljs-attr">"configurations"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">      <span class="hljs-attr">"development"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">        <span class="hljs-comment">// Use the `development` configuration of the `build` target.</span></div><div class="hljs-ln-line">        <span class="hljs-attr">"buildTarget"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"my-app:build:development"</span></div><div class="hljs-ln-line">      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">      <span class="hljs-attr">"production"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">        <span class="hljs-comment">// Use the `production` configuration of the `build` target.</span></div><div class="hljs-ln-line">        <span class="hljs-attr">"buildTarget"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"my-app:build:production"</span></div><div class="hljs-ln-line">      <span class="hljs-punctuation">}</span></div><div class="hljs-ln-line">    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">    <span class="hljs-attr">"defaultConfiguration"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"development"</span></div><div class="hljs-ln-line">  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_ref_id="7b32q459hivzb1ljgbf76y4ma"><code>defaultConfiguration</code>选项指定默认使用的配置。当未设置
<code>defaultConfiguration</code>时，
<code>options</code>直接使用，不会进行修改。</p>
