<header class="docs-header">
      <docs-breadcrumb></docs-breadcrumb>

      
  <!-- Page title -->
  <div class="docs-page-title">
    <h1 tabindex="-1" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="7l4r5ksly876d1b8swxh2gkax">Angular CLI 构建器（Builder）</h1>
    <a class="docs-github-links" target="_blank" href="https://github.com/angular/angular/edit/main/adev/src/content/tools/cli/cli-builder.md" title="Edit this page" aria-label="Edit this page">
      <!-- Pencil -->
      <docs-icon role="presentation">edit</docs-icon>
    </a>
  </div>
    </header>
    <p data-ng_translator_product="100" data-ng_translator_ref_id="3pxtn9o0lusdnqflpod6llzsn">许多 Angular CLI 命令对你的代码执行复杂过程，如构建、测试或为你的应用启动服务器。 这些命令使用一个名为 Architect 的内部工具来运行
<em>CLI 构建器</em>，这些构建器调用另一个工具（打捆工具、测试运行器、服务器）来完成所需的任务。 自定义构建器可以执行全新的任务，或更改现有命令使用的第三方工具。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="j2d0mdqv4nwj03y9kz41rl8a">本文档介绍了 CLI 构建器是如何与工作区配置文件集成的，还展示了如何创建你自己的构建器。</p>

    <div class="docs-alert docs-alert-helpful">
    <p data-ng_translator_product="100" data-ng_translator_ref_id="4amzlb7c9i9knkx90ucbd2o75"><strong>有帮助的:</strong> 在此
<a href="https://github.com/mgechev/cli-builders-demo" target="_blank">GitHub 仓库</a>中找到此处示例使用的代码。</p>

    </div>
    
  <h2 id="cli-builders">
    <a href="#cli-builders" class="docs-anchor" tabindex="-1" aria-label="Link to CLI builders" data-ng_translator_product="100" data-ng_translator_ref_id="6kgou0phblc70g8sr36snxabc">CLI 构建器</a>
  </h2>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="cmyuw2uyb9dvxnzruobo41t36">内部的 Architect 工具将工作委派给名为
<em>构建器</em>的处理函数。 构建器处理函数接收两个参数：</p>

  <div class="docs-table docs-scroll-track-transparent">
    <table>
      <thead>
        <tr>
<th align="left" data-ng_translator_product="100" data-ng_translator_ref_id="1fufha58swa4cfv613pusq6ln">参数</th>
<th align="left" data-ng_translator_product="100" data-ng_translator_ref_id="9l7wx57qn2rdbzj13yjkljua0">类型</th>
</tr>

      </thead>
      <tbody>
        <tr>
<td align="left"><code>options</code></td>
<td align="left"><code>JSONObject</code></td>
</tr>
<tr>
<td align="left"><code>context</code></td>
<td align="left"><code>BuilderContext</code></td>
</tr>

      </tbody>
    </table>
  </div>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="6me6zz454qnindzezhlllrdvr">这里的关注点分离与
<a href="tools/cli/schematics-authoring">schematics</a>（用于其他触及你代码的 CLI 命令，如
<code>ng generate</code>）相同。</p>

  <ul class="docs-list">
    <li data-ng_translator_product="100" data-ng_translator_ref_id="dehic98wkrw9r3v3ms1tpjsin"><code>options</code>对象由 CLI 用户的选项和配置提供，而
<code>context</code>对象由 CLI 构建器 API 自动提供。</li>
<li data-ng_translator_product="100" data-ng_translator_ref_id="8q8rn0zftirmyrk4bdhfz0jd2">除了上下文信息外，
<code>context</code>对象还提供一个调度方法，
<code>context.scheduleTarget()</code>。 调度器使用给定的目标配置执行构建器处理函数。</li>

  </ul>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="ewgexl4rh5grjjsnfwu81bs99">构建器处理函数可以是同步的（返回一个值），异步的（返回一个
<code>Promise</code>），或者监听并返回多个值（返回一个
<code>Observable</code>）。 返回值必须始终是
<code>BuilderOutput</code>类型。 此对象包含一个布尔类型的
<code>success</code>字段和一个可选的
<code>error</code>字段，该字段可以包含错误信息。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="brfbapqyftqi8fkreft1ps00k">Angular 提供了一些由 CLI 用于
<code>ng build</code>和
<code>ng test</code>等命令的构建器。 这些以及其他内置 CLI 构建器的默认目标配置可以在
<a href="reference/configs/workspace-config">工作区配置文件</a>
<code>angular.json</code>的“architect”部分找到并配置。 此外，通过创建你自己的构建器来扩展和自定义 Angular，你可以使用
<a href="cli/run"><code>ng run</code> CLI 命令</a>直接运行它们。</p>

  <h3 id="builder-project-structure">
    <a href="#builder-project-structure" class="docs-anchor" tabindex="-1" aria-label="Link to Builder project structure" data-ng_translator_product="100" data-ng_translator_ref_id="5r1ispfd7rgbbazpo0kgauejo">构建器的项目结构</a>
  </h3>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="e6grnrmnf7umtltqo3rh1rat1">构建器位于一个 "project" 文件夹中，该文件夹的结构类似于 Angular 工作区，包括位于顶层的全局配置文件，以及位于工作代码所在源文件夹中的更具体的配置。比如，<code>myBuilder</code> 文件夹中可能包含如下文件。</p>

  <div class="docs-table docs-scroll-track-transparent">
    <table>
      <thead>
        <tr>
<th align="left" data-ng_translator_product="100" data-ng_translator_ref_id="8n2c7wfntpyw9gnmnqx5bqxht">文件</th>
<th align="left" data-ng_translator_product="100" data-ng_translator_ref_id="297niinze7mn1fnajtyjcs0tb">目的</th>
</tr>

      </thead>
      <tbody>
        <tr>
<td align="left"><code>src/my-builder.ts</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="ahr5s0k61d5dbzq2vkwmj08qr">构建器定义的主源文件。</td>
</tr>
<tr>
<td align="left"><code>src/my-builder.spec.ts</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="66qowvh1zht2uzvl0ikg904hy">测试的源文件。</td>
</tr>
<tr>
<td align="left"><code>src/schema.json</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="2vsplc0qiumt6y2vozgwf87t7">构建器输入选项的定义。</td>
</tr>
<tr>
<td align="left"><code>builders.json</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="b3m621w2ry61vdwtsymyvne68">构建器定义。</td>
</tr>
<tr>
<td align="left"><code>package.json</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="6imt9sb01f1fvok2f7xhst5pv">依赖项。请参阅 
<a href="https://docs.npmjs.com/files/package.json" target="_blank">https://docs.npmjs.com/files/package.json</a>。</td>
</tr>
<tr>
<td align="left"><code>tsconfig.json</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="clh9ur3vgo7hiziezhmmdzeux"><a href="https://www.typescriptlang.org/docs/handbook/tsconfig-json.html" target="_blank">TypeScript 配置</a>。</td>
</tr>

      </tbody>
    </table>
  </div>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="e5ryfy9u1no3rx0cj9qkc16tt">构建器可以发布到 
<code>npm</code>，请参阅 
<a href="tools/libraries/creating-libraries">发布你的库</a>。</p>

  <h2 id="creating-a-builder">
    <a href="#creating-a-builder" class="docs-anchor" tabindex="-1" aria-label="Link to Creating a builder" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="9n6khelrjscrzq171a67lbxxu">创建构建器</a>
  </h2>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="2igq88uw17btob27hh9bie3ut">例如，创建一个将文件复制到新位置的构建器。 要创建构建器，请使用 
<code>createBuilder()</code> CLI 构建器函数，并返回一个 
<code>Promise&lt;BuilderOutput&gt;</code> 对象。</p>
<div class="docs-code" path="adev/src/content/examples/cli-builder/src/my-builder.ts" visiblelines="0,1,3,4,5,6,7,8,9,10,11,25,26" header="src/my-builder.ts (builder skeleton)">
    <div class="docs-code-header"><h3 data-ng_translator_product="100" data-ng_translator_ref_id="5v6t6bykunf9nnda0c1x8gqqw">src/my-builder.ts（构建器骨架）</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">BuilderContext</span>, <span class="hljs-title class_">BuilderOutput</span>, createBuilder} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular-devkit/architect'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">JsonObject</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular-devkit/core'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {promises <span class="hljs-keyword">as</span> fs} <span class="hljs-keyword">from</span> <span class="hljs-string">'fs'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Options</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JsonObject</span> {</div><div class="hljs-ln-line">  <span class="hljs-attr">source</span>: <span class="hljs-built_in">string</span>;</div><div class="hljs-ln-line">  <span class="hljs-attr">destination</span>: <span class="hljs-built_in">string</span>;</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">createBuilder</span>(copyFileBuilder);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">copyFileBuilder</span>(<span class="hljs-params">options: Options, context: BuilderContext</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">BuilderOutput</span>&gt; {</div><div class="hljs-ln-line">  context.<span class="hljs-title function_">reportStatus</span>(<span class="hljs-string">`Copying <span class="hljs-subst">${options.source}</span> to <span class="hljs-subst">${options.destination}</span>.`</span>);</div><div class="hljs-ln-line">  <span class="hljs-keyword">try</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">copyFile</span>(options.<span class="hljs-property">source</span>, options.<span class="hljs-property">destination</span>);</div><div class="hljs-ln-line">  } <span class="hljs-keyword">catch</span> (err) {</div><div class="hljs-ln-line">    context.<span class="hljs-property">logger</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to copy file.'</span>);</div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> {</div><div class="hljs-ln-line">      <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,</div><div class="hljs-ln-line">      <span class="hljs-attr">error</span>: (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">Error</span>).<span class="hljs-property">message</span>,</div><div class="hljs-ln-line">    };</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  context.<span class="hljs-title function_">reportStatus</span>(<span class="hljs-string">'Done.'</span>);</div><div class="hljs-ln-line">  <span class="hljs-keyword">return</span> {<span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>};</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_ref_id="63giqz4eyjyyt5o5yvmpa079l">现在让我们添加一些逻辑。 以下代码从用户选项中获取源文件和目标文件路径，并将文件从源路径复制到目标路径（使用
<a href="https://nodejs.org/api/fs.html#fs_fspromises_copyfile_src_dest_mode" target="_blank">内置 NodeJS <code>copyFile()</code> 函数的 Promise 版本</a>）。 如果复制操作失败，它会返回一个关于底层问题的错误信息。</p>
<div class="docs-code" path="adev/src/content/examples/cli-builder/src/my-builder.ts" visiblelines="0,1,2,3,4,5,6,7,8,9,10,11,13,14,15,17,18,19,20,21,24,25,26" header="src/my-builder.ts (builder)">
    <div class="docs-code-header"><h3 data-ng_translator_product="100" data-ng_translator_ref_id="1lm1d5ar6iymx3rjbxg2i6aq5">src/my-builder.ts（构建器）</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">BuilderContext</span>, <span class="hljs-title class_">BuilderOutput</span>, createBuilder} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular-devkit/architect'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">JsonObject</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular-devkit/core'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {promises <span class="hljs-keyword">as</span> fs} <span class="hljs-keyword">from</span> <span class="hljs-string">'fs'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Options</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JsonObject</span> {</div><div class="hljs-ln-line">  <span class="hljs-attr">source</span>: <span class="hljs-built_in">string</span>;</div><div class="hljs-ln-line">  <span class="hljs-attr">destination</span>: <span class="hljs-built_in">string</span>;</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">createBuilder</span>(copyFileBuilder);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">copyFileBuilder</span>(<span class="hljs-params">options: Options, context: BuilderContext</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">BuilderOutput</span>&gt; {</div><div class="hljs-ln-line">  context.<span class="hljs-title function_">reportStatus</span>(<span class="hljs-string">`Copying <span class="hljs-subst">${options.source}</span> to <span class="hljs-subst">${options.destination}</span>.`</span>);</div><div class="hljs-ln-line">  <span class="hljs-keyword">try</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">copyFile</span>(options.<span class="hljs-property">source</span>, options.<span class="hljs-property">destination</span>);</div><div class="hljs-ln-line">  } <span class="hljs-keyword">catch</span> (err) {</div><div class="hljs-ln-line">    context.<span class="hljs-property">logger</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to copy file.'</span>);</div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> {</div><div class="hljs-ln-line">      <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,</div><div class="hljs-ln-line">      <span class="hljs-attr">error</span>: (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">Error</span>).<span class="hljs-property">message</span>,</div><div class="hljs-ln-line">    };</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  context.<span class="hljs-title function_">reportStatus</span>(<span class="hljs-string">'Done.'</span>);</div><div class="hljs-ln-line">  <span class="hljs-keyword">return</span> {<span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>};</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"></div></code>
    </pre>
  </div>
  <h3 id="handling-output">
    <a href="#handling-output" class="docs-anchor" tabindex="-1" aria-label="Link to Handling output" data-ng_translator_product="100" data-ng_translator_ref_id="3x6r7cwe0w52kmwvxzbr9x5n0">处理输出</a>
  </h3>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="3g1q724t3fnfoarlvgg90nap5">默认情况下，
<code>copyFile()</code> 不会向进程标准输出或错误输出打印任何内容。 如果发生错误，可能很难理解构建器在问题发生时试图做什么。 通过使用 
<code>Logger</code> API 记录额外的信息来添加一些上下文。 这也允许构建器本身在一个单独的进程中执行，即使标准输出和错误输出被禁用。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="7kgarbtoeyjq81dmaswy4mtoa">你可以从上下文中检索一个 <code>Logger</code> 实例。</p>
<div class="docs-code" path="adev/src/content/examples/cli-builder/src/my-builder.ts" visiblelines="13,14,15,16,17,18,19,20,21" header="src/my-builder.ts (handling output)">
    <div class="docs-code-header"><h3 data-ng_translator_product="100" data-ng_translator_ref_id="46wmbjwrbbl00u6ec50opy2v5">src/my-builder.ts（处理输出）</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">BuilderContext</span>, <span class="hljs-title class_">BuilderOutput</span>, createBuilder} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular-devkit/architect'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">JsonObject</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular-devkit/core'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {promises <span class="hljs-keyword">as</span> fs} <span class="hljs-keyword">from</span> <span class="hljs-string">'fs'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Options</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JsonObject</span> {</div><div class="hljs-ln-line">  <span class="hljs-attr">source</span>: <span class="hljs-built_in">string</span>;</div><div class="hljs-ln-line">  <span class="hljs-attr">destination</span>: <span class="hljs-built_in">string</span>;</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">createBuilder</span>(copyFileBuilder);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">copyFileBuilder</span>(<span class="hljs-params">options: Options, context: BuilderContext</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">BuilderOutput</span>&gt; {</div><div class="hljs-ln-line">  context.<span class="hljs-title function_">reportStatus</span>(<span class="hljs-string">`Copying <span class="hljs-subst">${options.source}</span> to <span class="hljs-subst">${options.destination}</span>.`</span>);</div><div class="hljs-ln-line">  <span class="hljs-keyword">try</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">copyFile</span>(options.<span class="hljs-property">source</span>, options.<span class="hljs-property">destination</span>);</div><div class="hljs-ln-line">  } <span class="hljs-keyword">catch</span> (err) {</div><div class="hljs-ln-line">    context.<span class="hljs-property">logger</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to copy file.'</span>);</div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> {</div><div class="hljs-ln-line">      <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,</div><div class="hljs-ln-line">      <span class="hljs-attr">error</span>: (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">Error</span>).<span class="hljs-property">message</span>,</div><div class="hljs-ln-line">    };</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  context.<span class="hljs-title function_">reportStatus</span>(<span class="hljs-string">'Done.'</span>);</div><div class="hljs-ln-line">  <span class="hljs-keyword">return</span> {<span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>};</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"></div></code>
    </pre>
  </div>
  <h3 id="progress-and-status-reporting">
    <a href="#progress-and-status-reporting" class="docs-anchor" tabindex="-1" aria-label="Link to Progress and status reporting" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="cuz0pn5szvgyi9hhwxlztzh9w">进度和状态报告</a>
  </h3>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="1v2vr412xyj4jsu3cnnxe0njj">CLI 构建器 API 包含一些进度报告和状态报告工具，可以为某些函数和接口提供提示信息。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="19lyy7yl7ufujqem0b90y2ytw">要报告进度，请使用 
<code>context.reportProgress()</code> 方法，该方法接受当前值、可选的总数和状态字符串作为参数。 总数可以是任意数字。例如，如果你知道需要处理的文件数，总数可以是文件数，而当前值应该是到目前为止处理的文件数。 状态字符串不变，除非你传入一个新的字符串值。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="9suu21epk3evbq957b236ktw8">在我们的例子中，这种复制操作或者已完成或者正在执行，所以不需要进度报告，但是可以报告状态，以便调用此构建器的父构建器知道发生了什么。可以用 <code>context.reportStatus()</code> 方法生成一个任意长度的状态字符串。</p>

    <div class="docs-alert docs-alert-helpful">
    <p data-ng_translator_product="100" data-ng_translator_ref_id="6z4dmgika3deqk6b5qm082u0w"><strong>提示：</strong>不能保证显示的字符串会完整显示；它可能会被裁剪以适应显示它的 UI。</p>

    </div>
    <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="33ic1reyfdyf4bzokpq4i2k27">传入一个空字符串可以移除状态。</p>
<div class="docs-code" path="adev/src/content/examples/cli-builder/src/my-builder.ts" visiblelines="12,13,14,15,16,17,18,19,20,21,22,23,24" header="src/my-builder.ts (progress reporting)">
    <div class="docs-code-header"><h3 data-ng_translator_product="100" data-ng_translator_ref_id="4wtoeqbv4tc87snezabxmsv7r">src/my-builder.ts（进度报告）</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">BuilderContext</span>, <span class="hljs-title class_">BuilderOutput</span>, createBuilder} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular-devkit/architect'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">JsonObject</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular-devkit/core'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {promises <span class="hljs-keyword">as</span> fs} <span class="hljs-keyword">from</span> <span class="hljs-string">'fs'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Options</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JsonObject</span> {</div><div class="hljs-ln-line">  <span class="hljs-attr">source</span>: <span class="hljs-built_in">string</span>;</div><div class="hljs-ln-line">  <span class="hljs-attr">destination</span>: <span class="hljs-built_in">string</span>;</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">createBuilder</span>(copyFileBuilder);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">copyFileBuilder</span>(<span class="hljs-params">options: Options, context: BuilderContext</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">BuilderOutput</span>&gt; {</div><div class="hljs-ln-line">  context.<span class="hljs-title function_">reportStatus</span>(<span class="hljs-string">`Copying <span class="hljs-subst">${options.source}</span> to <span class="hljs-subst">${options.destination}</span>.`</span>);</div><div class="hljs-ln-line">  <span class="hljs-keyword">try</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">copyFile</span>(options.<span class="hljs-property">source</span>, options.<span class="hljs-property">destination</span>);</div><div class="hljs-ln-line">  } <span class="hljs-keyword">catch</span> (err) {</div><div class="hljs-ln-line">    context.<span class="hljs-property">logger</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to copy file.'</span>);</div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> {</div><div class="hljs-ln-line">      <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,</div><div class="hljs-ln-line">      <span class="hljs-attr">error</span>: (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">Error</span>).<span class="hljs-property">message</span>,</div><div class="hljs-ln-line">    };</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  context.<span class="hljs-title function_">reportStatus</span>(<span class="hljs-string">'Done.'</span>);</div><div class="hljs-ln-line">  <span class="hljs-keyword">return</span> {<span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>};</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"></div></code>
    </pre>
  </div>
  <h2 id="builder-input">
    <a href="#builder-input" class="docs-anchor" tabindex="-1" aria-label="Link to Builder input" data-ng_translator_product="100" data-ng_translator_ref_id="sbsbuw84666j6o1ltiwslp71">构建器的输入</a>
  </h2>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="a5z5jl5s3s9nl4c9jh4jm6o6c">你可以通过一个 CLI 命令（如 
<code>ng build</code>）间接调用构建器，或者直接使用 Angular CLI 的 
<code>ng run</code> 命令调用构建器。 在任何情况下，你都必须提供必要的输入，但可以让其他输入默认使用为特定
<em>目标</em>预配置的值（由
<a href="tools/cli/environments">配置</a>指定或在命令行中设置）。</p>

  <h3 id="input-validation">
    <a href="#input-validation" class="docs-anchor" tabindex="-1" aria-label="Link to Input validation" data-ng_translator_product="100" data-ng_translator_ref_id="8zp0j3nlgyvlg4excdxtxvofq">对输入的验证</a>
  </h3>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="e2eweoluvjtjj3jsqlxj91ix0">你在与该构建器关联的 JSON 模式中定义构建器输入。 类似于原理图，Architect 工具收集求解后的输入值到一个 
<code>options</code> 对象中，并在传递给构建器函数之前根据模式验证它们的类型。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="4w08ip205ij5cra8mqsqz86q7">对于我们的示例构建器，
<code>options</code> 应该是一个具有两个键的 
<code>JsonObject</code>： 一个 
<code>source</code> 和一个 
<code>destination</code>，每个都是字符串。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="dud81slq4btbplmmqds9hc9o6">你可以提供如下模式来对这些值的类型进行验证。</p>
<div class="docs-code" header="src/schema.json">
    <div class="docs-code-header"><h3>src/schema.json</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">  <span class="hljs-attr">"$schema"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"http://json-schema.org/schema"</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"object"</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">  <span class="hljs-attr">"properties"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">    <span class="hljs-attr">"source"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"string"</span></div><div class="hljs-ln-line">    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">    <span class="hljs-attr">"destination"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"string"</span></div><div class="hljs-ln-line">    <span class="hljs-punctuation">}</span></div><div class="hljs-ln-line">  <span class="hljs-punctuation">}</span></div><div class="hljs-ln-line"><span class="hljs-punctuation">}</span></div></code>
    </pre>
  </div>
    <div class="docs-alert docs-alert-helpful">
    <p data-ng_translator_product="100" data-ng_translator_ref_id="qoy9z69hc6b0plwgx5fagcpx"><strong>有用提示：</strong>这是一个最小示例，但使用模式进行验证可以非常强大。 更多信息请参见 
<a href="http://json-schema.org" target="_blank">JSON 模式网站</a>。</p>

    </div>
    <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="49ftuezbb6rk0bnryjsviyvz5">要把构建器的实现与它的模式和名称关联起来，你需要创建一个<em>构建器定义</em>文件，可以在 <code>package.json</code> 中指向该文件。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="9s0wtwjyqyy3eks004lwoeafy">创建一个名为 <code>builders.json</code> 文件，它看起来像这样。</p>
<div class="docs-code" header="builders.json">
    <div class="docs-code-header"><h3>builders.json</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">  <span class="hljs-attr">"builders"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">    <span class="hljs-attr">"copy"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">      <span class="hljs-attr">"implementation"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./dist/my-builder.js"</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">      <span class="hljs-attr">"schema"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./src/schema.json"</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">      <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Copies a file."</span></div><div class="hljs-ln-line">    <span class="hljs-punctuation">}</span></div><div class="hljs-ln-line">  <span class="hljs-punctuation">}</span></div><div class="hljs-ln-line"><span class="hljs-punctuation">}</span></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="ap3klge1omnmmbyvlhp6p9a8h">在 <code>package.json</code> 文件中，添加一个 <code>builders</code> 键，告诉建筑师工具可以在哪里找到这个构建器定义文件。</p>
<div class="docs-code" header="package.json">
    <div class="docs-code-header"><h3>package.json</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"@example/copy-file"</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">  <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Builder for copying files"</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">  <span class="hljs-attr">"builders"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"builders.json"</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">    <span class="hljs-attr">"@angular-devkit/architect"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"~0.1200.0"</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">    <span class="hljs-attr">"@angular-devkit/core"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^12.0.0"</span></div><div class="hljs-ln-line">  <span class="hljs-punctuation">}</span></div><div class="hljs-ln-line"><span class="hljs-punctuation">}</span></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_ref_id="5crm30d813gymk50di3cg12zk">我们构建器的正式名称现在是 
<code>@example/copy-file:copy</code>。 第一部分是包名称，第二部分是 
<code>builders.json</code> 文件中指定的构建器名称。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="2hrn2hdg4c13xl7zm9psfaigh">这些值通过 
<code>options.source</code> 和 
<code>options.destination</code> 访问。</p>
<div class="docs-code" path="adev/src/content/examples/cli-builder/src/my-builder.ts" visiblelines="14" header="src/my-builder.ts (report status)">
    <div class="docs-code-header"><h3 data-ng_translator_product="100" data-ng_translator_ref_id="kxaypyqo5a0f2k24tx00e1d3">src/my-builder.ts（报告状态）</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">BuilderContext</span>, <span class="hljs-title class_">BuilderOutput</span>, createBuilder} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular-devkit/architect'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">JsonObject</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular-devkit/core'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {promises <span class="hljs-keyword">as</span> fs} <span class="hljs-keyword">from</span> <span class="hljs-string">'fs'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Options</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JsonObject</span> {</div><div class="hljs-ln-line">  <span class="hljs-attr">source</span>: <span class="hljs-built_in">string</span>;</div><div class="hljs-ln-line">  <span class="hljs-attr">destination</span>: <span class="hljs-built_in">string</span>;</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">createBuilder</span>(copyFileBuilder);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">copyFileBuilder</span>(<span class="hljs-params">options: Options, context: BuilderContext</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">BuilderOutput</span>&gt; {</div><div class="hljs-ln-line">  context.<span class="hljs-title function_">reportStatus</span>(<span class="hljs-string">`Copying <span class="hljs-subst">${options.source}</span> to <span class="hljs-subst">${options.destination}</span>.`</span>);</div><div class="hljs-ln-line">  <span class="hljs-keyword">try</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">copyFile</span>(options.<span class="hljs-property">source</span>, options.<span class="hljs-property">destination</span>);</div><div class="hljs-ln-line">  } <span class="hljs-keyword">catch</span> (err) {</div><div class="hljs-ln-line">    context.<span class="hljs-property">logger</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to copy file.'</span>);</div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> {</div><div class="hljs-ln-line">      <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,</div><div class="hljs-ln-line">      <span class="hljs-attr">error</span>: (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">Error</span>).<span class="hljs-property">message</span>,</div><div class="hljs-ln-line">    };</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  context.<span class="hljs-title function_">reportStatus</span>(<span class="hljs-string">'Done.'</span>);</div><div class="hljs-ln-line">  <span class="hljs-keyword">return</span> {<span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>};</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"></div></code>
    </pre>
  </div>
  <h3 id="target-configuration">
    <a href="#target-configuration" class="docs-anchor" tabindex="-1" aria-label="Link to Target configuration" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="ap4qp9spjlry1ho1c60c9q7i0">目标配置</a>
  </h3>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="bwt3cc60scbz66c99wwz667m4">构建器必须有一个定义的目标，将其与特定输入配置和项目关联。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="6vjcvbz9ynlc6r9g0z8y9qmen">目标在 
<code>angular.json</code> 
<a href="reference/configs/workspace-config">CLI 配置文件</a>中定义。 一个目标指定要使用的构建器、其默认选项配置和命名的替代配置。 Angular CLI 中的 Architect 使用目标定义来求解给定运行的输入选项。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="a5tny6c3demeogev23qsl2ch2"><code>angular.json</code> 文件为每个项目设置一个部分，每个项目的 "architect" 部分配置 CLI 命令（如 'build'、'test' 和 'serve'）使用的构建器目标。 例如，默认情况下，
<code>ng build</code> 命令运行构建器 
<code>@angular-devkit/build-angular:browser</code> 来执行构建任务，并传递 
<code>angular.json</code> 中为 
<code>build</code> 目标指定的默认选项值。</p>
<div class="docs-code" header="angular.json">
    <div class="docs-code-header"><h3>angular.json</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line">…</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-attr">"myApp"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">  …</div><div class="hljs-ln-line">  <span class="hljs-attr">"architect"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">      <span class="hljs-attr">"builder"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"@angular-devkit/build-angular:browser"</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">      <span class="hljs-attr">"options"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">        <span class="hljs-attr">"outputPath"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dist/myApp"</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">        <span class="hljs-attr">"index"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"src/index.html"</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">        …</div><div class="hljs-ln-line">      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">      <span class="hljs-attr">"configurations"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">        <span class="hljs-attr">"production"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">          <span class="hljs-attr">"fileReplacements"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></div><div class="hljs-ln-line">            <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">              <span class="hljs-attr">"replace"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"src/environments/environment.ts"</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">              <span class="hljs-attr">"with"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"src/environments/environment.prod.ts"</span></div><div class="hljs-ln-line">            <span class="hljs-punctuation">}</span></div><div class="hljs-ln-line">          <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">          <span class="hljs-attr">"optimization"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">          <span class="hljs-attr">"outputHashing"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"all"</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">          …</div><div class="hljs-ln-line">        <span class="hljs-punctuation">}</span></div><div class="hljs-ln-line">      <span class="hljs-punctuation">}</span></div><div class="hljs-ln-line">    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">    …</div><div class="hljs-ln-line">  <span class="hljs-punctuation">}</span></div><div class="hljs-ln-line"><span class="hljs-punctuation">}</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">…</div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_ref_id="eugu9f3zy3c4djeqnonm9bmix">该命令将默认选项集传递给构建器，这些选项在 "options" 部分中指定。 如果你传递 
<code>--configuration=production</code> 标志，它将使用在 
<code>production</code> 配置中指定的覆盖值。 在命令行中进一步单独指定选项覆盖。</p>

  <h4 id="target-strings">
    <a href="#target-strings" class="docs-anchor" tabindex="-1" aria-label="Link to Target strings" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="dat3zwzlefm6chdua35ukj6vs">目标字符串</a>
  </h4>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="8af6583cxip4hdmda40v4u18e">通用的 <code>ng run</code> CLI 命令将以下格式的目标字符串作为其第一个参数。</p>
<div class="docs-code shell">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line">project:target[:configuration]</div></code>
    </pre>
  </div>
  <div class="docs-table docs-scroll-track-transparent">
    <table>
      <thead>
        <tr>
<th align="left"></th>
<th align="left" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="3prlgfrx5eo2xqncnnob4crxu">详情</th>
</tr>

      </thead>
      <tbody>
        <tr>
<td align="left">project</td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="xe7zxgogglxp43ocx7mv7xhh">与目标关联的 Angular CLI 项目名称。</td>
</tr>
<tr>
<td align="left">target</td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="4q2aeminbjb51gnx01abjeckn">从 
<code>angular.json</code> 文件的 
<code>architect</code> 部分命名的构建器配置。</td>
</tr>
<tr>
<td align="left">configuration</td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="64p2jryo7rbjs5n2t200z6yc3">（可选）在 
<code>angular.json</code> 文件中定义的给定目标的特定配置覆盖名称。</td>
</tr>

      </tbody>
    </table>
  </div>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="4t61j0b1s0jlq0newc1hwotmg">如果你的构建器调用另一个构建器，它可能需要读取一个传入的目标字符串。可以使用 <code>@angular-devkit/architect</code> 中的工具函数 <code>targetFromTargetString()</code> 把这个字符串解析成一个对象。</p>

  <h2 id="schedule-and-run">
    <a href="#schedule-and-run" class="docs-anchor" tabindex="-1" aria-label="Link to Schedule and run" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="8loj29v6qd1xkvdwzrc9s7hlj">调度并运行</a>
  </h2>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="1es39azpn7uf5m3h3nma254xn">建筑师会异步运行构建器。要调用某个构建器，就要在所有配置解析完成之后安排一个要运行的任务。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="ekq5y231idg6kef0fzzg0us94">在调度器返回 <code>BuilderRun</code> 控件对象之前，不会执行该构建器函数。CLI 通常会通过调用 <code>context.scheduleTarget()</code> 函数来调度任务，然后使用 <code>angular.json</code> 文件中的目标定义来解析输入选项。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="4dvrfts53tbjmliok5cs0ejtg">Architect 通过获取默认选项对象来求解给定目标的输入选项，然后从配置中覆盖值，再从传递给 
<code>context.scheduleTarget()</code> 的覆盖对象中进一步覆盖值。 对于 Angular CLI，覆盖对象是从命令行参数构建的。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="7ekj848pozzkwzl0liow9vbdb">建筑师会根据构建器的模式对生成的选项值进行验证。如果输入有效，建筑师会创建上下文并执行该构建器。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="4wy12nvrm437g8pnxdsaaisvj">更多信息请参见 
<a href="reference/configs/workspace-config">工作区配置</a>。</p>

    <div class="docs-alert docs-alert-helpful">
    <p data-ng_translator_product="100" data-ng_translator_ref_id="572r2eanaw36w9qn4r6v2u3zi"><strong>有用提示：</strong> 你还可以通过调用 
<code>context.scheduleBuilder()</code>，直接从另一个 builder 或测试中调用某个 builder。你可以直接将 
<code>options</code> 对象传递给此方法，这些选项值会按照 builder 的 schema 进行验证，而无需进一步调整。</p>

    </div>
    <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="73l0g32a2mbxl8r0i3l0u1nxm">只有 <code>context.scheduleTarget()</code> 方法来解析这些配置和并通过 <code>angular.json</code> 文件进行覆盖。</p>

  <h3 id="default-architect-configuration">
    <a href="#default-architect-configuration" class="docs-anchor" tabindex="-1" aria-label="Link to Default architect configuration" data-ng_translator_product="100" data-ng_translator_ref_id="9nozhnfbaf3yyhzkadlg9zrdr">默认建筑师配置</a>
  </h3>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="4l58ytmuf1unpfz649fij7oj0">让我们创建一个简单的 <code>angular.json</code> 文件，它会把目标配置放到上下文中。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="98qko2brn0tdbm46v50qo4z6l">你可以将该 builder 发布到 npm（参见 
<a href="tools/libraries/creating-libraries#publishing-your-library">发布你的库</a>），并使用以下命令安装它：</p>
<div class="docs-code shell">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line">npm install @example/copy-file</div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="14zx9jczm1sbzkvexzh8apq8a">如果用 <code>ng new builder-test</code> 创建一个新项目，那么生成的 <code>angular.json</code> 文件就是这样的，它只有默认的构建器参数。</p>
<div class="docs-code" header="angular.json">
    <div class="docs-code-header"><h3>angular.json</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">  <span class="hljs-attr">"projects"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">    <span class="hljs-attr">"builder-test"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">      <span class="hljs-attr">"architect"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">        <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">          <span class="hljs-attr">"builder"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"@angular-devkit/build-angular:browser"</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">          <span class="hljs-attr">"options"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">            <span class="hljs-comment">// more options...</span></div><div class="hljs-ln-line">            <span class="hljs-attr">"outputPath"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dist/builder-test"</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">            <span class="hljs-attr">"index"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"src/index.html"</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">            <span class="hljs-attr">"main"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"src/main.ts"</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">            <span class="hljs-attr">"polyfills"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"src/polyfills.ts"</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">            <span class="hljs-attr">"tsConfig"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"src/tsconfig.app.json"</span></div><div class="hljs-ln-line">          <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">          <span class="hljs-attr">"configurations"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">            <span class="hljs-attr">"production"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">              <span class="hljs-comment">// more options...</span></div><div class="hljs-ln-line">              <span class="hljs-attr">"optimization"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">              <span class="hljs-attr">"aot"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">              <span class="hljs-attr">"buildOptimizer"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span></div><div class="hljs-ln-line">            <span class="hljs-punctuation">}</span></div><div class="hljs-ln-line">          <span class="hljs-punctuation">}</span></div><div class="hljs-ln-line">        <span class="hljs-punctuation">}</span></div><div class="hljs-ln-line">      <span class="hljs-punctuation">}</span></div><div class="hljs-ln-line">    <span class="hljs-punctuation">}</span></div><div class="hljs-ln-line">  <span class="hljs-punctuation">}</span></div><div class="hljs-ln-line"><span class="hljs-punctuation">}</span></div></code>
    </pre>
  </div>
  <h3 id="adding-a-target">
    <a href="#adding-a-target" class="docs-anchor" tabindex="-1" aria-label="Link to Adding a target" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="dpaaal8hv3zp02d3ah4mnilj1">添加目标</a>
  </h3>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="44xjuwbbf5vrorwzs09zwrbf3">添加一个新的目标，来运行我们的构建器以复制文件。该目标告诉构建器，复制 <code>package.json</code> 文件。</p>

  <ul class="docs-list">
    <li data-ng_translator_product="100" data-ng_translator_ref_id="52ss9kzsal7j4b2n6eklirpy9">我们将为项目的 
<code>architect</code> 对象添加新的目标部分。</li>
<li data-ng_translator_product="100" data-ng_translator_ref_id="8etxcy0uogmyi743jy2pb72oi">名为 
<code>copy-package</code> 的目标使用你发布到 
<code>@example/copy-file</code> 的 builder。</li>
<li>The options object provides default values for the two inputs that you defined.
  <ul class="docs-list">
    <li data-ng_translator_product="100" data-ng_translator_ref_id="a4heb70klmr20xo5ywt35n7am"><code>source</code> - 你要复制的现有文件。</li>
<li data-ng_translator_product="100" data-ng_translator_ref_id="6o8ytjjyjo9438o4ybo6k78hf"><code>destination</code> - 你想要复制到的路径。</li>

  </ul>
  </li>

  </ul>
  <div class="docs-code" header="angular.json">
    <div class="docs-code-header"><h3>angular.json</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">  <span class="hljs-attr">"projects"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">    <span class="hljs-attr">"builder-test"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">      <span class="hljs-attr">"architect"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">        <span class="hljs-attr">"copy-package"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">          <span class="hljs-attr">"builder"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"@example/copy-file:copy"</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">          <span class="hljs-attr">"options"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></div><div class="hljs-ln-line">            <span class="hljs-attr">"source"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"package.json"</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">            <span class="hljs-attr">"destination"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"package-copy.json"</span></div><div class="hljs-ln-line">          <span class="hljs-punctuation">}</span></div><div class="hljs-ln-line">        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">        <span class="hljs-comment">// Existing targets...</span></div><div class="hljs-ln-line">      <span class="hljs-punctuation">}</span></div><div class="hljs-ln-line">    <span class="hljs-punctuation">}</span></div><div class="hljs-ln-line">  <span class="hljs-punctuation">}</span></div><div class="hljs-ln-line"><span class="hljs-punctuation">}</span></div></code>
    </pre>
  </div>
  <h3 id="running-the-builder">
    <a href="#running-the-builder" class="docs-anchor" tabindex="-1" aria-label="Link to Running the builder" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="7j4jdrwbywskac2u890ftsrm9">运行这个构建器</a>
  </h3>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="5oabbdx5cx5023vt2e2ulgpqj">要想使用这个新目标的默认配置运行我们的构建器，请使用以下 CLI 命令。</p>
<div class="docs-code shell">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line">ng run builder-test:copy-package</div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="dcw5w0nq8lhbrbhs8kqvpud9m">这将把 <code>package.json</code> 文件复制成 <code>package-copy.json</code>。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="bqnzgbnfa02j3dv97r5da0wna">你可以使用命令行参数来覆盖已配置的默认值。比如，要改用其它 <code>destination</code> 值运行，请使用以下 CLI 命令。</p>
<div class="docs-code shell">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line">ng run builder-test:copy-package --destination=package-other.json</div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_ref_id="akq802z79nv3l8xjjrvixn2bj">这会将文件复制到 
<code>package-other.json</code>，而不是 
<code>package-copy.json</code>。因为你没有覆盖 
<em>source</em> 选项，它仍会从默认的 
<code>package.json</code> 文件进行复制。</p>

  <h2 id="testing-a-builder">
    <a href="#testing-a-builder" class="docs-anchor" tabindex="-1" aria-label="Link to Testing a builder" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="76v60t367d30jnmj6ny5c3pgg">测试构建器</a>
  </h2>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="6vreyjcgppb3pdtpkwwupqjyw">为你的 builder 使用集成测试，这样你就可以使用 Architect 调度器创建上下文，如这个 
<a href="https://github.com/mgechev/cli-builders-demo" target="_blank">示例</a> 中所示。在 builder 源目录中，创建一个新的测试文件 
<code>my-builder.spec.ts</code>。该测试会创建 
<code>JsonSchemaRegistry</code>（用于 schema 验证）、
<code>TestingArchitectHost</code>（
<code>ArchitectHost</code> 的内存实现）和 
<code>Architect</code> 的新实例。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="7an6uvui2e4vw4o8e2ufwuvrx">下面是运行此复制文件构建器的测试范例。该测试使用该构建器来复制 <code>package.json</code> 文件，并验证复制后的文件内容与源文件相同。</p>
<div class="docs-code" path="adev/src/content/examples/cli-builder/src/my-builder.spec.ts" header="src/my-builder.spec.ts">
    <div class="docs-code-header"><h3>src/my-builder.spec.ts</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">Architect</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular-devkit/architect'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">TestingArchitectHost</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular-devkit/architect/testing'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {schema} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular-devkit/core'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {promises <span class="hljs-keyword">as</span> fs} <span class="hljs-keyword">from</span> <span class="hljs-string">'fs'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {join} <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-title function_">describe</span>(<span class="hljs-string">'Copy File Builder'</span>, <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">  <span class="hljs-keyword">let</span> <span class="hljs-attr">architect</span>: <span class="hljs-title class_">Architect</span>;</div><div class="hljs-ln-line">  <span class="hljs-keyword">let</span> <span class="hljs-attr">architectHost</span>: <span class="hljs-title class_">TestingArchitectHost</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">beforeEach</span>(<span class="hljs-keyword">async</span> () =&gt; {</div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> registry = <span class="hljs-keyword">new</span> schema.<span class="hljs-title class_">CoreSchemaRegistry</span>();</div><div class="hljs-ln-line">    registry.<span class="hljs-title function_">addPostTransform</span>(schema.<span class="hljs-property">transforms</span>.<span class="hljs-property">addUndefinedDefaults</span>);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">// TestingArchitectHost() takes workspace and current directories.</span></div><div class="hljs-ln-line">    <span class="hljs-comment">// Since we don't use those, both are the same in this case.</span></div><div class="hljs-ln-line">    architectHost = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestingArchitectHost</span>(__dirname, __dirname);</div><div class="hljs-ln-line">    architect = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Architect</span>(architectHost, registry);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">// This will either take a Node package name, or a path to the directory</span></div><div class="hljs-ln-line">    <span class="hljs-comment">// for the package.json file.</span></div><div class="hljs-ln-line">    <span class="hljs-keyword">await</span> architectHost.<span class="hljs-title function_">addBuilderFromPackage</span>(<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'..'</span>));</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-title function_">it</span>(<span class="hljs-string">'can copy files'</span>, <span class="hljs-keyword">async</span> () =&gt; {</div><div class="hljs-ln-line">    <span class="hljs-comment">// A "run" can have multiple outputs, and contains progress information.</span></div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> run = <span class="hljs-keyword">await</span> architect.<span class="hljs-title function_">scheduleBuilder</span>(<span class="hljs-string">'@example/copy-file:copy'</span>, {</div><div class="hljs-ln-line">      <span class="hljs-attr">source</span>: <span class="hljs-string">'package.json'</span>,</div><div class="hljs-ln-line">      <span class="hljs-attr">destination</span>: <span class="hljs-string">'package-copy.json'</span>,</div><div class="hljs-ln-line">    });</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">// The "result" member (of type BuilderOutput) is the next output.</span></div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> output = <span class="hljs-keyword">await</span> run.<span class="hljs-property">result</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">// Stop the builder from running. This stops Architect from keeping</span></div><div class="hljs-ln-line">    <span class="hljs-comment">// the builder-associated states in memory, since builders keep waiting</span></div><div class="hljs-ln-line">    <span class="hljs-comment">// to be scheduled.</span></div><div class="hljs-ln-line">    <span class="hljs-keyword">await</span> run.<span class="hljs-title function_">stop</span>();</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-comment">// Expect that the copied file is the same as its source.</span></div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> sourceContent = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readFile</span>(<span class="hljs-string">'package.json'</span>, <span class="hljs-string">'utf8'</span>);</div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> destinationContent = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readFile</span>(<span class="hljs-string">'package-copy.json'</span>, <span class="hljs-string">'utf8'</span>);</div><div class="hljs-ln-line">    <span class="hljs-title function_">expect</span>(destinationContent).<span class="hljs-title function_">toBe</span>(sourceContent);</div><div class="hljs-ln-line">  });</div><div class="hljs-ln-line">});</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div>
    <div class="docs-alert docs-alert-helpful">
    <p data-ng_translator_product="100" data-ng_translator_ref_id="5effsjscxriky75daq7jwe878"><strong>有用提示：</strong> 在你的仓库中运行此测试时，你需要 
<a href="https://github.com/TypeStrong/ts-node" target="_blank"><code>ts-node</code></a> 包。你可以通过将 
<code>my-builder.spec.ts</code> 重命名为 
<code>my-builder.spec.js</code> 来避免此问题。</p>

    </div>
    
  <h3 id="watch-mode">
    <a href="#watch-mode" class="docs-anchor" tabindex="-1" aria-label="Link to Watch mode" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="3kp0kq6h4xp3h8xnjsuxa6pem">监视（watch）模式</a>
  </h3>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="14vrf0qdpzv37nzysnlfgwdwh">大多数 builders 都是一次运行并返回。然而，这种行为与监视更改的 builder（例如开发服务器）不完全兼容。Architect 可以支持监视模式，但有一些注意事项。</p>

  <ul class="docs-list">
    <li><p data-ng_translator_product="100" data-ng_translator_ref_id="2s37188tix1jelksyzh6qfl1j">要与监视模式一起使用，builder 处理函数应返回一个 
<code>Observable</code>。Architect 会订阅该 
<code>Observable</code> 直到它完成，并且如果使用相同的参数再次调度该 builder，可能会复用它。</p>
</li>
<li><p data-ng_translator_product="100" data-ng_translator_ref_id="7y06rmxz2k6i66emnc52m42hw">builder 应该在每次执行后始终发出一个 
<code>BuilderOutput</code> 对象。执行后，它可以进入监视模式，等待外部事件触发。如果事件触发它重新启动，builder 应该执行 
<code>context.reportRunning()</code> 函数，告知 Architect 它正在运行。这可以防止 Architect 在另一个运行被调度时停止该 builder。</p>
</li>

  </ul>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="ckrxp8g88m2qdtk8ny02widxs">当你的 builder 调用 
<code>BuilderRun.stop()</code> 退出监视模式时，Architect 会取消订阅 builder 的 
<code>Observable</code> 并调用 builder 的拆解逻辑进行清理。这种行为也允许长时间运行的构建被停止和清理。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="94ot10c8uub5h3bphdmprmn7t">一般来说，如果你的构建器正在监视一个外部事件，你应该把你的运行分成三个阶段。</p>

  <div class="docs-table docs-scroll-track-transparent">
    <table>
      <thead>
        <tr>
<th align="left" data-ng_translator_product="100" data-ng_translator_ref_id="2v8iozxk892ni0taax8ij1mry">阶段</th>
<th align="left" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="3prlgfrx5eo2xqncnnob4crxu">详情</th>
</tr>

      </thead>
      <tbody>
        <tr>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="5frl2ir0exfvl8imvuiuljuo9">运行中</td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="c8z9lb7sglz8rkm4ry79a15b1">正在执行的任务，比如调用编译器。这个过程在编译器完成并且你的构建器发出一个 
<code>BuilderOutput</code> 对象时结束。</td>
</tr>
<tr>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="37f7flgry1x95bjv914i9u06v">监视</td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="drel2opkw00m9ivqvpc80qg84">在两次运行之间，监视某个外部事件流。例如，监视文件系统是否有任何变化。这在编译器重新启动并且调用 
<code>context.reportRunning()</code> 时结束。</td>
</tr>
<tr>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="2u4dioitnz04de7ge1ldln80e">完成</td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="7g5acbl0gx3fuavxfcgex6iqw">要么任务已完全完成（例如编译器需要运行多次），要么构建器运行已停止（使用 
<code>BuilderRun.stop()</code>）。Architect 会执行拆卸逻辑并从你的构建器的 
<code>Observable</code> 中取消订阅。</td>
</tr>

      </tbody>
    </table>
  </div>
  
  <h2 id="summary">
    <a href="#summary" class="docs-anchor" tabindex="-1" aria-label="Link to Summary" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="2fflknbbur8ttwdtn3o9w4vat">总结</a>
  </h2>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="5azarob1xecu7vdiggwpb8mjj">CLI 构建器 API 提供了一种通过使用构建器执行自定义逻辑来更改 Angular CLI 行为的方法。</p>

  <ul class="docs-list">
    <li data-ng_translator_product="100" data-ng_translator_ref_id="7h7l0m6i6c8afy81d0p8ybxr5">构建器可以是同步的或异步的，执行一次或监听外部事件，并且可以调度其他构建器或目标。</li>
<li data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="2v44ljs7tudqb5upt6pvv0mk1">构建器在 <code>angular.json</code> 配置文件中指定了选项的默认值，它可以被目标的备用配置覆盖，还可以进一步被命令行标志所覆盖</li>
<li data-ng_translator_product="100" data-ng_translator_ref_id="9a2981381fucd782jfx2d7s53">Angular 团队建议你使用集成测试来测试 Architect 构建器。使用单元测试来验证构建器执行的逻辑。</li>
<li data-ng_translator_product="100" data-ng_translator_ref_id="d9eonx8da8tuf1d5ydpaejqxt">如果你的构建器返回一个 
<code>Observable</code>，它应在该 
<code>Observable</code> 的拆卸逻辑中清理构建器。</li>

  </ul>
  