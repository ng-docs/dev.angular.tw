<header class="docs-header">
      <docs-breadcrumb></docs-breadcrumb>

      
  <!-- Page title -->
  <div class="docs-page-title">
    <h1 tabindex="-1" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="c0tpmwh7ayfgel7xsonxno8h3">库的原理图</h1>
    <a class="docs-github-links" target="_blank" href="https://github.com/angular/angular/edit/main/adev/src/content/tools/cli/schematics-for-libraries.md" title="Edit this page" aria-label="Edit this page">
      <!-- Pencil -->
      <docs-icon role="presentation">edit</docs-icon>
    </a>
  </div>
    </header>
    <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="c67mo0zy32owx4mcuktajykv">当创建 Angular 库时，你可以为同时为它打包进一组原理图，并把它与 Angular CLI 集成在一起。借助原理图，用户可以用 <code>ng add</code> 来安装你这个库的初始版本，可以用 <code>ng generate</code> 来创建你在库中定义的一些工件，可以用 <code>ng update</code> 来调整他们的项目，以支持你在库的新版本中引入的重大变更。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="658i64tiye6kda2gzcbx7cbfh">这三种原理图都可以作为你打包进库中的集合的一部分。</p>

  <h2 id="creating-a-schematics-collection">
    <a href="#creating-a-schematics-collection" class="docs-anchor" tabindex="-1" aria-label="Link to Creating a schematics collection" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="bpow710nw9arsmw4yue91x4na">创建一个原理图集合</a>
  </h2>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="c8u426bzgp76avdupx6c6lkmy">要开始一个集合，你需要创建一些原理图文件。下列步骤说明了如何在不修改任何项目文件的情况下添加初始支持。</p>

    <ol class="docs-ordered-list">
      <li><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="bfwfroq8yg91abdrhwgk7mqsl">在库的根文件夹中，创建一个 <code>schematics/</code> 文件夹。</p>
</li>
<li><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="aegf62knclqlwfwd3j0o4lu9g">在 <code>schematics/</code> 文件夹中，为你的第一个原理图创建一个 <code>ng-add/</code> 文件夹。</p>
</li>
<li><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="cclazxcgoszq4dwixw5eiodry">在 <code>schematics/</code> 文件夹的根级，创建一个 <code>collection.json</code> 文件。</p>
</li>
<li><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="3hpvnrr524j8w0a14ttahgxva">编辑 <code>collection.json</code> 文件来定义你的集合的初始模式定义。</p>
<div class="docs-code" path="adev/src/content/examples/schematics-for-libraries/projects/my-lib/schematics/collection.1.json" header="projects/my-lib/schematics/collection.json (Schematics Collection)">
    <div class="docs-code-header"><h3 data-ng_translator_product="100" data-ng_translator_ref_id="5ednp4i98wk9r0whkr7pbr3ej">projects/my-lib/schematics/collection.json（原理图集合）</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line">{</div><div class="hljs-ln-line">  <span class="hljs-string">"$schema"</span>: <span class="hljs-string">"../../../node_modules/@angular-devkit/schematics/collection-schema.json"</span>,</div><div class="hljs-ln-line">  <span class="hljs-string">"schematics"</span>: {</div><div class="hljs-ln-line">    <span class="hljs-string">"ng-add"</span>: {</div><div class="hljs-ln-line">      <span class="hljs-string">"description"</span>: <span class="hljs-string">"Add my library to the project."</span>,</div><div class="hljs-ln-line">      <span class="hljs-string">"factory"</span>: <span class="hljs-string">"./ng-add/index#ngAdd"</span>,</div><div class="hljs-ln-line">      <span class="hljs-string">"schema"</span>: <span class="hljs-string">"./ng-add/schema.json"</span></div><div class="hljs-ln-line">    }</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line">}</div></code>
    </pre>
  </div>
  <ul class="docs-list">
    <li data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="62312gvv6f2fq2jb3cb82nlc1"><code>$schema</code> 路径是相对于 Angular Devkit 集合模式定义的。</li>
<li data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="epe57i8ed73nc0b9y02rn25cx"><code>schematics</code> 对象描述了该集合中的命名原理图。</li>
<li data-ng_translator_product="100" data-ng_translator_ref_id="8boqbqjzogjqf2o71f88oroi0">第一个条目是一个名为 
<code>ng-add</code> 的原理图。 它包含描述，并指向当你的原理图执行时调用的工厂函数。</li>

  </ul>
  </li>
<li><p data-ng_translator_product="100" data-ng_translator_ref_id="7p4g4ldjhodymckn0mbeasvh3">在你的库项目的 
<code>package.json</code> 文件中，添加一个 "schematics" 条目，并指定此条目的路径指向你的 schema 文件。 Angular CLI 使用此条目在运行命令时找到你集合中的命名原理图。</p>
<div class="docs-code" path="adev/src/content/examples/schematics-for-libraries/projects/my-lib/package.json" visiblelines="0,1,2,11,19,20,21" header="projects/my-lib/package.json (Schematics Collection Reference)">
    <div class="docs-code-header"><h3 data-ng_translator_product="100" data-ng_translator_ref_id="b51hzht3e6p23xk35u0cra5hc">projects/my-lib/package.json (原理图集合引用)</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line">{</div><div class="hljs-ln-line">  <span class="hljs-string">"name"</span>: <span class="hljs-string">"my-lib"</span>,</div><div class="hljs-ln-line">  <span class="hljs-string">"version"</span>: <span class="hljs-string">"0.0.1"</span>,</div><div class="hljs-ln-line">  <span class="hljs-string">"scripts"</span>: {</div><div class="hljs-ln-line">    <span class="hljs-string">"build"</span>: <span class="hljs-string">"tsc -p tsconfig.schematics.json"</span>,</div><div class="hljs-ln-line">    <span class="hljs-string">"postbuild"</span>: <span class="hljs-string">"copyfiles schematics/*/schema.json schematics/*/files/** schematics/collection.json ../../dist/my-lib/"</span></div><div class="hljs-ln-line">  },</div><div class="hljs-ln-line">  <span class="hljs-string">"peerDependencies"</span>: {</div><div class="hljs-ln-line">    <span class="hljs-string">"@angular/common"</span>: <span class="hljs-string">"^16.1.0"</span>,</div><div class="hljs-ln-line">    <span class="hljs-string">"@angular/core"</span>: <span class="hljs-string">"^16.1.0"</span></div><div class="hljs-ln-line">  },</div><div class="hljs-ln-line">  <span class="hljs-string">"schematics"</span>: <span class="hljs-string">"./schematics/collection.json"</span>,</div><div class="hljs-ln-line">  <span class="hljs-string">"ng-add"</span>: {</div><div class="hljs-ln-line">    <span class="hljs-string">"save"</span>: <span class="hljs-string">"devDependencies"</span></div><div class="hljs-ln-line">  },</div><div class="hljs-ln-line">  <span class="hljs-string">"devDependencies"</span>: {</div><div class="hljs-ln-line">    <span class="hljs-string">"copyfiles"</span>: <span class="hljs-string">"file:../../node_modules/copyfiles"</span>,</div><div class="hljs-ln-line">    <span class="hljs-string">"typescript"</span>: <span class="hljs-string">"file:../../node_modules/typescript"</span></div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div></li>

    </ol>
    <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="130s5de8lzym0c3wjk348buzi">你所创建的初始模式告诉 CLI 在哪里可以找到支持 <code>ng add</code> 命令的原理图。现在，你已准备好创建该原理图了。</p>

  <h2 id="providing-installation-support">
    <a href="#providing-installation-support" class="docs-anchor" tabindex="-1" aria-label="Link to Providing installation support" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="94bjhcepmuzvsps9f0r0bzs69">提供安装支持</a>
  </h2>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="6fzwzm8b1jok5xa7enyj736hv"><code>ng add</code> 命令的原理图可以增强用户的初始安装过程。可以按如下步骤定义这种原理图。</p>

    <ol class="docs-ordered-list">
      <li data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="81n233alp4yy491dwchggzsei">进入 <code>&lt;lib-root&gt;/schematics/ng-add/</code> 目录。</li>
<li data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="cyooj6deeogp02qrnwvpvcyo8">创建主文件 <code>index.ts</code>。</li>
<li>Open <code>index.ts</code> and add the source code for your schematic factory function.<div class="docs-code" path="adev/src/content/examples/schematics-for-libraries/projects/my-lib/schematics/ng-add/index.ts" header="projects/my-lib/schematics/ng-add/index.ts (ng-add Rule Factory)">
    <div class="docs-code-header"><h3 data-ng_translator_product="100" data-ng_translator_ref_id="7kxyztn0iwyqx7no49cez4luj">projects/my-lib/schematics/ng-add/index.ts (ng-add 规则工厂)</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-keyword">Rule</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular-devkit/schematics'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {addRootImport} <span class="hljs-keyword">from</span> <span class="hljs-string">'@schematics/angular/utility'</span>;</div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-keyword">Schema</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'./schema'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">export <span class="hljs-keyword">function</span> ngAdd(<span class="hljs-keyword">options</span>: <span class="hljs-keyword">Schema</span>): <span class="hljs-keyword">Rule</span> {</div><div class="hljs-ln-line">  // <span class="hljs-keyword">Add</span> an <span class="hljs-keyword">import</span> `MyLibModule` <span class="hljs-keyword">from</span> `my-lib` <span class="hljs-keyword">to</span> the root <span class="hljs-keyword">of</span> the <span class="hljs-keyword">user</span><span class="hljs-string">'s project.</span></div><div class="hljs-ln-line">  return addRootImport(</div><div class="hljs-ln-line">    options.project,</div><div class="hljs-ln-line">    ({code, external}) =&gt; code`${external('MyLibModul<span class="hljs-string">e', '</span>my-lib<span class="hljs-string">')}`,</span></div><div class="hljs-ln-line">  );</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div></li>

    </ol>
    <p data-ng_translator_product="100" data-ng_translator_ref_id="y7bhudvbudklrptl7r3jd1et">Angular CLI 将自动安装此库的最新版本，本示例更进一步，将 
<code>MyLibModule</code> 添加到应用的根部。
<code>addRootImport</code> 函数接受一个需要返回代码块的回调函数。你可以在标记为 
<code>code</code> 的字符串内编写任何代码，任何外部符号都必须用 
<code>external</code> 函数包裹，以确保生成适当的 import 语句。</p>

  <h3 id="define-dependency-type">
    <a href="#define-dependency-type" class="docs-anchor" tabindex="-1" aria-label="Link to Define dependency type" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="5pywyrx1e58sbneypuaqh3cox">定义依赖类型</a>
  </h3>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="f2km5c4v6dj2fnm4qyy2vks1p">如果该库应该添加到 <code>dependencies</code> 中、<code>devDependencies</code> 中，或者不用保存到项目的 <code>package.json</code> 配置文件中，请使用 <code>ng-add</code> 的 <code>save</code> 选项进行配置</p>
<div class="docs-code" path="adev/src/content/examples/schematics-for-libraries/projects/my-lib/package.json" visiblelines="12,13,14" header="projects/my-lib/package.json (ng-add Reference)">
    <div class="docs-code-header"><h3 data-ng_translator_product="100" data-ng_translator_ref_id="4ud9seskyzuvydta6265x64ai">projects/my-lib/package.json (ng-add 引用)</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line">{</div><div class="hljs-ln-line">  <span class="hljs-string">"name"</span>: <span class="hljs-string">"my-lib"</span>,</div><div class="hljs-ln-line">  <span class="hljs-string">"version"</span>: <span class="hljs-string">"0.0.1"</span>,</div><div class="hljs-ln-line">  <span class="hljs-string">"scripts"</span>: {</div><div class="hljs-ln-line">    <span class="hljs-string">"build"</span>: <span class="hljs-string">"tsc -p tsconfig.schematics.json"</span>,</div><div class="hljs-ln-line">    <span class="hljs-string">"postbuild"</span>: <span class="hljs-string">"copyfiles schematics/*/schema.json schematics/*/files/** schematics/collection.json ../../dist/my-lib/"</span></div><div class="hljs-ln-line">  },</div><div class="hljs-ln-line">  <span class="hljs-string">"peerDependencies"</span>: {</div><div class="hljs-ln-line">    <span class="hljs-string">"@angular/common"</span>: <span class="hljs-string">"^16.1.0"</span>,</div><div class="hljs-ln-line">    <span class="hljs-string">"@angular/core"</span>: <span class="hljs-string">"^16.1.0"</span></div><div class="hljs-ln-line">  },</div><div class="hljs-ln-line">  <span class="hljs-string">"schematics"</span>: <span class="hljs-string">"./schematics/collection.json"</span>,</div><div class="hljs-ln-line">  <span class="hljs-string">"ng-add"</span>: {</div><div class="hljs-ln-line">    <span class="hljs-string">"save"</span>: <span class="hljs-string">"devDependencies"</span></div><div class="hljs-ln-line">  },</div><div class="hljs-ln-line">  <span class="hljs-string">"devDependencies"</span>: {</div><div class="hljs-ln-line">    <span class="hljs-string">"copyfiles"</span>: <span class="hljs-string">"file:../../node_modules/copyfiles"</span>,</div><div class="hljs-ln-line">    <span class="hljs-string">"typescript"</span>: <span class="hljs-string">"file:../../node_modules/typescript"</span></div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="9oahsccg0lenq695w6sdn9ol9">可能的值有：</p>

  <div class="docs-table docs-scroll-track-transparent">
    <table>
      <thead>
        <tr>
<th align="left" data-ng_translator_product="100" data-ng_translator_ref_id="bulyvki1easdsqhng9yr2vtyi">值</th>
<th align="left" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="3prlgfrx5eo2xqncnnob4crxu">详情</th>
</tr>

      </thead>
      <tbody>
        <tr>
<td align="left"><code>false</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="axhx0wn01pzowye8334r9bcje">不要将该包添加到 
<code>package.json</code></td>
</tr>
<tr>
<td align="left"><code>true</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="2evca1cjzfqcdpxpjdge4kcva">将该包添加到 dependencies</td>
</tr>
<tr>
<td align="left"><code>"dependencies"</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="2evca1cjzfqcdpxpjdge4kcva">将该包添加到 dependencies</td>
</tr>
<tr>
<td align="left"><code>"devDependencies"</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="asul6b74i2obzzpje1l19t0p2">将该包添加到 devDependencies</td>
</tr>

      </tbody>
    </table>
  </div>
  
  <h2 id="building-your-schematics">
    <a href="#building-your-schematics" class="docs-anchor" tabindex="-1" aria-label="Link to Building your schematics" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="4l3abe1q87gge838veufwbtns">构建你的原理图</a>
  </h2>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="2axveauioqx4oazffswnbg4e8">要把你的原理图和库打包到一起，就必须把这个库配置成单独构建原理图，然后再把它们添加到发布包中。你必须<em>先构建库</em>再构建原理图，这样才能把它们放到正确的目录下。</p>

  <ul class="docs-list">
    <li data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="7g9t02ka8ahfzhs1rmnf565mu">你的库需要一个自定义的 Typescript 配置文件，里面带有如何把原理图编译进库的发布版的一些指令。</li>
<li data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="a4j9f6twqmdumpdjmbj57aciz">要把这些原理图添加到库的发布包中，就要把这些脚本添加到该库的 <code>package.json</code> 文件中。</li>

  </ul>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="6u2i5z5gw9itsfkfd5i9ahnus">假设你在 Angular 工作区中有一个库项目 <code>my-lib</code>。要想告诉库如何构建原理图，就要在生成的 <code>tsconfig.lib.json</code> 库配置文件旁添加一个 <code>tsconfig.schematics.json</code> 文件。</p>

    <ol class="docs-ordered-list">
      <li><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="ccuviw7hrh39mbcwuz4upfo0v">编辑 <code>tsconfig.schematics.json</code> 文件，添加如下内容。</p>
<div class="docs-code" path="adev/src/content/examples/schematics-for-libraries/projects/my-lib/tsconfig.schematics.json" header="projects/my-lib/tsconfig.schematics.json (TypeScript Config)">
    <div class="docs-code-header"><h3 data-ng_translator_product="100" data-ng_translator_ref_id="clra65kj5svbzpdc49x49z0on">projects/my-lib/tsconfig.schematics.json (TypeScript 配置)</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line">{</div><div class="hljs-ln-line">  <span class="hljs-string">"compilerOptions"</span>: {</div><div class="hljs-ln-line">    <span class="hljs-string">"baseUrl"</span>: <span class="hljs-string">"."</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">    <span class="hljs-string">"lib"</span>: [</div><div class="hljs-ln-line">      <span class="hljs-string">"es2018"</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">      <span class="hljs-string">"dom"</span></div><div class="hljs-ln-line">    ]<span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">    <span class="hljs-string">"declaration"</span>: <span class="hljs-literal">true</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">    <span class="hljs-string">"module"</span>: <span class="hljs-string">"commonjs"</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">    <span class="hljs-string">"moduleResolution"</span>: <span class="hljs-string">"node"</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">    <span class="hljs-string">"noEmitOnError"</span>: <span class="hljs-literal">true</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">    <span class="hljs-string">"noFallthroughCasesInSwitch"</span>: <span class="hljs-literal">true</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">    <span class="hljs-string">"noImplicitAny"</span>: <span class="hljs-literal">true</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">    <span class="hljs-string">"noImplicitThis"</span>: <span class="hljs-literal">true</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">    <span class="hljs-string">"noUnusedParameters"</span>: <span class="hljs-literal">true</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">    <span class="hljs-string">"noUnusedLocals"</span>: <span class="hljs-literal">true</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">    <span class="hljs-string">"rootDir"</span>: <span class="hljs-string">"schematics"</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">    <span class="hljs-string">"outDir"</span>: <span class="hljs-string">"../../dist/my-lib/schematics"</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">    <span class="hljs-string">"skipDefaultLibCheck"</span>: <span class="hljs-literal">true</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">    <span class="hljs-string">"skipLibCheck"</span>: <span class="hljs-literal">true</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">    <span class="hljs-string">"sourceMap"</span>: <span class="hljs-literal">true</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">    <span class="hljs-string">"strictNullChecks"</span>: <span class="hljs-literal">true</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">    <span class="hljs-string">"target"</span>: <span class="hljs-string">"es6"</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">    <span class="hljs-string">"types"</span>: [</div><div class="hljs-ln-line">      <span class="hljs-string">"jasmine"</span><span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">      <span class="hljs-string">"node"</span></div><div class="hljs-ln-line">    ]</div><div class="hljs-ln-line">  }<span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">  <span class="hljs-string">"include"</span>: [</div><div class="hljs-ln-line">    <span class="hljs-string">"schematics/**/*"</span></div><div class="hljs-ln-line">  ]<span class="hljs-punctuation">,</span></div><div class="hljs-ln-line">  <span class="hljs-string">"exclude"</span>: [</div><div class="hljs-ln-line">    <span class="hljs-string">"schematics/*/files/**/*"</span></div><div class="hljs-ln-line">  ]</div><div class="hljs-ln-line">}</div></code>
    </pre>
  </div>
  <div class="docs-table docs-scroll-track-transparent">
    <table>
      <thead>
        <tr>
<th align="left" data-ng_translator_product="100" data-ng_translator_ref_id="cyk2rtnidu0xcswyg7218m57s">选项</th>
<th align="left" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="3prlgfrx5eo2xqncnnob4crxu">详情</th>
</tr>

      </thead>
      <tbody>
        <tr>
<td align="left"><code>rootDir</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="9a7tnjtgr2h91q1o0ifbocf6o">指定你的 
<code>schematics</code> 文件夹包含要编译的输入文件。</td>
</tr>
<tr>
<td align="left"><code>outDir</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="eo3z19powq7wrv337bid1ycoq">映射到库的输出文件夹。默认情况下，这是工作区根目录下的 
<code>dist/my-lib</code> 文件夹。</td>
</tr>

      </tbody>
    </table>
  </div>
  </li>
<li><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="yuqq5pf4j1qhee1y39jnxv1h">要确保你的原理图源文件会被编译进库包中，请把下列脚本添加到库项目的根文件夹（<code>projects/my-lib</code>）下的 <code>package.json</code> 文件中。</p>
<div class="docs-code" path="adev/src/content/examples/schematics-for-libraries/projects/my-lib/package.json" header="projects/my-lib/package.json (Build Scripts)">
    <div class="docs-code-header"><h3 data-ng_translator_product="100" data-ng_translator_ref_id="287gsclm635s6xvhz2hf8sx7n">projects/my-lib/package.json (构建脚本)</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line">{</div><div class="hljs-ln-line">  <span class="hljs-string">"name"</span>: <span class="hljs-string">"my-lib"</span>,</div><div class="hljs-ln-line">  <span class="hljs-string">"version"</span>: <span class="hljs-string">"0.0.1"</span>,</div><div class="hljs-ln-line">  <span class="hljs-string">"scripts"</span>: {</div><div class="hljs-ln-line">    <span class="hljs-string">"build"</span>: <span class="hljs-string">"tsc -p tsconfig.schematics.json"</span>,</div><div class="hljs-ln-line">    <span class="hljs-string">"postbuild"</span>: <span class="hljs-string">"copyfiles schematics/*/schema.json schematics/*/files/** schematics/collection.json ../../dist/my-lib/"</span></div><div class="hljs-ln-line">  },</div><div class="hljs-ln-line">  <span class="hljs-string">"peerDependencies"</span>: {</div><div class="hljs-ln-line">    <span class="hljs-string">"@angular/common"</span>: <span class="hljs-string">"^16.1.0"</span>,</div><div class="hljs-ln-line">    <span class="hljs-string">"@angular/core"</span>: <span class="hljs-string">"^16.1.0"</span></div><div class="hljs-ln-line">  },</div><div class="hljs-ln-line">  <span class="hljs-string">"schematics"</span>: <span class="hljs-string">"./schematics/collection.json"</span>,</div><div class="hljs-ln-line">  <span class="hljs-string">"ng-add"</span>: {</div><div class="hljs-ln-line">    <span class="hljs-string">"save"</span>: <span class="hljs-string">"devDependencies"</span></div><div class="hljs-ln-line">  },</div><div class="hljs-ln-line">  <span class="hljs-string">"devDependencies"</span>: {</div><div class="hljs-ln-line">    <span class="hljs-string">"copyfiles"</span>: <span class="hljs-string">"file:../../node_modules/copyfiles"</span>,</div><div class="hljs-ln-line">    <span class="hljs-string">"typescript"</span>: <span class="hljs-string">"file:../../node_modules/typescript"</span></div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div>
  <ul class="docs-list">
    <li data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="6tj8lux7qswqyfayb270b9gsr"><code>build</code> 脚本使用自定义的 <code>tsconfig.schematics.json</code> 文件来编译你的原理图。</li>
<li data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="hdek7tc8fquu0h36e4vdroc"><code>postbuild</code> 脚本会在 <code>build</code> 脚本完成后复制原理图文件。</li>
<li data-ng_translator_product="100" data-ng_translator_ref_id="8xmi4u36694mxp1nas3lonkm"><code>build</code> 和 
<code>postbuild</code> 脚本都需要 
<code>copyfiles</code> 和 
<code>typescript</code> 依赖项。 要安装这些依赖项，导航到 
<code>devDependencies</code> 中定义的路径，并在运行脚本之前运行 
<code>npm install</code>。</li>

  </ul>
  </li>

    </ol>
    
  <h2 id="providing-generation-support">
    <a href="#providing-generation-support" class="docs-anchor" tabindex="-1" aria-label="Link to Providing generation support" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="4zsjzh8rwo8inpret06exllih">提供生成器支持</a>
  </h2>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="83kly8jc2wvezd7l7v86yvydt">你可以把一个命名原理图添加到集合中，让你的用户可以使用 <code>ng generate</code> 命令来创建你在库中定义的工件。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="9ysvduow8csoqjp1jpu8dvrnf">我们假设你的库定义了一项需要进行某些设置的服务 <code>my-service</code>。你希望用户能够用下面的 CLI 命令来生成它。</p>
<div class="docs-code shell">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line">ng generate my-lib:my-service</div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="8n6m32ttmownklzl07fzktbs8">首先，在 <code>schematics</code> 文件夹中新建一个子文件夹 <code>my-service</code>。</p>

  <h3 id="configure-the-new-schematic">
    <a href="#configure-the-new-schematic" class="docs-anchor" tabindex="-1" aria-label="Link to Configure the new schematic" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="8ratkdlkod58smkz0nmlq17rl">配置新的原理图</a>
  </h3>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="9jgiryoxn1oauqxfonhuw79sx">当你要把一个原理图添加到集合中时，就必须在该集合的模式中指向它，并提供一些配置文件来定义用户可以传给该命令的选项。</p>

    <ol class="docs-ordered-list">
      <li><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="aoul61nwksf8ha0pbks6h82">编辑一下 <code>schematics/collection.json</code> 文件，指向新的原理图子文件夹，并附上一个指向模式文件的指针，该文件将会指定新原理图的输入。</p>
<div class="docs-code" path="adev/src/content/examples/schematics-for-libraries/projects/my-lib/schematics/collection.json" header="projects/my-lib/schematics/collection.json (Schematics Collection)">
    <div class="docs-code-header"><h3 data-ng_translator_product="100" data-ng_translator_ref_id="5ednp4i98wk9r0whkr7pbr3ej">projects/my-lib/schematics/collection.json（原理图集合）</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line">{</div><div class="hljs-ln-line">  <span class="hljs-string">"$schema"</span>: <span class="hljs-string">"../../../node_modules/@angular-devkit/schematics/collection-schema.json"</span>,</div><div class="hljs-ln-line">  <span class="hljs-string">"schematics"</span>: {</div><div class="hljs-ln-line">    <span class="hljs-string">"ng-add"</span>: {</div><div class="hljs-ln-line">      <span class="hljs-string">"description"</span>: <span class="hljs-string">"Add my library to the project."</span>,</div><div class="hljs-ln-line">      <span class="hljs-string">"factory"</span>: <span class="hljs-string">"./ng-add/index<span class="hljs-subst">#ngAdd</span>"</span>,</div><div class="hljs-ln-line">      <span class="hljs-string">"schema"</span>: <span class="hljs-string">"./ng-add/schema.json"</span></div><div class="hljs-ln-line">    },</div><div class="hljs-ln-line">    <span class="hljs-string">"my-service"</span>: {</div><div class="hljs-ln-line">      <span class="hljs-string">"description"</span>: <span class="hljs-string">"Generate a service in the project."</span>,</div><div class="hljs-ln-line">      <span class="hljs-string">"factory"</span>: <span class="hljs-string">"./my-service/index<span class="hljs-subst">#myService</span>"</span>,</div><div class="hljs-ln-line">      <span class="hljs-string">"schema"</span>: <span class="hljs-string">"./my-service/schema.json"</span></div><div class="hljs-ln-line">    }</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line">}</div></code>
    </pre>
  </div></li>
<li><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="dqdvxe0z2xag7kmp8uk3wbfpz">进入 <code>&lt;lib-root&gt;/schematics/my-service/</code> 目录。</p>
</li>
<li><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="3tok7ekb4nibcqiui6nh8vksu">创建一个 <code>schema.json</code> 文件并定义该原理图的可用选项。</p>
<div class="docs-code" path="adev/src/content/examples/schematics-for-libraries/projects/my-lib/schematics/my-service/schema.json" header="projects/my-lib/schematics/my-service/schema.json (Schematic JSON Schema)">
    <div class="docs-code-header"><h3 data-ng_translator_product="100" data-ng_translator_ref_id="kotchshsyps9g1ectryqpabb">projects/my-lib/schematics/my-service/schema.json (原理图 JSON Schema)</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line">{</div><div class="hljs-ln-line">  <span class="hljs-string">"<span class="hljs-variable">$schema</span>"</span>: <span class="hljs-string">"http://json-schema.org/schema"</span>,</div><div class="hljs-ln-line">  <span class="hljs-string">"<span class="hljs-variable">$id</span>"</span>: <span class="hljs-string">"SchematicsMyService"</span>,</div><div class="hljs-ln-line">  <span class="hljs-string">"title"</span>: <span class="hljs-string">"My Service Schema"</span>,</div><div class="hljs-ln-line">  <span class="hljs-string">"type"</span>: <span class="hljs-string">"object"</span>,</div><div class="hljs-ln-line">  <span class="hljs-string">"properties"</span>: {</div><div class="hljs-ln-line">    <span class="hljs-string">"name"</span>: {</div><div class="hljs-ln-line">      <span class="hljs-string">"description"</span>: <span class="hljs-string">"The name of the service."</span>,</div><div class="hljs-ln-line">      <span class="hljs-string">"type"</span>: <span class="hljs-string">"string"</span></div><div class="hljs-ln-line">    },</div><div class="hljs-ln-line">    <span class="hljs-string">"path"</span>: {</div><div class="hljs-ln-line">      <span class="hljs-string">"type"</span>: <span class="hljs-string">"string"</span>,</div><div class="hljs-ln-line">      <span class="hljs-string">"format"</span>: <span class="hljs-string">"path"</span>,</div><div class="hljs-ln-line">      <span class="hljs-string">"description"</span>: <span class="hljs-string">"The path to create the service."</span>,</div><div class="hljs-ln-line">      <span class="hljs-string">"visible"</span>: <span class="hljs-literal">false</span></div><div class="hljs-ln-line">    },</div><div class="hljs-ln-line">    <span class="hljs-string">"project"</span>: {</div><div class="hljs-ln-line">      <span class="hljs-string">"type"</span>: <span class="hljs-string">"string"</span>,</div><div class="hljs-ln-line">      <span class="hljs-string">"description"</span>: <span class="hljs-string">"The name of the project."</span>,</div><div class="hljs-ln-line">      <span class="hljs-string">"<span class="hljs-variable">$default</span>"</span>: {</div><div class="hljs-ln-line">        <span class="hljs-string">"<span class="hljs-variable">$source</span>"</span>: <span class="hljs-string">"projectName"</span></div><div class="hljs-ln-line">      }</div><div class="hljs-ln-line">    }</div><div class="hljs-ln-line">   },</div><div class="hljs-ln-line">  <span class="hljs-string">"required"</span>: [</div><div class="hljs-ln-line">    <span class="hljs-string">"name"</span></div><div class="hljs-ln-line">  ]</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div>
  <ul class="docs-list">
    <li data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="2cxpsfd3hnrop1yv4q012aaki"><em>id</em>：这个模式定义在集合中的唯一 ID。</li>
<li data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="ev55hglavv0ssw7wlohca6i5b"><em>title</em>：一个人类可读的模式描述。</li>
<li data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="b9k5cng0ginko7uvronqtu8qz"><em>type</em>：由这些属性提供的类型描述符。</li>
<li data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="bxfy5wc8tafa1q12e2ifs88dd"><em>properties</em>：一个定义该原理图可用选项的对象。</li>

  </ul>
  <p data-ng_translator_product="100" data-ng_translator_ref_id="ce66eiezqih9cnmsx1gj4wqxp">每个选项都将键与类型、描述和可选别名关联起来。 类型定义了你期望的值的形状，描述会在用户请求使用帮助时显示。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="binwp5gndhpsrt04mlscfldig">关于原理图的更多自定义选项，请参阅工作区的模式定义。</p>
</li>
<li><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="736i29n1dtaco06apu4urqywa">创建一个 <code>schema.ts</code> 文件，并定义一个接口，用于存放 <code>schema.json</code> 文件中定义的各个选项的值。</p>
<div class="docs-code" path="adev/src/content/examples/schematics-for-libraries/projects/my-lib/schematics/my-service/schema.ts" header="projects/my-lib/schematics/my-service/schema.ts (Schematic Interface)">
    <div class="docs-code-header"><h3 data-ng_translator_product="100" data-ng_translator_ref_id="64f51ufzjpn1yrh9qd98bfrwk">projects/my-lib/schematics/my-service/schema.ts（原理图接口）</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line">export <span class="hljs-keyword">interface</span> <span class="hljs-symbol">Schema</span> {</div><div class="hljs-ln-line">  <span class="hljs-comment">// The name of the service.</span></div><div class="hljs-ln-line">  name: <span class="hljs-built_in">string</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-comment">// The path to create the service.</span></div><div class="hljs-ln-line">  path?: <span class="hljs-built_in">string</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-comment">// The name of the project.</span></div><div class="hljs-ln-line">  project?: <span class="hljs-built_in">string</span>;</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div>
  <div class="docs-table docs-scroll-track-transparent">
    <table>
      <thead>
        <tr>
<th align="left" data-ng_translator_product="100" data-ng_translator_ref_id="cyk2rtnidu0xcswyg7218m57s">选项</th>
<th align="left" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="3prlgfrx5eo2xqncnnob4crxu">详情</th>
</tr>

      </thead>
      <tbody>
        <tr>
<td align="left">name</td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="c1duwhgcx1wujnjv7hnrtx44a">你想为创建的服务提供的名称。</td>
</tr>
<tr>
<td align="left">path</td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="f09j6348j6jwiutf3wkdwkrxp">覆盖提供给原理图的路径。默认路径值基于当前工作目录。</td>
</tr>
<tr>
<td align="left">project</td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="2pkm7z4ltkx29e3ewd8619603">提供一个特定的项目来运行此原理图。在原理图中，如果用户未提供此选项，可以提供一个默认值。</td>
</tr>

      </tbody>
    </table>
  </div>
  </li>

    </ol>
    
  <h3 id="add-template-files">
    <a href="#add-template-files" class="docs-anchor" tabindex="-1" aria-label="Link to Add template files" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="5k2cddbg2hta9xlw5uzsl8wd9">添加模板文件</a>
  </h3>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="byffjy2ci3r5dvqcm3fremfoo">要把工件添加到项目中，你的原理图就需要自己的模板文件。原理图模板支持特殊的语法来执行代码和变量替换。</p>

    <ol class="docs-ordered-list">
      <li><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="9hqm2grze7pgowmy84gnsewg5">在 <code>schematics/my-service/</code> 目录下创建一个 <code>files/</code> 文件夹。</p>
</li>
<li><p data-ng_translator_product="100" data-ng_translator_ref_id="21aw98ug6r93rczc4n77lcxwu">创建一个名为
<code>__name@dasherize__.service.ts.template</code>的文件，定义用于生成文件的模板。 此模板将生成一个在构造函数中已经注入了 Angular 的
<code>HttpClient</code>的服务。</p>
<div class="docs-code" header="projects/my-lib/schematics/my-service/files/__name@dasherize__.service.ts.template (Schematic Template)">
    <div class="docs-code-header"><h3 data-ng_translator_product="100" data-ng_translator_ref_id="e4vu72wep8kis00mej6if00oj">projects/my-lib/schematics/my-service/files/__name@dasherize__.service.ts.template（原理图模板）</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Injectable</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;</div><div class="hljs-ln-line"> <span class="hljs-keyword">import</span> { <span class="hljs-title class_">HttpClient</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/common/http'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"> <span class="hljs-meta">@Injectable</span>({</div><div class="hljs-ln-line">   <span class="hljs-attr">providedIn</span>: <span class="hljs-string">'root'</span></div><div class="hljs-ln-line"> })</div><div class="hljs-ln-line"> <span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> &lt;%= <span class="hljs-title function_">classify</span>(name) %&gt;<span class="hljs-title class_">Service</span> {</div><div class="hljs-ln-line">   <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> http: HttpClient</span>) { }</div><div class="hljs-ln-line"> }</div></code>
    </pre>
  </div>
  <ul class="docs-list">
    <li><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="8zbw2vf0vnb4vx60geddk8h2e"><code>classify</code> 和 <code>dasherize</code> 方法是实用函数，你的原理图会用它们来转换你的模板源码和文件名。</p>
</li>
<li><p data-ng_translator_product="100" data-ng_translator_ref_id="2n8x4lon62td3xsgto14pra61"><code>name</code>作为属性从你的工厂函数中提供。 它与在 schema 中定义的
<code>name</code>相同。</p>
</li>

  </ul>
  </li>

    </ol>
    
  <h3 id="add-the-factory-function">
    <a href="#add-the-factory-function" class="docs-anchor" tabindex="-1" aria-label="Link to Add the factory function" data-ng_translator_product="100" data-ng_translator_ref_id="bkfp92wn0lqwx2ryf50kq0bjg">添加工厂函数</a>
  </h3>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="bkal07o7vhrvchj40eearnpnz">现在，你已经有了基础设施，可以开始定义一个 main 函数来执行要对用户项目做的各种修改了。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="dp6y0365lt1ajv0xee5hjppjk">Schematics 框架提供了一个文件模板系统，它支持路径和内容模板。系统会操作在这个输入文件树（<code>Tree</code>）中加载的文件内或路径中定义的占位符，用传给 <code>Rule</code> 的值来填充它们。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="4f7p468ng6ainpysaz27yzk7m">有关这些数据结构和语法的详细信息，请参见
<a href="https://github.com/angular/angular-cli/blob/main/packages/angular_devkit/schematics/README.md" target="_blank">原理图 README</a>。</p>

    <ol class="docs-ordered-list">
      <li><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="ew04tgyh0co70zc5b85klntd3">创建主文件 <code>index.ts</code> 并为你的原理图工厂函数添加源代码。</p>
</li>
<li><p data-ng_translator_product="100" data-ng_translator_ref_id="4kor03h7kvvvvxf6rwvs30i3t">首先，导入你将需要的原理图定义。 原理图框架提供了许多实用函数，用于在运行原理图时创建和使用规则。</p>
<div class="docs-code" path="adev/src/content/examples/schematics-for-libraries/projects/my-lib/schematics/my-service/index.ts" visiblelines="0,1,2,3,4,5,6,7,8,9,10,11,12" header="projects/my-lib/schematics/my-service/index.ts (Imports)">
    <div class="docs-code-header"><h3 data-ng_translator_product="100" data-ng_translator_ref_id="82obyb5rl7a6jb6bv7qtvhrkr">projects/my-lib/schematics/my-service/index.ts（导入）</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {</div><div class="hljs-ln-line">  <span class="hljs-title class_">Rule</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">Tree</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">SchematicsException</span>,</div><div class="hljs-ln-line">  apply,</div><div class="hljs-ln-line">  url,</div><div class="hljs-ln-line">  applyTemplates,</div><div class="hljs-ln-line">  move,</div><div class="hljs-ln-line">  chain,</div><div class="hljs-ln-line">  mergeWith,</div><div class="hljs-ln-line">} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular-devkit/schematics'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {strings, normalize, virtualFs, workspaces} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular-devkit/core'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">Schema</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">MyServiceSchema</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'./schema'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createHost</span>(<span class="hljs-params">tree: Tree</span>): workspaces.<span class="hljs-property">WorkspaceHost</span> {</div><div class="hljs-ln-line">  <span class="hljs-keyword">return</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">async</span> <span class="hljs-title function_">readFile</span>(<span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> data = tree.<span class="hljs-title function_">read</span>(path);</div><div class="hljs-ln-line">      <span class="hljs-keyword">if</span> (!data) {</div><div class="hljs-ln-line">        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SchematicsException</span>(<span class="hljs-string">'File not found.'</span>);</div><div class="hljs-ln-line">      }</div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> virtualFs.<span class="hljs-title function_">fileBufferToString</span>(data);</div><div class="hljs-ln-line">    },</div><div class="hljs-ln-line">    <span class="hljs-keyword">async</span> <span class="hljs-title function_">writeFile</span>(<span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> tree.<span class="hljs-title function_">overwrite</span>(path, data);</div><div class="hljs-ln-line">    },</div><div class="hljs-ln-line">    <span class="hljs-keyword">async</span> <span class="hljs-title function_">isDirectory</span>(<span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; {</div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> !tree.<span class="hljs-title function_">exists</span>(path) &amp;&amp; tree.<span class="hljs-title function_">getDir</span>(path).<span class="hljs-property">subfiles</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>;</div><div class="hljs-ln-line">    },</div><div class="hljs-ln-line">    <span class="hljs-keyword">async</span> <span class="hljs-title function_">isFile</span>(<span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; {</div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> tree.<span class="hljs-title function_">exists</span>(path);</div><div class="hljs-ln-line">    },</div><div class="hljs-ln-line">  };</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">myService</span>(<span class="hljs-params">options: MyServiceSchema</span>): <span class="hljs-title class_">Rule</span> {</div><div class="hljs-ln-line">  <span class="hljs-keyword">return</span> <span class="hljs-keyword">async</span> (<span class="hljs-attr">tree</span>: <span class="hljs-title class_">Tree</span>) =&gt; {</div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> host = <span class="hljs-title function_">createHost</span>(tree);</div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> {workspace} = <span class="hljs-keyword">await</span> workspaces.<span class="hljs-title function_">readWorkspace</span>(<span class="hljs-string">'/'</span>, host);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> project = options.<span class="hljs-property">project</span> != <span class="hljs-literal">null</span> ? workspace.<span class="hljs-property">projects</span>.<span class="hljs-title function_">get</span>(options.<span class="hljs-property">project</span>) : <span class="hljs-literal">null</span>;</div><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> (!project) {</div><div class="hljs-ln-line">      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SchematicsException</span>(<span class="hljs-string">`Invalid project name: <span class="hljs-subst">${options.project}</span>`</span>);</div><div class="hljs-ln-line">    }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> projectType = project.<span class="hljs-property">extensions</span>.<span class="hljs-property">projectType</span> === <span class="hljs-string">'application'</span> ? <span class="hljs-string">'app'</span> : <span class="hljs-string">'lib'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> (options.<span class="hljs-property">path</span> === <span class="hljs-literal">undefined</span>) {</div><div class="hljs-ln-line">      options.<span class="hljs-property">path</span> = <span class="hljs-string">`<span class="hljs-subst">${project.sourceRoot}</span>/<span class="hljs-subst">${projectType}</span>`</span>;</div><div class="hljs-ln-line">    }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> templateSource = <span class="hljs-title function_">apply</span>(<span class="hljs-title function_">url</span>(<span class="hljs-string">'./files'</span>), [</div><div class="hljs-ln-line">      <span class="hljs-title function_">applyTemplates</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">classify</span>: strings.<span class="hljs-property">classify</span>,</div><div class="hljs-ln-line">        <span class="hljs-attr">dasherize</span>: strings.<span class="hljs-property">dasherize</span>,</div><div class="hljs-ln-line">        <span class="hljs-attr">name</span>: options.<span class="hljs-property">name</span>,</div><div class="hljs-ln-line">      }),</div><div class="hljs-ln-line">      <span class="hljs-title function_">move</span>(<span class="hljs-title function_">normalize</span>(options.<span class="hljs-property">path</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>)),</div><div class="hljs-ln-line">    ]);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> <span class="hljs-title function_">chain</span>([<span class="hljs-title function_">mergeWith</span>(templateSource)]);</div><div class="hljs-ln-line">  };</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div></li>
<li><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="cayv5qhamyy1fm1jp5ivlttat">导入已定义的模式接口，它会为你的原理图选项提供类型信息。</p>
<div class="docs-code" path="adev/src/content/examples/schematics-for-libraries/projects/my-lib/schematics/my-service/index.ts" visiblelines="0,1,2,3,4,5,6,7,8,9,10,11,12,13,14" header="projects/my-lib/schematics/my-service/index.ts (Schema Import)">
    <div class="docs-code-header"><h3 data-ng_translator_product="100" data-ng_translator_ref_id="67y4siqt7j88n642etvvk0pjg">projects/my-lib/schematics/my-service/index.ts（Schema 导入）</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {</div><div class="hljs-ln-line">  <span class="hljs-title class_">Rule</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">Tree</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">SchematicsException</span>,</div><div class="hljs-ln-line">  apply,</div><div class="hljs-ln-line">  url,</div><div class="hljs-ln-line">  applyTemplates,</div><div class="hljs-ln-line">  move,</div><div class="hljs-ln-line">  chain,</div><div class="hljs-ln-line">  mergeWith,</div><div class="hljs-ln-line">} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular-devkit/schematics'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {strings, normalize, virtualFs, workspaces} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular-devkit/core'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">Schema</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">MyServiceSchema</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'./schema'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createHost</span>(<span class="hljs-params">tree: Tree</span>): workspaces.<span class="hljs-property">WorkspaceHost</span> {</div><div class="hljs-ln-line">  <span class="hljs-keyword">return</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">async</span> <span class="hljs-title function_">readFile</span>(<span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> data = tree.<span class="hljs-title function_">read</span>(path);</div><div class="hljs-ln-line">      <span class="hljs-keyword">if</span> (!data) {</div><div class="hljs-ln-line">        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SchematicsException</span>(<span class="hljs-string">'File not found.'</span>);</div><div class="hljs-ln-line">      }</div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> virtualFs.<span class="hljs-title function_">fileBufferToString</span>(data);</div><div class="hljs-ln-line">    },</div><div class="hljs-ln-line">    <span class="hljs-keyword">async</span> <span class="hljs-title function_">writeFile</span>(<span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> tree.<span class="hljs-title function_">overwrite</span>(path, data);</div><div class="hljs-ln-line">    },</div><div class="hljs-ln-line">    <span class="hljs-keyword">async</span> <span class="hljs-title function_">isDirectory</span>(<span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; {</div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> !tree.<span class="hljs-title function_">exists</span>(path) &amp;&amp; tree.<span class="hljs-title function_">getDir</span>(path).<span class="hljs-property">subfiles</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>;</div><div class="hljs-ln-line">    },</div><div class="hljs-ln-line">    <span class="hljs-keyword">async</span> <span class="hljs-title function_">isFile</span>(<span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; {</div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> tree.<span class="hljs-title function_">exists</span>(path);</div><div class="hljs-ln-line">    },</div><div class="hljs-ln-line">  };</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">myService</span>(<span class="hljs-params">options: MyServiceSchema</span>): <span class="hljs-title class_">Rule</span> {</div><div class="hljs-ln-line">  <span class="hljs-keyword">return</span> <span class="hljs-keyword">async</span> (<span class="hljs-attr">tree</span>: <span class="hljs-title class_">Tree</span>) =&gt; {</div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> host = <span class="hljs-title function_">createHost</span>(tree);</div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> {workspace} = <span class="hljs-keyword">await</span> workspaces.<span class="hljs-title function_">readWorkspace</span>(<span class="hljs-string">'/'</span>, host);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> project = options.<span class="hljs-property">project</span> != <span class="hljs-literal">null</span> ? workspace.<span class="hljs-property">projects</span>.<span class="hljs-title function_">get</span>(options.<span class="hljs-property">project</span>) : <span class="hljs-literal">null</span>;</div><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> (!project) {</div><div class="hljs-ln-line">      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SchematicsException</span>(<span class="hljs-string">`Invalid project name: <span class="hljs-subst">${options.project}</span>`</span>);</div><div class="hljs-ln-line">    }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> projectType = project.<span class="hljs-property">extensions</span>.<span class="hljs-property">projectType</span> === <span class="hljs-string">'application'</span> ? <span class="hljs-string">'app'</span> : <span class="hljs-string">'lib'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> (options.<span class="hljs-property">path</span> === <span class="hljs-literal">undefined</span>) {</div><div class="hljs-ln-line">      options.<span class="hljs-property">path</span> = <span class="hljs-string">`<span class="hljs-subst">${project.sourceRoot}</span>/<span class="hljs-subst">${projectType}</span>`</span>;</div><div class="hljs-ln-line">    }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> templateSource = <span class="hljs-title function_">apply</span>(<span class="hljs-title function_">url</span>(<span class="hljs-string">'./files'</span>), [</div><div class="hljs-ln-line">      <span class="hljs-title function_">applyTemplates</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">classify</span>: strings.<span class="hljs-property">classify</span>,</div><div class="hljs-ln-line">        <span class="hljs-attr">dasherize</span>: strings.<span class="hljs-property">dasherize</span>,</div><div class="hljs-ln-line">        <span class="hljs-attr">name</span>: options.<span class="hljs-property">name</span>,</div><div class="hljs-ln-line">      }),</div><div class="hljs-ln-line">      <span class="hljs-title function_">move</span>(<span class="hljs-title function_">normalize</span>(options.<span class="hljs-property">path</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>)),</div><div class="hljs-ln-line">    ]);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> <span class="hljs-title function_">chain</span>([<span class="hljs-title function_">mergeWith</span>(templateSource)]);</div><div class="hljs-ln-line">  };</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div></li>
<li><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="92mja2ifgx7af11th6zhv0e4i">要想构建 "生成器原理图"，我们从一个空白的规则工厂开始。</p>
<div class="docs-code" path="adev/src/content/examples/schematics-for-libraries/projects/my-lib/schematics/my-service/index.1.ts" visiblelines="4,5,6" header="projects/my-lib/schematics/my-service/index.ts (Initial Rule)">
    <div class="docs-code-header"><h3 data-ng_translator_product="100" data-ng_translator_ref_id="3cm4nbnt7w8d3pr3jfomtbi5a">projects/my-lib/schematics/my-service/index.ts（初始规则）</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">Rule</span>, <span class="hljs-title class_">Tree</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular-devkit/schematics'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">Schema</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">MyServiceSchema</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'./schema'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">myService</span>(<span class="hljs-params">options: MyServiceSchema</span>): <span class="hljs-title class_">Rule</span> {</div><div class="hljs-ln-line">  <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">tree: Tree</span>) =&gt;</span> tree;</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div></li>

    </ol>
    <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="5ile85kkr33jze11lmykadm6j">这个规则工厂返回树而不做任何修改。这些选项都是从 <code>ng generate</code> 命令传过来的选项值。</p>

  <h2 id="define-a-generation-rule">
    <a href="#define-a-generation-rule" class="docs-anchor" tabindex="-1" aria-label="Link to Define a generation rule" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="boko0athqp4brsqjihg2fxk1k">定义生成规则</a>
  </h2>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="awg7oxiumdfjjeui14huvatq0">你现在有了一个框架，可用来创建一些真正修改用户程序的代码，以便对库中定义的服务进行设置。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="5y2y1uc6mkfgzdq4rpumiqmlc">用户安装过此库的 Angular 工作区中会包含多个项目（应用和库）。用户可以在命令行中指定一个项目，也可以使用它的默认值。在任何一种情况下，你的代码都需要知道应该在哪个项目上应用此原理图，这样才能从该项目的配置中检索信息。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="5toa3tnyibsgf2rlgo7vfkoku">可以使用传给工厂函数的 <code>Tree</code> 对象来做到这一点。通过 <code>Tree</code> 的一些方法，你可以访问此工作区的完整文件树，以便在运行原理图时读写文件。</p>

  <h3 id="get-the-project-configuration">
    <a href="#get-the-project-configuration" class="docs-anchor" tabindex="-1" aria-label="Link to Get the project configuration" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="77670o14lac2r8zh3x7rl32w2">获取项目配置</a>
  </h3>
  
    <ol class="docs-ordered-list">
      <li><p data-ng_translator_product="100" data-ng_translator_ref_id="2x5e3g9b742mts8hv7c1g1dg6">要确定目标项目，使用
<code>workspaces.readWorkspace</code>方法读取工作区配置文件
<code>angular.json</code>的内容。 要使用
<code>workspaces.readWorkspace</code>，你需要从
<code>Tree</code>创建一个
<code>workspaces.WorkspaceHost</code>。 将以下代码添加到你的工厂函数中。</p>
<div class="docs-code" path="adev/src/content/examples/schematics-for-libraries/projects/my-lib/schematics/my-service/index.ts" visiblelines="0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,64,65,66,67" header="projects/my-lib/schematics/my-service/index.ts (Schema Import)">
    <div class="docs-code-header"><h3 data-ng_translator_product="100" data-ng_translator_ref_id="67y4siqt7j88n642etvvk0pjg">projects/my-lib/schematics/my-service/index.ts（Schema 导入）</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {</div><div class="hljs-ln-line">  <span class="hljs-title class_">Rule</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">Tree</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">SchematicsException</span>,</div><div class="hljs-ln-line">  apply,</div><div class="hljs-ln-line">  url,</div><div class="hljs-ln-line">  applyTemplates,</div><div class="hljs-ln-line">  move,</div><div class="hljs-ln-line">  chain,</div><div class="hljs-ln-line">  mergeWith,</div><div class="hljs-ln-line">} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular-devkit/schematics'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {strings, normalize, virtualFs, workspaces} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular-devkit/core'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">Schema</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">MyServiceSchema</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'./schema'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createHost</span>(<span class="hljs-params">tree: Tree</span>): workspaces.<span class="hljs-property">WorkspaceHost</span> {</div><div class="hljs-ln-line">  <span class="hljs-keyword">return</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">async</span> <span class="hljs-title function_">readFile</span>(<span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> data = tree.<span class="hljs-title function_">read</span>(path);</div><div class="hljs-ln-line">      <span class="hljs-keyword">if</span> (!data) {</div><div class="hljs-ln-line">        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SchematicsException</span>(<span class="hljs-string">'File not found.'</span>);</div><div class="hljs-ln-line">      }</div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> virtualFs.<span class="hljs-title function_">fileBufferToString</span>(data);</div><div class="hljs-ln-line">    },</div><div class="hljs-ln-line">    <span class="hljs-keyword">async</span> <span class="hljs-title function_">writeFile</span>(<span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> tree.<span class="hljs-title function_">overwrite</span>(path, data);</div><div class="hljs-ln-line">    },</div><div class="hljs-ln-line">    <span class="hljs-keyword">async</span> <span class="hljs-title function_">isDirectory</span>(<span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; {</div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> !tree.<span class="hljs-title function_">exists</span>(path) &amp;&amp; tree.<span class="hljs-title function_">getDir</span>(path).<span class="hljs-property">subfiles</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>;</div><div class="hljs-ln-line">    },</div><div class="hljs-ln-line">    <span class="hljs-keyword">async</span> <span class="hljs-title function_">isFile</span>(<span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; {</div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> tree.<span class="hljs-title function_">exists</span>(path);</div><div class="hljs-ln-line">    },</div><div class="hljs-ln-line">  };</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">myService</span>(<span class="hljs-params">options: MyServiceSchema</span>): <span class="hljs-title class_">Rule</span> {</div><div class="hljs-ln-line">  <span class="hljs-keyword">return</span> <span class="hljs-keyword">async</span> (<span class="hljs-attr">tree</span>: <span class="hljs-title class_">Tree</span>) =&gt; {</div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> host = <span class="hljs-title function_">createHost</span>(tree);</div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> {workspace} = <span class="hljs-keyword">await</span> workspaces.<span class="hljs-title function_">readWorkspace</span>(<span class="hljs-string">'/'</span>, host);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> project = options.<span class="hljs-property">project</span> != <span class="hljs-literal">null</span> ? workspace.<span class="hljs-property">projects</span>.<span class="hljs-title function_">get</span>(options.<span class="hljs-property">project</span>) : <span class="hljs-literal">null</span>;</div><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> (!project) {</div><div class="hljs-ln-line">      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SchematicsException</span>(<span class="hljs-string">`Invalid project name: <span class="hljs-subst">${options.project}</span>`</span>);</div><div class="hljs-ln-line">    }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> projectType = project.<span class="hljs-property">extensions</span>.<span class="hljs-property">projectType</span> === <span class="hljs-string">'application'</span> ? <span class="hljs-string">'app'</span> : <span class="hljs-string">'lib'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> (options.<span class="hljs-property">path</span> === <span class="hljs-literal">undefined</span>) {</div><div class="hljs-ln-line">      options.<span class="hljs-property">path</span> = <span class="hljs-string">`<span class="hljs-subst">${project.sourceRoot}</span>/<span class="hljs-subst">${projectType}</span>`</span>;</div><div class="hljs-ln-line">    }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> templateSource = <span class="hljs-title function_">apply</span>(<span class="hljs-title function_">url</span>(<span class="hljs-string">'./files'</span>), [</div><div class="hljs-ln-line">      <span class="hljs-title function_">applyTemplates</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">classify</span>: strings.<span class="hljs-property">classify</span>,</div><div class="hljs-ln-line">        <span class="hljs-attr">dasherize</span>: strings.<span class="hljs-property">dasherize</span>,</div><div class="hljs-ln-line">        <span class="hljs-attr">name</span>: options.<span class="hljs-property">name</span>,</div><div class="hljs-ln-line">      }),</div><div class="hljs-ln-line">      <span class="hljs-title function_">move</span>(<span class="hljs-title function_">normalize</span>(options.<span class="hljs-property">path</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>)),</div><div class="hljs-ln-line">    ]);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> <span class="hljs-title function_">chain</span>([<span class="hljs-title function_">mergeWith</span>(templateSource)]);</div><div class="hljs-ln-line">  };</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="7tbo38wa9c6tcnm1va1474rbf">一定要检查此上下文是否存在，并抛出相应的错误。</p>
</li>
<li><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="13oda8ahwdz2b3b47wvm2vfwi">现在你有了项目名称，用它来检索指定项目的配置信息。</p>
<div class="docs-code" path="adev/src/content/examples/schematics-for-libraries/projects/my-lib/schematics/my-service/index.ts" visiblelines="43,44,45,46,47,48" header="projects/my-lib/schematics/my-service/index.ts (Project)">
    <div class="docs-code-header"><h3 data-ng_translator_product="100" data-ng_translator_ref_id="cktz5p4ua50jb0jw58v54hh2o">projects/my-lib/schematics/my-service/index.ts（项目）</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {</div><div class="hljs-ln-line">  <span class="hljs-title class_">Rule</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">Tree</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">SchematicsException</span>,</div><div class="hljs-ln-line">  apply,</div><div class="hljs-ln-line">  url,</div><div class="hljs-ln-line">  applyTemplates,</div><div class="hljs-ln-line">  move,</div><div class="hljs-ln-line">  chain,</div><div class="hljs-ln-line">  mergeWith,</div><div class="hljs-ln-line">} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular-devkit/schematics'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {strings, normalize, virtualFs, workspaces} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular-devkit/core'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">Schema</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">MyServiceSchema</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'./schema'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createHost</span>(<span class="hljs-params">tree: Tree</span>): workspaces.<span class="hljs-property">WorkspaceHost</span> {</div><div class="hljs-ln-line">  <span class="hljs-keyword">return</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">async</span> <span class="hljs-title function_">readFile</span>(<span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> data = tree.<span class="hljs-title function_">read</span>(path);</div><div class="hljs-ln-line">      <span class="hljs-keyword">if</span> (!data) {</div><div class="hljs-ln-line">        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SchematicsException</span>(<span class="hljs-string">'File not found.'</span>);</div><div class="hljs-ln-line">      }</div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> virtualFs.<span class="hljs-title function_">fileBufferToString</span>(data);</div><div class="hljs-ln-line">    },</div><div class="hljs-ln-line">    <span class="hljs-keyword">async</span> <span class="hljs-title function_">writeFile</span>(<span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> tree.<span class="hljs-title function_">overwrite</span>(path, data);</div><div class="hljs-ln-line">    },</div><div class="hljs-ln-line">    <span class="hljs-keyword">async</span> <span class="hljs-title function_">isDirectory</span>(<span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; {</div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> !tree.<span class="hljs-title function_">exists</span>(path) &amp;&amp; tree.<span class="hljs-title function_">getDir</span>(path).<span class="hljs-property">subfiles</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>;</div><div class="hljs-ln-line">    },</div><div class="hljs-ln-line">    <span class="hljs-keyword">async</span> <span class="hljs-title function_">isFile</span>(<span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; {</div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> tree.<span class="hljs-title function_">exists</span>(path);</div><div class="hljs-ln-line">    },</div><div class="hljs-ln-line">  };</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">myService</span>(<span class="hljs-params">options: MyServiceSchema</span>): <span class="hljs-title class_">Rule</span> {</div><div class="hljs-ln-line">  <span class="hljs-keyword">return</span> <span class="hljs-keyword">async</span> (<span class="hljs-attr">tree</span>: <span class="hljs-title class_">Tree</span>) =&gt; {</div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> host = <span class="hljs-title function_">createHost</span>(tree);</div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> {workspace} = <span class="hljs-keyword">await</span> workspaces.<span class="hljs-title function_">readWorkspace</span>(<span class="hljs-string">'/'</span>, host);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> project = options.<span class="hljs-property">project</span> != <span class="hljs-literal">null</span> ? workspace.<span class="hljs-property">projects</span>.<span class="hljs-title function_">get</span>(options.<span class="hljs-property">project</span>) : <span class="hljs-literal">null</span>;</div><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> (!project) {</div><div class="hljs-ln-line">      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SchematicsException</span>(<span class="hljs-string">`Invalid project name: <span class="hljs-subst">${options.project}</span>`</span>);</div><div class="hljs-ln-line">    }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> projectType = project.<span class="hljs-property">extensions</span>.<span class="hljs-property">projectType</span> === <span class="hljs-string">'application'</span> ? <span class="hljs-string">'app'</span> : <span class="hljs-string">'lib'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> (options.<span class="hljs-property">path</span> === <span class="hljs-literal">undefined</span>) {</div><div class="hljs-ln-line">      options.<span class="hljs-property">path</span> = <span class="hljs-string">`<span class="hljs-subst">${project.sourceRoot}</span>/<span class="hljs-subst">${projectType}</span>`</span>;</div><div class="hljs-ln-line">    }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> templateSource = <span class="hljs-title function_">apply</span>(<span class="hljs-title function_">url</span>(<span class="hljs-string">'./files'</span>), [</div><div class="hljs-ln-line">      <span class="hljs-title function_">applyTemplates</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">classify</span>: strings.<span class="hljs-property">classify</span>,</div><div class="hljs-ln-line">        <span class="hljs-attr">dasherize</span>: strings.<span class="hljs-property">dasherize</span>,</div><div class="hljs-ln-line">        <span class="hljs-attr">name</span>: options.<span class="hljs-property">name</span>,</div><div class="hljs-ln-line">      }),</div><div class="hljs-ln-line">      <span class="hljs-title function_">move</span>(<span class="hljs-title function_">normalize</span>(options.<span class="hljs-property">path</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>)),</div><div class="hljs-ln-line">    ]);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> <span class="hljs-title function_">chain</span>([<span class="hljs-title function_">mergeWith</span>(templateSource)]);</div><div class="hljs-ln-line">  };</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="dadycki16710cqm9phu3sc0lo">此 <code>workspace.projects</code> 对象包含指定项目的全部配置信息。</p>
</li>
<li><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="3ekapjmb4dhxfzp6eleljiojh"><code>options.path</code> 决定了应用原理图之后，要把原理图模板文件移动到的位置。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="ccbmc4yk1xd6u045yw1cklyy6">原理图 schema 中的
<code>path</code>选项默认替换为当前工作目录。 如果未定义
<code>path</code>，使用项目配置中的
<code>sourceRoot</code>和
<code>projectType</code>。</p>
<div class="docs-code" path="adev/src/content/examples/schematics-for-libraries/projects/my-lib/schematics/my-service/index.ts" visiblelines="50,51,52" header="projects/my-lib/schematics/my-service/index.ts (Project Info)">
    <div class="docs-code-header"><h3 data-ng_translator_product="100" data-ng_translator_ref_id="6hf2mwcnwzojg9t2pn89tkoaf">projects/my-lib/schematics/my-service/index.ts（项目信息）</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {</div><div class="hljs-ln-line">  <span class="hljs-title class_">Rule</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">Tree</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">SchematicsException</span>,</div><div class="hljs-ln-line">  apply,</div><div class="hljs-ln-line">  url,</div><div class="hljs-ln-line">  applyTemplates,</div><div class="hljs-ln-line">  move,</div><div class="hljs-ln-line">  chain,</div><div class="hljs-ln-line">  mergeWith,</div><div class="hljs-ln-line">} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular-devkit/schematics'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {strings, normalize, virtualFs, workspaces} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular-devkit/core'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">Schema</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">MyServiceSchema</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'./schema'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createHost</span>(<span class="hljs-params">tree: Tree</span>): workspaces.<span class="hljs-property">WorkspaceHost</span> {</div><div class="hljs-ln-line">  <span class="hljs-keyword">return</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">async</span> <span class="hljs-title function_">readFile</span>(<span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> data = tree.<span class="hljs-title function_">read</span>(path);</div><div class="hljs-ln-line">      <span class="hljs-keyword">if</span> (!data) {</div><div class="hljs-ln-line">        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SchematicsException</span>(<span class="hljs-string">'File not found.'</span>);</div><div class="hljs-ln-line">      }</div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> virtualFs.<span class="hljs-title function_">fileBufferToString</span>(data);</div><div class="hljs-ln-line">    },</div><div class="hljs-ln-line">    <span class="hljs-keyword">async</span> <span class="hljs-title function_">writeFile</span>(<span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> tree.<span class="hljs-title function_">overwrite</span>(path, data);</div><div class="hljs-ln-line">    },</div><div class="hljs-ln-line">    <span class="hljs-keyword">async</span> <span class="hljs-title function_">isDirectory</span>(<span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; {</div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> !tree.<span class="hljs-title function_">exists</span>(path) &amp;&amp; tree.<span class="hljs-title function_">getDir</span>(path).<span class="hljs-property">subfiles</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>;</div><div class="hljs-ln-line">    },</div><div class="hljs-ln-line">    <span class="hljs-keyword">async</span> <span class="hljs-title function_">isFile</span>(<span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; {</div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> tree.<span class="hljs-title function_">exists</span>(path);</div><div class="hljs-ln-line">    },</div><div class="hljs-ln-line">  };</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">myService</span>(<span class="hljs-params">options: MyServiceSchema</span>): <span class="hljs-title class_">Rule</span> {</div><div class="hljs-ln-line">  <span class="hljs-keyword">return</span> <span class="hljs-keyword">async</span> (<span class="hljs-attr">tree</span>: <span class="hljs-title class_">Tree</span>) =&gt; {</div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> host = <span class="hljs-title function_">createHost</span>(tree);</div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> {workspace} = <span class="hljs-keyword">await</span> workspaces.<span class="hljs-title function_">readWorkspace</span>(<span class="hljs-string">'/'</span>, host);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> project = options.<span class="hljs-property">project</span> != <span class="hljs-literal">null</span> ? workspace.<span class="hljs-property">projects</span>.<span class="hljs-title function_">get</span>(options.<span class="hljs-property">project</span>) : <span class="hljs-literal">null</span>;</div><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> (!project) {</div><div class="hljs-ln-line">      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SchematicsException</span>(<span class="hljs-string">`Invalid project name: <span class="hljs-subst">${options.project}</span>`</span>);</div><div class="hljs-ln-line">    }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> projectType = project.<span class="hljs-property">extensions</span>.<span class="hljs-property">projectType</span> === <span class="hljs-string">'application'</span> ? <span class="hljs-string">'app'</span> : <span class="hljs-string">'lib'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> (options.<span class="hljs-property">path</span> === <span class="hljs-literal">undefined</span>) {</div><div class="hljs-ln-line">      options.<span class="hljs-property">path</span> = <span class="hljs-string">`<span class="hljs-subst">${project.sourceRoot}</span>/<span class="hljs-subst">${projectType}</span>`</span>;</div><div class="hljs-ln-line">    }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> templateSource = <span class="hljs-title function_">apply</span>(<span class="hljs-title function_">url</span>(<span class="hljs-string">'./files'</span>), [</div><div class="hljs-ln-line">      <span class="hljs-title function_">applyTemplates</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">classify</span>: strings.<span class="hljs-property">classify</span>,</div><div class="hljs-ln-line">        <span class="hljs-attr">dasherize</span>: strings.<span class="hljs-property">dasherize</span>,</div><div class="hljs-ln-line">        <span class="hljs-attr">name</span>: options.<span class="hljs-property">name</span>,</div><div class="hljs-ln-line">      }),</div><div class="hljs-ln-line">      <span class="hljs-title function_">move</span>(<span class="hljs-title function_">normalize</span>(options.<span class="hljs-property">path</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>)),</div><div class="hljs-ln-line">    ]);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> <span class="hljs-title function_">chain</span>([<span class="hljs-title function_">mergeWith</span>(templateSource)]);</div><div class="hljs-ln-line">  };</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div></li>

    </ol>
    
  <h3 id="define-the-rule">
    <a href="#define-the-rule" class="docs-anchor" tabindex="-1" aria-label="Link to Define the rule" data-ng_translator_product="100" data-ng_translator_ref_id="epggc8qwxcvlf4m5tcj89nw96">定义规则</a>
  </h3>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="exxmduvqzjbyb1v1g8o5v41b3"><code>Rule</code> 可以使用外部模板文件，对它们进行转换，并使用转换后的模板返回另一个 <code>Rule</code> 对象。可以用模板来生成原理图所需的任意自定义文件。</p>

    <ol class="docs-ordered-list">
      <li><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="49rou0ocznfad39yca7dqbz0o">将以下代码添加到工厂函数中。</p>
<div class="docs-code" path="adev/src/content/examples/schematics-for-libraries/projects/my-lib/schematics/my-service/index.ts" visiblelines="54,55,56,57,58,59,60,61" header="projects/my-lib/schematics/my-service/index.ts (Template transform)">
    <div class="docs-code-header"><h3 data-ng_translator_product="100" data-ng_translator_ref_id="70tgjbxi1vgh7qsrwn90x6asu">projects/my-lib/schematics/my-service/index.ts（模板转换）</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {</div><div class="hljs-ln-line">  <span class="hljs-title class_">Rule</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">Tree</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">SchematicsException</span>,</div><div class="hljs-ln-line">  apply,</div><div class="hljs-ln-line">  url,</div><div class="hljs-ln-line">  applyTemplates,</div><div class="hljs-ln-line">  move,</div><div class="hljs-ln-line">  chain,</div><div class="hljs-ln-line">  mergeWith,</div><div class="hljs-ln-line">} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular-devkit/schematics'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {strings, normalize, virtualFs, workspaces} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular-devkit/core'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">Schema</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">MyServiceSchema</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'./schema'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createHost</span>(<span class="hljs-params">tree: Tree</span>): workspaces.<span class="hljs-property">WorkspaceHost</span> {</div><div class="hljs-ln-line">  <span class="hljs-keyword">return</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">async</span> <span class="hljs-title function_">readFile</span>(<span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> data = tree.<span class="hljs-title function_">read</span>(path);</div><div class="hljs-ln-line">      <span class="hljs-keyword">if</span> (!data) {</div><div class="hljs-ln-line">        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SchematicsException</span>(<span class="hljs-string">'File not found.'</span>);</div><div class="hljs-ln-line">      }</div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> virtualFs.<span class="hljs-title function_">fileBufferToString</span>(data);</div><div class="hljs-ln-line">    },</div><div class="hljs-ln-line">    <span class="hljs-keyword">async</span> <span class="hljs-title function_">writeFile</span>(<span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> tree.<span class="hljs-title function_">overwrite</span>(path, data);</div><div class="hljs-ln-line">    },</div><div class="hljs-ln-line">    <span class="hljs-keyword">async</span> <span class="hljs-title function_">isDirectory</span>(<span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; {</div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> !tree.<span class="hljs-title function_">exists</span>(path) &amp;&amp; tree.<span class="hljs-title function_">getDir</span>(path).<span class="hljs-property">subfiles</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>;</div><div class="hljs-ln-line">    },</div><div class="hljs-ln-line">    <span class="hljs-keyword">async</span> <span class="hljs-title function_">isFile</span>(<span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; {</div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> tree.<span class="hljs-title function_">exists</span>(path);</div><div class="hljs-ln-line">    },</div><div class="hljs-ln-line">  };</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">myService</span>(<span class="hljs-params">options: MyServiceSchema</span>): <span class="hljs-title class_">Rule</span> {</div><div class="hljs-ln-line">  <span class="hljs-keyword">return</span> <span class="hljs-keyword">async</span> (<span class="hljs-attr">tree</span>: <span class="hljs-title class_">Tree</span>) =&gt; {</div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> host = <span class="hljs-title function_">createHost</span>(tree);</div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> {workspace} = <span class="hljs-keyword">await</span> workspaces.<span class="hljs-title function_">readWorkspace</span>(<span class="hljs-string">'/'</span>, host);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> project = options.<span class="hljs-property">project</span> != <span class="hljs-literal">null</span> ? workspace.<span class="hljs-property">projects</span>.<span class="hljs-title function_">get</span>(options.<span class="hljs-property">project</span>) : <span class="hljs-literal">null</span>;</div><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> (!project) {</div><div class="hljs-ln-line">      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SchematicsException</span>(<span class="hljs-string">`Invalid project name: <span class="hljs-subst">${options.project}</span>`</span>);</div><div class="hljs-ln-line">    }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> projectType = project.<span class="hljs-property">extensions</span>.<span class="hljs-property">projectType</span> === <span class="hljs-string">'application'</span> ? <span class="hljs-string">'app'</span> : <span class="hljs-string">'lib'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> (options.<span class="hljs-property">path</span> === <span class="hljs-literal">undefined</span>) {</div><div class="hljs-ln-line">      options.<span class="hljs-property">path</span> = <span class="hljs-string">`<span class="hljs-subst">${project.sourceRoot}</span>/<span class="hljs-subst">${projectType}</span>`</span>;</div><div class="hljs-ln-line">    }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> templateSource = <span class="hljs-title function_">apply</span>(<span class="hljs-title function_">url</span>(<span class="hljs-string">'./files'</span>), [</div><div class="hljs-ln-line">      <span class="hljs-title function_">applyTemplates</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">classify</span>: strings.<span class="hljs-property">classify</span>,</div><div class="hljs-ln-line">        <span class="hljs-attr">dasherize</span>: strings.<span class="hljs-property">dasherize</span>,</div><div class="hljs-ln-line">        <span class="hljs-attr">name</span>: options.<span class="hljs-property">name</span>,</div><div class="hljs-ln-line">      }),</div><div class="hljs-ln-line">      <span class="hljs-title function_">move</span>(<span class="hljs-title function_">normalize</span>(options.<span class="hljs-property">path</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>)),</div><div class="hljs-ln-line">    ]);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> <span class="hljs-title function_">chain</span>([<span class="hljs-title function_">mergeWith</span>(templateSource)]);</div><div class="hljs-ln-line">  };</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div>
  <div class="docs-table docs-scroll-track-transparent">
    <table>
      <thead>
        <tr>
<th align="left" data-ng_translator_product="100" data-ng_translator_ref_id="1xubgaqmffibk0p3s7z4lwoiw">方法</th>
<th align="left" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="3prlgfrx5eo2xqncnnob4crxu">详情</th>
</tr>

      </thead>
      <tbody>
        <tr>
<td align="left"><code>apply()</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="4w6c2oz6awcb8pucduci1c7bj">将多个规则应用于源并返回转换后的源。它接受两个参数，一个源和一个规则数组。</td>
</tr>
<tr>
<td align="left"><code>url()</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="5agekbzvjrzkz89mh4sdzjpuf">从你的文件系统中读取与原理图相关的源文件。</td>
</tr>
<tr>
<td align="left"><code>applyTemplates()</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="4s8she14v6vf3smh5lyh8sbun">接收一个方法和属性的参数，你想要让原理图模板和原理图文件名可用。它返回一个
<code>Rule</code>。这是你定义
<code>classify()</code>和
<code>dasherize()</code>方法以及
<code>name</code>属性的地方。</td>
</tr>
<tr>
<td align="left"><code>classify()</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="1sm7yeth9nfl8k1my343rx6wf">接受一个值并以标题大小写返回该值。例如，如果提供的名称是
<code>my service</code>，则返回为
<code>MyService</code>。</td>
</tr>
<tr>
<td align="left"><code>dasherize()</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="av9jp3in5vg11mba7a63fotht">接受一个值并以短划线和小写形式返回该值。例如，如果提供的名称是MyService，则返回为
<code>my-service</code>。</td>
</tr>
<tr>
<td align="left"><code>move()</code></td>
<td align="left" data-ng_translator_product="100" data-ng_translator_ref_id="1e6g7h1gcjxgj1wtexdyh4mbx">在应用原理图时，将提供的源文件移动到它们的目的地。</td>
</tr>

      </tbody>
    </table>
  </div>
  </li>
<li><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="axtt7len442ksusj93nl9k5jl">最后，规则工厂必须返回一条规则。</p>
<div class="docs-code" path="adev/src/content/examples/schematics-for-libraries/projects/my-lib/schematics/my-service/index.ts" visiblelines="63" header="projects/my-lib/schematics/my-service/index.ts (Chain Rule)">
    <div class="docs-code-header"><h3 data-ng_translator_product="100" data-ng_translator_ref_id="dx8f0983dpwf900pdavqhjl24">projects/my-lib/schematics/my-service/index.ts（链式规则）</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {</div><div class="hljs-ln-line">  <span class="hljs-title class_">Rule</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">Tree</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">SchematicsException</span>,</div><div class="hljs-ln-line">  apply,</div><div class="hljs-ln-line">  url,</div><div class="hljs-ln-line">  applyTemplates,</div><div class="hljs-ln-line">  move,</div><div class="hljs-ln-line">  chain,</div><div class="hljs-ln-line">  mergeWith,</div><div class="hljs-ln-line">} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular-devkit/schematics'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {strings, normalize, virtualFs, workspaces} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular-devkit/core'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">Schema</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">MyServiceSchema</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'./schema'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createHost</span>(<span class="hljs-params">tree: Tree</span>): workspaces.<span class="hljs-property">WorkspaceHost</span> {</div><div class="hljs-ln-line">  <span class="hljs-keyword">return</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">async</span> <span class="hljs-title function_">readFile</span>(<span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> data = tree.<span class="hljs-title function_">read</span>(path);</div><div class="hljs-ln-line">      <span class="hljs-keyword">if</span> (!data) {</div><div class="hljs-ln-line">        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SchematicsException</span>(<span class="hljs-string">'File not found.'</span>);</div><div class="hljs-ln-line">      }</div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> virtualFs.<span class="hljs-title function_">fileBufferToString</span>(data);</div><div class="hljs-ln-line">    },</div><div class="hljs-ln-line">    <span class="hljs-keyword">async</span> <span class="hljs-title function_">writeFile</span>(<span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> tree.<span class="hljs-title function_">overwrite</span>(path, data);</div><div class="hljs-ln-line">    },</div><div class="hljs-ln-line">    <span class="hljs-keyword">async</span> <span class="hljs-title function_">isDirectory</span>(<span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; {</div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> !tree.<span class="hljs-title function_">exists</span>(path) &amp;&amp; tree.<span class="hljs-title function_">getDir</span>(path).<span class="hljs-property">subfiles</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>;</div><div class="hljs-ln-line">    },</div><div class="hljs-ln-line">    <span class="hljs-keyword">async</span> <span class="hljs-title function_">isFile</span>(<span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; {</div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> tree.<span class="hljs-title function_">exists</span>(path);</div><div class="hljs-ln-line">    },</div><div class="hljs-ln-line">  };</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">myService</span>(<span class="hljs-params">options: MyServiceSchema</span>): <span class="hljs-title class_">Rule</span> {</div><div class="hljs-ln-line">  <span class="hljs-keyword">return</span> <span class="hljs-keyword">async</span> (<span class="hljs-attr">tree</span>: <span class="hljs-title class_">Tree</span>) =&gt; {</div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> host = <span class="hljs-title function_">createHost</span>(tree);</div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> {workspace} = <span class="hljs-keyword">await</span> workspaces.<span class="hljs-title function_">readWorkspace</span>(<span class="hljs-string">'/'</span>, host);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> project = options.<span class="hljs-property">project</span> != <span class="hljs-literal">null</span> ? workspace.<span class="hljs-property">projects</span>.<span class="hljs-title function_">get</span>(options.<span class="hljs-property">project</span>) : <span class="hljs-literal">null</span>;</div><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> (!project) {</div><div class="hljs-ln-line">      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SchematicsException</span>(<span class="hljs-string">`Invalid project name: <span class="hljs-subst">${options.project}</span>`</span>);</div><div class="hljs-ln-line">    }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> projectType = project.<span class="hljs-property">extensions</span>.<span class="hljs-property">projectType</span> === <span class="hljs-string">'application'</span> ? <span class="hljs-string">'app'</span> : <span class="hljs-string">'lib'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> (options.<span class="hljs-property">path</span> === <span class="hljs-literal">undefined</span>) {</div><div class="hljs-ln-line">      options.<span class="hljs-property">path</span> = <span class="hljs-string">`<span class="hljs-subst">${project.sourceRoot}</span>/<span class="hljs-subst">${projectType}</span>`</span>;</div><div class="hljs-ln-line">    }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> templateSource = <span class="hljs-title function_">apply</span>(<span class="hljs-title function_">url</span>(<span class="hljs-string">'./files'</span>), [</div><div class="hljs-ln-line">      <span class="hljs-title function_">applyTemplates</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">classify</span>: strings.<span class="hljs-property">classify</span>,</div><div class="hljs-ln-line">        <span class="hljs-attr">dasherize</span>: strings.<span class="hljs-property">dasherize</span>,</div><div class="hljs-ln-line">        <span class="hljs-attr">name</span>: options.<span class="hljs-property">name</span>,</div><div class="hljs-ln-line">      }),</div><div class="hljs-ln-line">      <span class="hljs-title function_">move</span>(<span class="hljs-title function_">normalize</span>(options.<span class="hljs-property">path</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>)),</div><div class="hljs-ln-line">    ]);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> <span class="hljs-title function_">chain</span>([<span class="hljs-title function_">mergeWith</span>(templateSource)]);</div><div class="hljs-ln-line">  };</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_ref_id="5fs2ld9lxhghxgbt4z0z2gpkp"><code>chain()</code>方法允许你将多个规则组合成单个规则，这样你就可以在单个原理图中执行多个操作。在这里，你只是将模板规则与原理图执行的任何代码合并。</p>
</li>

    </ol>
    <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="9gyk9zd3s37t4zbdwz2xr9z5r">请看原理图规则函数的一个完整例子。</p>
<div class="docs-code" path="adev/src/content/examples/schematics-for-libraries/projects/my-lib/schematics/my-service/index.ts" header="projects/my-lib/schematics/my-service/index.ts">
    <div class="docs-code-header"><h3>projects/my-lib/schematics/my-service/index.ts</h3></div>
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {</div><div class="hljs-ln-line">  <span class="hljs-title class_">Rule</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">Tree</span>,</div><div class="hljs-ln-line">  <span class="hljs-title class_">SchematicsException</span>,</div><div class="hljs-ln-line">  apply,</div><div class="hljs-ln-line">  url,</div><div class="hljs-ln-line">  applyTemplates,</div><div class="hljs-ln-line">  move,</div><div class="hljs-ln-line">  chain,</div><div class="hljs-ln-line">  mergeWith,</div><div class="hljs-ln-line">} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular-devkit/schematics'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {strings, normalize, virtualFs, workspaces} <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular-devkit/core'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">Schema</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">MyServiceSchema</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'./schema'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createHost</span>(<span class="hljs-params">tree: Tree</span>): workspaces.<span class="hljs-property">WorkspaceHost</span> {</div><div class="hljs-ln-line">  <span class="hljs-keyword">return</span> {</div><div class="hljs-ln-line">    <span class="hljs-keyword">async</span> <span class="hljs-title function_">readFile</span>(<span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; {</div><div class="hljs-ln-line">      <span class="hljs-keyword">const</span> data = tree.<span class="hljs-title function_">read</span>(path);</div><div class="hljs-ln-line">      <span class="hljs-keyword">if</span> (!data) {</div><div class="hljs-ln-line">        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SchematicsException</span>(<span class="hljs-string">'File not found.'</span>);</div><div class="hljs-ln-line">      }</div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> virtualFs.<span class="hljs-title function_">fileBufferToString</span>(data);</div><div class="hljs-ln-line">    },</div><div class="hljs-ln-line">    <span class="hljs-keyword">async</span> <span class="hljs-title function_">writeFile</span>(<span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> tree.<span class="hljs-title function_">overwrite</span>(path, data);</div><div class="hljs-ln-line">    },</div><div class="hljs-ln-line">    <span class="hljs-keyword">async</span> <span class="hljs-title function_">isDirectory</span>(<span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; {</div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> !tree.<span class="hljs-title function_">exists</span>(path) &amp;&amp; tree.<span class="hljs-title function_">getDir</span>(path).<span class="hljs-property">subfiles</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>;</div><div class="hljs-ln-line">    },</div><div class="hljs-ln-line">    <span class="hljs-keyword">async</span> <span class="hljs-title function_">isFile</span>(<span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; {</div><div class="hljs-ln-line">      <span class="hljs-keyword">return</span> tree.<span class="hljs-title function_">exists</span>(path);</div><div class="hljs-ln-line">    },</div><div class="hljs-ln-line">  };</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">myService</span>(<span class="hljs-params">options: MyServiceSchema</span>): <span class="hljs-title class_">Rule</span> {</div><div class="hljs-ln-line">  <span class="hljs-keyword">return</span> <span class="hljs-keyword">async</span> (<span class="hljs-attr">tree</span>: <span class="hljs-title class_">Tree</span>) =&gt; {</div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> host = <span class="hljs-title function_">createHost</span>(tree);</div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> {workspace} = <span class="hljs-keyword">await</span> workspaces.<span class="hljs-title function_">readWorkspace</span>(<span class="hljs-string">'/'</span>, host);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> project = options.<span class="hljs-property">project</span> != <span class="hljs-literal">null</span> ? workspace.<span class="hljs-property">projects</span>.<span class="hljs-title function_">get</span>(options.<span class="hljs-property">project</span>) : <span class="hljs-literal">null</span>;</div><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> (!project) {</div><div class="hljs-ln-line">      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SchematicsException</span>(<span class="hljs-string">`Invalid project name: <span class="hljs-subst">${options.project}</span>`</span>);</div><div class="hljs-ln-line">    }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> projectType = project.<span class="hljs-property">extensions</span>.<span class="hljs-property">projectType</span> === <span class="hljs-string">'application'</span> ? <span class="hljs-string">'app'</span> : <span class="hljs-string">'lib'</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> (options.<span class="hljs-property">path</span> === <span class="hljs-literal">undefined</span>) {</div><div class="hljs-ln-line">      options.<span class="hljs-property">path</span> = <span class="hljs-string">`<span class="hljs-subst">${project.sourceRoot}</span>/<span class="hljs-subst">${projectType}</span>`</span>;</div><div class="hljs-ln-line">    }</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> templateSource = <span class="hljs-title function_">apply</span>(<span class="hljs-title function_">url</span>(<span class="hljs-string">'./files'</span>), [</div><div class="hljs-ln-line">      <span class="hljs-title function_">applyTemplates</span>({</div><div class="hljs-ln-line">        <span class="hljs-attr">classify</span>: strings.<span class="hljs-property">classify</span>,</div><div class="hljs-ln-line">        <span class="hljs-attr">dasherize</span>: strings.<span class="hljs-property">dasherize</span>,</div><div class="hljs-ln-line">        <span class="hljs-attr">name</span>: options.<span class="hljs-property">name</span>,</div><div class="hljs-ln-line">      }),</div><div class="hljs-ln-line">      <span class="hljs-title function_">move</span>(<span class="hljs-title function_">normalize</span>(options.<span class="hljs-property">path</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>)),</div><div class="hljs-ln-line">    ]);</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> <span class="hljs-title function_">chain</span>([<span class="hljs-title function_">mergeWith</span>(templateSource)]);</div><div class="hljs-ln-line">  };</div><div class="hljs-ln-line">}</div><div class="hljs-ln-line"></div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_ref_id="8t5blz46enlpou7gc3kuphj2m">有关规则和实用方法的更多信息，请参见
<a href="https://github.com/angular/angular-cli/tree/main/packages/angular_devkit/schematics#provided-rules" target="_blank">提供的规则</a>。</p>

  <h2 id="running-your-library-schematic">
    <a href="#running-your-library-schematic" class="docs-anchor" tabindex="-1" aria-label="Link to Running your library schematic" data-ng_translator_product="100" data-ng_translator_ref_id="aold32uyuob089icwmnjl9wkq">运行你的库原理图</a>
  </h2>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="87ly3xkay8a859bhxx90mmq97">在构建库和原理图之后，你就可以安装一个原理图集合来运行你的项目了。下面的步骤介绍了如何使用上面创建的原理图来生成服务。</p>

  <h3 id="build-your-library-and-schematics">
    <a href="#build-your-library-and-schematics" class="docs-anchor" tabindex="-1" aria-label="Link to Build your library and schematics" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="2eb4ioq1v2m6yx8xp0peh5ax4">构建你的库和原理图</a>
  </h3>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="bwht40o6i29fzgrk2ykug64ff">在工作区的根目录下，运行库的 <code>ng build</code> 命令。</p>
<div class="docs-code shell">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line">ng build my-lib</div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="22goufcjjw1gq0vuzjj0ejkov">然后，进入库目录，构建原理图</p>
<div class="docs-code shell">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line">cd projects/my-lib</div><div class="hljs-ln-line">npm run build</div></code>
    </pre>
  </div>
  <h3 id="link-the-library">
    <a href="#link-the-library" class="docs-anchor" tabindex="-1" aria-label="Link to Link the library" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="1o74d19gaulhr5nps8clfoo2t">链接这个库</a>
  </h3>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="dfc4lqsh3mjv413edsyb3pd7h">这些库和原理图都已打包好了，就放在你工作区根目录下的 <code>dist/my-lib</code> 文件夹中。要运行这个原理图，你需要把这个库链接到 <code>node_modules</code> 文件夹中。在工作区的根目录下，运行 <code>npm link</code> 命令，并把你的可分发库的路径作为参数。</p>
<div class="docs-code shell">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line">npm link dist/my-lib</div></code>
    </pre>
  </div>
  <h3 id="run-the-schematic">
    <a href="#run-the-schematic" class="docs-anchor" tabindex="-1" aria-label="Link to Run the schematic" data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="9sx8ycipbi0osno0gk9zpgj30">运行原理图</a>
  </h3>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="7hytclehxcdr6vztf2slcygz0">现在你的库已经安装完毕，可以使用 <code>ng generate</code> 命令来运行原理图了。</p>
<div class="docs-code shell">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line">ng generate my-lib:my-service --name my-data</div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="a1osllwumnir4k6cyt0r2md25">在控制台中，你会看到原理图已经运行过了，<code>my-data.service.ts</code> 文件被创建在了你的 app 文件夹中。</p>
<div class="docs-code shell">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line">CREATE src/app/my-data.service.ts (208 bytes)</div></code>
    </pre>
  </div>