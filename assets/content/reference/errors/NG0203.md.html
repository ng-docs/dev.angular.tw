<header class="docs-header">
      <docs-breadcrumb></docs-breadcrumb>

      
  <!-- Page title -->
  <div class="docs-page-title">
    <h1 tabindex="-1" data-ng_translator_product="100" data-ng_translator_ref_id="961oa99gxxk281fhmf7jnyw3m"><code>inject()</code> 必须在注入上下文中调用</h1>
    <a class="docs-github-links" target="_blank" href="https://github.com/angular/angular/edit/main/adev/src/content/reference/errors/NG0203.md" title="Edit this page" aria-label="Edit this page">
      <!-- Pencil -->
      <docs-icon role="presentation">edit</docs-icon>
    </a>
  </div>
    </header>
    <p data-ng_translator_product="100" data-ng_translator_ref_id="2e5d6kw59xekqfxmjnpyge5hr">当你试图在不允许的
<a href="guide/di/dependency-injection-context">注入上下文</a>之外使用
<a href="api/core/inject"><code>inject</code></a>函数时，会看到此错误。注入上下文在类创建和初始化期间可用。它也可用于与
<code>runInInjectionContext</code>一起使用的函数。</p>
<p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="by6a13yi22q6k4deqt2y50qvf">在实践中，构造函数、构造函数参数和字段初始化器中允许进行 <code>inject()</code> 调用：</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-meta">@Injectable</span>({<span class="hljs-attr">providedIn</span>: <span class="hljs-string">'root'</span>})</div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Car</span> {</div><div class="hljs-ln-line">  <span class="hljs-attr">radio</span>: <span class="hljs-title class_">Radio</span>|<span class="hljs-literal">undefined</span>;</div><div class="hljs-ln-line"></div><div class="hljs-ln-line">  <span class="hljs-comment">// OK: field initializer</span></div><div class="hljs-ln-line">  spareTyre = <span class="hljs-title function_">inject</span>(<span class="hljs-title class_">Tyre</span>);</div><div class="hljs-ln-line">  </div><div class="hljs-ln-line">  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {</div><div class="hljs-ln-line">    <span class="hljs-comment">// OK: constructor body</span></div><div class="hljs-ln-line">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">radio</span> = <span class="hljs-title function_">inject</span>(<span class="hljs-title class_">Radio</span>);</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line">}</div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_ref_id="3cd39muwt2cnai3lrw26l1jw9">从提供者的工厂中调用
<a href="api/core/inject"><code>inject</code></a>也是合法的：</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-attr">providers</span>: [</div><div class="hljs-ln-line">  {<span class="hljs-attr">provide</span>: <span class="hljs-title class_">Car</span>, <span class="hljs-attr">useFactory</span>: <span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">    <span class="hljs-comment">// OK: a class factory</span></div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> engine = <span class="hljs-title function_">inject</span>(<span class="hljs-title class_">Engine</span>);</div><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Car</span>(engine);</div><div class="hljs-ln-line">  }}</div><div class="hljs-ln-line">]</div></code>
    </pre>
  </div><p data-ng_translator_product="100" data-ng_translator_ref_id="9xy4fqlbcget6wtsvaqmwq553">在类创建或
<code>runInInjectionContext</code>之外调用
<a href="api/core/inject"><code>inject</code></a>函数将导致错误。最显著的是，在创建类实例后，在方法（包括生命周期钩子）中调用
<code>inject()</code>是不允许的：</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-meta">@Component</span>({ ... })</div><div class="hljs-ln-line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CarComponent</span> {</div><div class="hljs-ln-line">  <span class="hljs-title function_">ngOnInit</span>(<span class="hljs-params"></span>) {</div><div class="hljs-ln-line">    <span class="hljs-comment">// ERROR: too late, the component instance was already created</span></div><div class="hljs-ln-line">    <span class="hljs-keyword">const</span> engine = <span class="hljs-title function_">inject</span>(<span class="hljs-title class_">Engine</span>);</div><div class="hljs-ln-line">    engine.<span class="hljs-title function_">start</span>();</div><div class="hljs-ln-line">  }</div><div class="hljs-ln-line">}</div></code>
    </pre>
  </div>
  <h2 id="debugging-the-error">
    <a href="#debugging-the-error" class="docs-anchor" tabindex="-1" aria-label="Link to Debugging the error" data-ng_translator_product="100" data-ng_translator_ref_id="6rp3v2icazrcg6696buxdgjjo">调试此错误</a>
  </h2>
  <p data-ng_translator_product="100" data-ng_translator_confirmed data-ng_translator_ref_id="413geysemcdkuwgc9nxa9uxwq">从错误堆栈跟踪中向后找，以识别出不允许的 <code>inject()</code> 调用所在的位置。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="9psd08f917851urt3ntxgjnop">要修复此错误，请将
<a href="api/core/inject"><code>inject</code></a>调用移到允许的位置（通常是类构造函数或字段初始化器）。</p>
<p data-ng_translator_product="100" data-ng_translator_ref_id="doferno27o6vt1y2yj7yp6ofx"><strong>注意：</strong>如果你在测试上下文中运行，
<code>TestBed.runInInjectionContext</code>将允许
<code>inject()</code>成功。</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <code><div class="hljs-ln-line"><span class="hljs-title class_">TestBed</span>.<span class="hljs-title function_">runInInjectionContext</span>(<span class="hljs-function">() =&gt;</span> {</div><div class="hljs-ln-line">   <span class="hljs-comment">// ...</span></div><div class="hljs-ln-line">});</div></code>
    </pre>
  </div>