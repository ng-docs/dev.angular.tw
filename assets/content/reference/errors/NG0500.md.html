<header class="docs-header">
      <docs-breadcrumb></docs-breadcrumb>

      
  <!-- Page title -->
  <div class="docs-page-title">
    <h1 tabindex="-1">水合節點不對應</h1>
    <a class="docs-github-links" target="_blank" href="https://github.com/angular/angular/edit/main/adev/src/content/reference/errors/NG0500.md" title="Edit this page" aria-label="Edit this page">
      <!-- Pencil -->
      <docs-icon role="presentation">edit</docs-icon>
    </a>
  </div>
    </header>
    <p>此錯誤意味著在水合過程中，Angular 期望的 DOM 結構與伺服器端渲染期間渲染和註解的 DOM 結構一致。然而，在用戶端，DOM 樹與伺服器渲染的 DOM 樹不同。</p>
<p>此錯誤通常是由於使用原生瀏覽器 API 直接操縱 DOM，從而在 Angular 生成的 DOM 結構之外更改了 DOM 結構而發生的。如果您使用 <code>innerHTML</code> 或 <code>outerHTML</code> 設定 HTML 內容（同樣會在 Angular 生成的 DOM 結構之外更改 DOM 結構），也會發生此錯誤。您可以透過重構元件以使用原生 Angular API 而不是原生 API 來解決此問題。如果無法做到這一點，您可以將 <code>ngSkipHydration</code> 屬性新增到元件的宿主節點，這將停用該組件及其子元件的水合。<code>ngSkipHydration</code> 應該只作為最後的手段使用，並且應該被視為需要修復的錯誤。</p>
<p>有關水合的更多訊息，請參見<a href="guide/hydration">本指南</a>。</p>
<p>以下範例將觸發此錯誤。</p>
<div class="docs-code">
    
    <pre class="docs-mini-scroll-track">      <pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Component</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">({</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  selector: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">'app-example'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  template: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">'&lt;div&gt;&lt;span&gt;world&lt;/span&gt;&lt;/div&gt;'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">})</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> ExampleComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {</span></span><span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70">  hostElement</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> inject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(ElementRef).nativeElement;</span></span><span class="line"></span><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">  ngOnInit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">() {</span></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    // Create a new &lt;p&gt; element with the `Hello` text inside</span></span><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> newNode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">createElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">'p'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    newNode.innerHTML </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> 'Hello'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span><span class="line"></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    // Insert the &lt;p&gt; before the first element. Since Angular has no information</span></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">   // about the &lt;p&gt; element, it will be looking for the &lt;div&gt; element at the first</span></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">   // element position instead. As a result, a hydration mismatch error would be</span></span><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">   // thrown. Instead, update component's template to create the &lt;p&gt; element.</span></span><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">   this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.hostElement.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">insertBefore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(newNode, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.hostElement.firstChild);</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre>
    </pre>
  </div>
  <h2 id="debugging-the-error">
    <a href="#debugging-the-error" class="docs-anchor" tabindex="-1" aria-label="Link to Debugging the error">除錯錯誤</a>
  </h2>
  <p>開發者控制台中的錯誤訊息應包含有關導致問題的應用 DOM 結構的特定部分的訊息。檢查應用的那部分是否存在與水合相關的錯誤，例如使用原生 API 進行直接 DOM 操縱。</p>
<p>檢查您的樣板是否具有有效的 HTML 結構。有關更多訊息，請參見<a href="guide/hydration#valid-html-structure">水合指南</a>。</p>
<p>您可以將 <code>ngSkipHydration</code> 屬性新增到元件宿主節點，作為一種可能的權宜之計。</p>
<p>如果您的應用在開發環境中工作正常，但在生產建立中看到水合錯誤，請確保傳遞到瀏覽器的生成的 HTML 包含 Angular 在服務器端渲染期間生成的註解節點。這些註解節點被 Angular 執行時用作檢視容器（無論是否進行水合）的錨點，並且水合過程期望它們出現在其原始位置。如果您有自定義邏輯從伺服器端渲染生成的 HTML 中刪除註解節點，或者您已設定 CDN 以在提供內容服務之前刪除它們 - 請停用註解節點移除，並檢查水合錯誤是否消失。</p>
