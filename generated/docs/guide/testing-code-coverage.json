{"id":"guide/testing-code-coverage","title":"找出你要测试多少代码","contents":"<div class=\"content\">\n  <p><a id=\"code-coverage\"></a></p>\n<h1 id=\"find-out-how-much-code-youre-testing\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"bzzyzrlgoh0dsi6ih4hbx3f0o\">找出你要测试多少代码<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/testing-code-coverage#find-out-how-much-code-youre-testing\"><i class=\"material-icons\">link</i></a></h1>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"ezsj57y9jluw9zcsy6k2ep0z\">CLI 可以运行单元测试并创建代码覆盖率报告。代码覆盖率报告会向你展示代码库中可能无法通过单元测试进行正确测试的任意部位。</p>\n<div class=\"alert is-helpful\">\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"3jhe3g7pull8hzqtm08p46wf0\">如果你要试验本指南中所讲的应用，请<live-example name=\"testing\" nodownload=\"\">在浏览器中运行它</live-example>或<live-example name=\"testing\" downloadonly=\"\">下载并在本地运行它</live-example>。</p>\n</div>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"6dy7h465zj8rug2v3othq93lu\">要生成覆盖率报告，请在项目的根目录下运行以下命令。</p>\n<code-example format=\"shell\" language=\"shell\">\n\nng test --no-watch --code-coverage\n\n</code-example>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"8uo5e9vxp3954ga1pbdxr5a8\">测试完成后，该命令会在项目中创建一个 <code>/coverage</code> 目录。打开 <code>index.html</code> 文件，可以查看带有源代码和代码覆盖率值的报表。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"b6jvldm0dy9bky5ag0ew4wlmj\">如果要在每次测试时都创建代码覆盖率报告，可以在 CLI 配置文件 <code>angular.json</code> 中设置以下选项：</p>\n<code-example format=\"json\" language=\"json\">\n\n\"test\": {\n  \"options\": {\n    \"codeCoverage\": true\n  }\n}\n\n</code-example>\n<h2 id=\"code-coverage-enforcement\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"5p4gxh94oylm1v29m7jeawnra\">代码覆盖的实施<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/testing-code-coverage#code-coverage-enforcement\"><i class=\"material-icons\">link</i></a></h2>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"e709mnkttbflj5f8ktfmy4t4u\">代码覆盖率可以让你估算出你的代码测试了多少。如果你的团队确定要设置单元测试的最小覆盖率，可以使用 Angular CLI 来强制实施这个最低要求。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"89vs4e963yshduqjy579j3z5z\">比如，假设你希望代码库的代码覆盖率至少达到 80％。要启用此功能，请打开 <a href=\"https://karma-runner.github.io\">Karma</a> 测试平台的配置文件 <code>karma.conf.js</code>，并在 <code>coverageReporter:</code> 键下添加 <code>check</code> 属性。</p>\n<code-example format=\"javascript\" language=\"javascript\">\n\ncoverageReporter: {\n  dir: require('path').join(__dirname, './coverage/&lt;project-name&gt;'),\n  subdir: '.',\n  reporters: [\n    { type: 'html' },\n    { type: 'text-summary' }\n  ],\n  check: {\n    global: {\n      statements: 80,\n      branches: 80,\n      functions: 80,\n      lines: 80\n    }\n  }\n}\n\n</code-example>\n<div class=\"alert is-helpful\">\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"6wqojttmkfx54ynwth0bgrdwp\">在<a href=\"guide/testing#configuration\">测试指南</a>中可以了解更多关于创建和微调 Karma 配置的内容。</p>\n</div>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"ctm3rt15daxll4pgu7o9zet8y\"><code>check</code> 属性会让该工具在项目中运行单元测试时强制要求至少 80％的代码覆盖率。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"7nh9zswmf31b3sitgbx2fk2ed\">在 <a href=\"https://github.com/karma-runner/karma-coverage/blob/master/docs/configuration.md\">Karma 覆盖率文档</a>中阅读有关覆盖配置选项的更多信息。</p>\n<!-- links -->\n<!-- external links -->\n<!-- end links -->\n\n  <div class=\"reviewed\">最后复查时间：Tue Jan 17 2023</div>\n</div>\n\n\n<!-- links to this doc:\n - guide/testing\n-->\n<!-- links from this doc:\n - guide/testing#configuration\n - guide/testing-code-coverage#code-coverage-enforcement\n - guide/testing-code-coverage#find-out-how-much-code-youre-testing\n - https://github.com/karma-runner/karma-coverage/blob/master/docs/configuration.md\n - https://karma-runner.github.io\n-->"}