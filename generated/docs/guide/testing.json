{"id":"guide/testing","title":"测试","contents":"<div class=\"content\">\n  <p><a id=\"top\"></a></p>\n\n<h1 id=\"testing\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"etpgj6p39fywtmcrsphy8qrcg\">测试<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/testing#testing\"><i class=\"material-icons\">link</i></a></h1>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"dtoha25m910v3325wxkzl8c55\">测试你的 Angular 应用可以帮助你检查此应用是否正常运行。</p>\n<h2 id=\"prerequisites\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"e44b21uig1fakj5vcfuvz1bdu\">前提条件<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/testing#prerequisites\"><i class=\"material-icons\">link</i></a></h2>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"67ufq6uo5axbfdm9my5w25nes\">在为 Angular 应用编写测试之前，你应该对这些概念有一个基本的了解：</p>\n<ul>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"9l16j6cppokhgw9xk8pkapybb\"><a href=\"guide/architecture\">Angular 的基本原理</a></li>\n<li><a href=\"https://javascript.info/\">JavaScript</a></li>\n<li>HTML</li>\n<li>CSS</li>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"4vtg2wry451tucy201uexb3e4\"><a href=\"cli\">Angular CLI</a></li>\n</ul>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"q76rqw85moe5ornj72cfa9pt\">测试文档提供了通过使用 <a href=\"cli\">Angular CLI</a> 创建的示例应用程序对 Angular 应用程序进行单元和集成测试的提示和技术。这个示例应用程序与<a href=\"tutorial/tour-of-heroes\"><em>英雄之旅</em>教程</a>中的示例应用程序非常相似。</p>\n<div class=\"alert is-helpful\">\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"3jhe3g7pull8hzqtm08p46wf0\">如果你要试验本指南中所讲的应用，请<live-example name=\"testing\" nodownload=\"\">在浏览器中运行它</live-example>或<live-example name=\"testing\" downloadonly=\"\">下载并在本地运行它</live-example>。</p>\n</div>\n<p><a id=\"setup\"></a></p>\n<h2 id=\"set-up-testing\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"edicl79awnv03trzhz9yfom1o\">建立环境<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/testing#set-up-testing\"><i class=\"material-icons\">link</i></a></h2>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"b4tofl9hem3jy11tfxyx6gdi4\">Angular CLI 会下载并安装试用 <a href=\"https://jasmine.github.io\">Jasmine 测试框架</a> 测试 Angular 应用时所需的一切。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"n73ve7p3gz8brbfwvlv181qt\">你使用 CLI 创建的项目是可以立即用于测试的。运行 CLI 命令 <a href=\"cli/test\"><code>ng test</code></a> 即可：</p>\n<code-example format=\"shell\" language=\"shell\">\n\nng test\n\n</code-example>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"bfmcdar6a6v13ntx8qg8hn49\"><code>ng test</code> 命令在<em>监视模式</em>下构建应用，并启动 <a href=\"https://karma-runner.github.io\">karma 测试运行器</a>。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"143mb2sxqioqmlb935o73glhr\">它的控制台输出一般是这样的：</p>\n<code-example format=\"shell\" language=\"shell\">\n\n02 11 2022 09:08:28.605:INFO [karma-server]: Karma v6.4.1 server started at http://localhost:9876/\n02 11 2022 09:08:28.607:INFO [launcher]: Launching browsers Chrome with concurrency unlimited\n02 11 2022 09:08:28.620:INFO [launcher]: Starting browser Chrome\n02 11 2022 09:08:31.312:INFO [Chrome]: Connected on socket -LaEYvD2R7MdcS0-AAAB with id 31534482\nChrome: Executed 3 of 3 SUCCESS (0.193 secs / 0.172 secs)\nTOTAL: 3 SUCCESS\n\n</code-example>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"ezenbfo7fgv3ucmd32f9o8afa\">日志的最后一行显示 Karma 运行了三个测试，这些测试都通过了。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"5xwudpy3iu7qzot51svxoxkob\">测试输出使用 <a href=\"https://github.com/dfederm/karma-jasmine-html-reporter\">Karma Jasmine HTML Reporter</a> 显示在浏览器中。</p>\n<div class=\"lightbox\">\n<img alt=\"Jasmine HTML Reporter in the browser\" src=\"generated/images/guide/testing/initial-jasmine-html-reporter.png\" width=\"502\" height=\"306\">\n</div>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"c8rc7xggj9xxj96xw1264rzx2\">可以点击某一行测试，来单独重跑这个测试，或者点击一行描述信息来重跑所选测试组（“测试套件”）中的那些测试。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"1rj5tiit5ellz0r8ysi7rpicu\">同时，<code>ng test</code> 命令还会监听这些变化。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"6h090eu20dackksclavpk66ki\">要查看它的实际效果，就对 <code>app.component.ts</code> 做一个小修改，并保存它。这些测试就会重新运行，浏览器也会刷新，然后新的测试结果就出现了。</p>\n<h2 id=\"configuration\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"27io2zcn0syxgd4dfu8paj1a1\">配置<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/testing#configuration\"><i class=\"material-icons\">link</i></a></h2>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"bz57jbvt3r6qfqd6n0jv9bpo5\">Angular CLI 会为你处理 Jasmine 和 Karma 配置。它根据 <code>angular.json</code> 文件中指定的选项在内存中构建完整配置。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"ecipaazwpymkekjlzp3i645rm\">如果你想自定义 Karma，你可以通过运行以下命令创建一个 <code>karma.conf.js</code>：</p>\n<code-example format=\"shell\" language=\"shell\">\n\nng generate config karma\n\n</code-example>\n<div class=\"alert is-helpful\">\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"ah59ewko3655t3tmhhe4rq9nu\">在 <a href=\"http://karma-runner.github.io/6.4/config/configuration-file.html\">Karma 配置指南</a>中可以了解更多关于 Karma 配置的内容。</p>\n</div>\n<h3 id=\"other-test-frameworks\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"drmoxmvux9pu6iqyppujewc6n\">其他测试框架<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/testing#other-test-frameworks\"><i class=\"material-icons\">link</i></a></h3>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"e0imts06tg8mf7lk32venpu09\">你还可以使用其它的测试库和测试运行器来对 Angular 应用进行单元测试。每个库和运行器都有自己特有的安装过程、配置项和语法。</p>\n<h3 id=\"test-file-name-and-location\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"6cerb1mtf9nx0obt7rpcge4a7\">测试文件名及其位置<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/testing#test-file-name-and-location\"><i class=\"material-icons\">link</i></a></h3>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"dbjde75p51n1rvxeujg10e2uz\">在 <code>src/app</code> 目录中，CLI 为 <code>AppComponent</code> 生成了一个名叫 <code>app.component.spec.ts</code> 的测试文件。</p>\n<div class=\"alert is-important\">\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"1dojjiqkjf7lj9m50wvh1fli4\">测试文件的扩展名<strong>必须是 <code>.spec.ts</code></strong>，以便测试工具可以把它识别成一个包含测试的文件，也叫 <em>spec（规约）</em> 文件。</p>\n</div>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"6yrd6x5pz3t2o1yuumv2pt6gv\"><code>app.component.ts</code> 和 <code>app.component.spec.ts</code> 文件位于同一个文件夹中，而且相邻。其根文件名部分（<code>app.component</code>）都是一样的。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"b7hqspxutkt7z1vb19zl70drd\">请在你的项目中对<em>任意类型</em>的测试文件都坚持这两条约定。</p>\n<p><a id=\"q-spec-file-location\"></a></p>\n<h4 id=\"place-your-spec-file-next-to-the-file-it-tests\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"574nnwg8yc6bbjxl79gfirzi3\">把测试规约（spec）文件放在它要测试的文件旁边<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/testing#place-your-spec-file-next-to-the-file-it-tests\"><i class=\"material-icons\">link</i></a></h4>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"1w6h4s3byl6lkb9eziur1dzxy\">最好把单元测试规约文件放到与它们测试的应用源码文件相同的文件夹中：</p>\n<ul>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"bcnm8rwnax2j186oy1zt6807t\">这些测试很容易找到。</li>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"cnswkkr7dbefmenhnlyhxv92h\">你一眼就能看到应用中是否缺少一些测试。</li>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"7ooyq3vve01imdyk6m7p6bnd\">临近的测试可以揭示一个部件会如何在上下文中工作。</li>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"bwbgrrue4nw87pocd2i8p8an8\">当移动源代码时（在所难免），你不会忘了同时移动测试。</li>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"2bb4dpwfhuxyj43ug4r3ygo4s\">当重命名源文件时（在所难免），你不会忘了重命名测试文件。</li>\n</ul>\n<p><a id=\"q-specs-in-test-folder\"></a></p>\n<h4 id=\"place-your-spec-files-in-a-test-folder\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"cjbw4yjrubbfc412p5wqcgqg6\">把 spec 文件放到 test 目录下<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/testing#place-your-spec-files-in-a-test-folder\"><i class=\"material-icons\">link</i></a></h4>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"c65r6dw3b922y9gk4sfd2we3g\">应用的集成测试规范可以测试跨文件夹和模块的多个部分之间的交互。它们并不属于任何一个特定的部分，所以把它们放在任何一个文件旁都很不自然。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"8dur4tu2f3hv2gydei57rqnmy\">最好在 <code>tests</code> 目录下为它们创建一个合适的文件夹。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"byv0pfv3h0bcohahbdnchd4lt\">当然，用来测试那些测试助手的规约也位于 <code>test</code> 目录下，紧挨着相应的测试助手文件。</p>\n<p><a id=\"ci\"></a></p>\n<h2 id=\"testing-in-continuous-integration\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"47v9jkjdv1d2o866rbyqsn5qi\">建立持续集成环境<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/testing#testing-in-continuous-integration\"><i class=\"material-icons\">link</i></a></h2>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"2i8nzffvt1lfz9lu9n2eigeuq\">保持项目无错误的最佳方法之一是通过测试套件，但你可能会忘记一直运行测试。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"8akwisdymeqvxyadxxsnfvpl3\">避免项目出 BUG 的最佳方式之一，就是使用测试套件。但是很容易忘了一直运行它。持续集成（CI）服务器让你可以配置项目的代码仓库，以便每次提交和收到 Pull Request 时就会运行你的测试。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"bdmrgs0xyry18yxwg1c604rp8\">要在持续集成 (CI) 中测试你的 Angular CLI 应用程序，请运行以下命令：</p>\n<code-example format=\"shell\" language=\"shell\">\n\nng test --no-watch --no-progress --browsers=ChromeHeadless\n\n</code-example>\n<h2 id=\"more-information-on-testing\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"7838f80a0ysxladw99799isth\">关于测试的更多信息<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/testing#more-information-on-testing\"><i class=\"material-icons\">link</i></a></h2>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"4xxb806cvgsy9y0ihrr9s2od9\">当你设置准备好测试环境之后，可能会发现以下测试指南很有用。</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\"></th>\n<th align=\"left\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"3prlgfrx5eo2xqncnnob4crxu\">详情</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"left\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"bub3wooqubzybel4lxa7e31qy\"><a href=\"guide/testing-code-coverage\">代码覆盖率</a></td>\n<td align=\"left\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"68gb8d40vgp1dygkwn38zr6d6\">你的测试覆盖了多少应用程序，以及如何指定所需的覆盖范围。</td>\n</tr>\n<tr>\n<td align=\"left\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"111dw2uqxce0frefshaxhiubm\"><a href=\"guide/testing-services\">测试服务</a></td>\n<td align=\"left\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"7vy8pk98tc5upmchmuk22728u\">如何测试应用程序使用的服务。</td>\n</tr>\n<tr>\n<td align=\"left\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"5wmrobtuqwngusc83o7y8xn1m\"><a href=\"guide/testing-components-basics\">测试组件的基础知识</a></td>\n<td align=\"left\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"95suvuqwzzuw9xi8tu2a75tew\">测试 Angular 组件的基础知识。</td>\n</tr>\n<tr>\n<td align=\"left\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"5qnj2zh93r9d8ko8av13px9oi\"><a href=\"guide/testing-components-scenarios\">组件测试场景</a></td>\n<td align=\"left\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"2f76x68lcqwm5ossqcjk6m50v\">各种组件测试场景和用例。</td>\n</tr>\n<tr>\n<td align=\"left\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"c03r5zb18lvlbg4o5hck7xaw2\"><a href=\"guide/testing-attribute-directives\">测试属性型指令</a></td>\n<td align=\"left\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"cahzo9hqvjzcibfx0pfh5h721\">如何测试你的属性型指令。</td>\n</tr>\n<tr>\n<td align=\"left\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"3pantetu747y46uftmm2hif3o\"><a href=\"guide/testing-pipes\">测试管道</a></td>\n<td align=\"left\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"exl37e6zp8i5yzvgetx09ngyu\">如何测试管道。</td>\n</tr>\n<tr>\n<td align=\"left\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"dl9b4lzjfotu6yd6hy8bf1l83\"><a href=\"guide/test-debugging\">调试测试</a></td>\n<td align=\"left\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"9jv0iyys15gw4tpmr6pieu3qv\">常见的测试 bug。</td>\n</tr>\n<tr>\n<td align=\"left\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"jmf95vqhs6rhs83f91eiqcjn\"><a href=\"guide/testing-utility-apis\">测试工具 API</a></td>\n<td align=\"left\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"f1q3mmrkn65rty2sx6s93y8qk\">Angular 测试功能。</td>\n</tr>\n</tbody>\n</table>\n<!-- links -->\n<!-- external links -->\n<!-- end links -->\n\n  <div class=\"reviewed\">最后复查时间：Tue Jan 17 2023</div>\n</div>\n\n\n<!-- links to this doc:\n - guide/architecture-next-steps\n - guide/developer-guide-overview\n - guide/docs-style-guide\n - guide/example-apps-list\n - guide/test-debugging\n - guide/testing-code-coverage\n - guide/testing-utility-apis\n - tutorial/tour-of-heroes/toh-pt0\n-->\n<!-- links from this doc:\n - cli\n - cli/test\n - guide/architecture\n - guide/test-debugging\n - guide/testing#configuration\n - guide/testing#more-information-on-testing\n - guide/testing#other-test-frameworks\n - guide/testing#place-your-spec-file-next-to-the-file-it-tests\n - guide/testing#place-your-spec-files-in-a-test-folder\n - guide/testing#prerequisites\n - guide/testing#set-up-testing\n - guide/testing#test-file-name-and-location\n - guide/testing#testing\n - guide/testing#testing-in-continuous-integration\n - guide/testing-attribute-directives\n - guide/testing-code-coverage\n - guide/testing-components-basics\n - guide/testing-components-scenarios\n - guide/testing-pipes\n - guide/testing-services\n - guide/testing-utility-apis\n - tutorial/tour-of-heroes\n - http://karma-runner.github.io/6.4/config/configuration-file.html\n - https://github.com/dfederm/karma-jasmine-html-reporter\n - https://jasmine.github.io\n - https://javascript.info/\n - https://karma-runner.github.io\n-->"}