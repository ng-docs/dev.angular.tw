{"id":"guide/service-worker-getting-started","title":"Service Worker 快速上手","contents":"<div class=\"content\">\n  <h1 id=\"getting-started-with-service-workers\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"4yha3afq07kgs584opdzpq1lo\">Service Worker 快速上手<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-getting-started#getting-started-with-service-workers\"><i class=\"material-icons\">link</i></a></h1>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"6a6adzx146man204bq4t0wu68\">本文档解释了如何在 <a href=\"cli\">Angular CLI</a> 项目中启用对 Angular Service Worker 的支持。稍后它会用一个简单的范例来向你展示 Service Worker 实践，包括加载和基础的缓存功能。</p>\n<h2 id=\"prerequisites\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"e44b21uig1fakj5vcfuvz1bdu\">前提条件<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-getting-started#prerequisites\"><i class=\"material-icons\">link</i></a></h2>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"egdp8o5zi4j5h8dj6e31uly5d\">对 <a href=\"guide/service-worker-intro\">Angular Service Worker 简介</a>中的信息有了基本的了解。</p>\n<p><a id=\"cli-command\"></a></p>\n<h2 id=\"adding-a-service-worker-to-your-project\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"2xsgefbns41m019zxkmklyo1p\">为你的项目添加 Service Worker<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-getting-started#adding-a-service-worker-to-your-project\"><i class=\"material-icons\">link</i></a></h2>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"cni5ja2rybijmzrobb4v1xh4q\">要在你的项目中设置 Angular 服务工作线程，运行以下 CLI 命令。</p>\n<code-example format=\"shell\" language=\"shell\">\n\nng add @angular/pwa\n\n</code-example>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"7vob609vjawvhuoifc04hc6tn\">CLI 配置你的应用程序以使用以下操作的服务工作线程：</p>\n<ol>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"c6oai5akhc95o4e3wm7e3qq1c\">把 <code>@angular/service-worker</code> 添加到你的项目中。</li>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"3enldwhkega3uk8li4ga7655t\">在 CLI 中启用 Service Worker 的构建支持。</li>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"4w1yfasp4m7bi03lwfgajk0r4\">导入并注册服务工作线程到应用程序的根提供者。</li>\n<li>Updates the <code>index.html</code> file:\n<ul>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"e9qioqzejauu7lvofggx1keki\">包含要添加到 <code>manifest.webmanifest</code> 文件中的链接。</li>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"5kdxiv79l61k75i0awcdke2kv\">为 <code>theme-color</code> 添加 meta 标签。</li>\n</ul>\n</li>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"9212p1ih3xblpr9sjzsd7ogz\">创建图标文件，以支持安装渐进式应用（PWA）。</li>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"417f6dzhh47wj80yelgn8lcci\">创建名为 \n<a href=\"guide/service-worker-config\"><code>ngsw-config.json</code></a> 的服务工作线程配置文件，指定缓存行为和其他设置。</li>\n</ol>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"dqesf5rpl99huotcqg2fd4nw6\">现在，构建本项目：</p>\n<code-example format=\"shell\" language=\"shell\">\n\nng build\n\n</code-example>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"eakp2vhma7v9tao4aitfq5auj\">现在，这个 CLI 项目就可以使用 Angular Service Worker 了。</p>\n<h2 id=\"service-worker-in-action-a-tour\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"aapfkbx4b29k01a2h7xs8p41g\">Service Worker 实战：向导<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-getting-started#service-worker-in-action-a-tour\"><i class=\"material-icons\">link</i></a></h2>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"2sbdfsejl8k2125iifqaxu6h8\">本节用一个范例应用来演示一下 Service Worker 实战。</p>\n<div class=\"alert is-helpful\">\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"8iavrb74znq8a23f3frbv0pty\">要参与其中， \n<live-example downloadonly=\"\">\n 下载示例代码\n</live-example>。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"7fdbeojqxksr7asat2ue424lr\">解压下载文件，切换到该目录，并在终端窗口中输入以下命令。</p>\n<code-example format=\"shell\" language=\"shell\">\n\nnpm install           # install node packages\nng add @angular/pwa   # setup to use service worker\nng build              # build the app for production; code is in the /dist folder\n\n</code-example>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"j5jyop0kxtmgh1pdzwz919vr\">在本地开发期间启用服务工作线程支持，使用以下命令使用生产配置。</p>\n<code-example format=\"shell\" language=\"shell\">\n\nng serve --prod\n\n</code-example>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"1nssaperbdwj0udwpv4r0yqs0\">或者，你可以使用来自 \n<a href=\"https://www.npmjs.com/package/http-server\"><code>http-server package</code></a> 的 npm，支持服务工作线程应用程序。不安装直接运行：</p>\n<code-example format=\"shell\" language=\"shell\">\n\nnpx http-server -p 8080 -c-1 dist/&lt;project-name&gt;/browser\n\n</code-example>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"b5s2wmev7tamso15mxqhn1r5\">这将以 http://localhost:8080 为地址为你的应用程序提供服务工作线程支持。</p>\n</div>\n<h3 id=\"initial-load\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"9fe5bvw4ksvggq8yyjr9cemea\">最初的加载<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-getting-started#initial-load\"><i class=\"material-icons\">link</i></a></h3>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"c83imrpsdedq74sdl80cjn68l\">在端口 \n<code>8080</code> 上运行服务器，将浏览器指向 \n<code>http://localhost:8080</code>。 你的应用程序应该正常加载。</p>\n<div class=\"alert is-helpful\">\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"dkb9bum4050ljiu796b1y87ml\"><strong>提示</strong>：<br>\n当测试 Angular Service Worker 时，最好使用浏览器中的隐身或隐私窗口，以确保 Service Worker 不会从以前的残留状态中读取数据，否则可能导致意外的行为。</p>\n</div>\n<div class=\"alert is-helpful\">\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"kvumc5v4tgbs928ssc708vu\"><strong>注意</strong>：<br>\n如果没有使用 HTTPS，那么 Service Worker 只会在 <code>localhost</code> 上的应用中进行注册。</p>\n</div>\n<h3 id=\"simulating-a-network-issue\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"dfbik6sxxjrssehkisgdje4b2\">模拟网络出问题<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-getting-started#simulating-a-network-issue\"><i class=\"material-icons\">link</i></a></h3>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"cas3n3t0qkdq9lo0t42ug091k\">如果想模拟网络问题，以便在你的应用中禁用网络交互。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"cfh0b9glok9z92qjdgybth2fo\">在 Chrome 中：</p>\n<ol>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"e6cpmbxuznvbzvh4rmlz3lz18\">选择 <strong>Tools</strong> &gt; <strong>Developer Tools</strong>（从右上角的 Chrome 菜单）。</li>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"7egcsyqxgmk8ahjqbdt1ks9kz\">进入 <strong>Network 页</strong>。</li>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"5a9499yidv2ti3yiohleq20go\">在 <strong>Throttling</strong> 下拉菜单中选择 <strong>Offline</strong> 复选框。</li>\n</ol>\n<div class=\"lightbox\">\n<img alt=\"The offline option in the Network tab is selected\" src=\"generated/images/guide/service-worker/offline-option.png\" width=\"910\" height=\"261\">\n</div>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"dmo4hyyzimw09cwo2rslm8pvy\">现在，本应用不能再和网络进行交互了。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"3r6porlb9r7ocmc0xjjhqefye\">对于那些不使用 Angular Service Worker 的应用，现在刷新将会显示 Chrome 的“网络中断”页，提示“没有可用的网络连接”。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"bywpiyn6tkeu4ztuizjlft102\">有了 Angular Service Worker，本应用的行为就不一样了。刷新时，页面会正常加载。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"64b5tdkg11lkaa4nyqwl4caeb\">看看 Network 页，来验证此 Service Worker 是激活的。</p>\n<div class=\"lightbox\">\n<img alt=\"Requests are marked as from ServiceWorker\" src=\"generated/images/guide/service-worker/sw-active.png\" width=\"1576\" height=\"170\">\n</div>\n<div class=\"alert is-helpful\">\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"5hdb3wbo3oey0hj3w2ni69cgu\"><strong>注意</strong>：<br>\n在 “Size” 列中，请求的状态是 <code>(ServiceWorker)</code>。\n这表示该资源不是从网络上加载的，而是从 Service Worker 的缓存中。</p>\n</div>\n<h3 id=\"whats-being-cached\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"cv1x6fcf23pfneu3unifia472\">什么被缓存了？<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-getting-started#whats-being-cached\"><i class=\"material-icons\">link</i></a></h3>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"ev2cd4jpix2527gm1peze0e90\">注意，浏览器要渲染的所有这些文件都被缓存了。<code>ngsw-config.json</code> 样板文件被配置成了要缓存 CLI 用到的那些文件：</p>\n<ul>\n<li><code>index.html</code></li>\n<li><code>favicon.ico</code></li>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"7yakfueai4l668pdizgb0p7q1\">构建结果（JS 和 CSS 包）</li>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"38gre1eia5fsj9dmgoqn81q9a\"><code>assets</code> 下的一切</li>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"7x0yt8ouv743bvfpmbt2bm4c3\">图片和字体直接位于所配置的 <code>outputPath</code>(认为 <code>./dist/&lt;project-name&gt;/</code>）或 <code>resourcesOutputPath</code> 下。关于这些配置的更多信息，请参阅 <a href=\"cli/build\"><code>ng build</code></a>。</li>\n</ul>\n<div class=\"alert is-important\">\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"2jdpazrz9qqfk3jcv2la9ha1r\">注意如下两个关键点：</p>\n<ol>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"3huzgu6n9m19z1f5dkyqupf25\">所生成的 <code>ngsw-config.json</code> 包括一个可缓存字体和图像的有限列表。在某些情况下，你可能要按需修改这些 glob 模式。</p>\n</li>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"b5n00dr4htv9giolkcdzie2lo\">如果在生成了配置文件之后修改了 <code>resourcesOutputPath</code> 或 <code>assets</code> 的路径，那么就要在 <code>ngsw-config.json</code> 中手动修改这些路径。</p>\n</li>\n</ol>\n</div>\n<h3 id=\"making-changes-to-your-application\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"17kj9bztiae63lut6gogrp2bt\">修改你的应用<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-getting-started#making-changes-to-your-application\"><i class=\"material-icons\">link</i></a></h3>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"8dq8mlj78d0u7ta4ic14oqqry\">现在，你已经看到了 Service Worker 如何缓存你的应用，接下来的步骤讲它如何进行更新。</p>\n<ol>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"aodegeg08gdqy1osnwduco3zq\">如果你正在隐身窗口中测试，请打开第二个空白页。这会让该隐身窗口和缓存的状态在测试期间持续活着。</p>\n</li>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"2ant1xud24wbru4b2w836mywn\">关闭该应用的页面，而不是整个窗口。这也会同时关闭开发者工具。</p>\n</li>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"1jlo12rr4opjk0oxr92etnkp\">关闭 \n<code>http-server</code>（Ctrl-c）。</p>\n</li>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"7hr5lbwyrv9f8ov5d2i9yii6x\">打开 <code>src/app/app.component.html</code> 以供编辑。</p>\n</li>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"jyvu169iq829jd2w3lh9k16d\">把文本 <code>Welcome to {{title}}!</code> 改为 <code>Bienvenue à {{title}}!</code>。</p>\n</li>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"7qo6pjm5mg8j3aw0qd12dg37i\">再次构建并运行此服务器：</p>\n<code-example format=\"shell\" language=\"shell\">\n\nng build\nnpx http-server -p 8080 -c-1 dist/&lt;project-name&gt;/browser\n\n</code-example>\n</li>\n</ol>\n<h3 id=\"updating-your-application-in-the-browser\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"d3qeh57xh83q2m0u5islqenpc\">在浏览器中更新你的应用<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-getting-started#updating-your-application-in-the-browser\"><i class=\"material-icons\">link</i></a></h3>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"eigww7tkojjjaca1f7ivjixlp\">现在，看看浏览器和 Service Worker 如何处理这个更新后的应用。</p>\n<ol>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"eh71inqc5tma5zc4lhzeb5sbv\">在同一窗口中再次打开 \n<a href=\"http://localhost:8080\">http://localhost:8080</a>。 会发生什么？</p>\n<div class=\"lightbox\">\n<img alt=\"It still says Welcome to Service Workers!\" src=\"generated/images/guide/service-worker/welcome-msg-en.png\" width=\"411\" height=\"248\">\n</div>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"4c9fj8deo67nyhc4d4cywqlp\">出了什么问题？ \n<em>实际上，没有！</em></p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"4lxr7w4h1n96ffeaaukwjhm2t\">Angular 服务工作线程正在执行其工作，并提供其已经 \n<strong>安装</strong> 的应用程序版本，即使有更新可用。 为了速度起见，服务工作线程在提供其已缓存的应用程序之前不会等待检查更新。</p>\n<br>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"20yofaklk1gatvld77ypwtl1j\">查看 \n<code>http-server</code> 日志，看到服务工作线程请求 \n<code>/ngsw.json</code>。</p>\n<code-example format=\"shell\" language=\"shell\">\n\n[2023-09-07T00:37:24.372Z]  \"GET /ngsw.json?ngsw-cache-bust=0.9365263935102124\" \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/115.0.0.0 Safari/537.36\"\n\n</code-example>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"i3tkpt9ep73nmoomaikrc0kf\">这是服务工作线程检查更新的方式。</p>\n</li>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"9mmvm1labqvmf7epmverv6qt\">刷新页面。</p>\n<div class=\"lightbox\">\n<img alt=\"The text has changed to say Bienvenue à app!\" src=\"generated/images/guide/service-worker/welcome-msg-fr.png\" width=\"393\" height=\"240\">\n</div>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"72zdicn5iev2qfe50ga7megoo\">Service Worker <em>在后台</em>安装好了这个更新后的版本，下次加载或刷新页面时，Service Worker 就切换到最新的版本了。</p>\n</li>\n</ol>\n<h2 id=\"more-on-angular-service-workers\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"e9jl51v338pdg88lkv1cl8f1i\">关于 Angular Service Worker 的更多信息<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-getting-started#more-on-angular-service-workers\"><i class=\"material-icons\">link</i></a></h2>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"1oolgylns9kaynftarwog49tq\">你可能还对下列内容感兴趣：</p>\n<ul>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"9cfxkkw7yam6tkmu721tmsmxm\"><a href=\"guide/service-worker-communications\">与 Service Worker 通讯</a></li>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"euc8u4m04wpqm4u3h2eqnb0fp\"><a href=\"guide/app-shell\">应用外壳</a></li>\n</ul>\n<!-- links -->\n<!-- external links -->\n<!-- end links -->\n\n  <div class=\"reviewed\">最后复查时间：Wed Sep 06 2023</div>\n</div>\n\n\n<!-- links to this doc:\n - guide/service-worker-communications\n - guide/service-worker-intro\n - guide/service-worker-notifications\n-->\n<!-- links from this doc:\n - cli\n - cli/build\n - guide/app-shell\n - guide/service-worker-communications\n - guide/service-worker-config\n - guide/service-worker-getting-started#adding-a-service-worker-to-your-project\n - guide/service-worker-getting-started#getting-started-with-service-workers\n - guide/service-worker-getting-started#initial-load\n - guide/service-worker-getting-started#making-changes-to-your-application\n - guide/service-worker-getting-started#more-on-angular-service-workers\n - guide/service-worker-getting-started#prerequisites\n - guide/service-worker-getting-started#service-worker-in-action-a-tour\n - guide/service-worker-getting-started#simulating-a-network-issue\n - guide/service-worker-getting-started#updating-your-application-in-the-browser\n - guide/service-worker-getting-started#whats-being-cached\n - guide/service-worker-intro\n - http://localhost:8080\n - https://www.npmjs.com/package/http-server\n-->"}