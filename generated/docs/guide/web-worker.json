{"id":"guide/web-worker","title":"用 Web Worker 处理后台进程","contents":"<div class=\"content\">\n  <h1 id=\"background-processing-using-web-workers\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"40bfhnilf20f4cpt7dpp912ls\">用 Web Worker 处理后台进程<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/web-worker#background-processing-using-web-workers\"><i class=\"material-icons\">link</i></a></h1>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"c6kh7vefpai1cqk4hvqkrast0\"><a href=\"https://developer.mozilla.org/docs/Web/API/Web_Workers_API\">Web workers</a> 允许您在后台线程中运行 CPU 密集型计算，从而释放主线程以更新用户界面。执行大量计算的应用程序，如生成计算机辅助设计（CAD）图纸或进行繁重的几何计算，可以使用 Web workers 来提高性能。</p>\n<div class=\"alert is-helpful\">\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"66pi88a3ek3nfr5asx6k7y3om\">CLI 不支持在 Web Worker 中运行 Angular。</p>\n</div>\n<h2 id=\"adding-a-web-worker\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"9tj6jrqzrx8m80p552amj53cg\">添加一个 Web Worker<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/web-worker#adding-a-web-worker\"><i class=\"material-icons\">link</i></a></h2>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"4k8z0r36tkhw8t52hb858wh6l\">要把 Web Worker 添加到现有项目中，请使用 Angular CLI <code>ng generate</code> 命令。</p>\n<code-example format=\"shell\" language=\"shell\">\n\nng generate web-worker &lt;location&gt;\n\n</code-example>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"dr3zh8ehdhbl3qqvhdz4uwr1t\">你可以在应用的任何位置添加 Web Worker。比如，要把一个 Web Worker 添加到根组件 <code>src/app/app.component.ts</code>，请运行如下命令。</p>\n<code-example format=\"shell\" language=\"shell\">\n\nng generate web-worker app\n\n</code-example>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"53hzaguzi3nse5kjl9mtvc9xz\">该命令会执行以下操作。</p>\n<ol>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"9j1u8p9lfllnuvhm15hc0f8ab\">把你的项目配置为使用 Web Worker，如果还没有的话。</p>\n</li>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"amgtcsx4e7x3dxopxge06djeq\">把如下脚手架代码添加到 <code>src/app/app.worker.ts</code> 以接收消息。</p>\n<code-example language=\"typescript\" header=\"src/app/app.worker.ts\">\n\naddEventListener('message', ({ data }) =&gt; {\n  const response = `worker response to ${data}`;\n  postMessage(response);\n});\n\n</code-example>\n</li>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"c7nj905eekbzsqjh9dknzueg6\">把如下脚手架代码添加到 <code>src/app/app.component.ts</code> 以使用这个 Worker。</p>\n<code-example language=\"typescript\" header=\"src/app/app.component.ts\">\n\nif (typeof Worker !== 'undefined') {\n  // Create a new\n  const worker = new Worker(new URL('./app.worker', import.meta.url));\n  worker.onmessage = ({ data }) =&gt; {\n    console.log(`page got message: ${data}`);\n  };\n  worker.postMessage('hello');\n} else {\n  // Web workers are not supported in this environment.\n  // You should add a fallback so that your program still executes correctly.\n}\n\n</code-example>\n</li>\n</ol>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"e8wugpimyqurpqg0cvz2bv036\">生成这个初始脚手架之后，你必须把代码重构成向这个 Worker 发送消息和从 Worker 接收消息，以便使用 Web Worker。</p>\n<div class=\"alert is-important\">\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"79ef0nvh0ip14n2kbzhzquebl\">某些环境或平台，例如在 \n<code>@angular/platform-server</code> 中使用的 \n<a href=\"guide/ssr\">服务器端渲染</a>，不支持 Web workers。为了确保您的应用程序在这些环境中正常工作，您必须提供一个回退机制来执行工作线程否则执行的计算。</p>\n</div>\n<!-- links -->\n<!-- external links -->\n<!-- end links -->\n\n  <div class=\"reviewed\">最后复查时间：Mon Feb 28 2022</div>\n</div>\n\n\n<!-- links to this doc:\n - guide/architecture-next-steps\n - guide/developer-guide-overview\n-->\n<!-- links from this doc:\n - guide/ssr\n - guide/web-worker#adding-a-web-worker\n - guide/web-worker#background-processing-using-web-workers\n - https://developer.mozilla.org/docs/Web/API/Web_Workers_API\n-->"}