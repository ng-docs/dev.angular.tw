{"id":"guide/web-worker","title":"用 Web Worker 處理後台程序","contents":"<div class=\"content\">\n  <h1 id=\"background-processing-using-web-workers\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"40bfhnilf20f4cpt7dpp912ls\">用 Web Worker 處理後台程序<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/web-worker#background-processing-using-web-workers\"><i class=\"material-icons\">link</i></a></h1>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"c6kh7vefpai1cqk4hvqkrast0\"><a href=\"https://developer.mozilla.org/docs/Web/API/Web_Workers_API\">Web workers</a> 允許您在後台執行緒中執行 CPU 密集型計算，從而釋放主線程以更新使用者介面。執行大量計算的應用程式，如生成電腦輔助設計（CAD）圖紙或進行繁重的幾何計算，可以使用 Web workers 來提高效能。</p>\n<div class=\"alert is-helpful\">\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"66pi88a3ek3nfr5asx6k7y3om\">CLI 不支援在 Web Worker 中執行 Angular。</p>\n</div>\n<h2 id=\"adding-a-web-worker\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"9tj6jrqzrx8m80p552amj53cg\">新增一個 Web Worker<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/web-worker#adding-a-web-worker\"><i class=\"material-icons\">link</i></a></h2>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"4k8z0r36tkhw8t52hb858wh6l\">要把 Web Worker 新增到現有專案中，請使用 Angular CLI <code>ng generate</code> 指令。</p>\n<code-example format=\"shell\" language=\"shell\">\n\nng generate web-worker &lt;location&gt;\n\n</code-example>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"dr3zh8ehdhbl3qqvhdz4uwr1t\">你可以在應用的任何位置新增 Web Worker。比如，要把一個 Web Worker 新增到根元件 <code>src/app/app.component.ts</code>，請執行如下指令。</p>\n<code-example format=\"shell\" language=\"shell\">\n\nng generate web-worker app\n\n</code-example>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"53hzaguzi3nse5kjl9mtvc9xz\">該指令會執行以下操作。</p>\n<ol>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"9j1u8p9lfllnuvhm15hc0f8ab\">把你的專案設定為使用 Web Worker，如果還沒有的話。</p>\n</li>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"amgtcsx4e7x3dxopxge06djeq\">把如下腳手架程式碼新增到 <code>src/app/app.worker.ts</code> 以接收訊息。</p>\n<code-example language=\"typescript\" header=\"src/app/app.worker.ts\">\n\naddEventListener('message', ({ data }) =&gt; {\n  const response = `worker response to ${data}`;\n  postMessage(response);\n});\n\n</code-example>\n</li>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"c7nj905eekbzsqjh9dknzueg6\">把如下腳手架程式碼新增到 <code>src/app/app.component.ts</code> 以使用這個 Worker。</p>\n<code-example language=\"typescript\" header=\"src/app/app.component.ts\">\n\nif (typeof Worker !== 'undefined') {\n  // Create a new\n  const worker = new Worker(new URL('./app.worker', import.meta.url));\n  worker.onmessage = ({ data }) =&gt; {\n    console.log(`page got message: ${data}`);\n  };\n  worker.postMessage('hello');\n} else {\n  // Web workers are not supported in this environment.\n  // You should add a fallback so that your program still executes correctly.\n}\n\n</code-example>\n</li>\n</ol>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"e8wugpimyqurpqg0cvz2bv036\">生成這個初始腳手架之後，你必須把程式碼重構成向這個 Worker 傳送訊息和從 Worker 接收訊息，以便使用 Web Worker。</p>\n<div class=\"alert is-important\">\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"79ef0nvh0ip14n2kbzhzquebl\">某些環境或平台，例如在 \n<code>@angular/platform-server</code> 中使用的 \n<a href=\"guide/ssr\">伺服器端渲染</a>，不支援 Web workers。為了確保您的應用程式在這些環境中正常工作，您必須提供一個回退機制來執行工作執行緒否則執行的計算。</p>\n</div>\n<!-- links -->\n<!-- external links -->\n<!-- end links -->\n\n  <div class=\"reviewed\">最後複查時間：Mon Feb 28 2022</div>\n</div>\n\n\n<!-- links to this doc:\n - guide/architecture-next-steps\n - guide/developer-guide-overview\n-->\n<!-- links from this doc:\n - guide/ssr\n - guide/web-worker#adding-a-web-worker\n - guide/web-worker#background-processing-using-web-workers\n - https://developer.mozilla.org/docs/Web/API/Web_Workers_API\n-->"}