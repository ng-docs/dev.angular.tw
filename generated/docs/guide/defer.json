{"id":"guide/defer","title":"可延遲檢視","contents":"<div class=\"content\">\n  <h1 id=\"deferrable-views\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"3q4t2vob8qvc0bj45iceb1d8\">可延遲檢視<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/defer#deferrable-views\"><i class=\"material-icons\">link</i></a></h1>\n<h2 id=\"overview\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"3ivgu86loww6mg4fq1brezlnd\">概覽<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/defer#overview\"><i class=\"material-icons\">link</i></a></h2>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"aicu6m9211e41eapiulu3ifsa\">可延遲檢視可用於元件樣板中延遲載入該樣板中的某些依賴項。這些依賴項包括元件、指令和通道，以及任何相關的 CSS。要使用此功能，你可以在樣板中宣告性地將一個部分包裝在一個指定載入條件的 \n<code><a href=\"api/core/defer\" class=\"code-anchor\">@defer</a></code> 塊中。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"cgjo4r93vj19xips92bx6nb3v\">可延遲檢視支援一系列 \n<a href=\"guide/defer#triggers\">觸發器</a>、\n<a href=\"guide/defer#prefetching\">預取</a>，以及用於 \n<a href=\"guide/defer#placeholder\">佔位符</a>、\n<a href=\"guide/defer#loading\">載入</a> 和 \n<a href=\"guide/defer#error\">錯誤</a> 狀態管理的幾個子區塊。你還可以使用 \n<a href=\"guide/defer#when\"><code>when</code></a> 和 \n<a href=\"guide/defer#prefetching\"><code>prefetch when</code></a> 建立自定義條件。</p>\n<code-example language=\"html\">\n@defer {\n  &lt;large-component /&gt;\n}\n</code-example>\n<h2 id=\"why-use-deferrable-views\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"eqw38jgvw2xoyqoitjjbfww7l\">為什麼使用可延遲檢視？<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/defer#why-use-deferrable-views\"><i class=\"material-icons\">link</i></a></h2>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"87h850xe0w36jk0pxp5okysnq\">可延遲檢視，也稱為 \n<code><a href=\"api/core/defer\" class=\"code-anchor\">@defer</a></code> 區塊，是一個強大的工具，可用於減少應用程式的初始捆綁包大小，或者推遲載入可能直到以後才會被載入的重型元件。這應該會導致更快的初始載入速度，並提高你的核心 Web Vitals（CWV）結果。推遲一些元件直到以後應該特別能夠改善最大內容繪製（LCP）和首位元組時間（TTFB）。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"f27r0p8vps0xkn2rys4bpfdwq\">注意：強烈建議任何推遲載入的元件，一旦依賴項載入完成可能導致佈局變化的，都應放在頁面下方或者對使用者尚不可見的位置。</p>\n<h2 id=\"which-dependencies-are-defer-loadable\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"av5807mkv3w8igny4fjzbbew2\">哪些依賴項可以推遲載入？<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/defer#which-dependencies-are-defer-loadable\"><i class=\"material-icons\">link</i></a></h2>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"81jhtmyvjzgcvanzfheub7ccc\">為了使 \n<code><a href=\"api/core/defer\" class=\"code-anchor\">@defer</a></code> 塊中的依賴項能夠推遲載入，它們需要滿足兩個條件：</p>\n<ol>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"dga4a4vefv1w4omte5ydor2i2\">它們必須是獨立的。非獨立的依賴項無法推遲載入，並且將仍然被急性載入，即使在 \n<code><a href=\"api/core/defer\" class=\"code-anchor\">@defer</a></code> 區塊內部。</p>\n</li>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"ao19h2cgbudx6xj6ffygdwbah\">它們不能直接從同一檔案中的其他位置引用，即使在 \n<code><a href=\"api/core/defer\" class=\"code-anchor\">@defer</a></code> 區塊外部；這包括 ViewChild 查詢。</p>\n</li>\n</ol>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"3q43pbzuijfspeey0hfsvvc4x\">在推遲塊中使用的元件、指令和通道的傳遞依賴關係可以是獨立的或基於 NgModule，並且仍將被推遲載入。</p>\n<h2 id=\"blocks\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"a5xwaqbi0e61umqg5kpxpysa\">區塊<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/defer#blocks\"><i class=\"material-icons\">link</i></a></h2>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"9ttaydr0z6jzzri65bfq369n2\"><code><a href=\"api/core/defer\" class=\"code-anchor\">@defer</a></code> 區塊具有幾個子區塊，用於優雅地處理推遲載入過程中的不同階段。</p>\n<h3 id=\"defer\"><code><a href=\"api/core/defer\" class=\"code-anchor\">@defer</a></code><a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/defer#defer\"><i class=\"material-icons\">link</i></a></h3>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"2c2drayszg3e61zu0jm0tbjud\">主 \n<code><a href=\"api/core/defer\" class=\"code-anchor\">@defer</a></code> 區塊的內容是延遲載入的內容部分。它在初始渲染時不會被呈現，所有內容將在指定的 \n<a href=\"guide/defer#triggers\">觸發器</a> 或 \n<code>when</code> 條件滿足並且依賴項被獲取後才會顯示。預設情況下，\n<code><a href=\"api/core/defer\" class=\"code-anchor\">@defer</a></code> 區塊在瀏覽器狀態變為 \n<a href=\"guide/defer#on-idle\">空閒</a> 時觸發。</p>\n<h3 id=\"placeholder\"><code>@placeholder</code><a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/defer#placeholder\"><i class=\"material-icons\">link</i></a></h3>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"b7e02pr8wtu4ji9rxsnapxcjb\">預設情況下，推遲區塊在觸發之前不呈現任何內容。 \n<code>@placeholder</code> 是一個可選區塊，宣告在推遲區塊觸發之前要顯示的內容。一旦載入完成，此佔位符內容將被主內容替換。您可以在佔位符部分中使用任何內容，包括純 HTML、元件、指令和通道；但請記住，佔位符區塊的依賴項將被急性載入。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"8ttzz4s8jynb6347wdk0q3zfk\">注意：為了獲得最佳使用者體驗，您應始終指定一個 \n<code>@placeholder</code> 區塊。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"d859cez6bu3slqmve207e3epf\"><code>@placeholder</code> 區塊接受一個可選引數，用於指定此佔位符應該顯示的最短時間 \n<code>minimum</code>。這個 \n<code>minimum</code> 引數以毫秒（ms）或秒（s）的時間增量指定。這個引數的存在是為了防止在推遲載入的依賴項快速獲取時佔位符內容快速閃爍。 \n<code>@placeholder</code> 區塊的 \n<code>minimum</code> 計時器在初始渲染此 \n<code>@placeholder</code> 區塊完成後開始計時。</p>\n<code-example language=\"html\">\n@defer {\n  &lt;large-component /&gt;\n} @placeholder (minimum 500ms) {\n  &lt;p&gt;Placeholder content&lt;/p&gt;\n}\n</code-example>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"8iaywp99mqbprkzdjrz76wnbc\">注意：某些觸發器可能需要存在\n<code>@placeholder</code>或樣板引用變數才能正常工作。檢視\n<a href=\"guide/defer#triggers\">觸發器</a>部分瞭解更多詳情。</p>\n<h3 id=\"loading\"><code>@loading</code><a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/defer#loading\"><i class=\"material-icons\">link</i></a></h3>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"86b133pf8h1fwy9ld2ntptblw\"><code>@loading</code>區塊是一個可選區塊，允許你宣告在延遲依賴項載入期間顯示的內容。例如，你可以顯示一個載入動畫。與\n<code>@placeholder</code>類似，\n<code>@loading</code>區塊的依賴項會被急性載入。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"7ilnvhe2j6beujcwg1xqrvyvd\"><code>@loading</code>區塊接受兩個可選引數，用於指定應該顯示此佔位符的\n<code>最小</code>時間量和載入開始後等待顯示載入樣板的時間量。\n<code>minimum</code>和\n<code>after</code>引數以毫秒（ms）或秒（s）為單位指定。與\n<code>@placeholder</code>類似，這些引數存在是為了防止延遲依賴項快速獲取時內容快速閃爍。\n<code>@loading</code>區塊的\n<code>minimum</code>和\n<code>after</code>計時器在載入觸發後立即開始。</p>\n<code-example language=\"html\">\n@defer {\n  &lt;large-component /&gt;\n} @loading (after 100ms; minimum 1s) {\n  &lt;<a href=\"api/common/NgOptimizedImage\" class=\"code-anchor\">img</a> alt=\"loading...\" src=\"loading.gif\" /&gt;\n}\n</code-example>\n<h3 id=\"error\"><code>@error</code><a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/defer#error\"><i class=\"material-icons\">link</i></a></h3>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"70ekio5p4v4yxik0t1va0z91m\"><code>@error</code>區塊允許你宣告在延遲載入失敗時顯示的內容。與\n<code>@placeholder</code>和\n<code>@loading</code>類似，\n<code>@error</code>區塊的依賴項會被急性載入。\n<code>@error</code>區塊是可選的。</p>\n<code-example language=\"html\">\n@defer {\n  &lt;calendar-cmp /&gt;\n} @error {\n  &lt;p&gt;Failed to load the calendar&lt;/p&gt;\n}\n</code-example>\n<h2 id=\"triggers\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"7vgcf722ylvmkj1nb28q7j5wh\">觸發器<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/defer#triggers\"><i class=\"material-icons\">link</i></a></h2>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"57jv5k89zo7gkgfpjlmjfyzus\">當觸發\n<code><a href=\"api/core/defer\" class=\"code-anchor\">@defer</a></code>區塊時，它將佔位內容替換為延遲載入的內容。有兩種設定何時觸發此替換的選項：\n<code>on</code>和\n<code>when</code>。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"6hp2czyy8m8g7illj3i6flzvc\"><a id=\"on\"></a>\n<code>on</code>使用可用觸發器清單中的觸發器指定觸發條件。例如，可以是互動或視口觸發。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"y6yy85zsidrmes9o0bje6oer\">可以同時定義多個事件觸發器。例如：\n<code>on interaction; on timer(5s)</code>表示如果使用者與佔位符互動，或者經過5秒後，延遲區塊將被觸發。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"5gzzlp4jmm27blfbqjsuzbtud\">注意：多個\n<code>on</code>觸發器始終為OR條件。類似地，\n<code>on</code>與\n<code>when</code>條件混合也是OR條件。</p>\n<code-example language=\"html\">\n@defer (on viewport; on timer(5s)) {\n  &lt;calendar-cmp /&gt;\n} @placeholder {\n  &lt;<a href=\"api/common/NgOptimizedImage\" class=\"code-anchor\">img</a> src=\"placeholder.png\" /&gt;\n}\n</code-example>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"5kuc7dckyoibsomr5e3fj1pgt\"><a id=\"when\"></a>\n<code>when</code>將條件指定為回傳布林值的表示式。當此表示式變為真時，佔位符將與延遲載入的內容交換（如果依賴項需要獲取，這可能是一個非同步操作）。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"2cf1ecjyux600dnm2rxm9svqq\">注意：如果\n<code>when</code>條件再次切換為\n<code>false</code>，則延遲區塊不會恢復為佔位符。替換是一次性操作。如果區塊內的內容應有條件地渲染，則可以在區塊內部使用\n<code>if</code>條件。</p>\n<code-example language=\"html\">\n@defer (when cond) {\n  &lt;calendar-cmp /&gt;\n}\n</code-example>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"4a0xokaw1c579hp8rzbybpfy9\">你也可以在一個語句中同時使用\n<code>when</code>和\n<code>on</code>，如果任一條件滿足則會觸發替換。</p>\n<code-example language=\"html\">\n@defer (on viewport; when cond) {\n  &lt;calendar-cmp /&gt;\n} @placeholder {\n  &lt;<a href=\"api/common/NgOptimizedImage\" class=\"code-anchor\">img</a> src=\"placeholder.png\" /&gt;\n}\n</code-example>\n<h3 id=\"on-idle\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"6yo0od9ry9n4jlq7362h1j6nu\">on idle<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/defer#on-idle\"><i class=\"material-icons\">link</i></a></h3>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"9gf9pjtsqp3wuper8vgmoq3b8\"><code>idle</code>將在瀏覽器達到空閒狀態時觸發延遲載入（在底層使用\n<code>requestIdleCallback</code> API進行檢測）。這是帶有延遲區塊的預設行為。</p>\n<h3 id=\"on-viewport\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"3l5fa35s4o3mdit39v4bccrw1\">on viewport<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/defer#on-viewport\"><i class=\"material-icons\">link</i></a></h3>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"agfh77wvg22r8rv1zhdobscfc\"><code>viewport</code>會在指定內容進入視口時觸發延遲區塊，使用\n<code>IntersectionObserver</code> API進行檢測。這可以是佔位內容或元素引用。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"aknyqi7gf8t7z3ev72ttb79ii\">預設情況下，只要它是單個根元素節點，佔位符將作為被監視以進入視口的元素。</p>\n<code-example language=\"html\">\n@defer (on viewport) {\n  &lt;calendar-cmp /&gt;\n} @placeholder {\n  &lt;div&gt;Calendar placeholder&lt;/div&gt;\n}\n</code-example>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"a5n60fujsgygo3rcxvwllv1jb\">或者，可以在與\n<code><a href=\"api/core/defer\" class=\"code-anchor\">@defer</a></code>區塊相同的樣板中指定一個\n<a href=\"guide/glossary#template-reference-variable\">樣板引用變數</a>作為在視口觸發器上監視進入視口的元素。此變數作為視口觸發器的引數傳入。</p>\n<code-example language=\"html\">\n&lt;div #greeting&gt;Hello!&lt;/div&gt;\n\n@defer (on viewport(greeting)) {\n  &lt;greetings-cmp /&gt;\n}\n</code-example>\n<h3 id=\"on-interaction\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"jpomf2uqg6fxlc7dz8t1zc00\">on interaction<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/defer#on-interaction\"><i class=\"material-icons\">link</i></a></h3>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"2klbl2kcd6s8b036jo8c5rxy7\"><code>interaction</code>將在使用者透過\n<code>click</code>或\n<code>keydown</code>事件與指定元素互動時觸發延遲區塊。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"edmq5s0p78ydl9mdlb909qs81\">預設情況下，只要佔位符是單個根元素節點，它就會作為互動元素。</p>\n<code-example language=\"html\">\n@defer (on interaction) {\n  &lt;calendar-cmp /&gt;\n} @placeholder {\n  &lt;div&gt;Calendar placeholder&lt;/div&gt;\n}\n</code-example>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"7338jjskunez7zpquobdho5av\">或者，你可以指定一個作為觸發互動的\n<a href=\"guide/glossary#template-reference-variable\">樣板引用變數</a>。這個變數將作為互動觸發器的引數傳入。</p>\n<code-example language=\"html\">\n&lt;button type=\"button\" #greeting&gt;Hello!&lt;/button&gt;\n\n@defer (on interaction(greeting)) {\n  &lt;calendar-cmp /&gt;\n} @placeholder {\n  &lt;div&gt;Calendar placeholder&lt;/div&gt;\n}\n</code-example>\n<h3 id=\"on-hover\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"79fn49s04jmptc9py6b736189\">在懸停時<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/defer#on-hover\"><i class=\"material-icons\">link</i></a></h3>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"avwgfyonfa7p4igjahem9p4l3\"><code>hover</code> 當滑鼠懸停在觸發區域上時觸發延遲載入。用於此操作的事件為\n<code>mouseenter</code>和\n<code>focusin</code>。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"dmec9s3522j6g9av48cxjc2sx\">預設情況下，只要佔位符是單個根元素節點，它就會作為懸停元素。</p>\n<code-example language=\"html\">\n@defer (on hover) {\n  &lt;calendar-cmp /&gt;\n} @placeholder {\n  &lt;div&gt;Calendar placeholder&lt;/div&gt;\n}\n</code-example>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"9g6rula47whyfm1ud2ge2y94e\">或者，你可以指定一個作為懸停元素的\n<a href=\"guide/glossary#template-reference-variable\">樣板引用變數</a>。這個變數將作為懸停觸發器的引數傳入。</p>\n<code-example language=\"html\">\n&lt;div #greeting&gt;Hello!&lt;/div&gt;\n\n@defer (on hover(greeting)) {\n  &lt;calendar-cmp /&gt;\n} @placeholder {\n  &lt;div&gt;Calendar placeholder&lt;/div&gt;\n}\n</code-example>\n<h3 id=\"on-immediate\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"2u6bykvmbcmje6t8v1naz9x3q\">立即觸發<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/defer#on-immediate\"><i class=\"material-icons\">link</i></a></h3>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"9d6t0zhr85x6cczjowbcm94ow\"><code>immediate</code> 立即觸發延遲載入，意味著一旦用戶端完成渲染，延遲區塊就會立即開始獲取。</p>\n<code-example language=\"html\">\n@defer (on immediate) {\n  &lt;calendar-cmp /&gt;\n} @placeholder {\n  &lt;div&gt;Calendar placeholder&lt;/div&gt;\n}\n</code-example>\n<h3 id=\"on-timer\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"ae8oye3lfxqwvh13qy06adsfr\">按計時器觸發<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/defer#on-timer\"><i class=\"material-icons\">link</i></a></h3>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"enqp2n849tfxu0eutm22doidv\"><code>timer(x)</code> 將在指定的持續時間後觸發。持續時間是必需的，可以用\n<code>ms</code>或\n<code>s</code>指定。</p>\n<code-example language=\"html\">\n@defer (on timer(500ms)) {\n  &lt;calendar-cmp /&gt;\n}\n</code-example>\n<h2 id=\"prefetching\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"686wkjb6lmoavo6zrleeymhrp\">預取<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/defer#prefetching\"><i class=\"material-icons\">link</i></a></h2>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"bdndvashm0sgtw5mbsv8mktjl\"><code><a href=\"api/core/defer\" class=\"code-anchor\">@defer</a></code>允許指定何時觸發依賴項的預取條件。你可以使用特殊的\n<code>prefetch</code>關鍵字。\n<code>prefetch</code>語法與主要延遲條件類似，接受\n<code>when</code>和/或\n<code>on</code>來宣告觸發條件。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"2oycr9fte06bph87a30p1upd3\">在這種情況下，與延遲相關的\n<code>when</code>和\n<code>on</code>控制何時渲染，而\n<code>prefetch when</code>和\n<code>prefetch on</code>控制何時獲取資源。這使得更高階的行為成為可能，例如在使用者實際看到或與延遲區塊互動之前就開始預取資源，以更快地使資源可用。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"5o3q281ubwjjx218tjzblr8o7\">在下面的範例中，預取在瀏覽器空閒時開始，區塊的內容在互動時渲染。</p>\n<code-example language=\"html\">\n@defer (on interaction; prefetch on idle) {\n  &lt;calendar-cmp /&gt;\n} @placeholder {\n  &lt;<a href=\"api/common/NgOptimizedImage\" class=\"code-anchor\">img</a> src=\"placeholder.png\" /&gt;\n}\n</code-example>\n<h2 id=\"testing\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"etpgj6p39fywtmcrsphy8qrcg\">測試<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/defer#testing\"><i class=\"material-icons\">link</i></a></h2>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"clfjxa2pyopk3niealujpip8g\">Angular提供了TestBed API來簡化測試\n<code><a href=\"api/core/defer\" class=\"code-anchor\">@defer</a></code>區塊和在測試期間觸發不同狀態的過程。預設情況下，在測試中，\n<code><a href=\"api/core/defer\" class=\"code-anchor\">@defer</a></code>區塊會像在實際應用程式中一樣播放。如果你想手動逐步執行狀態，可以在TestBed設定中將延遲區塊行為切換為\n<code>Manual</code>。</p>\n<code-example language=\"typescript\">\nit('should render a defer block in different states', <a href=\"api/platform-browser/animations/async\" class=\"code-anchor\">async</a> () =&gt; {\n  // configures the defer block behavior to start in \"paused\" state for manual control.\n  TestBed.configureTestingModule({deferBlockBehavior: <a href=\"api/core/testing/DeferBlockBehavior#Manual\" class=\"code-anchor\">DeferBlockBehavior.Manual</a>});\n\n  @<a href=\"api/core/Component\" class=\"code-anchor\">Component</a>({\n    // ...\n    template: `\n      @defer {\n        &lt;large-component /&gt;\n      } @placeholder {\n        Placeholder\n      } @loading {\n        Loading...\n      }\n    `\n  })\n  class ComponentA {}\n\n  // Create component fixture.\n  const componentFixture = TestBed.createComponent(ComponentA);\n\n  // Retrieve the list of all defer block fixtures and get the first block.\n  const deferBlockFixture = (await componentFixture.getDeferBlocks())[0];\n\n  // Renders placeholder state by default.\n  expect(componentFixture.nativeElement.innerHTML).toContain('Placeholder');\n\n  // Render loading state and verify rendered output.\n  await deferBlockFixture.render(<a href=\"api/core/testing/DeferBlockState#Loading\" class=\"code-anchor\">DeferBlockState.Loading</a>);\n  expect(componentFixture.nativeElement.innerHTML).toContain('Loading');\n\n  // Render final state and verify the output.\n  await deferBlockFixture.render(<a href=\"api/core/testing/DeferBlockState#Complete\" class=\"code-anchor\">DeferBlockState.Complete</a>);\n  expect(componentFixture.nativeElement.innerHTML).toContain('large works!');\n});\n</code-example>\n<h2 id=\"behavior-with-server-side-rendering-ssr-and-static-site-generation-ssg\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"1l738nh4yhfl1btc712ne60hp\">與伺服器端渲染（SSR）和靜態站點生成（SSG）的行為<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/defer#behavior-with-server-side-rendering-ssr-and-static-site-generation-ssg\"><i class=\"material-icons\">link</i></a></h2>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"528i7hztxvzxz3l1ejmav4bm9\">在服務器端渲染應用程式（使用SSR或SSG）時，延遲區塊始終會呈現它們的\n<code>@placeholder</code>（如果未指定佔位符，則不會呈現任何內容）。伺服器端會忽略觸發器。</p>\n<h2 id=\"behavior-with-ngmodule\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"9d0rl1czjapf1servwx1zqj5k\">與\n<code><a href=\"api/core/NgModule\" class=\"code-anchor\">NgModule</a></code>的行為<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/defer#behavior-with-ngmodule\"><i class=\"material-icons\">link</i></a></h2>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"e1evjdxkbbum354zjte4rlxll\"><code><a href=\"api/core/defer\" class=\"code-anchor\">@defer</a></code>區塊可以在獨立元件、指令和通道以及NgModule中使用。你可以在\n<code><a href=\"api/core/defer\" class=\"code-anchor\">@defer</a></code>塊中使用獨立和NgModule中的依賴項，但\n<strong>只有獨立元件、指令和通道可以延遲載入</strong>。NgModule中的依賴項將包含在急性載入的捆綁包中。</p>\n<h2 id=\"nested-defer-blocks-and-avoiding-cascading-loads\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"27o495r8rsad7hz7w6eugfqdw\">巢狀的\n<code><a href=\"api/core/defer\" class=\"code-anchor\">@defer</a></code>區塊和避免級聯載入<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/defer#nested-defer-blocks-and-avoiding-cascading-loads\"><i class=\"material-icons\">link</i></a></h2>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"7m17yrz5jakmhs6qcclzvk3w3\">有些情況下，巢狀多個 \n<code><a href=\"api/core/defer\" class=\"code-anchor\">@defer</a></code> 區塊可能會導致級聯請求。一個例子是，當一個具有立即觸發器的 \n<code><a href=\"api/core/defer\" class=\"code-anchor\">@defer</a></code> 區塊有一個巢狀的具有另一個立即觸發器的 \n<code><a href=\"api/core/defer\" class=\"code-anchor\">@defer</a></code> 區塊時。當你有巢狀的 \n<code><a href=\"api/core/defer\" class=\"code-anchor\">@defer</a></code> 區塊時，請確保內部區塊具有不同的條件集，以便它們不會同時觸發，從而導致級聯請求。</p>\n<h2 id=\"avoiding-layout-shifts\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"b1wzdl7lyg58c7pevmdhoqm7r\">避免佈局位移<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/defer#avoiding-layout-shifts\"><i class=\"material-icons\">link</i></a></h2>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"ezmyx51phab07pu6pd6pag682\">推薦的最佳實踐是不延遲使用者在初始載入時可見的元件。這將透過導致累積佈局位移（CLS）而對 Core Web Vitals 產生負面影響。如果你選擇在此區域延遲元件，請避免使用 \n<code>immediate</code>、\n<code>timer</code>、\n<code>viewport</code> 和自定義 \n<code>when</code> 條件，這些條件會導致內容在頁面初始渲染時載入。</p>\n\n  \n</div>\n\n\n<!-- links to this doc:\n - api/core/defer\n-->\n<!-- links from this doc:\n - api/common/NgOptimizedImage\n - api/core/Component\n - api/core/NgModule\n - api/core/defer\n - api/core/testing/DeferBlockBehavior#Manual\n - api/core/testing/DeferBlockState#Complete\n - api/core/testing/DeferBlockState#Loading\n - api/platform-browser/animations/async\n - guide/defer#avoiding-layout-shifts\n - guide/defer#behavior-with-ngmodule\n - guide/defer#behavior-with-server-side-rendering-ssr-and-static-site-generation-ssg\n - guide/defer#blocks\n - guide/defer#defer\n - guide/defer#deferrable-views\n - guide/defer#error\n - guide/defer#loading\n - guide/defer#nested-defer-blocks-and-avoiding-cascading-loads\n - guide/defer#on-hover\n - guide/defer#on-idle\n - guide/defer#on-immediate\n - guide/defer#on-interaction\n - guide/defer#on-timer\n - guide/defer#on-viewport\n - guide/defer#overview\n - guide/defer#placeholder\n - guide/defer#prefetching\n - guide/defer#testing\n - guide/defer#triggers\n - guide/defer#when\n - guide/defer#which-dependencies-are-defer-loadable\n - guide/defer#why-use-deferrable-views\n - guide/glossary#template-reference-variable\n - https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API\n-->"}