{"id":"guide/i18n-common-deploy","title":"部署多个语言环境","contents":"<div class=\"content\">\n  <h1 id=\"deploy-multiple-locales\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"4f52ejc3rinwvytrc1s74trwz\">部署多个语言环境<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/i18n-common-deploy#deploy-multiple-locales\"><i class=\"material-icons\">link</i></a></h1>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"ez1mv34tnjwkwv7jxk36idw7m\">如果 <code>myapp</code> 是包含项目可分发文件的目录，你通常会在语言环境目录中为不同的语言环境提供不同的版本，比如法语版的 <code>myapp/fr</code> 和西班牙语版的 <code>myapp/es</code>。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"7cy1j9zuli2t5032zk8vnlxu4\">带有 <code>href</code> 属性的 HTML <code>base</code> 标签指定了相对链接的基本 URI 或 URL。如果你将工作空间构建配置文件 <a href=\"guide/workspace-config\" title=\"Angular workspace configuration | Angular\"><code>angular.json</code></a> 中的 <code>\"localize\"</code> 选项设置为 <code>true</code> 或语言环境 ID 数组，CLI 会为应用程序的每个版本调整 base <code>href</code>。要为应用程序的每个版本调整 base <code>href</code>，CLI 会将语言环境添加到配置的 <code>\"baseHref\"</code> 中。在工作区配置文件 <a href=\"guide/workspace-config\" title=\"Angular workspace configuration | Angular\"><code>angular.json</code></a> 中为每个语言环境指定 <code>\"baseHref\"</code>。以下示例展示了设置为空字符串的 <code>\"baseHref\"</code>。</p>\n<code-example header=\"angular.json\" path=\"i18n/angular.json\" region=\"i18n-baseHref\">\n  \"projects\": {\n    \"angular.io-example\": {\n      // ...\n      \"i18n\": {\n        \"sourceLocale\": \"en-US\",\n        \"locales\": {\n          \"fr\": {\n            \"translation\": \"src/locale/messages.fr.xlf\",\n            \"baseHref\": \"\"\n          }\n        }\n      },\n      \"architect\": {\n        // ...\n      }\n    }\n  }\n  // ...\n}\n\n</code-example>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"5j044z0omnrreo7ajea5f92u2\">此外，要在编译时声明 base <code>href</code>，请将在 CLI 中使用带有 <code>--baseHref</code> 选项的 <a href=\"cli/build\" title=\"ng build | CLI | Angular\"> <code>ng build</code> </a>。</p>\n<h2 id=\"configure-a-server\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"82s4atn4w14dlfrv8nqng6qsl\">配置服务器<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/i18n-common-deploy#configure-a-server\"><i class=\"material-icons\">link</i></a></h2>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"ae1xgllvgd78u42ya1ljky643\">多语言的典型部署方式是为来自不同子目录的每种语言提供服务。使用 <code>Accept-Language</code> HTTP 标头将用户重定向到浏览器中定义的首选语言。如果用户未定义首选语言，或者首选语言不可用，则服务器将回退到默认语言。要更改语言，就转到另一个子目录。\n子目录的更改通常使用应用程序中实现的菜单进行。</p>\n<div class=\"alert is-helpful\">\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"7ae34t2gw6bvkop2yjxxcqwmo\">有关如何将应用程序部署到远程服务器的更多信息，请参阅<a href=\"guide/deployment\" title=\"Deployment | Angular\">部署</a>。</p>\n</div>\n<h3 id=\"nginx-example\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"938p8l1dpasfpk0irdr2v3uz1\">Nginx 范例<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/i18n-common-deploy#nginx-example\"><i class=\"material-icons\">link</i></a></h3>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"7n05mzp688aehj6j6x2rd7h8\">以下示例展示了 Nginx 配置。</p>\n<code-example path=\"i18n/doc-files/nginx.conf\" language=\"nginx\">\n<a href=\"api/common/http\" class=\"code-anchor\">http</a> {\n    # Browser preferred language detection (does NOT require\n    # AcceptLanguageModule)\n    map $http_accept_language $accept_language {\n        ~*^de de;\n        ~*^fr fr;\n        ~*^en en;\n    }\n    # ...\n}\n\nserver {\n    listen 80;\n    server_name localhost;\n    root /www/data;\n\n    # Fallback to default language if no preference defined by <a href=\"api/animations/browser\" class=\"code-anchor\">browser</a>\n    if ($accept_language ~ \"^$\") {\n        set $accept_language \"fr\";\n    }\n\n    # Redirect \"/\" to Angular application in the preferred language of the <a href=\"api/animations/browser\" class=\"code-anchor\">browser</a>\n    rewrite ^/$ /$accept_language permanent;\n\n    # Everything under the Angular application is always redirected to Angular in the\n    # correct language\n    location ~ ^/(fr|de|en) {\n        try_files $uri /$1/index.html?$args;\n    }\n    # ...\n}\n\n\n</code-example>\n<h3 id=\"apache-example\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"2yf63hmoz35531bmp25rg7i1l\">Apache 范例<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/i18n-common-deploy#apache-example\"><i class=\"material-icons\">link</i></a></h3>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"a0kxe5d8b9oewutz9ypaqp7rf\">以下示例展示了 Apache 配置。</p>\n<code-example path=\"i18n/doc-files/apache2.conf\" language=\"apache\">\n&lt;VirtualHost *:80&gt;\n    ServerName localhost\n    DocumentRoot /www/data\n    &lt;Directory \"/www/data\"&gt;\n        RewriteEngine on\n        RewriteBase /\n        RewriteRule ^../index\\.html$ - [L]\n\n        RewriteCond %{REQUEST_FILENAME} !-f\n        RewriteCond %{REQUEST_FILENAME} !-d\n        RewriteRule (..) $1/index.html [L]\n\n        RewriteCond %{HTTP:Accept-Language} ^de [NC]\n        RewriteRule ^$ /de/ [R]\n\n        RewriteCond %{HTTP:Accept-Language} ^en [NC]\n        RewriteRule ^$ /en/ [R]\n\n        RewriteCond %{HTTP:Accept-Language} !^en [NC]\n        RewriteCond %{HTTP:Accept-Language} !^de [NC]\n        RewriteRule ^$ /fr/ [R]\n    &lt;/Directory&gt;\n&lt;/VirtualHost&gt;\n\n\n</code-example>\n<!-- links -->\n<!-- external links -->\n<!-- end links -->\n\n  <div class=\"reviewed\">最后复查时间：Mon Feb 28 2022</div>\n</div>\n\n\n<!-- links to this doc:\n - guide/i18n-common-merge\n - guide/i18n-common-overview\n-->\n<!-- links from this doc:\n - api/animations/browser\n - api/common/http\n - cli/build\n - guide/deployment\n - guide/i18n-common-deploy#apache-example\n - guide/i18n-common-deploy#configure-a-server\n - guide/i18n-common-deploy#deploy-multiple-locales\n - guide/i18n-common-deploy#nginx-example\n - guide/workspace-config\n-->"}