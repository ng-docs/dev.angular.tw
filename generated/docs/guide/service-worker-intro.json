{"id":"guide/service-worker-intro","title":"Angular 的 Service Worker 簡介","contents":"<div class=\"content\">\n  <h1 id=\"angular-service-worker-introduction\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"5bxudog612cer74evhk8xnrq2\">Angular 的 Service Worker 簡介<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-intro#angular-service-worker-introduction\"><i class=\"material-icons\">link</i></a></h1>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"3q4ea0xplioo8hnmivqe69q1f\">Service Worker 可以增強傳統的 Web 發布模式，並使應用程式能夠提供可與原生程式碼（它執行在你的作業系統和硬體層面）媲美的高可靠、高效能的使用者體驗。為 Angular 應用新增 Service Worker 是把應用轉換成<a href=\"https://web.dev/progressive-web-apps/\">漸進式應用（PWA）</a>的步驟之一。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"7lz37fhq89j237yc6b926q0m6\">簡單來說，Service Worker 就是一段執行在 Web 瀏覽器中，併為應用管理快取的指令碼。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"edo9cfg6asy9ob8mg81himybi\">Service Worker 的功能就像一個網路代理。它們會攔截所有由應用發出的 HTTP 請求，並選擇如何給出回應。比如，它們可以查詢區域性快取，如果有快取的回應資料，就用它做出回應。這種代理行為不會侷限於透過程式呼叫 API（比如 <code>fetch</code>）發起的請求，還包括 HTML 中對資源的引用，甚至對 <code>index.html</code> 的首次請求。基於 Service Worker 的快取是完全可程式設計的，並且不依賴於伺服器端指定的那些控制快取策略的頭。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"bothubejt9fayj1j0mhdsukqh\">不像應用中的其它指令碼（如 Angular 的應用套件），Service Worker 在使用者關閉瀏覽器頁標籤時仍然會被保留。下次瀏覽器載入本應用時，Service Worker 會首先載入，然後攔截載入本應用時的對每一項資源的請求。如果這個 Service Worker 就是為此而設計的，它就能<em>完全滿足應用載入時的需求，而不需要依賴網路</em>。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"6zj6vrzlpjw01kuqje20lpo41\">即使在快速可靠的網路中，往返延遲也可能在載入應用程式時產生顯著的延遲。使用 Service Worker 來減少對網路的依賴可以顯著改善使用者體驗。</p>\n<h2 id=\"service-workers-in-angular\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"710ds2h0tru0c4kiixhs9s64b\">Angular 中的 Service Worker<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-intro#service-workers-in-angular\"><i class=\"material-icons\">link</i></a></h2>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"634g04oo0jaky8ehgjabtoix0\">作為單頁面應用，Angular 應用可以受益於 Service Worker 的優勢。從版本 5.0.0 開始，Angular 提供了一份 Service Worker 的實現。Angular 開發人員可以利用 Service Worker，並受益於其增強的可靠性和效能，而無需再針對底層 API 寫程式碼。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"9oy05jvwnfpr6arldgeokhrh2\">Angular 的 Service Worker 的設計目標是最佳化那些使用慢速、不可靠網路的最終使用者的體驗，同時還要儘可能減小提供過期內容的風險。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"4c5jvhj821vgpitgtw0iu8w5a\">為了達成此目標，Angular Service Worker 的行為遵循下列設計原則：</p>\n<ul>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"523y9d3cigv006mldr4odjivd\">像安裝原生應用一樣快取應用。該應用作為整體被快取，它的所有檔案作為整體進行更新。</p>\n</li>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"2a43ht6ffnecfowatjmfe3vn6\">正在執行的應用使用所有檔案的同一版本繼續執行。不要突然開始接收來自新版本的、可能不相容的快取檔案。</p>\n</li>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"83cksvq0m81j2vqlcx3xval6c\">當用戶重新整理本應用時，他們會看到最新的被完全快取的版本。新的頁標籤中會載入最新的快取程式碼。</p>\n</li>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"c39487t6ynzaobdayv4h5nmdv\">在更改發布之後，相對較快的在後台進行更新。在一次完整的更新完成之前，仍然使用應用的上一個版本。</p>\n</li>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"7fkugy8iryoxbi8qq6b89zikd\">只要有可能，Service Worker 就會儘量節省頻寬。它只會下載那些發生了變化的資源。</p>\n</li>\n</ul>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"14ablj9xlftso5fm3nk3sb49a\">要支援這些行為，Angular 的 Service Worker 會從伺服器上下載一個 <code>manifest</code> 檔案。\n這個 <code>manifest</code> 檔案（不同於 <a href=\"https://developer.mozilla.org/docs/Web/Manifest\">web 應用的 manifest</a>）描述要快取的資源，幷包含每個檔案內容的雜湊值。\n當發布了應用的一個新版本時，<code>manifest</code> 的內容就會改變，通知 Service Worker 應該下載並快取應用的一個新版本了。\n這個 manifest 是從 CLI 生成的一個名叫 <code>ngsw-config.json</code> 的檔案中生成的。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"80bv3hocnqmqnknlaqx6zb5xj\">安裝 Angular 服務工作者與\n<a href=\"guide/service-worker-getting-started#cli-command\">執行 Angular CLI 指令</a>一樣簡單直接。 除了將 Angular 服務工作者註冊到瀏覽器中，這還提供了一些可用於注入的服務，這些服務與服務工作者進行互動，可以用於控制它。 例如，應用程式可以請求在新更新可用時收到通知，或者應用程式可以請求服務工作者檢查伺服器是否有可用更新。</p>\n<h2 id=\"prerequisites\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"e44b21uig1fakj5vcfuvz1bdu\">前提條件<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-intro#prerequisites\"><i class=\"material-icons\">link</i></a></h2>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"3433byl2e3k9oafcrul46yv16\">要使用 Angular Service Worker 的所有功能，請使用最新版本的 Angular 和 Angular CLI。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"baidqwaylokdfppqusuwn04zz\">要註冊 Service Worker，必須透過 HTTPS 而非 HTTP 訪問該應用程式。瀏覽器會忽略透過不安全連線訪問的頁面上的 Service Worker。原因是 Service Worker 非常強大，因此需要格外小心，以確保 Service Worker 的指令碼未被篡改。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"1nxs7o2r5dtov15vcy2yjr9ip\">這條規則有一個例外：為了方便本地開發，當訪問 <code>localhost</code> 上的應用時，瀏覽器<em>不</em>要求安全連線。</p>\n<h3 id=\"browser-support\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"4kdi5razdf2rr2s146m9cpxqe\">瀏覽器支援<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-intro#browser-support\"><i class=\"material-icons\">link</i></a></h3>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"f1geu4xsjg9juavguha1ya06c\">要從 Angular Service Worker 中受益，你的應用必須在支援 Service Worker 的 Web 瀏覽器中執行。當前，最新版本的 Chrome，Firefox，Edge，Safari，Opera，UC 瀏覽器（Android 版）和 Samsung Internet 支援 Service Worker。而 IE 和 Opera Mini 等瀏覽器不支援 Service Worker。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"1ko25vlaz56idtdbtyhtm742a\">如果使用者透過不支援 Service Worker 的瀏覽器訪問你的應用程式，則該 Service Worker 不會註冊，並且不會發生相關行為，比如離線快取管理和推送通知。進一步來說：</p>\n<ul>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"azmreq7rov08wecnek7j2t634\">瀏覽器不會下載 Service Worker 指令碼和 <code>ngsw.json</code> 清單檔案。</li>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"7l4s2d68pf6semepei94vrw95\">主動嘗試與 Service Worker 進行互動，比如呼叫 <code><a href=\"api/service-worker/SwUpdate#checkForUpdate\" class=\"code-anchor\">SwUpdate.checkForUpdate()</a></code>，會回傳被拒絕的承諾（Promise）</li>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"5euowedp2r6kb4rjlf3i1w384\">相關服務的可觀察事件，比如\n<code><a href=\"api/service-worker/SwUpdate#versionUpdates\" class=\"code-anchor\">SwUpdate.versionUpdates</a></code>，不會被觸發</li>\n</ul>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"ywxpoqwk9ky1wk5120t8kp9w\">強烈建議你確保即使在瀏覽器中沒有 Service Worker 支援的情況下，你的應用也可以正常執行。儘管不受支援的瀏覽器會忽略 Service Worker 快取，但如果應用程式嘗試與 Service Worker 進行互動，它將仍然會報告錯誤。比如，呼叫 <code><a href=\"api/service-worker/SwUpdate#checkForUpdate\" class=\"code-anchor\">SwUpdate.checkForUpdate()</a></code> 將回傳被拒絕的 Promise。為避免此類別錯誤，你可以使用 <code><a href=\"api/service-worker/SwUpdate#isEnabled\" class=\"code-anchor\">SwUpdate.isEnabled</a>()</code> 檢查是否啟用了 Angular Service Worker。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"6vpf89s1whzmd9nuosj8d0bv2\">要了解關於其它支援 Service Worker 的瀏覽器的更多訊息，請參閱 <a href=\"https://caniuse.com/#feat=serviceworkers\">Can I Use</a> 頁面和 <a href=\"https://developer.mozilla.org/docs/Web/API/Service_Worker_API\">MDN 文件</a>。</p>\n<h2 id=\"related-resources\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"e69igq8a2xsab77xsoqacateg\">相關資源<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-intro#related-resources\"><i class=\"material-icons\">link</i></a></h2>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"8wtp2ock1z28kah31dhqr03o9\">本節中的其餘文章專門針對 Service Worker 的 Angular 實現。</p>\n<ul>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"3chpa91gkd8kngrnffrmr754r\"><a href=\"guide/service-worker-communications\">與 Service Worker 通訊</a>.</li>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"53swk0yxrhfk9vwssqxhoeq0i\"><a href=\"guide/service-worker-notifications\">Service Worker 通知</a></li>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"c8h34vd4o8r9mh6u20crmuohp\"><a href=\"guide/service-worker-devops\">生產環境下的 Service Worker</a>。</li>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"ew4ab2vokoabifajmxtyb01m1\"><a href=\"guide/service-worker-config\">Service Worker 設定</a>。</li>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"euc8u4m04wpqm4u3h2eqnb0fp\"><a href=\"guide/app-shell\">應用外殼</a></li>\n</ul>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"9m70jbhou0ahqw1ybx9ybahxp\">要了解更多關於 Service Worker 的普遍性訊息，參閱 <a href=\"https://developers.google.com/web/fundamentals/primers/service-workers\">Service Worker 簡介</a>。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"e32buagb950sdih3dokjays7m\">要了解關於瀏覽器支援度的更多訊息，參閱 <a href=\"https://developers.google.com/web/fundamentals/primers/service-workers\">Service Worker 簡介</a> 中的<a href=\"https://developers.google.com/web/fundamentals/primers/service-workers/#browser_support\">瀏覽器支援</a>部分、Jake Archibald 寫的<a href=\"https://jakearchibald.github.io/isserviceworkerready\">Serviceworker 好了嗎？</a>和 <a href=\"https://caniuse.com/serviceworkers\">Can I Use</a>。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"45u3qlmptdvepsf3s5wqucnpw\">關於其它建議和範例，請參閱：</p>\n<ul>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"chl023blm7karzv4b1gwezzg1\"><a href=\"https://web.dev/precaching-with-the-angular-service-worker\">使用 Angular Service Worker 進行預快取</a></li>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"1okxbi7w7zysugl5h944zx3e4\"><a href=\"https://web.dev/creating-pwa-with-angular-cli\">使用 Angular CLI 建立 PWA</a></li>\n</ul>\n<h2 id=\"next-step\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"bio9f6q0dnpxej0ntev8d0cqg\">下一步<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-intro#next-step\"><i class=\"material-icons\">link</i></a></h2>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"2axvbmyo06sfe9h7iixy2u9ci\">要開始使用 Angular service Worker，參閱 <a href=\"guide/service-worker-getting-started\">Service Worker 快速上手</a>。</p>\n<!-- links -->\n<!-- external links -->\n<!-- end links -->\n\n  <div class=\"reviewed\">最後複查時間：Wed Sep 06 2023</div>\n</div>\n\n\n<!-- links to this doc:\n - api/service-worker\n - guide/architecture-next-steps\n - guide/developer-guide-overview\n - guide/glossary\n - guide/libraries\n - guide/service-worker-getting-started\n - guide/what-is-angular\n-->\n<!-- links from this doc:\n - api/service-worker/SwUpdate#checkForUpdate\n - api/service-worker/SwUpdate#isEnabled\n - api/service-worker/SwUpdate#versionUpdates\n - guide/app-shell\n - guide/service-worker-communications\n - guide/service-worker-config\n - guide/service-worker-devops\n - guide/service-worker-getting-started\n - guide/service-worker-getting-started#cli-command\n - guide/service-worker-intro#angular-service-worker-introduction\n - guide/service-worker-intro#browser-support\n - guide/service-worker-intro#next-step\n - guide/service-worker-intro#prerequisites\n - guide/service-worker-intro#related-resources\n - guide/service-worker-intro#service-workers-in-angular\n - guide/service-worker-notifications\n - https://caniuse.com/#feat=serviceworkers\n - https://caniuse.com/serviceworkers\n - https://developer.mozilla.org/docs/Web/API/Service_Worker_API\n - https://developer.mozilla.org/docs/Web/Manifest\n - https://developers.google.com/web/fundamentals/primers/service-workers\n - https://developers.google.com/web/fundamentals/primers/service-workers/#browser_support\n - https://jakearchibald.github.io/isserviceworkerready\n - https://web.dev/creating-pwa-with-angular-cli\n - https://web.dev/precaching-with-the-angular-service-worker\n - https://web.dev/progressive-web-apps/\n-->"}