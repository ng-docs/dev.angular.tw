{"id":"guide/language-service","title":"Angular 语言服务","contents":"<div class=\"content\">\n  <h1 id=\"angular-language-service\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"2ha168k1thozk25n4q3jnrajw\">Angular 语言服务<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/language-service#angular-language-service\"><i class=\"material-icons\">link</i></a></h1>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"dfsr1n1jxasz9jhcl6a0q6uh0\">Angular 语言服务为代码编辑器提供了一种在 Angular 模板中获取自动补全、错误、提示和导航的方法。它支持位于独立 HTML 文件中的外部模板以及内联模板。</p>\n<h2 id=\"configuring-compiler-options-for-the-angular-language-service\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"bttqlwqsgobew2o37aaxfu531\">配置 Angular 语言服务的编译器选项<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/language-service#configuring-compiler-options-for-the-angular-language-service\"><i class=\"material-icons\">link</i></a></h2>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"4k5hpigptvzo81pu1ia1rwg53\">要启用最新的语言服务功能，请在 <code>tsconfig.json</code> 中将 <code>strictTemplates</code> 选项设置为 <code>true</code>，如以下示例所示：</p>\n<code-example language=\"json\">\n\n\"angularCompilerOptions\": {\n  \"strictTemplates\": true\n}\n\n</code-example>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"8i6scvkcudkg5xgtrwiu74dao\">有关更多信息，请参见 <a href=\"guide/angular-compiler-options\">Angular 编译器选项</a>指南。</p>\n<h2 id=\"features\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"920kaz2p0y1fs418qurz1o45h\">特性<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/language-service#features\"><i class=\"material-icons\">link</i></a></h2>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"bcthhqwku53vcizzntgiaq6qh\">编辑器会自动检测到你正在打开 Angular 文件。然后，它就会使用 Angular Language Service 读取 <code>tsconfig.json</code> 文件，查找应用程序中具有的所有模板，然后为你打开的任何模板提供语言服务。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"b8c9o7g7wuf87k7iu202eijon\">语言服务包括：</p>\n<ul>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"r00316x5cewu12v3ftrjp7t9\">自动补全清单</li>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"3zmztekqkbyrjtkbfoe2i60n0\">AOT 诊断消息</li>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"f1sa0wjcr81ixrpmk1h2b0fs\">快捷信息</li>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"4l4rqqo1d1pgyzcjpcmhj25it\">转到定义</li>\n</ul>\n<h3 id=\"autocompletion\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"4w9ffi3auytore9nkduori6b1\">自动补全<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/language-service#autocompletion\"><i class=\"material-icons\">link</i></a></h3>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"1bajh55ze7ms6eu1nx1xtcwmo\">自动补全可以在输入时为你提供当前情境下的候选内容和提示，从而提高开发速度。下面这个例子展示了插值中的自动补全功能。当你进行输入的时候，就可以按 tab 键来自动补全。</p>\n<div class=\"lightbox\">\n<img alt=\"autocompletion\" src=\"generated/images/guide/language-service/language-completion.gif\" width=\"480\" height=\"72\">\n</div>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"2gwzq5bnhaws9hwcexnzcvipn\">还有对元素的自动补全。你定义的任何组件的选择器都会显示在自动补全列表中。</p>\n<h3 id=\"error-checking\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"blguyj3yc9hlvge1yvc11dr16\">错误检查<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/language-service#error-checking\"><i class=\"material-icons\">link</i></a></h3>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"cqhstbdffn4cz57un7yvq8bf5\">Angular 语言服务能对代码中存在的错误进行预警。在这个例子中，Angular 不知道什么是 <code>orders</code> 或者它来自哪里。</p>\n<div class=\"lightbox\">\n<img alt=\"error checking\" src=\"generated/images/guide/language-service/language-error.gif\" width=\"480\" height=\"126\">\n</div>\n<h3 id=\"quick-info-and-navigation\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"8hvxs76r3zyqizwcof6pbuc4j\">快捷信息与导航<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/language-service#quick-info-and-navigation\"><i class=\"material-icons\">link</i></a></h3>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"48k3211uq8spapkggs8y4bn3t\">快捷信息功能使你可以悬停以查看组件、指令、模块等的来源。然后，你可以单击“转到定义”或按 F12 键直接转到定义。</p>\n<div class=\"lightbox\">\n<img alt=\"navigation\" src=\"generated/images/guide/language-service/language-navigation.gif\" width=\"392\" height=\"186\">\n</div>\n<h2 id=\"angular-language-service-in-your-editor\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"97hsiplyxlq186tso3zl8bb4k\">编辑器中的 Angular 语言服务<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/language-service#angular-language-service-in-your-editor\"><i class=\"material-icons\">link</i></a></h2>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"1wo1gg9tfnl8hjd8nrhaahvwm\">Angular 语言服务目前在<a href=\"https://code.visualstudio.com\">Visual Studio Code</a>和<a href=\"https://www.jetbrains.com/webstorm\">WebStorm</a>、<a href=\"https://www.sublimetext.com/\">Sublime Text</a> 和 <a href=\"https://www.eclipse.org/eclipseide/\">Eclipse IDE</a> 中都有可用的扩展。</p>\n<h3 id=\"visual-studio-code\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"cm6n2qbzmvydr12efbe7np4bb\">Visual Studio Code<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/language-service#visual-studio-code\"><i class=\"material-icons\">link</i></a></h3>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"5yzx3v5mxu18ee235vbx3jlkm\">在 <a href=\"https://code.visualstudio.com\">Visual Studio Code 中</a>，从 “<a href=\"https://marketplace.visualstudio.com/items?itemName=Angular.ng-template\">扩展程序：市场</a> 中安装扩展程序。可以用左侧菜单窗格中的扩展程序图标从编辑器中打开市场，或使用 VS 快速打开（在 Mac 上为 ⌘+ P，在 Windows 上为 CTRL + P）并输入“? ext”。在市场中，搜索 Angular Language Service 扩展，并点击 <strong>Install</strong> 按钮。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"e0ldi9hks54m02zlp0e93t4p7\">Visual Studio Code 与 Angular 语言服务的集成工作是由 Angular 团队发布的。</p>\n<h3 id=\"visual-studio\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"ep6dskylmuoww2m8zoo38arht\">Visual Studio<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/language-service#visual-studio\"><i class=\"material-icons\">link</i></a></h3>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"8hc8uatxlpqtal0ccnpcvgm65\">在 <a href=\"https://visualstudio.microsoft.com\">Visual Studio 中</a>，从<a href=\"https://marketplace.visualstudio.com/items?itemName=TypeScriptTeam.AngularLanguageService\">“扩展程序：市场”</a>中安装扩展程序。可以从编辑器中打开市场，在顶部菜单窗格中选择“扩展”，然后选择“管理扩展”。在市场上，搜索 Angular Language Service extension，然后单击<strong>“安装”</strong>按钮。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"7qjmafc7x5exr6huxdhg50yiw\">Microsoft 在 Angular 团队的帮助下维护和发布了 Visual Studio 与 Angular 语言服务的集成。<a href=\"https://github.com/microsoft/vs-ng-language-service\">在这里</a>查看项目。</p>\n<h3 id=\"webstorm\">WebStorm<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/language-service#webstorm\"><i class=\"material-icons\">link</i></a></h3>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"3n5t9g6ruy3urawup2t3blhk8\">在 <a href=\"https://www.jetbrains.com/webstorm\">WebStorm</a> 中，启用 <a href=\"https://plugins.jetbrains.com/plugin/6971-angular-and-angularjs\">Angular 与 AngularJS</a> 插件。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"4kmwrgl42lkbb0r4lwvg748k3\">从 WebStorm 2019.1 开始，<code>@angular/language-service</code> 已经不再需要了，应该从你的 <code>package.json</code> 中移除。</p>\n<h3 id=\"sublime-text\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"3e2o1wsmuybxgc5urmh2zuq5q\">Sublime Text<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/language-service#sublime-text\"><i class=\"material-icons\">link</i></a></h3>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"ee7jk29advl6jt0fcjs6gepzf\">在 <a href=\"https://www.sublimetext.com\">Sublime Text</a> 中，当安装为插件时，语言服务仅支持内联模板。你需要自定义 Sublime 插件（或修改当前插件），来实现 HTML 文件中的自动补齐。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"1t2kzz41zw0v1l8v21tqaqpnb\">要想在内联模板中使用语言服务，你必须首先添加一个扩展，以支持 TypeScript，然后安装 Angular 语言服务插件。从 TypeScript 2.3 开始，TypeScript 提供了一个插件模型，供语言服务使用。</p>\n<ol>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"cg7uupfbo76qv1s638mxyyobb\">把最新版本的 TypeScript 安装到本地的 <code>node_modules</code> 目录下：</p>\n<code-example format=\"shell\" language=\"shell\">\n\nnpm install --save-dev typescript\n\n</code-example>\n</li>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"qph8o4snyx1czw6jdcmjyah0\">把 Angular 语言服务的包安装到同一位置：</p>\n<code-example format=\"shell\" language=\"shell\">\n\nnpm install --save-dev @angular/language-service\n\n</code-example>\n</li>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"aq6ymh80hxl2eejiygrjj8858\">安装好这个包后，将以下内容添加到项目的 <code>tsconfig.json</code> 的 <code>\"compilerOptions\"</code> 部分。</p>\n<code-example header=\"tsconfig.json\" language=\"json\">\n\n\"plugins\": [\n    {\"name\": \"@angular/language-service\"}\n]\n\n</code-example>\n</li>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"bk630yukm7i0060w49p52090e\">在编辑器的用户首选项（<code>Cmd+,</code> 或 <code>Ctrl+,</code>）中，添加以下内容：</p>\n<code-example header=\"Sublime Text user preferences\" language=\"json\">\n\n\"typescript-tsdk\": \"&lt;path to your folder&gt;/node_modules/typescript/lib\"\n\n</code-example>\n</li>\n</ol>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"31yt6oo7jin795v263388i0lr\">这样就能让 Angular 语言服务提供 <code>.ts</code> 文件中的诊断与自动补全信息。</p>\n<h3 id=\"eclipse-ide\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"diw85b1lkslv275rzf3qkmnyb\">Eclipse IDE<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/language-service#eclipse-ide\"><i class=\"material-icons\">link</i></a></h3>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"edpzxp72aiyci79d41cg578xa\">你或者直接安装包含了 Angular Language Server 的 “Eclipse IDE for Web and JavaScript developers” 软件包，或者直接从其他 Eclipse IDE 软件包中安装，使用“Help” &gt; “Eclipse Marketplace” 来查找并安装 <a href=\"https://marketplace.eclipse.org/content/wild-web-developer-html-css-javascript-typescript-nodejs-angular-json-yaml-kubernetes-xml\">Eclipse Wild Web Developer</a>。</p>\n<h3 id=\"neovim\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"cjlldz5z4jvvr9b220k6hng6o\">Neovim<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/language-service#neovim\"><i class=\"material-icons\">link</i></a></h3>\n<ol>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"2zpgwqocj6x7w65x4nn5dwm2b\"><a href=\"https://github.com/neoclide/coc.nvim\">设置 coc.nvim</a></p>\n</li>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"36yvebm0a90bexgagbjmtma36\"><a href=\"https://github.com/iamcco/coc-angular/issues/70#issuecomment-1616340751\">配置 Angular 语言服务</a></p>\n</li>\n</ol>\n<code-example>\n{\n  \"languageserver\": {\n    \"angular\": {\n      \"command\": \"ngserver\",\n      \"args\": [\n        \"--stdio\",\n        \"--tsProbeLocations\",\n        \"/usr/local/lib/node_modules/typescript/lib\",\n        \"--ngProbeLocations\",\n        \"/usr/local/lib/node_modules/@angular/language-server/bin\"\n      ],\n      \"filetypes\": [\"ts\", \"typescript\", \"html\"],\n      \"trace.server.verbosity\": \"verbose\"\n    }\n  }\n}\n</code-example>\n<h2 id=\"how-the-language-service-works\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"dfr7wxgbd47jyqbbvcnayntf6\">语言服务的工作原理<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/language-service#how-the-language-service-works\"><i class=\"material-icons\">link</i></a></h2>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"42ce3c688z0zwmskrwnp614xp\">当你将编辑器与语言服务一起使用时，该编辑器将启动一个单独的语言服务进程，并使用<a href=\"https://microsoft.github.io/language-server-protocol\">语言服务协议</a>通过 <a href=\"https://en.wikipedia.org/wiki/Remote_procedure_call\">RPC</a> 与之通信。当你输入编辑器时，编辑器会将信息发送到语言服务流程，以跟踪你的项目状态。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"eggi44okc00vl1mleydgh8y95\">当你触发模板中的完成列表时，编辑器首先将模板解析为 HTML <a href=\"https://en.wikipedia.org/wiki/Abstract_syntax_tree\">抽象语法树（AST）</a>。Angular 编译器解释这棵树以确定上下文：模板属于哪个模块，当前作用域，组件选择器以及光标在模板 AST 中的位置。然后，它就可以确定可能位于该位置的符号。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"evbk1rrj40m3v3h0iigbdzh98\">如果你要进行插值，则需要更多的精力。如果你在 <code>div</code> 有 <code>{{data.---}}</code> 的插值，并且在 <code>data.---</code> 之后需要自动补全列表，则编译器无法使用 HTML AST 查找答案。HTML AST 只能告诉编译器某些文本带有字符 “<code>{{data.---}}</code>”。那时模板解析器会生成一个表达式 AST，该表达式位于模板 AST 中。然后，Angular 语言服务会在其上下文中查找 <code>data.---</code>，询问 TypeScript 语言服务 <code>data</code> 的成员是什么，并返回可能性列表。</p>\n<h2 id=\"more-information\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"a4i4l0z1p0mxth3he9lk6m2op\">更多信息<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/language-service#more-information\"><i class=\"material-icons\">link</i></a></h2>\n<ul>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"9rvrneu0ht3y0f2cpsvo7rcin\">关于该实现的更多详细信息，请参阅 <a href=\"https://github.com/angular/angular/blob/main/packages/language-service/src/types.ts\">Angular 语言服务 API</a>。</li>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"4dq0m900dbtmohnbceurxqrwm\">关于此设计注意事项和意图的更多信息，请参阅<a href=\"https://github.com/angular/vscode-ng-language-service/wiki/Design\">此处的设计文档</a></li>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"7jyya9dv0i2xus7ucw4ku6l65\">另请参阅 <a href=\"https://www.ng-conf.org\">ng-conf</a> 2017 上 Chuck Jazdzewski 关于 Angular 语言服务的 <a href=\"https://www.youtube.com/watch?v=ez3R0Gi4z5A&amp;t=368s\">演讲</a></li>\n</ul>\n<!-- links -->\n<!-- external links -->\n<!-- end links -->\n\n  <div class=\"reviewed\">最后复查时间：Mon Feb 28 2022</div>\n</div>\n\n\n<!-- links to this doc:\n-->\n<!-- links from this doc:\n - guide/angular-compiler-options\n - guide/language-service#angular-language-service\n - guide/language-service#angular-language-service-in-your-editor\n - guide/language-service#autocompletion\n - guide/language-service#configuring-compiler-options-for-the-angular-language-service\n - guide/language-service#eclipse-ide\n - guide/language-service#error-checking\n - guide/language-service#features\n - guide/language-service#how-the-language-service-works\n - guide/language-service#more-information\n - guide/language-service#neovim\n - guide/language-service#quick-info-and-navigation\n - guide/language-service#sublime-text\n - guide/language-service#visual-studio\n - guide/language-service#visual-studio-code\n - guide/language-service#webstorm\n - https://code.visualstudio.com\n - https://en.wikipedia.org/wiki/Abstract_syntax_tree\n - https://en.wikipedia.org/wiki/Remote_procedure_call\n - https://github.com/angular/angular/blob/main/packages/language-service/src/types.ts\n - https://github.com/angular/vscode-ng-language-service/wiki/Design\n - https://github.com/iamcco/coc-angular/issues/70#issuecomment-1616340751\n - https://github.com/microsoft/vs-ng-language-service\n - https://github.com/neoclide/coc.nvim\n - https://marketplace.eclipse.org/content/wild-web-developer-html-css-javascript-typescript-nodejs-angular-json-yaml-kubernetes-xml\n - https://marketplace.visualstudio.com/items?itemName=Angular.ng-template\n - https://marketplace.visualstudio.com/items?itemName=TypeScriptTeam.AngularLanguageService\n - https://microsoft.github.io/language-server-protocol\n - https://plugins.jetbrains.com/plugin/6971-angular-and-angularjs\n - https://visualstudio.microsoft.com\n - https://www.eclipse.org/eclipseide\n - https://www.jetbrains.com/webstorm\n - https://www.ng-conf.org\n - https://www.sublimetext.com\n - https://www.youtube.com/watch?v=ez3R0Gi4z5A&t=368s\n-->"}