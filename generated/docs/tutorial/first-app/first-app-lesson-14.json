{"id":"tutorial/first-app/first-app-lesson-14","title":"第14課：嚮應用新增 HTTP 通訊","contents":"<div class=\"content\">\n  <h1 id=\"lesson-14-add-http-communication-to-your-app\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"5ee9auekvi1gd6j24kh2zuibr\">第14課：嚮應用新增 HTTP 通訊<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"tutorial/first-app/first-app-lesson-14#lesson-14-add-http-communication-to-your-app\"><i class=\"material-icons\">link</i></a></h1>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"1zu0r1j9brhncg2jsuv3fw2z2\">本教程示範如何將 HTTP 和 API 整合到應用程式中。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"c5rnwwioukzmjpg48glhjzr83\">到目前為止，應用程式都在從 Angular 服務中的靜態陣列讀取資料。下一步是讓應用程式透過 HTTP 與 JSON 伺服器通訊。HTTP 請求將會模擬處理來自伺服器的資料的體驗。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"7yrs6yvmlabo3pu7w8cj5do0j\"><strong>預計時間</strong>：約15分鐘</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"1zwe6zuh9gf7zmfin6bgujbhg\"><strong>起始程式碼：</strong> \n<live-example name=\"first-app-lesson-13\"></live-example></p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"86dyd1lhtdpn90hshiwdtsxq9\"><strong>完成程式碼：</strong> \n<live-example name=\"first-app-lesson-14\"></live-example></p>\n<h2 id=\"what-youll-learn\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"cy8qhuh22qozu5okjmjfdf3nx\">你將學到<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"tutorial/first-app/first-app-lesson-14#what-youll-learn\"><i class=\"material-icons\">link</i></a></h2>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"443kwq9gq631pznbo37xy0f9p\">應用程式將使用來自 JSON 伺服器的資料</p>\n<h2 id=\"step-1---configure-the-json-server\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"78kbyfactynzahp9nb3vyoor0\">第 1 步 - 設定 JSON 伺服器<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"tutorial/first-app/first-app-lesson-14#step-1---configure-the-json-server\"><i class=\"material-icons\">link</i></a></h2>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"18blsp3zwdre73iumrcg696k7\">JSON Server 是一種用於建立模擬 REST API 的開源工具。你將使用它來提供當前儲存在房屋服務中的房屋位置資料。</p>\n<ol>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"6h7rr80zdf6jj4ithpjxkl93r\">透過以下指令從 npm 安裝\n<code>json-server</code>。 \n<code-example language=\"bash\" format=\"bash\">\n  npm install -g json-server \n</code-example></p>\n</li>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"dly0kbc67ixrh0ojxrvmma887\">在專案的根目錄中，建立一個名為 <code>db.json</code> 的檔案。這是你將儲存 <code>json-server</code> 資料的地方。</p>\n</li>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"5z2mvx7d9kaztxsw7awm75xp3\">開啟\n<code>db.json</code>，將以下程式碼複製到檔案中 \n<code-example language=\"json\" format=\"json\">\n  { \"locations\": [ { \"id\": 0, \"name\": \"Acme Fresh Start Housing\", \"city\": \"Chicago\", \"state\": \"IL\", \"photo\": \"https://angular.io/assets/images/tutorials/faa/bernard-hermant-CLKGGwIBTaY-unsplash.jpg\", \"availableUnits\": 4, \"wifi\": true, \"laundry\": true }, { \"id\": 1, \"name\": \"A113 Transitional Housing\", \"city\": \"Santa Monica\", \"state\": \"CA\", \"photo\": \"https://angular.io/assets/images/tutorials/faa/brandon-griggs-wR11KBaB86U-unsplash.jpg\", \"availableUnits\": 0, \"wifi\": false, \"laundry\": true }, { \"id\": 2, \"name\": \"Warm Beds Housing Support\", \"city\": \"Juneau\", \"state\": \"AK\", \"photo\": \"https://angular.io/assets/images/tutorials/faa/i-do-nothing-but-love-lAyXdl1-Wmc-unsplash.jpg\", \"availableUnits\": 1, \"wifi\": false, \"laundry\": false }, { \"id\": 3, \"name\": \"Homesteady Housing\", \"city\": \"Chicago\", \"state\": \"IL\", \"photo\": \"https://angular.io/assets/images/tutorials/faa/ian-macdonald-W8z6aiwfi1E-unsplash.jpg\", \"availableUnits\": 1, \"wifi\": true, \"laundry\": false }, { \"id\": 4, \"name\": \"Happy Homes Group\", \"city\": \"Gary\", \"state\": \"IN\", \"photo\": \"https://angular.io/assets/images/tutorials/faa/krzysztof-hepner-978RAXoXnH4-unsplash.jpg\", \"availableUnits\": 1, \"wifi\": true, \"laundry\": false }, { \"id\": 5, \"name\": \"Hopeful Apartment Group\", \"city\": \"Oakland\", \"state\": \"CA\", \"photo\": \"https://angular.io/assets/images/tutorials/faa/r-architecture-JvQ0Q5IkeMM-unsplash.jpg\", \"availableUnits\": 2, \"wifi\": true, \"laundry\": true }, { \"id\": 6, \"name\": \"Seriously Safe Towns\", \"city\": \"Oakland\", \"state\": \"CA\", \"photo\": \"https://angular.io/assets/images/tutorials/faa/phil-hearing-IYfp2Ixe9nM-unsplash.jpg\", \"availableUnits\": 5, \"wifi\": true, \"laundry\": true }, { \"id\": 7, \"name\": \"Hopeful Housing Solutions\", \"city\": \"Oakland\", \"state\": \"CA\", \"photo\": \"https://angular.io/assets/images/tutorials/faa/r-architecture-GGupkreKwxA-unsplash.jpg\", \"availableUnits\": 2, \"wifi\": true, \"laundry\": true }, { \"id\": 8, \"name\": \"Seriously Safe Towns\", \"city\": \"Oakland\", \"state\": \"CA\", \"photo\": \"https://angular.io/assets/images/tutorials/faa/saru-robert-9rP3mxf8qWI-unsplash.jpg\", \"availableUnits\": 10, \"wifi\": false, \"laundry\": false }, { \"id\": 9, \"name\": \"Capital Safe Towns\", \"city\": \"Portland\", \"state\": \"OR\", \"photo\": \"https://angular.io/assets/images/tutorials/faa/webaliser-_TPTXZd9mOo-unsplash.jpg\", \"availableUnits\": 6, \"wifi\": true, \"laundry\": true } ] } \n</code-example></p>\n</li>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"5o4m0mbz6xkgc4k6pb8lpnltc\">儲存此檔案。</p>\n</li>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"13w1nos2v5r29ex8ipneaoo4o\">是時候測試你的設定了。開啟指令行視窗，在專案的根目錄下執行以下指令。</p>\n<code-example language=\"bash\" format=\"bash\">\n    json-server --watch db.json\n</code-example>\n</li>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"c9mqw6abb6d0fz3iupadiqcbw\">在你的 Web 瀏覽器中，導向到 <code>http://localhost:3000/locations</code> 並確認回應裡包括儲存在 <code>db.json</code> 中的資料。</p>\n</li>\n</ol>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"5c18qh2qp67g60d9jrwpphn4t\">如果你的設定有任何問題，可以在<a href=\"https://www.npmjs.com/package/json-server\">官方文件</a>中找到更多詳細訊息。</p>\n<h2 id=\"step-2---update-service-to-use-web-server-instead-of-local-array\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"sasegbo39v9euoo8wa1ie60x\">第 2 步 - 更新服務以使用 Web 伺服器而非本地陣列<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"tutorial/first-app/first-app-lesson-14#step-2---update-service-to-use-web-server-instead-of-local-array\"><i class=\"material-icons\">link</i></a></h2>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"ltyz4v4gh1bisx0jzdvutt8l\">資料來源已設定，下一步是更新你的 Web 應用程式以連線到它來使用資料。</p>\n<ol>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"7m3bzlxqw7t2vdvshccln5862\">在 <code>src/app/housing.service.ts</code> 中，進行以下更改：</p>\n<ol>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"a65zpqwlbxdlwegwo2q0u5x4m\">更新程式碼以刪除 <code>housingLocationList</code> 屬性和包含資料的陣列。</p>\n</li>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"68y2615xl4871320zcsyh8b51\">新增一個名為\n<code>url</code>的字串屬性，並將其值設定為\n<code>'http://localhost:3000/locations'</code></p>\n<code-example language=\"javascript\" format=\"javascript\">\nurl = 'http://localhost:3000/locations';\n</code-example>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"5hgnpj2w13wdpugodony0lm2c\">此程式碼將導致檔案其餘部分出錯，因為它依賴 <code>housingLocationList</code> 屬性。接下來我們將更新服務方法。</p>\n</li>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"5xbi06qrxkjtbfwcltme1g19b\">更新 <code>getAllHousingLocations</code> 函式以呼叫你設定好的 Web 伺服器。</p>\n<code-example header=\"\" path=\"first-app-lesson-14/src/app/housing.service.ts\" region=\"update-getAllHousingLocations\">\n<a href=\"api/platform-browser/animations/async\" class=\"code-anchor\">async</a> getAllHousingLocations(): Promise&lt;HousingLocation[]&gt; {\n  const data = await fetch(this.url);\n  return await data.json() ?? [];\n}\n\n</code-example>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"mifc2tifk745krrhfo1qrjao\">程式碼現在使用非同步程式碼透過 HTTP 傳送 \n<strong>GET</strong> 請求。</p>\n<div class=\"callout is-helpful\">\nFor this example, the code uses `fetch`. For more advanced use cases consider using `HttpClient` provided by Angular.\n</div>\n</li>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"20nfd75ywz4ryesvuwu0gdu7i\">更新 <code>getHousingLocationsById</code> 函式以呼叫你設定好的 Web 伺服器。</p>\n<code-example header=\"\" path=\"first-app-lesson-14/src/app/housing.service.ts\" region=\"update-getHousingLocationById\">\n<a href=\"api/platform-browser/animations/async\" class=\"code-anchor\">async</a> getHousingLocationById(id: number): Promise&lt;HousingLocation | undefined&gt; {\n  const data = await fetch(`${this.url}/${id}`);\n  return await data.json() ?? {};\n}\n\n</code-example>\n</li>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"df8kv4mysw9gnfz1qqodehacc\">一旦所有更新完成，你的更新後的服務應該與以下程式碼對應。</p>\n<code-example header=\"Final version of housing.service.ts\" path=\"first-app-lesson-14/src/app/housing.service.ts\">\nimport { <a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a> } from '@angular/core';\nimport { HousingLocation } from './housinglocation';\n\n@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>({\n  providedIn: 'root'\n})\nexport class HousingService {\n\n  url = 'http://localhost:3000/locations';\n\n  <a href=\"api/platform-browser/animations/async\" class=\"code-anchor\">async</a> getAllHousingLocations(): Promise&lt;HousingLocation[]&gt; {\n    const data = await fetch(this.url);\n    return await data.json() ?? [];\n  }\n\n  <a href=\"api/platform-browser/animations/async\" class=\"code-anchor\">async</a> getHousingLocationById(id: number): Promise&lt;HousingLocation | undefined&gt; {\n    const data = await fetch(`${this.url}/${id}`);\n    return await data.json() ?? {};\n  }\n\n  submitApplication(firstName: string, lastName: string, <a href=\"api/forms/EmailValidator\" class=\"code-anchor\">email</a>: string) {\n    console.log(firstName, lastName, <a href=\"api/forms/EmailValidator\" class=\"code-anchor\">email</a>);\n  }\n}\n\n\n</code-example>\n</li>\n</ol>\n</li>\n</ol>\n<h2 id=\"step-3---update-the-components-to-use-asynchronous-calls-to-the-housing-service\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"4nz40owpn0m1r0y8ioonjv4a\">第 3 步 - 更新元件以使用非同步方式呼叫房屋服務<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"tutorial/first-app/first-app-lesson-14#step-3---update-the-components-to-use-asynchronous-calls-to-the-housing-service\"><i class=\"material-icons\">link</i></a></h2>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"2pwhrelh8w7zmowwnjiiaknbn\">伺服器現在正在從 HTTP 請求中讀取資料，但依賴於該服務的元件現在出現錯誤，因為它們被程式設計為使用該服務的同步版本。</p>\n<ol>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"570ii2ap5px1xcb3xdy6q3uwz\">在 \n<code>src/app/home/home.component.ts</code> 中，更新 \n<code>constructor</code> 使用新的 \n<code>getAllHousingLocations</code> 方法的非同步版本。</p>\n<code-example header=\"\" path=\"first-app-lesson-14/src/app/home/home.component.ts\" region=\"update-home-component-constructor\">\nconstructor() {\n  this.housingService.getAllHousingLocations().then((housingLocationList: HousingLocation[]) =&gt; {\n    this.housingLocationList = housingLocationList;\n    this.filteredLocationList = housingLocationList;\n  });\n}\n\n</code-example>\n</li>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"3ckkx0krtwhv3ooeys3nsnplv\">在 \n<code>src/app/details/details.component.ts</code> 中，更新 \n<code>constructor</code> 使用新的 \n<code>getHousingLocationById</code> 方法的非同步版本。</p>\n<code-example header=\"\" path=\"first-app-lesson-14/src/app/details/details.component.ts\" region=\"update-details-component-constructor\">\nconstructor() {\n  const housingLocationId = parseInt(this.route.snapshot.params['id'], 10);\n  this.housingService.getHousingLocationById(housingLocationId).then(housingLocation =&gt; {\n    this.housingLocation = housingLocation;\n  });\n}\n\n</code-example>\n</li>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"d9bvruz5d6s4tuafhg77ynow5\">儲存你的程式碼。</p>\n</li>\n<li>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"2ivt98pn4yu9uy8aydeoomd2s\">在瀏覽器中開啟應用程式並確認它執行沒有任何錯誤。</p>\n</li>\n</ol>\n<h2 id=\"lesson-review\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"ckmo8mg671uh3oxv2z72tuj64\">課程回顧<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"tutorial/first-app/first-app-lesson-14#lesson-review\"><i class=\"material-icons\">link</i></a></h2>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"d5ud8w00ppczgc6czqimjxyvo\">在這節課中，你將應用更新為：</p>\n<ul>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"alhqhlbpnru90kvgst5qbtr7o\">使用本地網路伺服器（<code>json-server</code>）</li>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"1uo5b7mc0p2kd2qqsxqieaffy\">使用非同步服務方法來檢索資料。</li>\n</ul>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"bid4loxb5z390uy1k9t701z43\">恭喜！你已成功完成本教程，並已準備好繼續建立更復雜的 Angular 應用程式。如果你想了解更多訊息，請考慮完成 Angular 的一些其他開發者<a href=\"tutorial\">教程</a>和<a href=\"/guide/developer-guide-overview\">指南</a>。</p>\n\n  <div class=\"reviewed\">最後複查時間：Wed Jul 12 2023</div>\n</div>\n\n\n<!-- links to this doc:\n - tutorial/first-app/first-app-lesson-13\n-->\n<!-- links from this doc:\n - /guide/developer-guide-overview\n - api/core/Injectable\n - api/forms/EmailValidator\n - api/platform-browser/animations/async\n - tutorial\n - tutorial/first-app/first-app-lesson-14#lesson-14-add-http-communication-to-your-app\n - tutorial/first-app/first-app-lesson-14#lesson-review\n - tutorial/first-app/first-app-lesson-14#step-1---configure-the-json-server\n - tutorial/first-app/first-app-lesson-14#step-2---update-service-to-use-web-server-instead-of-local-array\n - tutorial/first-app/first-app-lesson-14#step-3---update-the-components-to-use-asynchronous-calls-to-the-housing-service\n - tutorial/first-app/first-app-lesson-14#what-youll-learn\n - https://www.npmjs.com/package/json-server\n-->"}