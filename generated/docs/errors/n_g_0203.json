{"id":"errors/NG0203","title":"NG0203: `inject()` 必须从注入上下文中调用，比如构造函数、工厂函数、字段初始化程序，或者与 `runInInjectionContext` 一起使用的函数。","contents":"<div class=\"content\">\n\n  <h1 id=\"ng0203-inject-must-be-called-from-an-injection-context-such-as-a-constructor-a-factory-function-a-field-initializer-or-a-function-used-with-runininjectioncontext\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"6l6v2fwg67etzya1koyewc8ni\">NG0203: `inject()` 必须从注入上下文中调用，比如构造函数、工厂函数、字段初始化程序，或者与 `runInInjectionContext` 一起使用的函数。<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"errors/NG0203#ng0203-inject-must-be-called-from-an-injection-context-such-as-a-constructor-a-factory-function-a-field-initializer-or-a-function-used-with-runininjectioncontext\"><i class=\"material-icons\">link</i></a></h1>\n\n  \n  \n\n  <div class=\"error-description\">\n    <h2 id=\"description\">说明<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"errors/NG0203#description\"><i class=\"material-icons\">link</i></a></h2>\n    <p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"5c9yrf0f3gklhzvafdruvrdu9\">当您尝试在允许的注入上下文之外使用 \n<a href=\"api/core/inject\"><code>inject</code></a> 函数时，会看到此错误。注入上下文在类创建和初始化期间可用。它也适用于使用 \n<code><a href=\"api/core/runInInjectionContext\" class=\"code-anchor\">runInInjectionContext</a></code> 的函数。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"by6a13yi22q6k4deqt2y50qvf\">在实践中，构造函数、构造函数参数和字段初始化器中允许进行 <code>inject()</code> 调用：</p>\n<code-example language=\"typescript\">\n@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>({providedIn: 'root'})\nexport class Car {\n  radio: Radio|undefined;\n\n  // OK: field initializer\n  spareTyre = inject(Tyre);\n  \n  constructor() {\n    // OK: constructor body\n    this.radio = inject(Radio);\n  }\n}\n</code-example>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"3cd39muwt2cnai3lrw26l1jw9\">从提供者的工厂中调用 \n<a href=\"api/core/inject\"><code>inject</code></a> 也是合法的：</p>\n<code-example language=\"typescript\">\nproviders: [\n  {provide: Car, useFactory: () =&gt; {\n    // OK: a class factory\n    const engine = inject(Engine);\n    return new Car(engine);\n  }}\n]\n</code-example>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"b39hran17wzc9nl1q0wukuxqq\">在类创建或 \n<code><a href=\"api/core/runInInjectionContext\" class=\"code-anchor\">runInInjectionContext</a></code> 之外调用 \n<a href=\"api/core/inject\"><code>inject</code></a> 函数将导致错误。特别是，在创建类实例后，在方法中（包括生命周期钩子）禁止调用 \n<code>inject()</code>：</p>\n<code-example language=\"typescript\">\n@<a href=\"api/core/Component\" class=\"code-anchor\">Component</a>({ ... })\nexport class CarComponent {\n  ngOnInit() {\n    // ERROR: too late, the component instance was already created\n    const engine = inject(Engine);\n    engine.start();\n  }\n}\n</code-example>\n\n  </div>\n\n\n  \n  <br>\n\n  <div class=\"debugging\">\n    <h2 id=\"debugging-the-error\">如何排除本错误<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"errors/NG0203#debugging-the-error\"><i class=\"material-icons\">link</i></a></h2>\n    <p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"cbcbfcbh5qq3mut4m29agv4la\">从错误堆栈跟踪中向后找，以识别出不允许的 <code>inject()</code> 调用所在的位置。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"9psd08f917851urt3ntxgjnop\">要修复错误，请将 \n<a href=\"api/core/inject\"><code>inject</code></a> 调用移到允许的位置（通常是类构造函数或字段初始化程序）。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"doferno27o6vt1y2yj7yp6ofx\"><strong>注意：</strong>如果在测试上下文中运行，则 \n<code>TestBed.runInInjectionContext</code> 将使 \n<code>inject()</code> 可以成功。</p>\n<code-example language=\"typescript\">\nTestBed.runInInjectionContext(() =&gt; {\n   // ...\n});\n</code-example>\n<!-- links -->\n<!-- external links -->\n<!-- end links -->\n\n  </div>\n  \n</div>\n\n<!-- links to this doc:\n - errors\n-->\n<!-- links from this doc:\n - api/core/Component\n - api/core/Injectable\n - api/core/inject\n - api/core/runInInjectionContext\n - errors/NG0203#debugging-the-error\n - errors/NG0203#description\n - errors/NG0203#ng0203-inject-must-be-called-from-an-injection-context-such-as-a-constructor-a-factory-function-a-field-initializer-or-a-function-used-with-runininjectioncontext\n - guide/dependency-injection-context\n-->"}